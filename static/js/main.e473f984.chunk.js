(this["webpackJsonpdrawing-sample"]=this["webpackJsonpdrawing-sample"]||[]).push([[0],{123:function(e,t,n){"use strict";n.r(t);var r,c,a,i,o,s=n(0),l=n.n(s),u=n(30),b=n.n(u),j=n(96),d=n(184),f=n(174),O=n(5),v=n(55),x=n.n(v),p=new x.a(1,0),h=new x.a(0,1),g=function(e,t,n){if(n>=1)return t;if(n<=0)return e;var r=t.clone().subtract(e).normalize(),c=e.distance(t),a=r.multiplyScalar(c*n);return e.clone().add(a)},m=function(e,t){var n=t.clone().subtract(e).normalize(),r=new x.a(n.y,-1*n.x).normalize();return h.dot(r)>0&&r.invert(),r},y=function(e){return JSON.parse(JSON.stringify(e))},C=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=Math.pow(10,t),r=Math.round(e*n)/n;return r},w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,n=e/t,r=Math.round(n)*t;return r},k=function(e){var t=Object(O.a)(e,2),n=t[0],r=t[1],c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25;return[w(n,c),w(r,c)]},S=n(4),E=n(180),P=function(e,t){return{id:Object(E.a)(),x:e,y:t}},I=["free","pin","pinX","pinZ","fixX","fix"],z={unit:{force:"kN",length:"m"},nodes:[],beams:[],forces:[],trapezoids:[]},M=["select","edit"],N={A3:{width:0,height:0},A4:{width:2970,height:2100},B4:{width:0,height:0},B5:{width:0,height:0}},R={width:160,height:90},T={stroke:"#000000",strokeWidth:4,eraser:!1,lineJoin:"round",lineCap:"round"},D={size:"A4",drawings:[],structures:[Object(S.a)({data:z,x:100,y:100},R)]},_=n(1),W=Object(s.createContext)(void 0),B=function(e){var t=e.children,n=Object(s.useState)("note"),r=Object(O.a)(n,2),c=r[0],a=r[1],i=Object(s.useState)(D),o=Object(O.a)(i,2),l=o[0],u=o[1],b=Object(s.useState)(),j=Object(O.a)(b,2),d=j[0],f=j[1],v=Object(s.useState)(),x=Object(O.a)(v,2),p=x[0],h=x[1],g=Object(s.useRef)(null),m=Object(s.useCallback)((function(e){a("canvas"),h(e)}),[]),C=Object(s.useCallback)((function(){if(g.current){var e=g.current.getStructure(),t=g.current.toDataURL();"number"===typeof d&&u((function(n){var r=y(n);return r.structures[d].data=e,r.structures[d].image=t,r}))}a("note"),h(void 0)}),[d]);return Object(_.jsx)(W.Provider,{value:{mode:c,onChangeMode:a,page:l,onChange:u,selectedCanvasIndex:d,onSelectCanvas:f,canvasProps:p,editCanvas:m,closeCanvas:C,canvasRef:g},children:t})},F=Object(s.createContext)(void 0),J=function(e){var t=e.children,n=Object(s.useState)("select"),r=Object(O.a)(n,2),c=r[0],a=r[1];return Object(_.jsx)(F.Provider,{value:{tool:c,setTool:a},children:t})},X=Object(s.createContext)(void 0),A=function(e){var t=e.children,n=Object(s.useState)("select"),r=Object(O.a)(n,2),c=r[0],a=r[1],i=Object(s.useState)(T),o=Object(O.a)(i,2),l=o[0],u=o[1];return Object(_.jsx)(X.Provider,{value:{mode:c,settings:l,onChangeMode:a,onChangeDrawSettings:u},children:t})},G=n(192),L=n(186),Y=n(188),U=n(185),Z=null!==(r=null===(c="f45704606192ede3567b935e5f0f4a1e5591fc00\n")?void 0:c.substring(0,7))&&void 0!==r?r:"",V=null!==(a="2022/01/08 17:50:31")?a:"",H=null!==(i="0.1.0")?i:"",q=function(){return Object(_.jsx)(U.a,{variant:"caption",sx:{ml:2},children:"ver ".concat(H," (").concat(Z,": ").concat(V,")")})},K=function(){return Object(_.jsx)(L.a,{position:"static",children:Object(_.jsxs)(Y.a,{variant:"dense",children:[Object(_.jsx)(U.a,{component:"h1",variant:"h6",color:"inherit",children:"Drawing Sample"}),Object(_.jsx)(q,{})]})})},Q=n(22),$=n(18),ee=n(19),te=["select","pen","force","trapezoid","delete"],ne=Object(s.createContext)(void 0),re=function(e){var t=e.value,n=t.tool,r=t.readonly,c=t.points,a=t.setPoints,i=t.structure,o=t.setStructure,l=e.children,u=Object(s.useRef)(),b=Object(s.useRef)(),j=Object(s.useMemo)((function(){return!(!r&&"undefined"!==typeof o)||!("pen"===n||"trapezoid"===n)}),[r,o,n]),d=Object(s.useCallback)((function(e){var t;if(!j){if("trapezoid"===n){if("beam"!==e.target.attrs.type)return;var r=e.target.attrs.id,c=e.target.attrs.points;i=c,Array.isArray(i)&&(0===i.length||i.every((function(e){return"number"===typeof e})))&&"string"===typeof r&&(b.current={id:r,points:c})}var i,o=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();o&&(u.current=!0,a([o.x,o.y]))}}),[j,a,n]),f=Object(s.useCallback)((function(e){var t;if(!j&&u.current){var n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&a((function(e){return[].concat(Object(ee.a)(e),[n.x,n.y])}))}}),[j,a]),O=Object(s.useCallback)((function(e,t){if(o){var n=k([e[0],e[1]],25),r=k([t[0],t[1]],25);o((function(e){var t=y(e),c=P.apply(void 0,Object(ee.a)(n)),a=t.nodes.find((function(e){return e.x===c.x&&e.y===c.y}));a?c.id=a.id:t.nodes.push(c);var i=P.apply(void 0,Object(ee.a)(r)),o=t.nodes.find((function(e){return e.x===i.x&&e.y===i.y}));o?i.id=o.id:t.nodes.push(i);var s=function(e,t,n){return{id:Object(E.a)(),name:e,nodeI:t,nodeJ:n}}("Beam_".concat(t.beams.length+1),c.id,i.id);return t.beams.push(s),t}))}}),[o]),v=Object(s.useCallback)((function(e,t,n){if(o){var r=function(e,t,n,r){var c=r.slice(0,2),a=r.slice(-2),i=new x.a(c[0],c[1]),o=new x.a(a[0],a[1]),s=i.distance(o),l=o.clone().subtract(i).normalize(),u=new x.a(e[0],e[1]),b=new x.a(t[0],t[1]),j=i.distance(u),d=i.distance(b);if(j>d){var f=[b,u];u=f[0],b=f[1];var O=[d,j];j=O[0],d=O[1]}var v=i.clone().add(l.clone().multiplyScalar(j)),p=b.clone().subtract(v).normalize(),h=l.angle()-p.angle(),g=v.distance(b)*Math.cos(h),m=v.clone().add(l.clone().multiplyScalar(g));d=o.distance(m);var y=C(j/s,3),w=C(d/s,3);return{id:Object(E.a)(),name:"Trapezoid_N",beam:n,forceI:10,forceJ:10,distanceI:y,distanceJ:w,angle:90,isGlobal:!1}}(e,t,n.id,n.points);o((function(e){var t=y(e),n="Trapezoid_".concat(t.trapezoids.length+1);return r.name=n,t.trapezoids.push(r),t}))}}),[o]),p=Object(s.useCallback)((function(e){if(!j&&u.current&&(u.current=!1,c.length>=4)){var t=c.slice(0,2),r=c.slice(-2);"pen"===n?O(t,r):"trapezoid"===n&&b.current&&v(t,r,b.current),a([]),b.current=void 0}}),[j,O,v,c,a,n]);return Object(_.jsx)(ne.Provider,{value:{tool:n,readonly:r,points:c,setPoints:a,structure:i,setStructure:o,onPointerDown:d,onPointerMove:f,onPointerUp:p},children:l})},ce=function(e){var t=e.tool,n=e.points,r=Object(s.useMemo)((function(){switch(t){case"pen":return"blue";case"trapezoid":return"red";default:return"black"}}),[t]);return Object(_.jsx)($.e,{children:Object(_.jsx)($.f,{points:n,strokeWidth:3,stroke:r})})},ae=function(){var e=Object(s.useContext)(ne),t=e.tool,n=e.points;return Object(_.jsx)(ce,{tool:t,points:n})},ie=Object(s.createContext)(void 0),oe=function(e){var t=e.children,n=e.tool,r=void 0===n?"select":n,c=e.size,a=e.gridSize,i=void 0===a?25:a,o=e.snapSize,l=void 0===o?25:o,u=e.structure,b=e.setStructure,j=Object(s.useCallback)((function(e){var t=y(u),n="Force_".concat(t.forces.length+1),r=function(e){return Object(S.a)(Object(S.a)({},e),{},{id:Object(E.a)()})}(Object(S.a)({name:n},e));t.forces.push(r),b&&b(t)}),[b,u]),d=Object(s.useCallback)((function(e){var t=u.forces.findIndex((function(t){return t.id===e}));if(t>=0){var n=y(u);n.forces.splice(t,1),b&&b(n)}}),[b,u]),f=Object(s.useCallback)((function(e){var t=u.trapezoids.findIndex((function(t){return t.id===e}));if(t>=0){var n=y(u);n.trapezoids.splice(t,1),b&&b(n)}}),[b,u]),O=Object(s.useCallback)((function(e){var t=u.beams.findIndex((function(t){return t.id===e}));if(t>=0){var n=u.beams[t],r=n.nodeI,c=n.nodeJ,a=y(u);a.beams.splice(t,1),[r,c].forEach((function(e){var t=a.beams.some((function(t){var n=t.nodeI,r=t.nodeJ;return e===n||e===r}));if(!t){var n=a.nodes.findIndex((function(t){return t.id===e}));n>=0&&a.nodes.splice(n,1)}}));var i=a.forces.filter((function(t){return t.beam!==e}));a.forces=i;var o=a.trapezoids.filter((function(t){return t.beam!==e}));a.trapezoids=o,b&&b(a)}}),[b,u]);return Object(_.jsx)(ie.Provider,{value:{tool:r,size:c,gridSize:i,snapSize:l,structure:u,addForce:j,deleteForce:d,deleteTrapezoid:f,deleteBeam:O,setStructure:b},children:t})},se={id:"",points:[],stroke:"#c9e1ff",strokeWidth:1,dash:[5,3],listening:!1},le=function(){var e=Object(s.useContext)(ie),t=e.size,n=e.gridSize,r=Object(s.useMemo)((function(){for(var e=[],r=1,c=0;c<=t.height;c+=n)e.push(Object(S.a)(Object(S.a)({},se),{},{id:"Horizontal_".concat(r),points:[0,c,t.width,c]})),r++;return e}),[n,t.height,t.width]),c=Object(s.useMemo)((function(){for(var e=[],r=1,c=0;c<=t.width;c+=n)e.push(Object(S.a)(Object(S.a)({},se),{},{id:"Vertical_".concat(r),points:[c,0,c,t.height]})),r++;return e}),[n,t.height,t.width]);return Object(_.jsxs)($.e,{listening:!1,children:[r.map((function(e){return Object(_.jsx)($.f,Object(S.a)({},e),e.id)})),c.map((function(e){return Object(_.jsx)($.f,Object(S.a)({},e),e.id)}))]})},ue=Object(s.createContext)(void 0),be=function(e){var t=e.value,n=t.selected,r=t.setSelected,c=e.children,a=Object(s.useCallback)((function(e){return n.some((function(t){var n=t.type,r=t.id;return n===e.type&&r===e.id}))}),[n]),i=Object(s.useCallback)((function(e){a(e)||r((function(t){return[].concat(Object(ee.a)(t),[e])}))}),[a,r]),o=Object(s.useCallback)((function(e){a(e)?r((function(t){return t.filter((function(t){var n=t.type,r=t.id;return!(n===e.type&&r===e.id)}))})):r((function(t){return[].concat(Object(ee.a)(t),[e])}))}),[a,r]);return Object(_.jsx)(ue.Provider,{value:{selected:n,setSelected:r,isSelected:a,select:i,toggle:o},children:c})},je=function(e){var t=e.id,n=e.name,r=e.nodeI,c=e.nodeJ,a=e.tool,i=e.selected,o=void 0!==i&&i,l=e.addForce,u=e.onDelete,b=e.onSelect,j=Object(s.useState)([]),d=Object(O.a)(j,2),f=d[0],v=d[1],p=Object(s.useState)([0,0]),h=Object(O.a)(p,2),g=h[0],y=h[1],C=Object(s.useState)(0),w=Object(O.a)(C,2),k=w[0],S=w[1],E=Object(s.useState)(0),P=Object(O.a)(E,2),I=P[0],z=P[1],M=Object(s.useState)([[0,0],[0,0]]),N=Object(O.a)(M,2),R=N[0],T=N[1],D=Object(s.useRef)(new x.a(0,0)),W=Object(s.useRef)(new x.a(0,0)),B=Object(s.useCallback)((function(e){if("force"===a){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&(l(n,D.current,W.current),e.cancelBubble=!0)}else"delete"===a?(u(),e.cancelBubble=!0):"select"===a&&(b(),e.cancelBubble=!0)}),[l,u,b,a]);return Object(s.useEffect)((function(){if(v([r.x,r.y,c.x,c.y]),D.current.x=r.x,D.current.y=r.y,W.current.x=c.x,W.current.y=c.y,o){var e=D.current,t=W.current;if(e.x>t.x){var n=[t,e];e=n[0],t=n[1]}var a=e.distance(t),i=m(e,t),s=e.clone().add(i.clone().multiplyScalar(16)),l=t.clone().subtract(e).angleDeg(),u=i.clone().multiplyScalar(75),b=e.clone().add(u),j=t.clone().add(u);S(a),y([s.x,s.y]),z(l),T([[b.x,b.y],[j.x,j.y]])}}),[r.x,r.y,c.x,c.y,o]),Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)($.f,{id:t,type:"beam",points:f,stroke:o?"blue":"black",strokeWidth:4,onClick:B,onTap:B}),o&&Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)($.i,{x:g[0],y:g[1],rotation:I,text:n,fontSize:12,width:k,fill:"blue",align:"center",wrap:"none",ellipsis:!0,listening:!1}),Object(_.jsx)(ge,{start:R[0],end:R[1]})]})]})},de=function(e){var t=Object(s.useContext)(ie),n=t.tool,r=t.addForce,c=t.deleteBeam,a=Object(s.useContext)(ue),i=a.isSelected,o=a.toggle,l=Object(s.useCallback)((function(t,n,c){var a=new x.a(t.x,t.y),i=function(e,t,n,r){var c=t.distance(n),a=t.distance(r);return{beam:e,force:10,distanceI:C(a/c)}}(e.id,n,c,a);r(i)}),[r,e.id]),u=Object(s.useCallback)((function(){c(e.id)}),[c,e.id]),b=Object(s.useCallback)((function(){o({type:"beams",id:e.id})}),[e.id,o]);return Object(_.jsx)(je,Object(S.a)(Object(S.a)({},e),{},{tool:n,selected:i({type:"beams",id:e.id}),addForce:l,onDelete:u,onSelect:b}))},fe=Object(s.createContext)(void 0),Oe=function(e){var t=e.value,n=t.popupType,r=t.setPopupType,c=t.popupPosition,a=t.setPopupPosition,i=e.children,o=Object(s.useState)({}),l=Object(O.a)(o,2),u=l[0],b=l[1],j=Object(s.useCallback)((function(e,t,n){r(e),a(t),n&&b(n)}),[a,r]),d=Object(s.useCallback)((function(){r(void 0),a({top:0,left:0}),b({})}),[a,r]);return Object(_.jsx)(fe.Provider,{value:{popupType:n,setPopupType:r,popupPosition:c,setPopupPosition:a,open:j,close:d,popupParams:u},children:i})},ve=function(e){var t=e.beam,n=e.distanceI,r=e.force,c=e.forceRatio,a=e.tool,i=e.selected,o=void 0!==i&&i,l=e.onDelete,u=e.onSelect,b=e.onEdit,j=Object(s.useState)([]),d=Object(O.a)(j,2),f=d[0],v=d[1],h=Object(s.useState)(0),y=Object(O.a)(h,2),C=y[0],w=y[1],k=Object(s.useState)(0),S=Object(O.a)(k,2),E=S[0],P=S[1],I=Object(s.useState)([0,0]),z=Object(O.a)(I,2),M=z[0],N=z[1],R=Object(s.useRef)(new x.a(0,0)),T=Object(s.useRef)(new x.a(0,0));Object(s.useEffect)((function(){var e=t.nodeI,r=t.nodeJ;R.current.x=e.x,R.current.y=e.y,T.current.x=r.x,T.current.y=r.y;var a=g(R.current,T.current,n),i=m(R.current,T.current),o=30*c,s=a.clone().add(i.multiplyScalar(o));v([s.x,s.y,a.x,a.y]),w(Math.max(o,140));var l=i.clone().angleDeg();P(l);var u=R.current.clone().subtract(T.current).normalize();p.dot(u)<0&&u.invert();var b=a.clone().add(u.multiplyScalar(6));N([b.x,b.y])}),[t,n,c]);var D=Object(s.useCallback)((function(e){"delete"===a?(l(),e.cancelBubble=!0):"select"===a&&(u(),e.cancelBubble=!0)}),[l,u,a]),W=Object(s.useCallback)((function(e){e.cancelBubble=!0}),[]),B=Object(s.useCallback)((function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();if(n){var r=n.x,c=n.y;b({top:c,left:r})}}),[b]),F=Object(s.useMemo)((function(){return o?"red":"orange"}),[o]);return Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)($.a,{points:f,pointerLength:6,pointerWidth:6,fill:F,stroke:F,strokeWidth:2,onClick:D,onTap:D}),o&&Object(_.jsx)($.i,{x:M[0],y:M[1],offsetX:-6,text:"".concat(r,"kN"),fontSize:12,width:C,rotation:E,fill:F,wrap:"none",ellipsis:!0,onClick:W,onTap:W,onDblClick:B,onDblTap:B})]})},xe=function(e){var t=Object(s.useContext)(ie),n=t.tool,r=t.deleteForce,c=Object(s.useContext)(ue),a=c.isSelected,i=c.toggle,o=Object(s.useContext)(fe).open,l=Object(s.useCallback)((function(){r(e.id)}),[r,e.id]),u=Object(s.useCallback)((function(){i({type:"forces",id:e.id})}),[e.id,i]),b=Object(s.useCallback)((function(t){var n=Object(S.a)(Object(S.a)({},e),{},{beam:e.beam.id});o("forces",t,n)}),[o,e]);return Object(_.jsx)(ve,Object(S.a)(Object(S.a)({},e),{},{tool:n,selected:a({type:"forces",id:e.id}),onDelete:l,onSelect:u,onEdit:b}))},pe={fill:"silver",stroke:"silver",strokeWidth:1,listening:!1},he=Object(S.a)({pointerLength:6,pointerWidth:6,pointerAtBeginning:!0},pe),ge=function(e){var t=e.start,n=e.end,r=Object(s.useRef)(new x.a(0,0)),c=Object(s.useRef)(new x.a(0,0)),a=Object(s.useState)(0),i=Object(O.a)(a,2),o=i[0],l=i[1],u=Object(s.useState)(0),b=Object(O.a)(u,2),j=b[0],d=b[1],f=Object(s.useState)([0,0]),v=Object(O.a)(f,2),p=v[0],h=v[1];return Object(s.useEffect)((function(){r.current.x=t[0],r.current.y=t[1],c.current.x=n[0],c.current.y=n[1];var e=r.current.distance(c.current),a=c.current.clone().subtract(r.current).normalize().angleDeg();l(Math.round(e)),d(90===a?-90:a),h(90===a?n:t)}),[n,t]),Object(_.jsxs)($.c,{x:p[0],y:p[1],rotation:j,children:[Object(_.jsx)($.f,Object(S.a)({points:[0,0,0,10]},pe)),Object(_.jsx)($.a,Object(S.a)({points:[0,5,o,5]},he)),Object(_.jsx)($.f,Object(S.a)({points:[o,0,o,10]},pe)),Object(_.jsx)($.i,{x:0,y:-8,text:"".concat(o,"px"),fontSize:12,fill:"silver",width:o,align:"center",listening:!1,wrap:"none",ellipsis:!0})]})},me=n(44),ye=n.n(me),Ce={free:"/assets/images/pins/pin_1.svg",pin:"/assets/images/pins/pin_1.svg",pinX:"/assets/images/pins/pin_2.svg",pinZ:"/assets/images/pins/pin_2.svg",fixX:"/assets/images/pins/pin_3.svg",fix:"/assets/images/pins/pin_4.svg"},we=function(e){var t=e.id,n=e.x,r=e.y,c=e.pin,a=void 0===c?"free":c,i=e.tool,o=e.draggable,l=void 0!==o&&o,u=e.onChange,b=e.onCommit,j=e.onEdit,d=Object(s.useState)(!1),f=Object(O.a)(d,2),v=f[0],x=f[1],p=Object(s.useRef)({x:n,y:r}),h=Object(s.useRef)(),g=Object(s.useMemo)((function(){return"".concat("/drawing-sample").concat(Ce[a])}),[a]),m=ye()(g),y=Object(O.a)(m,1)[0],C=Object(s.useCallback)((function(){if(l){var e={id:t,x:p.current.x,y:p.current.y};u&&u(e)}}),[l,t,u]),w=Object(s.useCallback)((function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&(p.current=n,x(!0))}),[]),k=Object(s.useCallback)((function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&(p.current=n)}),[]),S=Object(s.useCallback)((function(e){var n,r=null===(n=e.target.getStage())||void 0===n?void 0:n.getPointerPosition();if(r){p.current=r,x(!1),h.current&&(clearInterval(h.current),h.current=void 0);var c={id:t,x:p.current.x,y:p.current.y};b&&b(c)}}),[t,b]),E=Object(s.useCallback)((function(e){"select"===i&&(e.cancelBubble=!0)}),[i]),P=Object(s.useCallback)((function(e){if("select"===i){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();if(n){var r=n.x,c=n.y;j({top:c,left:r})}}}),[j,i]);return Object(s.useEffect)((function(){var e=h.current;return l&&v&&(C(),h.current=setInterval(C,100)),function(){e&&clearInterval(e)}}),[l,v,C]),Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)($.b,{id:t,x:n,y:r,fill:v?"blue":"black",radius:4,draggable:l,onDragStart:w,onDragMove:k,onDragEnd:S,onClick:E,onTap:E,onDblClick:P,onDblTap:P,_useStrictMode:!0}),!v&&"free"!==a&&Object(_.jsx)($.d,{x:n,y:r,offsetX:12,offsetY:-4,rotation:"pinZ"===a?-90:0,image:y,width:24,height:24,listening:!1})]})},ke=function(e){var t=Object(s.useContext)(ie),n=t.tool,r=t.snapSize,c=t.setStructure,a=Object(s.useContext)(fe).open,i=Object(s.useMemo)((function(){return"pen"!==n&&Boolean(c)}),[c,n]),o=Object(s.useCallback)((function(e){var t=e.id,n=e.x,a=e.y;if(c){var i=k([n,a],r),o=Object(O.a)(i,2),s=o[0],l=o[1];c((function(e){var n=y(e),r=n.nodes.find((function(e){return e.id===t}));return r&&(r.x=s,r.y=l),n}))}}),[c,r]),l=Object(s.useCallback)((function(e){var t=e.id,n=e.x,a=e.y;if(c){var i=k([n,a],r),o=Object(O.a)(i,2),s=o[0],l=o[1];c((function(e){var n,r,c,a=y(e),i=a.nodes.findIndex((function(e){return e.id===t}));if(i>=0){var o=a.nodes.find((function(e){return e.id!==t&&e.x===s&&e.y===l}));o&&(n=a,r=t,c=o.id,n.beams.forEach((function(e){e.nodeI===r&&(e.nodeI=c),e.nodeJ===r&&(e.nodeJ=c)})),a.nodes.splice(i,1))}return a}))}}),[c,r]),u=Object(s.useCallback)((function(t){a("nodes",t,e)}),[a,e]);return Object(_.jsx)(we,Object(S.a)(Object(S.a)({},e),{},{draggable:i,tool:n,onChange:o,onCommit:l,onEdit:u}))},Se={stroke:"pink",strokeWidth:2},Ee=Object(S.a)({pointerLength:6,pointerWidth:6,fill:"pink"},Se),Pe={offsetX:-6,offsetY:14,fontSize:12,wrap:"none",ellipsis:!0},Ie=function(e){var t=e.beam,n=e.forceI,r=e.forceJ,c=e.distanceI,a=e.distanceJ,i=e.angle,o=void 0===i?90:i,l=e.isGlobal,u=void 0!==l&&l,b=e.tool,j=e.selected,d=void 0!==j&&j,f=e.onDelete,v=e.onSelect,h=e.onEdit,m=Object(s.useState)([]),y=Object(O.a)(m,2),C=y[0],w=y[1],k=Object(s.useState)([0,0,0,0]),E=Object(O.a)(k,2),P=E[0],I=E[1],z=Object(s.useState)(),M=Object(O.a)(z,2),N=M[0],R=M[1],T=Object(s.useState)(),D=Object(O.a)(T,2),W=D[0],B=D[1],F=Object(s.useState)([[0,0],[0,0]]),J=Object(O.a)(F,2),X=J[0],A=J[1];Object(s.useEffect)((function(){var e,i=t.nodeI,s=t.nodeJ,l=new x.a(i.x,i.y),b=new x.a(s.x,s.y),j=b.clone().subtract(l).normalize();e=u?p.clone().rotateDeg(-1*o):j.clone().rotateDeg(-1*o).normalize();var d=l.distance(b),f=l.clone().add(j.clone().multiplyScalar(d*c)),v=b.clone().add(j.clone().invert().multiplyScalar(d*a)),h=f.clone().add(e.clone().multiplyScalar(10*n)),m=v.clone().add(e.clone().multiplyScalar(10*r)),y=function(e,t,n){for(var r=[],c=e.distance(t),a=10,i=c/(a+1);i<25&&a>0;)i=c/(1+--a);if(a>0)for(var o=1;o<=a;o++){var s=e.clone().add(n.clone().multiplyScalar(i*o));r.push(s)}else if((i=c/2)>=10){var l=g(e,t,.5);r.push(l)}return r}(f,v,j),C=m.x-h.x!==0?(m.y-h.y)/(m.x-h.x):NaN,k=isNaN(C)?NaN:h.y-C*h.x,S=[];y.forEach((function(t){var n=function(e,t,n){var r=Object(O.a)(e,4),c=r[0],a=r[1],i=r[2],o=r[3],s=null;try{var l=t.clone().add(n),u=l.x-t.x!==0?(l.y-t.y)/(l.x-t.x):NaN,b=isNaN(u)?NaN:t.y-u*t.x;if(i===u)return null;if(isNaN(i)||isNaN(u)){if(isNaN(i)){var j=c.x;s=[j,j*u+b]}else if(isNaN(u)){var d=t.x;s=[d,d*i+o]}}else{var f=(b-o)/(i-u);s=[f,i*f+o]}if(s){var v=s,x=Object(O.a)(v,2),p=x[0],h=x[1],g=[c.x,a.x].sort((function(e,t){return e-t})),m=[c.y,a.y].sort((function(e,t){return e-t}));if(p>=g[0]&&p<=g[1]&&h>=m[0]&&h<=m[1])return s}return null}catch(y){console.error(y)}return null}([h,m,C,k],t,e);if(n){var r=[n[0],n[1],t.x,t.y];S.push(r)}}));var E=e.angleDeg();R({x:f.x,y:f.y,text:"".concat(n,"kN/m"),width:f.distance(h),rotation:E}),B({x:v.x,y:v.y,text:"".concat(r,"kN/m"),width:v.distance(m),rotation:E});var P=10*Math.max(n,r),z=e.clone().multiplyScalar(P+50),M=f.clone().add(z),N=v.clone().add(z);A([[M.x,M.y],[N.x,N.y]]),I([h.x,h.y,m.x,m.y]),w([[h.x,h.y,f.x,f.y]].concat(S,[[m.x,m.y,v.x,v.y]]))}),[o,t,c,a,n,r,u]);var G=Object(s.useCallback)((function(e){"select"===b?v():"delete"===b&&f(),e.cancelBubble=!0}),[f,v,b]),L=Object(s.useCallback)((function(e){if("select"===b){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();if(n){var r=n.x,c=n.y;h({top:c,left:r})}}}),[h,b]),Y=Object(s.useMemo)((function(){return d?"red":"pink"}),[d]);return Object(_.jsxs)($.c,{onClick:G,onTap:G,onDblClick:L,onDblTap:L,children:[Object(_.jsx)($.f,Object(S.a)(Object(S.a)({points:P},Se),{},{stroke:Y})),C.map((function(e,t){return Object(_.jsx)($.a,Object(S.a)(Object(S.a)({points:e},Ee),{},{stroke:Y,fill:Y}),"arrow_".concat(t))})),d&&Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)($.i,Object(S.a)(Object(S.a)(Object(S.a)({},Pe),N),{},{fill:Y})),Object(_.jsx)($.i,Object(S.a)(Object(S.a)(Object(S.a)({},Pe),W),{},{fill:Y})),Object(_.jsx)(ge,{start:X[0],end:X[1]})]})]})},ze=function(e){var t=Object(s.useContext)(ie),n=t.tool,r=t.deleteTrapezoid,c=Object(s.useContext)(ue),a=c.isSelected,i=c.toggle,o=Object(s.useContext)(fe).open,l=Object(s.useCallback)((function(){r(e.id)}),[r,e.id]),u=Object(s.useCallback)((function(){i({type:"trapezoids",id:e.id})}),[e.id,i]),b=Object(s.useCallback)((function(t){var n=Object(S.a)(Object(S.a)({},e),{},{beam:e.beam.id});o("trapezoids",t,n)}),[o,e]);return Object(_.jsx)(Ie,Object(S.a)(Object(S.a)({},e),{},{tool:n,selected:a({type:"trapezoids",id:e.id}),onDelete:l,onSelect:u,onEdit:b}))},Me=25,Ne=function(){var e=Object(s.useContext)(ie).structure,t=Object(s.useMemo)((function(){var t={maxX:Number.MIN_SAFE_INTEGER,minX:Number.MAX_SAFE_INTEGER,guidesX:[],maxY:Number.MIN_SAFE_INTEGER,minY:Number.MAX_SAFE_INTEGER,guidesY:[]},n=new Set,r=new Set;if(e.nodes.forEach((function(e){var c=e.x,a=e.y;t.maxX<c&&(t.maxX=c),t.minX>c&&(t.minX=c),n.has(c)||n.add(c),t.maxY<a&&(t.maxY=a),t.minY>a&&(t.minY=a),r.has(a)||r.add(a)})),n.size>1)for(var c=Array.from(n).sort((function(e,t){return e<t?-1:1})),a=c[0],i=1;i<c.length;i++){var o=c[i],s={key:"LocalGuideX_".concat(i),start:[a,t.maxY+100],end:[o,t.maxY+100]};a=o,t.guidesX.push(s)}if(r.size>1)for(var l=Array.from(r).sort((function(e,t){return e<t?-1:1})),u=l[0],b=Math.max(t.minX-100,50),j=1;j<l.length;j++){var d=l[j],f={key:"LocalGuideY_".concat(j),start:[b,u],end:[b,d]};u=d,t.guidesY.push(f)}return t}),[e.nodes]),n=t.minX,r=t.maxX,c=t.guidesX,a=t.minY,i=t.maxY,o=t.guidesY,l=Object(s.useMemo)((function(){return n!==Number.MAX_SAFE_INTEGER?Math.max(Me,n-125):0}),[n]),u=Object(s.useMemo)((function(){return i!==Number.MIN_SAFE_INTEGER?i+125:0}),[i]);return Object(_.jsxs)($.e,{listening:!1,children:[n!==Number.MAX_SAFE_INTEGER&&r!==Number.MIN_SAFE_INTEGER&&Object(_.jsx)(ge,{start:[n,u],end:[r,u]}),c.map((function(e){return Object(_.jsx)(ge,Object(S.a)({},e))})),a!==Number.MAX_SAFE_INTEGER&&i!==Number.MIN_SAFE_INTEGER&&Object(_.jsx)(ge,{start:[l,a],end:[l,i]}),o.map((function(e){return Object(_.jsx)(ge,Object(S.a)({},e))}))]})},Re=["structure"],Te=["nodeI","nodeJ"],De=["beam","force"],_e=["beam"],We=function(e){var t=e.structure,n=Object(Q.a)(e,Re),r=Object(s.useMemo)((function(){var e={};return t.nodes.forEach((function(t){e[t.id]=t})),e}),[t.nodes]),c=Object(s.useMemo)((function(){var e={};return t.beams.forEach((function(t){var n=t.nodeI,c=t.nodeJ,a=Object(Q.a)(t,Te),i=Object(S.a)(Object(S.a)({},a),{},{nodeI:r[n],nodeJ:r[c]});e[a.id]=i})),e}),[r,t.beams]),a=Object(s.useMemo)((function(){var e=t.forces,n={};if(e.length>0){var r=e.map((function(e){return e.force})).reduce((function(e,t){return e+t}))/e.length;e.forEach((function(e){var t=e.beam,a=e.force,i=Object(Q.a)(e,De),o=a/r;n[i.id]=Object(S.a)(Object(S.a)({},i),{},{force:a,forceRatio:o,beam:c[t]})}))}return n}),[c,t]),i=Object(s.useMemo)((function(){var e=t.trapezoids,n={};return e.forEach((function(e){var t=e.beam,r=Object(Q.a)(e,_e);n[r.id]=Object(S.a)(Object(S.a)({},r),{},{beam:c[t]})})),n}),[c,t]);return Object(_.jsxs)($.e,Object(S.a)(Object(S.a)({},n),{},{children:[Object.entries(c).map((function(e){var t=Object(O.a)(e,2),n=t[0],r=t[1];return Object(_.jsx)(de,Object(S.a)({},r),n)})),Object.entries(r).map((function(e){var t=Object(O.a)(e,2),n=t[0],r=t[1];return Object(_.jsx)(ke,Object(S.a)({},r),n)})),Object.entries(a).map((function(e){var t=Object(O.a)(e,2),n=t[0],r=t[1];return Object(_.jsx)(xe,Object(S.a)({},r),n)})),Object.entries(i).map((function(e){var t=Object(O.a)(e,2),n=t[0],r=t[1];return Object(_.jsx)(ze,Object(S.a)({},r),n)}))]}))},Be=function(){var e=Object(s.useContext)(ie).structure;return Object(_.jsx)(We,{structure:e})},Fe=n(71),Je=n(187),Xe=n(165),Ae=n(175),Ge=n(189),Le=n(182),Ye=["values"],Ue=function(e){var t=e.force,n=e.onChange,r=e.onClose,c=Object(s.useState)(""),a=Object(O.a)(c,2),i=a[0],o=a[1],l=Object(s.useState)(),u=Object(O.a)(l,2),b=u[0],j=u[1],d=Object(s.useCallback)((function(e){if(e.preventDefault(),e.currentTarget.checkValidity()&&"undefined"===typeof b){var c=parseFloat(i);isNaN(c)||(n(Object(S.a)(Object(S.a)({},t),{},{force:c})),r())}}),[b,n,r,i,t]),f=Object(s.useCallback)((function(e){var t,n=e.currentTarget.value;o(n),0===n.length&&(t="\u6570\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044");var r=parseFloat(n);isNaN(r)&&(t="\u6570\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"),(0>r||r>Number.MAX_SAFE_INTEGER)&&(t="0 \u3088\u308a\u5927\u304d\u3044\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"),j(t)}),[]);return Object(s.useEffect)((function(){o("".concat(t.force)),j(void 0)}),[t]),Object(_.jsx)(Je.a,{children:Object(_.jsxs)(Xe.a,{direction:"column",spacing:1,sx:{p:1,width:240},component:"form",autoComplete:"off",noValidate:!0,onSubmit:d,children:[Object(_.jsx)(Ae.a,{variant:"outlined",margin:"dense",size:"small",label:"\u96c6\u4e2d\u8377\u91cd",value:i,required:!0,fullWidth:!0,onChange:f,InputProps:{endAdornment:Object(_.jsx)(Ge.a,{position:"end",children:"kN"})},error:Boolean(b),helperText:b}),Object(_.jsxs)(Xe.a,{direction:"row",justifyContent:"flex-end",spacing:1,children:[Object(_.jsx)(Le.a,{size:"small",onClick:r,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),Object(_.jsx)(Le.a,{type:"submit",size:"small",variant:"contained",children:"OK"})]})]})})},Ze=function(e){var t=e.values,n=Object(Q.a)(e,Ye),r=Object(s.useMemo)((function(){return function(e){if(e&&"object"===typeof e){var t=e;return"string"===typeof t.id&&"string"===typeof t.name&&"string"===typeof t.beam&&"number"===typeof t.force&&"number"===typeof t.distanceI}return!1}(t)?t:{id:"",name:"",beam:"",force:0,distanceI:0}}),[t]);return Object(_.jsx)(Ue,Object(S.a)(Object(S.a)({},n),{},{force:r}))},Ve=n(91),He=n.n(Ve),qe=n(98),Ke=n(183),Qe=n(190),$e=["title","titleId"];function et(){return et=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},et.apply(this,arguments)}function tt(e,t){if(null==e)return{};var n,r,c=function(e,t){if(null==e)return{};var n,r,c={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(c[n]=e[n]);return c}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}function nt(e,t){var n=e.title,r=e.titleId,c=tt(e,$e);return s.createElement("svg",et({id:"svg",viewBox:"0 0 160 160",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},c),n?s.createElement("title",{id:r},n):null,o||(o=s.createElement("path",{d:"M80 0 L30 80 L130 80 Z",strokeWidth:6,stroke:"gray",fill:"transparent"})))}var rt,ct,at,it,ot=s.forwardRef(nt),st=(n.p,["title","titleId"]);function lt(){return lt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},lt.apply(this,arguments)}function ut(e,t){if(null==e)return{};var n,r,c=function(e,t){if(null==e)return{};var n,r,c={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(c[n]=e[n]);return c}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}function bt(e,t){var n=e.title,r=e.titleId,c=ut(e,st);return s.createElement("svg",lt({id:"svg",viewBox:"0 0 160 160",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},c),n?s.createElement("title",{id:r},n):null,rt||(rt=s.createElement("path",{d:"M80 0 L30 80 L130 80 Z",strokeWidth:6,stroke:"gray",fill:"transparent"})),ct||(ct=s.createElement("circle",{stroke:"gray",strokeWidth:6,fill:"transparent",cx:45,cy:115,r:20})),at||(at=s.createElement("circle",{stroke:"gray",strokeWidth:6,fill:"transparent",cx:115,cy:115,r:20})),it||(it=s.createElement("line",{x1:30,y1:150,x2:130,y2:150,stroke:"gray",strokeWidth:6})))}var jt,dt,ft,Ot,vt=s.forwardRef(bt),xt=(n.p,["title","titleId"]);function pt(){return pt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},pt.apply(this,arguments)}function ht(e,t){if(null==e)return{};var n,r,c=function(e,t){if(null==e)return{};var n,r,c={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(c[n]=e[n]);return c}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}function gt(e,t){var n=e.title,r=e.titleId,c=ht(e,xt);return s.createElement("svg",pt({id:"svg",style:{width:64},viewBox:"0 0 160 160",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},c),n?s.createElement("title",{id:r},n):null,jt||(jt=s.createElement("path",{d:"M30 3 L30 80 L130 80 L130 3 Z",strokeWidth:6,stroke:"gray",fill:"transparent"})),dt||(dt=s.createElement("circle",{stroke:"gray",strokeWidth:6,fill:"transparent",cx:45,cy:115,r:20})),ft||(ft=s.createElement("circle",{stroke:"gray",strokeWidth:6,fill:"transparent",cx:115,cy:115,r:20})),Ot||(Ot=s.createElement("line",{x1:30,y1:150,x2:130,y2:150,stroke:"gray",strokeWidth:6})))}var mt,yt,Ct,wt,kt,St=s.forwardRef(gt),Et=(n.p,["title","titleId"]);function Pt(){return Pt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Pt.apply(this,arguments)}function It(e,t){if(null==e)return{};var n,r,c=function(e,t){if(null==e)return{};var n,r,c={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(c[n]=e[n]);return c}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}function zt(e,t){var n=e.title,r=e.titleId,c=It(e,Et);return s.createElement("svg",Pt({id:"svg",style:{width:64},viewBox:"0 0 160 160",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},c),n?s.createElement("title",{id:r},n):null,mt||(mt=s.createElement("line",{x1:0,y1:3,x2:160,y2:3,stroke:"gray",strokeWidth:6})),yt||(yt=s.createElement("line",{x1:20,y1:0,x2:0,y2:60,stroke:"gray",strokeWidth:6})),Ct||(Ct=s.createElement("line",{x1:60,y1:0,x2:40,y2:60,stroke:"gray",strokeWidth:6})),wt||(wt=s.createElement("line",{x1:100,y1:0,x2:80,y2:60,stroke:"gray",strokeWidth:6})),kt||(kt=s.createElement("line",{x1:140,y1:0,x2:120,y2:60,stroke:"gray",strokeWidth:6})))}var Mt=s.forwardRef(zt),Nt=(n.p,["values"]),Rt={free:{type:"free",icon:Object(_.jsx)(He.a,{}),label:"\u5b8c\u5168\u30d5\u30ea\u30fc"},pin:{type:"pin",icon:Object(_.jsx)(qe.a,{sx:{width:24},viewBox:"0 0 160 160",children:Object(_.jsx)(ot,{})}),label:"\u5b8c\u5168\u30d4\u30f3"},pinX:{type:"pinX",icon:Object(_.jsx)(qe.a,{sx:{width:24},viewBox:"0 0 160 160",children:Object(_.jsx)(vt,{})}),label:"\u30d4\u30f3X\u30ed\u30fc\u30e9\u30fc"},pinZ:{type:"pinZ",icon:Object(_.jsx)(qe.a,{sx:{width:24,transform:"rotate(-90deg)"},viewBox:"0 0 160 160",children:Object(_.jsx)(vt,{})}),label:"\u30d4\u30f3Z\u30ed\u30fc\u30e9\u30fc"},fixX:{type:"fixX",icon:Object(_.jsx)(qe.a,{sx:{width:24},viewBox:"0 0 160 160",children:Object(_.jsx)(St,{})}),label:"\u56fa\u5b9aX\u30ed\u30fc\u30e9\u30fc"},fix:{type:"fix",icon:Object(_.jsx)(qe.a,{sx:{width:24},viewBox:"0 0 160 160",children:Object(_.jsx)(Mt,{})}),label:"\u5b8c\u5168\u56fa\u5b9a"}},Tt={sx:{justifyContent:"flex-start",alignItems:"center"}},Dt=function(e){var t=e.node,n=e.onChange,r=e.onClose,c=Object(s.useState)(),a=Object(O.a)(c,2),i=a[0],o=a[1],l=Object(s.useCallback)((function(e){e.preventDefault();var c=Object(S.a)(Object(S.a)({},t),{},{pin:i});n(c),r()}),[t,n,r,i]),u=Object(s.useCallback)((function(e,t){var n;null!==t&&("string"===typeof(n=t)&&I.some((function(e){return e===n})))&&o(t)}),[]);return Object(s.useEffect)((function(){var e;o(null!==(e=t.pin)&&void 0!==e?e:"free")}),[t.pin]),Object(_.jsx)(Je.a,{children:Object(_.jsxs)(Xe.a,{direction:"column",spacing:1,sx:{p:1,width:240},component:"form",autoComplete:"off",noValidate:!0,onSubmit:l,children:[Object(_.jsx)(Ke.a,{orientation:"vertical",value:i,size:"small",exclusive:!0,fullWidth:!0,onChange:u,children:Object.entries(Rt).map((function(e){var t=Object(O.a)(e,2),n=t[0],r=t[1],c=r.icon,a=r.label;return Object(_.jsxs)(Qe.a,Object(S.a)(Object(S.a)({value:n},Tt),{},{children:[c,Object(_.jsx)(U.a,{variant:"caption",sx:{ml:1},children:a})]}),n)}))}),Object(_.jsxs)(Xe.a,{direction:"row",justifyContent:"flex-end",spacing:1,children:[Object(_.jsx)(Le.a,{size:"small",onClick:r,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),Object(_.jsx)(Le.a,{type:"submit",size:"small",variant:"contained",children:"OK"})]})]})})},_t=function(e){var t=e.values,n=Object(Q.a)(e,Nt),r=Object(s.useMemo)((function(){return function(e){if(e&&"object"===typeof e){var t=e;return"string"===typeof t.id&&"number"===typeof t.x&&"number"===typeof t.y}return!1}(t)?t:{id:"",x:0,y:0}}),[t]);return Object(_.jsx)(Dt,Object(S.a)(Object(S.a)({},n),{},{node:r}))},Wt=n(3),Bt=n(191),Ft=n(177),Jt=["values"],Xt=function(e){if(0===e.length)return[NaN,!1,"\u6570\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"];var t=parseFloat(e);return isNaN(t)?[NaN,!1,"\u6570\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"]:0>=t&&t>Number.MAX_SAFE_INTEGER?[t,!1,"0 \u4ee5\u4e0a\u306e\u6570\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"]:[C(t,3),!0,""]},At=function(e){if(e.length>0){var t=parseInt(e,10);return isNaN(t)||e.indexOf(".")>=0?[NaN,!1,"\u6574\u6570\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"]:-180>t||180<t?[t,!1,"-180 \u301c 180 \u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"]:(-180===t&&(t=180),[t,!0,""])}return[90,!0,""]},Gt=function(e){var t,n,r,c,a,i,o,l=e.trapezoid,u=e.onChange,b=e.onClose,j=Object(s.useState)({}),d=Object(O.a)(j,2),f=d[0],v=d[1],x=Object(s.useState)({}),p=Object(O.a)(x,2),h=p[0],g=p[1],m=Object(s.useCallback)((function(e){if((e.preventDefault(),e.currentTarget.checkValidity())&&!Object.values(h).some((function(e){return e.length>0}))){var t=function(e){var t,n,r,c,a={forceI:0,forceJ:0,angle:90,isGlobal:!1},i=Xt(null!==(t=e.forceI)&&void 0!==t?t:""),o=Object(O.a)(i,2),s=o[0],l=o[1],u=Xt(null!==(n=e.forceJ)&&void 0!==n?n:""),b=Object(O.a)(u,2),j=b[0],d=b[1],f=At(null!==(r=e.angle)&&void 0!==r?r:""),v=Object(O.a)(f,2),x=v[0],p=v[1],h=l&&d&&p;return a.forceI=s,a.forceJ=j,a.angle=x,a.isGlobal=null!==(c=e.isGlobal)&&void 0!==c&&c,[h,a]}(f),n=Object(O.a)(t,2),r=n[0],c=n[1];console.log(r,c),r&&u(Object(S.a)(Object(S.a)({},l),c)),b()}}),[h,u,b,l,f]),y=Object(s.useCallback)((function(e){var t=e.target,n=t.name,r=t.value,c="";switch(n){case"forceI":case"forceJ":var a=Xt(r),i=Object(O.a)(a,3),o=i[1],s=i[2];o||(c=s);break;case"angle":var l=At(r),u=Object(O.a)(l,3),b=u[1],j=u[2];b||(c=j)}g((function(e){return Object(S.a)(Object(S.a)({},e),{},Object(Wt.a)({},n,c))})),v((function(e){return Object(S.a)(Object(S.a)({},e),{},Object(Wt.a)({},n,r))}))}),[]),C=Object(s.useCallback)((function(e){var t=e.target.checked;v((function(e){return Object(S.a)(Object(S.a)({},e),{},{isGlobal:t})}))}),[]);return Object(s.useEffect)((function(){v(function(e){var t,n={};return n.forceI="".concat(e.forceI),n.forceJ="".concat(e.forceJ),n.angle="".concat(null!==(t=e.angle)&&void 0!==t?t:""),n.isGlobal=e.isGlobal,n}(l)),g({})}),[l]),Object(_.jsx)(Je.a,{children:Object(_.jsxs)(Xe.a,{direction:"column",spacing:1,sx:{p:1,width:240},component:"form",autoComplete:"off",noValidate:!0,onSubmit:m,children:[Object(_.jsx)(Ae.a,{variant:"outlined",margin:"dense",size:"small",label:"I\u7aef\u5074\u306e\u8377\u91cd",name:"forceI",value:null!==(t=f.forceI)&&void 0!==t?t:"",required:!0,fullWidth:!0,onChange:y,InputProps:{endAdornment:Object(_.jsx)(Ge.a,{position:"end",children:"kN/m"})},error:Boolean(h.forceI),helperText:null!==(n=h.forceI)&&void 0!==n?n:""}),Object(_.jsx)(Ae.a,{variant:"outlined",margin:"dense",size:"small",label:"J\u7aef\u5074\u306e\u8377\u91cd",name:"forceJ",value:null!==(r=f.forceJ)&&void 0!==r?r:"",required:!0,fullWidth:!0,onChange:y,InputProps:{endAdornment:Object(_.jsx)(Ge.a,{position:"end",children:"kN/m"})},error:Boolean(h.forceJ),helperText:null!==(c=h.forceJ)&&void 0!==c?c:""}),Object(_.jsx)(Ae.a,{variant:"outlined",margin:"dense",size:"small",label:"\u89d2\u5ea6",name:"angle",value:null!==(a=f.angle)&&void 0!==a?a:"",fullWidth:!0,onChange:y,InputProps:{endAdornment:Object(_.jsx)(Ge.a,{position:"end",children:"\xb0"})},error:Boolean(h.angle),helperText:null!==(i=h.angle)&&void 0!==i?i:""}),Object(_.jsx)(Bt.a,{label:"\u5168\u4f53\u5ea7\u6a19\u7cfb",control:Object(_.jsx)(Ft.a,{name:"isGlobal",size:"small",checked:null!==(o=f.isGlobal)&&void 0!==o&&o,onChange:C})}),Object(_.jsxs)(Xe.a,{direction:"row",justifyContent:"flex-end",spacing:1,children:[Object(_.jsx)(Le.a,{size:"small",onClick:b,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),Object(_.jsx)(Le.a,{type:"submit",size:"small",variant:"contained",children:"OK"})]})]})})},Lt=function(e){var t=e.values,n=Object(Q.a)(e,Jt),r=Object(s.useMemo)((function(){return function(e){if(e&&"object"===typeof e){var t=e;return"string"===typeof t.id&&"string"===typeof t.name&&"string"===typeof t.beam&&"number"===typeof t.forceI&&"number"===typeof t.distanceI&&"number"===typeof t.forceJ&&"number"===typeof t.distanceJ}return!1}(t)?t:{id:"",name:"",beam:"",forceI:0,distanceI:0,forceJ:0,distanceJ:0}}),[t]);return Object(_.jsx)(Gt,Object(S.a)(Object(S.a)({},n),{},{trapezoid:r}))},Yt=function(){var e=Object(s.useContext)(fe),t=e.popupType,n=e.popupPosition,r=e.popupParams,c=e.close,a=Object(s.useContext)(ie).setStructure,i=Object(s.useMemo)((function(){var e=n.top,t=n.left;return{style:{zIndex:5e3,top:"".concat(e,"px"),left:"".concat(t,"px")}}}),[n]),o=Object(s.useCallback)((function(e){a&&a((function(t){var n=y(t),r=n.forces.findIndex((function(t){return t.id===e.id}));return r>=0&&(n.forces[r]=Object(S.a)({},e)),n}))}),[a]),l=Object(s.useCallback)((function(e){a&&a((function(t){var n=y(t),r=n.trapezoids.findIndex((function(t){return t.id===e.id}));return r>=0&&(n.trapezoids[r]=Object(S.a)({},e)),n}))}),[a]),u=Object(s.useCallback)((function(e){a&&a((function(t){var n=y(t),r=n.nodes.findIndex((function(t){return t.id===e.id}));return r>=0&&(n.nodes[r]=Object(S.a)({},e)),n}))}),[a]);return"undefined"===typeof t?null:Object(_.jsxs)(Fe.a,{divProps:i,children:["forces"===t&&Object(_.jsx)(Ze,{values:null!==r&&void 0!==r?r:{},onClose:c,onChange:o}),"trapezoids"===t&&Object(_.jsx)(Lt,{values:null!==r&&void 0!==r?r:{},onClose:c,onChange:l}),"nodes"===t&&Object(_.jsx)(_t,{values:null!==r&&void 0!==r?r:{},onClose:c,onChange:u})]})},Ut=["points","onPointerDown","onPointerMove","onPointerUp"],Zt=function(e,t){var n=e.tool,r=e.structure,c=e.size,a=(e.readonly,e.setStructure),i=Object(s.useContext)(ue),o=i.selected,l=i.setSelected,u=Object(s.useContext)(fe),b=u.popupType,j=u.setPopupType,d=u.popupPosition,f=u.setPopupPosition,O=u.close,v=Object(s.useContext)(ne),x=v.points,p=v.onPointerDown,h=v.onPointerMove,g=v.onPointerUp,m=Object(Q.a)(v,Ut),y=Object(s.useRef)(null);Object(s.useImperativeHandle)(t,(function(){return{toDataURL:function(){if(y.current)return y.current.toDataURL()}}}),[]);var C=Object(s.useCallback)((function(e){O(),"select"===n&&l([])}),[O,l,n]);return Object(_.jsx)($.h,{ref:y,width:c.width,height:c.height,onClick:C,onTap:C,onPointerDown:p,onPointerMove:h,onPointerUp:g,children:Object(_.jsx)(oe,{size:c,structure:r,tool:n,setStructure:a,children:Object(_.jsx)(Oe,{value:{popupType:b,setPopupType:j,popupPosition:d,setPopupPosition:f},children:Object(_.jsx)(be,{value:{selected:o,setSelected:l},children:Object(_.jsxs)(re,{value:Object(S.a)({points:x},m),children:[Object(_.jsx)(le,{}),Object(_.jsx)(Ne,{}),Object(_.jsx)(Be,{}),Object(_.jsx)(ae,{}),Object(_.jsx)(Yt,{})]})})})})})},Vt=Object(s.forwardRef)(Zt),Ht=["tool","structure"],qt=function(e,t){var n=e.tool,r=void 0===n?"select":n,c=e.structure,a=Object(Q.a)(e,Ht),i=Object(s.useState)({width:0,height:0}),o=Object(O.a)(i,2),l=o[0],u=o[1],b=Object(s.useState)([]),j=Object(O.a)(b,2),d=j[0],f=j[1],v=Object(s.useState)(),x=Object(O.a)(v,2),p=x[0],h=x[1],g=Object(s.useState)({top:0,left:0}),m=Object(O.a)(g,2),y=m[0],C=m[1],w=Object(s.useState)([]),k=Object(O.a)(w,2),E=k[0],P=k[1],I=Object(s.useState)(c),z=Object(O.a)(I,2),M=z[0],N=z[1],R=Object(s.useRef)(null),T=Object(s.useRef)(null);return Object(s.useImperativeHandle)(t,(function(){return{toDataURL:function(){if(T.current)return T.current.toDataURL()},getStructure:function(){return M}}}),[M]),Object(s.useEffect)((function(){var e=new ResizeObserver((function(e){var t=e[0].contentRect,n=t.width,r=t.height;u({width:n,height:r})}));return R.current&&e.observe(R.current),function(){e.disconnect()}}),[]),Object(_.jsx)(G.a,{ref:R,sx:{width:"auto",height:"100%",backgroundColor:"#ffffff",overscrollBehavior:"contain"},children:Object(_.jsx)(Oe,{value:{popupType:p,setPopupType:h,popupPosition:y,setPopupPosition:C},children:Object(_.jsx)(be,{value:{selected:d,setSelected:f},children:Object(_.jsx)(re,{value:Object(S.a)({points:E,setPoints:P,tool:r,structure:M,setStructure:N},a),children:Object(_.jsx)(Vt,Object(S.a)({ref:T,size:l,tool:r,structure:M,setStructure:N},a))})})})})},Kt=Object(s.forwardRef)(qt),Qt=["eraser"],$t=function(e){var t=e.drawings,n=e.settings,r=e.points;return Object(_.jsxs)($.e,{children:[t.map((function(e,t){var n=e.eraser,r=void 0!==n&&n,c=Object(Q.a)(e,Qt);return Object(_.jsx)($.f,Object(S.a)(Object(S.a)({},c),{},{globalCompositeOperation:r?"destination-out":"source-over"}),"note-drawing-".concat(t))})),r&&Object(_.jsx)($.f,Object(S.a)(Object(S.a)({},n),{},{points:r,globalCompositeOperation:n.eraser?"destination-out":"source-over"}))]})},en=n(92),tn=n.n(en),nn=n(93),rn=n.n(nn),cn=n(94),an=n.n(cn),on=n(8),sn=n(193),ln=n(95),un=n(178),bn=Object(on.a)("div")({display:"flex",alignItems:"center",width:"100%",padding:"0 8"}),jn=Object(on.a)("div")({flex:1}),dn=function(e){var t=e.visible,n=void 0!==t&&t,r=e.mode,c=e.y,a=e.x,i=e.width,o=e.onEdit,l=e.onCopy,u=e.onDelete,b=e.onCancel,j=Object(s.useState)(null),d=Object(O.a)(j,2),f=d[0],v=d[1],x=Object(s.useCallback)((function(e){v(e.currentTarget)}),[]),p=Object(s.useCallback)((function(){v(null)}),[]);return n?Object(_.jsxs)(Fe.a,{divProps:{style:{top:"".concat(c-42,"px"),left:"".concat(a,"px"),width:"".concat(i,"px")}},children:[Object(_.jsxs)(bn,{children:["canvas"===r&&Object(_.jsx)(sn.a,{size:"small",onClick:b,children:Object(_.jsx)(tn.a,{})}),"note"===r&&Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(sn.a,{size:"small",onClick:o,children:Object(_.jsx)(rn.a,{})}),Object(_.jsx)(jn,{}),Object(_.jsx)(sn.a,{size:"small",onClick:x,children:Object(_.jsx)(an.a,{})})]})]}),Object(_.jsxs)(ln.a,{anchorEl:f,open:Boolean(f),onClose:p,children:[Object(_.jsx)(un.a,{onClick:l,children:"\u30b3\u30d4\u30fc"}),Object(_.jsx)(un.a,{onClick:u,children:"\u524a\u9664"})]})]}):null},fn=["size","draggable","index","onChange","selected","onSelect","data","image"],On=function(e){var t=e.size,n=e.draggable,r=void 0!==n&&n,c=e.index,a=e.onChange,i=e.selected,o=void 0!==i&&i,l=e.onSelect,u=(e.data,e.image),b=Object(Q.a)(e,fn),j=Object(s.useRef)(null),d=Object(s.useRef)(null),f=Object(s.useState)(!1),v=Object(O.a)(f,2),x=v[0],p=v[1],h=ye()(null!==u&&void 0!==u?u:""),g=Object(O.a)(h,1)[0],m=Object(s.useContext)(X).mode,C=Object(s.useContext)(W),w=C.mode,k=C.editCanvas,E=C.closeCanvas,P=Object(s.useMemo)((function(){return N[t]}),[t]),I=Object(s.useMemo)((function(){return o&&!x&&"select"===m}),[x,m,o]),z=Object(s.useMemo)((function(){return r&&o}),[r,o]);Object(s.useEffect)((function(){var e;o&&d.current&&j.current&&(d.current.nodes([j.current]),null===(e=d.current.getLayer())||void 0===e||e.batchDraw())}),[o]);var M=Object(s.useCallback)((function(e){a((function(t){var n=y(t),r=n.structures[c].data;return n.structures[c]=Object(S.a)({data:r},e),n}))}),[c,a]),T=Object(s.useCallback)((function(){p(!0)}),[]),D=Object(s.useCallback)((function(e){if(e.cancelBubble=!0,j.current){var t=e.target.attrs,n=t.x,r=t.y;if("number"===typeof n&&"number"===typeof r){var c=j.current.getSize(),a=c.width,i=c.height,o=n,s=r;o<0?o=0:o>P.width-a&&(o=P.width-a),s<0?s=0:s>P.height-i&&(s=P.height-i),n===o&&r===s||j.current.setPosition({x:o,y:s})}}}),[P.height,P.width]),B=Object(s.useCallback)((function(e){if(j.current){var t=j.current.getPosition(),n=t.x,r=t.y,c=j.current.getSize(),a={x:n,y:r,width:c.width,height:c.height};p(!1),M(a)}}),[M]),F=Object(s.useCallback)((function(e,t){return t.width<R.width||t.height<R.height?e:t}),[]),J=Object(s.useCallback)((function(){if(j.current){var e=j.current,t=e.scale(),n=t.x,r=t.y;e.scale({x:1,y:1});var c={x:e.x(),y:e.y(),width:Math.max(R.width,e.width()*n),height:Math.max(R.height,e.height()*r)};M(c)}}),[M]),A=Object(s.useCallback)((function(e){var t=e.currentTarget.getBoundingClientRect(),n=t.top,r={x:t.left,y:n+42,width:b.width,height:b.height};k(r)}),[k,b.height,b.width]);return Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)($.g,Object(S.a)(Object(S.a)({},b),{},{fill:"white"})),g&&Object(_.jsx)($.d,Object(S.a)(Object(S.a)({},b),{},{image:g})),Object(_.jsx)($.g,Object(S.a)(Object(S.a)({ref:j,stroke:"black",strokeWidth:2,draggable:r},b),{},{onClick:l,onTap:l,onDragStart:T,onDragMove:D,onDragEnd:B,onTransformEnd:J})),Object(_.jsx)(dn,Object(S.a)(Object(S.a)({visible:I,mode:w},b),{},{onEdit:A,onCancel:E})),Object(_.jsx)($.j,{ref:d,visible:z,rotateEnabled:!1,boundBoxFunc:F})]})},vn=function(e){var t=e.size,n=e.structures,r=e.draggable,c=void 0!==r&&r,a=e.onChange,i=Object(s.useContext)(W),o=i.selectedCanvasIndex,l=i.onSelectCanvas,u=Object(s.useMemo)((function(){return N[t]}),[t]),b=Object(s.useCallback)((function(e){"background"===e.target.attrs.type&&l(void 0)}),[l]);return Object(_.jsxs)($.e,{children:[Object(_.jsx)($.g,Object(S.a)(Object(S.a)({x:0,y:0},u),{},{attrs:{type:"background"},onClick:b,onTap:b})),n.map((function(e,n){return Object(_.jsx)(On,Object(S.a)({size:t,draggable:c,index:n,onChange:a,selected:n===o,onSelect:function(){return l(n)}},e),"handle-".concat(n))}))]})},xn={id:"",points:[],stroke:"#c9e1ff",strokeWidth:1,dash:[5,3],listening:!1},pn=function(e){var t=e.size,n=Object(s.useMemo)((function(){return N[t]}),[t]),r=Object(s.useMemo)((function(){for(var e=[],t=1,r=0;r<=n.height;r+=50)e.push(Object(S.a)(Object(S.a)({},xn),{},{id:"Horizontal_".concat(t),points:[0,r,n.width,r]})),t++;return e}),[n]),c=Object(s.useMemo)((function(){for(var e=[],t=1,r=0;r<=n.width;r+=50)e.push(Object(S.a)(Object(S.a)({},xn),{},{id:"Vertical_".concat(t),points:[r,0,r,n.height]})),t++;return e}),[n]);return Object(_.jsxs)($.e,{children:[r.map((function(e){return Object(_.jsx)($.f,Object(S.a)({},e),e.id)})),c.map((function(e){return Object(_.jsx)($.f,Object(S.a)({},e),e.id)}))]})},hn=function(e){var t=e.viewBox,n=e.size,r=e.drawings,c=e.structures,a=e.onChange,i=Object(s.useRef)(null),o=Object(s.useContext)(X),l=o.mode,u=o.settings,b=Object(s.useContext)(W).mode,j=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=s.useRef([]);return r.current=t.map((function(e){return s.useContext(e)})),s.useMemo((function(){return function(e){var n=e.children;return t.reduceRight((function(e,t,n){return Object(_.jsx)(t.Provider,{value:r.current[n],children:e})}),n)}}),[t])}(W,F,X),d=Object(s.useRef)(),f=Object(s.useState)([]),v=Object(O.a)(f,2),x=v[0],p=v[1],h=Object(s.useMemo)((function(){return N[n]}),[n]),g=Object(s.useMemo)((function(){return"note"===b&&"select"===l}),[b,l]),m=Object(s.useCallback)((function(e){var n=e.target.attrs,r=n.x,c=n.y;if(i.current&&"number"===typeof r&&"number"===typeof c){var a=r,o=c,s=!1;a>0?(a=0,s=!0):Math.abs(a)+t.width>h.width&&(a=t.width-h.width,s=!0),o>0?(o=0,s=!0):Math.abs(o)+t.height>h.height&&(o=t.height-h.height,s=!0),s&&i.current.setPosition({x:a,y:o})}}),[h.height,h.width,t.height,t.width]),C=Object(s.useCallback)((function(e){var t;if("edit"===l){var n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();if(i.current&&n){d.current=!0;var r=i.current.getPosition(),c=r.x,a=r.y;p([n.x+Math.abs(c),n.y+Math.abs(a)])}}}),[l]),w=Object(s.useCallback)((function(e){var t;if("edit"===l&&d.current){var n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();if(i.current&&n){var r=i.current.getPosition(),c=r.x,a=r.y;p((function(e){return[].concat(Object(ee.a)(e),[n.x+Math.abs(c),n.y+Math.abs(a)])}))}}}),[l]),k=Object(s.useCallback)((function(e){"edit"===l&&d.current&&(d.current=!1,a((function(e){var t=y(e);return t.drawings.push(Object(S.a)(Object(S.a)({},u),{},{points:x})),t})),p([]))}),[l,a,x,u]);return Object(_.jsx)($.h,{ref:i,width:t.width,height:t.height,draggable:g,onDragMove:m,onPointerDown:C,onPointerMove:w,onPointerUp:k,children:Object(_.jsxs)(j,{children:[Object(_.jsx)(pn,{size:n}),Object(_.jsx)(vn,{size:n,structures:c,draggable:g,onChange:a}),Object(_.jsx)($t,{drawings:r,settings:u,points:x})]})})},gn=function(){var e=Object(s.useRef)(null),t=Object(s.useState)({width:0,height:0}),n=Object(O.a)(t,2),r=n[0],c=n[1],a=Object(s.useContext)(W),i=a.page,o=a.onChange;return Object(s.useEffect)((function(){var t=new ResizeObserver((function(e){var t=e[0].contentRect,n=t.width,r=t.height;c({width:n,height:r})}));return e.current&&t.observe(e.current),function(){t.disconnect()}}),[]),Object(_.jsx)(G.a,{ref:e,sx:{width:"auto",height:"100%",backgroundColor:"#ffffff",overscrollBehavior:"contain",overflow:"hidden"},children:Object(_.jsx)(hn,Object(S.a)(Object(S.a)({viewBox:r},i),{},{onChange:o}))})},mn=function(){var e=Object(s.useContext)(W),t=e.page,n=e.selectedCanvasIndex,r=e.canvasProps,c=e.canvasRef,a=Object(s.useContext)(F).tool,i=Object(s.useMemo)((function(){if("number"===typeof n)return t.structures[n].data}),[t.structures,n]);return Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(G.a,{sx:{boxSizing:"border-box",ml:1,mb:1,flex:1,border:function(e){return"1px solid ".concat(e.palette.divider)},borderRadius:1,overflow:"hidden"},children:Object(_.jsx)(gn,{})}),r&&Object(_.jsx)(G.a,{sx:{position:"absolute",top:r.y,left:r.x,width:r.width,height:r.height,backgroundColor:"red"},children:Object(_.jsx)(Kt,{ref:c,tool:a,structure:null!==i&&void 0!==i?i:z})})]})},yn=n(168),Cn=n(169),wn=n(170),kn=n(171),Sn=n(172),En={select:{tool:"select",icon:Object(_.jsx)(yn.a,{}),label:"\u9078\u629e"},pen:{tool:"pen",icon:Object(_.jsx)(Cn.a,{}),label:"\u6881\u8981\u7d20\u306e\u63cf\u753b"},force:{tool:"force",icon:Object(_.jsx)(wn.a,{}),label:"\u96c6\u4e2d\u8377\u91cd\u306e\u8ffd\u52a0"},trapezoid:{tool:"trapezoid",icon:Object(_.jsx)(kn.a,{}),label:"\u5206\u5e03\u8377\u91cd\u306e\u8ffd\u52a0"},delete:{tool:"delete",icon:Object(_.jsx)(Sn.a,{}),label:"\u8981\u7d20\u306e\u524a\u9664"}},Pn=function(e){var t=e.tool,n=e.onChange,r=Object(s.useCallback)((function(e,t){var r;null!==t&&("string"===typeof(r=t)&&te.some((function(e){return e===r})))&&n(t)}),[n]);return Object(_.jsxs)(Xe.a,{sx:{width:160},alignItems:"flex-start",children:[Object(_.jsx)(U.a,{variant:"caption",children:"Toolbox"}),Object(_.jsx)(Ke.a,{orientation:"vertical",value:t,exclusive:!0,fullWidth:!0,onChange:r,children:Object.entries(En).map((function(e){var t=Object(O.a)(e,2),n=t[0],r=t[1],c=r.icon,a=r.label;return Object(_.jsxs)(Qe.a,{value:n,sx:{justifyContent:"flex-start",alignItems:"center"},children:[c,Object(_.jsx)(U.a,{variant:"caption",sx:{ml:1},children:a})]},n)}))})]})},In=function(){var e=Object(s.useContext)(F),t=e.tool,n=e.setTool;return Object(_.jsx)(Pn,{tool:t,onChange:n})},zn=n(173),Mn=n(179),Nn=["pen","eraser"],Rn={select:{mode:"select",icon:Object(_.jsx)(yn.a,{}),label:"\u9078\u629e"},edit:{mode:"edit",icon:Object(_.jsx)(Cn.a,{}),label:"\u63cf\u753b"}},Tn={pen:{mode:"pen",icon:Object(_.jsx)(Cn.a,{}),label:"\u30da\u30f3\u30c4\u30fc\u30eb"},eraser:{mode:"eraser",icon:Object(_.jsx)(zn.a,{}),label:"\u6d88\u3057\u30b4\u30e0"}},Dn=function(e){var t=e.mode,n=e.settings,r=e.onChangeMode,c=e.onChangeDrawSettings,a=Object(s.useCallback)((function(e,t){var n;null!==t&&("string"===typeof(n=t)&&M.some((function(e){return e===n})))&&r(t)}),[r]),i=Object(s.useCallback)((function(e,t){var n;null!==t&&("string"===typeof(n=t)&&Nn.some((function(e){return e===n})))&&c((function(e){return Object(S.a)(Object(S.a)({},e),{},{eraser:"eraser"===t})}))}),[c]),o=Object(s.useCallback)((function(e,t){"number"===typeof t&&c((function(e){return Object(S.a)(Object(S.a)({},e),{},{strokeWidth:t})}))}),[c]),l=Object(s.useCallback)((function(e){if(e.target.checkValidity()){var t=e.target.value;c((function(e){return Object(S.a)(Object(S.a)({},e),{},{stroke:t})}))}}),[c]);return Object(_.jsxs)(Xe.a,{sx:{width:160},alignItems:"flex-start",children:[Object(_.jsx)(U.a,{variant:"caption",children:"Toolbox"}),Object(_.jsx)(Ke.a,{orientation:"vertical",value:t,exclusive:!0,fullWidth:!0,onChange:a,children:Object.entries(Rn).map((function(e){var t=Object(O.a)(e,2),n=t[0],r=t[1],c=r.icon,a=r.label;return Object(_.jsxs)(Qe.a,{value:n,sx:{justifyContent:"flex-start",alignItems:"center"},children:[c,Object(_.jsx)(U.a,{variant:"caption",sx:{ml:1},children:a})]},n)}))}),Object(_.jsx)(U.a,{variant:"caption",sx:{mt:1},children:"\u63cf\u753b\u30c4\u30fc\u30eb"}),Object(_.jsx)(Ke.a,{orientation:"vertical",value:n.eraser?"eraser":"pen",exclusive:!0,fullWidth:!0,disabled:"select"===t,onChange:i,children:Object.entries(Tn).map((function(e){var t=Object(O.a)(e,2),n=t[0],r=t[1],c=r.icon,a=r.label;return Object(_.jsxs)(Qe.a,{value:n,sx:{justifyContent:"flex-start",alignItems:"center"},children:[c,Object(_.jsx)(U.a,{variant:"caption",sx:{ml:1},children:a})]},n)}))}),Object(_.jsx)(U.a,{variant:"caption",sx:{mt:1},children:"\u592a\u3055"}),Object(_.jsx)(Mn.a,{sx:{ml:1,mb:2,boxSizing:"border-box",width:140},value:n.strokeWidth,min:4,max:20,step:4,marks:!0,valueLabelDisplay:"auto",disabled:"select"===t,onChange:o}),Object(_.jsx)(Ae.a,{type:"color",label:"\u30da\u30f3\u306e\u8272",value:n.stroke,disabled:"select"===t||n.eraser,fullWidth:!0,margin:"dense",size:"small",onChange:l})]})},_n=function(){var e=Object(s.useContext)(X);return Object(_.jsx)(Dn,Object(S.a)({},e))},Wn=function(){return"canvas"===Object(s.useContext)(W).mode?Object(_.jsx)(In,{}):Object(_.jsx)(_n,{})},Bn=function(){var e=Object(s.useState)({width:0,height:0}),t=Object(O.a)(e,2),n=t[0],r=t[1],c=Object(s.useCallback)((function(){var e=window,t=e.innerHeight,n=e.innerWidth;r({height:t,width:n})}),[]);return Object(s.useEffect)((function(){return c(),window.addEventListener("resize",c),function(){window.removeEventListener("resize",c)}}),[c]),Object(_.jsxs)(G.a,{sx:Object(S.a)(Object(S.a)({},n),{},{overflow:"hidden"}),children:[Object(_.jsx)(K,{}),Object(_.jsxs)(G.a,{sx:{boxSizing:"border-box",width:"auto",height:"calc(100% - 48px)",display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"stretch",pt:1,px:1},children:[Object(_.jsx)(Wn,{}),Object(_.jsx)(mn,{})]})]})},Fn=Object(j.a)(),Jn=function(){return Object(_.jsx)(d.a,{theme:Fn,children:Object(_.jsx)(B,{children:Object(_.jsx)(J,{children:Object(_.jsxs)(A,{children:[Object(_.jsx)(f.a,{}),Object(_.jsx)(Bn,{})]})})})})},Xn=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,194)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),r(e),c(e),a(e),i(e)}))};b.a.render(Object(_.jsx)(l.a.StrictMode,{children:Object(_.jsx)(Jn,{})}),document.getElementById("root")),Xn()}},[[123,1,2]]]);
//# sourceMappingURL=main.e473f984.chunk.js.map