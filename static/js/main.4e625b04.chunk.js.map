{"version":3,"sources":["components/Canvas/popup/pins/pin_1.svg","components/Canvas/util/vector.ts","components/Canvas/util/common.ts","components/Canvas/util/structure.ts","types/shape.ts","types/note.ts","providers/AppSettingsProvider.tsx","providers/ConfigurationProvider.tsx","providers/NoteSettingsProvider.tsx","components/Version.tsx","components/Header.tsx","hooks/useContextBridge.tsx","types/common.ts","components/Canvas/provider/StructureProvider.tsx","components/Canvas/provider/DrawProvider.tsx","components/Canvas/layer/DrawLayer.tsx","components/Canvas/layer/GridLayer.tsx","components/Canvas/provider/SelectProvider.tsx","components/Canvas/shape/Beam.tsx","components/Canvas/provider/PopupProvider.tsx","components/Canvas/shape/Force.tsx","components/Canvas/shape/Guide.tsx","components/Canvas/shape/Node.tsx","components/Canvas/shape/Trapezoid.tsx","components/Canvas/layer/GuideLayer.tsx","components/Canvas/layer/ShapeLayer.tsx","components/Canvas/popup/ForceEditor.tsx","components/Canvas/popup/pins/pin_2.svg","components/Canvas/popup/pins/pin_3.svg","components/Canvas/popup/pins/pin_4.svg","components/Canvas/popup/PinSelector.tsx","components/Canvas/popup/TrapezoidEditor.tsx","components/Canvas/popup/index.tsx","components/Canvas/core.tsx","components/Canvas/provider/CanvasProvider.tsx","components/Canvas/index.tsx","components/Note/layer/Draw.tsx","components/Note/nodes/CanvasHandle/HeaderMenu.tsx","components/Note/nodes/CanvasHandle/index.tsx","components/Note/layer/Frame.tsx","components/Note/layer/Grid.tsx","components/Note/Page.tsx","components/Note/index.tsx","components/MainContainer.tsx","components/Toolbox/CanvasToolbox.tsx","components/Toolbox/NoteToolbox.tsx","components/Toolbox/index.tsx","components/Layout.tsx","components/App.tsx","reportWebVitals.ts","index.tsx"],"names":["_path","vX","Vector","vY","lerp","v1","v2","alpha","dir","clone","subtract","normalize","distance","mv","multiplyScalar","add","verticalNormalizeVector","v","y","x","dot","invert","data","JSON","parse","stringify","round","value","figure","n","result","Math","snapping","snapSize","i","snap","createNode","id","uuid","NodePinTypes","emptyStructure","unit","force","length","nodes","beams","forces","trapezoids","NoteModes","PageSize","A3","width","height","A4","B4","B5","MinCanvasSize","defaultDrawSettings","stroke","strokeWidth","eraser","lineJoin","lineCap","defaultPageProps","size","drawings","structures","AppSettingsContext","createContext","undefined","AppSettingsProvider","children","useState","mode","setMode","page","setPage","selectedCanvasIndex","setCanvasIndex","canvasProps","setCanvasProps","canvasRef","useRef","editCanvas","useCallback","props","closeCanvas","current","structure","getStructure","image","toDataURL","state","Provider","onChangeMode","onChange","onSelectCanvas","ConfigurationContext","ConfigurationProvider","tool","setTool","NoteSettingsContext","NoteSettingsProvider","settings","setSettings","onChangeDrawSettings","hash","process","substring","date","version","Version","Typography","variant","sx","ml","Header","AppBar","position","Toolbar","component","color","useContextBridge","contexts","cRef","React","map","context","reduceRight","acc","Context","CanvasTools","StructureContext","StructureProvider","readonly","gridSize","source","setStructure","addForce","params","name","createForce","push","deleteForce","index","findIndex","splice","deleteTrapezoid","deleteBeam","nodeI","nodeJ","forEach","node","exists","some","j","filter","beam","DrawContext","DrawProvider","useContext","points","setPoints","isDrawing","beamRef","disabled","useMemo","handlePointerDown","event","target","attrs","beamId","beamPoints","item","Array","isArray","every","point","getStage","getPointerPosition","handlePointerMove","makeBeam","start","end","edgeI","edgeJ","n1","find","n2","createBeam","makeTrapezoid","trapezoid","pi","slice","pj","bi","bj","beamLength","beamDirection","ps","pe","disStart","disEnd","ti","angle","r","cos","tj","distanceI","distanceJ","forceI","forceJ","isGlobal","createTrapezoid","handlePointerUp","onPointerDown","onPointerMove","onPointerUp","DrawLayer","ConnectedDrawLayer","defaultLineProps","dash","listening","GridLayer","horizontalLines","lines","count","verticalLines","SelectContext","SelectProvider","selected","setSelected","isSelected","type","select","toggle","Beam","onDelete","onSelect","labelPosition","setLabelPosition","labelWidth","setLabelWidth","labelAngle","setLabelAngle","guidePoints","setGuidePoints","viRef","vjRef","handleClick","cancelBubble","useEffect","vi","vj","label","angleDeg","guideDir","guideI","guideJ","onClick","onTap","rotation","text","fontSize","fill","align","wrap","ellipsis","Guide","ConnectedBeam","handleAddForce","vp","createForceParams","handleDelete","handleSelect","PopupContext","PopupProvider","popupType","setPopupType","top","left","popupPosition","setPopupPosition","popupParams","setPopupParams","open","close","Force","forceRatio","onEdit","setDistance","setRotation","tail","vertical","arrowLength","head","max","p","handleLabelClick","handleLabelDoubleClick","pointerLength","pointerWidth","offsetX","onDblClick","onDblTap","ConnectedForce","handleEdit","defaultGuideProps","defaultGuideArrowProps","pointerAtBeginning","GuideLine","v1Ref","v2Ref","basis","setBasis","dist","Pins","free","pin","pinX","pinZ","fixX","fix","Node","draggable","onCommit","isDragging","setIsDragging","pointRef","timerRef","imageUrl","useImage","redraw","handleDragStart","handleDragMove","handleDragEnd","clearInterval","handleDoubleClick","timer","setInterval","radius","onDragStart","onDragMove","onDragEnd","_useStrictMode","offsetY","ConnectedNode","Boolean","handleChange","px","py","values","handleCommit","targetId","newId","defaultArrowProps","defaultLabelProps","Trapezoid","arrows","setArrows","line","setLine","labelI","setLabelI","labelJ","setLabelJ","vI","vJ","vd","rotateDeg","direction","interval","getInsidePoints","slope","NaN","intercept","isNaN","insideArrows","pd","pu","targetLine","slope1","intercept1","slope2","intercept2","rangeX","sort","a","b","rangeY","err","console","error","intercectPoint","arrow","guidePosition","gi","gj","ConnectedTrapezoid","GuideInterval","GuideLayer","guide","maxX","Number","MIN_SAFE_INTEGER","minX","MAX_SAFE_INTEGER","guidesX","maxY","minY","guidesY","pointsX","Set","pointsY","has","array","from","prev","key","localX","GlobalVerticalGuidePositionX","GlobalHorizontalGuidePositionY","ShapeLayerCore","layerProps","items","average","reduce","c","Object","entries","ShapeLayer","ForceEditor","onClose","setValue","setError","handleSubmit","preventDefault","currentTarget","checkValidity","num","parseFloat","errorMessage","Paper","Stack","spacing","autoComplete","noValidate","onSubmit","TextField","margin","required","fullWidth","InputProps","endAdornment","InputAdornment","helperText","justifyContent","Button","ConnectedForceEditor","isForce","_extends","assign","arguments","prototype","hasOwnProperty","call","apply","this","_objectWithoutProperties","excluded","sourceKeys","keys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","SvgPin1","_ref","svgRef","title","titleId","viewBox","xmlns","ref","d","_circle","_circle2","_line","ForwardRef","SvgPin2","cx","cy","x1","y1","x2","y2","SvgPin3","style","_line2","_line3","_line4","_line5","SvgPin4","PinButtons","icon","SvgIcon","transform","defaultButtonProps","alignItems","PinSelector","setPin","_","newValue","ToggleButtonGroup","orientation","exclusive","ToggleButton","ConnectedPinSelector","isNode","validateForce","val","validateAngle","parseInt","TrapezoidEditor","setValues","errors","setErrors","value1","valid1","value2","valid2","value3","valid3","valid","parseFormValues","log","error1","error2","handleChangeIsGlobal","checked","toFormValues","FormControlLabel","control","Checkbox","ConnectedTrapezoidEditor","isTrapezoid","Popup","handleChangeForce","handleChangeTrapezoid","handleChangeNode","Box","zIndex","CanvasCore","ContextBridge","useImperativeHandle","forwardRef","CanvasProvider","Canvas","setSize","containerRef","observer","ResizeObserver","contentRect","observe","disconnect","backgroundColor","overscrollBehavior","Draw","lineProps","globalCompositeOperation","Background","styled","display","padding","Spacer","flex","HeaderMenu","visible","onCopy","onCancel","anchorEl","setAnchorEl","handleClickMore","handleCloseMenu","divProps","IconButton","Menu","MenuItem","CanvasHandle","dataURL","rectRef","tfRef","setDragging","noteMode","appMode","pageSize","visibleMenu","visibleTransformer","getLayer","batchDraw","rect","newPage","getSize","newX","newY","setPosition","getPosition","newRectProps","handleChangeBoundBox","oldBox","newBox","handleTransformEnd","scale","scaleX","scaleY","getBoundingClientRect","onTransformEnd","rotateEnabled","boundBoxFunc","Frame","Grid","layerSize","Page","stageRef","modified","abs","Note","setViewBox","overflow","MainContainer","boxSizing","mb","border","theme","palette","divider","borderRadius","ToolboxButtons","PanToolAlt","pen","ArrowDownward","Texture","delete","Delete","CanvasToolboxCore","CanvasToolbox","DrawModes","NoteModeButtons","edit","DrawModeButtons","AutoFixNormal","NoteToolboxCore","handleChangeMode","handleChangeTool","handleChangeStrokeWidth","handleChangeStroke","mt","Slider","min","step","marks","valueLabelDisplay","NoteToolbox","Toolbox","Layout","windowRect","setWindowRect","fitWindowSize","window","innerHeight","innerWidth","addEventListener","removeEventListener","flexDirection","flexWrap","pt","createTheme","App","ThemeProvider","CssBaseline","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.4e625b04.chunk.js","sourcesContent":["var _path;\n\nvar _excluded = [\"title\", \"titleId\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgPin1(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    id: \"svg\",\n    viewBox: \"0 0 160 160\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M80 0 L30 80 L130 80 Z\",\n    strokeWidth: 6,\n    stroke: \"gray\",\n    fill: \"transparent\"\n  })));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgPin1);\nexport default __webpack_public_path__ + \"static/media/pin_1.92d54adc.svg\";\nexport { ForwardRef as ReactComponent };","import Vector from 'victor';\n\nexport { Vector };\n\n// X方向のベクトル\nexport const vX = new Vector(1, 0);\n// Y方向のベクトル\nexport const vY = new Vector(0, 1);\n\n/**\n * v1 と v2 の間にある vp を取得する\n * @param v1\n * @param v2\n * @param alpha\n * @returns\n */\nexport const lerp = (v1: Vector, v2: Vector, alpha: number): Vector => {\n    if (alpha >= 1) {\n        return v2;\n    }\n    if (alpha <= 0) {\n        return v1;\n    }\n    const dir = v2.clone().subtract(v1).normalize();\n    const distance = v1.distance(v2);\n    const mv = dir.multiplyScalar(distance * alpha);\n    return v1.clone().add(mv);\n};\n\n/**\n * v1 と v2 に直交する単位ベクトルを返す\n * @param v1\n * @param v2\n * @returns\n */\nexport const verticalNormalizeVector = (v1: Vector, v2: Vector): Vector => {\n    const dir = v2.clone().subtract(v1).normalize();\n    const v = new Vector(dir.y, dir.x * -1).normalize();\n\n    const value = vY.dot(v);\n    if (value > 0) {\n        v.invert();\n    }\n\n    return v;\n};\n","import { Point } from '../types';\nimport { lerp, Vector } from './vector';\n\nexport const clone = <T>(data: T): T => {\n    return JSON.parse(JSON.stringify(data)) as T;\n};\n\nexport const round = (value: number, figure = 3): number => {\n    const n = 10 ** figure;\n    const result = Math.round(value * n) / n;\n    return result;\n};\n\nconst snapping = (value: number, snapSize = 25): number => {\n    const n = value / snapSize;\n    const i = Math.round(n) * snapSize;\n    return i;\n};\n\nexport const DEFAULT_SNAP_SIZE = 25;\n\nexport const snap = ([x, y]: [number, number], snapSize = DEFAULT_SNAP_SIZE): [number, number] => {\n    return [snapping(x, snapSize), snapping(y, snapSize)];\n};\n\nconst InsideArrowCount = 10;\nconst InsideArrowInterval = 25;\nconst InsideArrowMinInterval = 10;\n\n/**\n * 開始点から終了点まで等間隔に点を取る\n * @param start\n * @param end\n * @param direction\n * @returns\n */\nexport const getInsidePoints = (start: Vector, end: Vector, direction: Vector): Vector[] => {\n    const points: Vector[] = [];\n    // 2点間の距離\n    const distance = start.distance(end);\n    // 分割数\n    let count = InsideArrowCount;\n    // 間隔\n    let interval = distance / (count + 1);\n    while (interval < InsideArrowInterval && count > 0) {\n        count--;\n        interval = distance / (count + 1);\n    }\n\n    if (count > 0) {\n        // 始点から interval の間隔で count 個 点を取る\n        for (let i = 1; i <= count; i++) {\n            const point = start.clone().add(direction.clone().multiplyScalar(interval * i));\n            points.push(point);\n        }\n    } else {\n        // 半分にしてみる\n        interval = distance / 2;\n        if (interval >= InsideArrowMinInterval) {\n            // 半分の位置に点を置く\n            const point = lerp(start, end, 0.5);\n            points.push(point);\n        }\n    }\n\n    return points;\n};\n\n/**\n * 開始点からある方向に伸ばした線が対象となる線と交わる点を取得する\n * @param targetLine 対象となる Line [始点、終点、傾き、切片]\n * @param start 開始点\n * @param dir 方向\n * @returns 交点（なければ null）\n */\nexport const intercectPoint = (\n    targetLine: [Vector, Vector, number, number],\n    start: Vector,\n    dir: Vector\n): Point | null => {\n    const [pi, pj, slope1, intercept1] = targetLine;\n    let point: Point | null = null;\n    try {\n        // dir の傾き\n        const end: Vector = start.clone().add(dir);\n        const slope2 = end.x - start.x !== 0 ? (end.y - start.y) / (end.x - start.x) : NaN;\n        // dir の切片\n        const intercept2 = isNaN(slope2) ? NaN : start.y - slope2 * start.x;\n\n        if (slope1 === slope2) {\n            // 平行なので交点なし\n            return null;\n        }\n\n        if (!isNaN(slope1) && !isNaN(slope2)) {\n            // どちらも垂直でない\n            const px = (intercept2 - intercept1) / (slope1 - slope2);\n            const py = slope1 * px + intercept1;\n\n            point = [px, py];\n        } else if (isNaN(slope1)) {\n            // 対象の Line が垂直\n            const px = pi.x;\n            const py = px * slope2 + intercept2;\n\n            point = [px, py];\n        } else if (isNaN(slope2)) {\n            // dir が垂直\n            const px = start.x;\n            const py = px * slope1 + intercept1;\n\n            point = [px, py];\n        }\n\n        // 交点が Line の内側？\n        if (point) {\n            const [x, y] = point;\n            const rangeX = [pi.x, pj.x].sort((a, b) => a - b);\n            const rangeY = [pi.y, pj.y].sort((a, b) => a - b);\n            if (x >= rangeX[0] && x <= rangeX[1] && y >= rangeY[0] && y <= rangeY[1]) {\n                return point;\n            }\n        }\n        return null;\n    } catch (err) {\n        console.error(err);\n    }\n\n    return null;\n};\n","import { v4 as uuid } from 'uuid';\nimport { Beam, Force, Node, Structure, Trapezoid } from '../../../types/shape';\nimport { round } from './common';\nimport { Vector } from './vector';\n\n/**\n * 節点の作成\n * @param x\n * @param y\n * @returns\n */\nexport const createNode = (x: number, y: number): Node => {\n    return {\n        id: uuid(),\n        x,\n        y,\n    };\n};\n\nexport const createBeam = (name: string, nodeI: string, nodeJ: string): Beam => {\n    return {\n        id: uuid(),\n        name,\n        nodeI,\n        nodeJ,\n    };\n};\n\ntype CreateForceParams = Omit<Force, 'id'>;\n\nexport const createForce = (params: CreateForceParams): Force => {\n    return {\n        ...params,\n        id: uuid(),\n    };\n};\n\nexport const createForceParams = (\n    beam: string,\n    vi: Vector,\n    vj: Vector,\n    vp: Vector\n): Omit<Force, 'id' | 'name'> => {\n    const beamLength = vi.distance(vj);\n    // クリック位置までの距離\n    const distance = vi.distance(vp);\n\n    return {\n        beam,\n        force: 10,\n        distanceI: round(distance / beamLength),\n    };\n};\n\nexport const replaceNode = (structure: Structure, targetId: string, newId: string): Structure => {\n    structure.beams.forEach((beam) => {\n        if (beam.nodeI === targetId) {\n            beam.nodeI = newId;\n        }\n        if (beam.nodeJ === targetId) {\n            beam.nodeJ = newId;\n        }\n    });\n    return structure;\n};\n\nexport const createTrapezoid = (\n    start: number[],\n    end: number[],\n    beamId: string,\n    beamPoints: number[]\n): Trapezoid => {\n    // 梁要素の情報\n    const pi = beamPoints.slice(0, 2);\n    const pj = beamPoints.slice(-2);\n    const bi = new Vector(pi[0], pi[1]);\n    const bj = new Vector(pj[0], pj[1]);\n    const beamLength = bi.distance(bj);\n    const beamDirection = bj.clone().subtract(bi).normalize();\n\n    // ドラッグ開始点/終了点\n    let ps = new Vector(start[0], start[1]);\n    let pe = new Vector(end[0], end[1]);\n    // 開始点と終了点のどちらが i端に近い？\n    let disStart = bi.distance(ps);\n    let disEnd = bi.distance(pe);\n    if (disStart > disEnd) {\n        // 終了点の方が i端に近ければ入れ替える\n        [ps, pe] = [pe, ps];\n        [disStart, disEnd] = [disEnd, disStart];\n    }\n\n    // 分布荷重の開始点を梁要素上の座標に取り直す\n    const ti = bi.clone().add(beamDirection.clone().multiplyScalar(disStart));\n    // ドラッグ方向\n    const dir = pe.clone().subtract(ti).normalize();\n    // 梁要素とドラッグ方向が成す角度\n    const angle = beamDirection.angle() - dir.angle();\n    // 開始点からドラッグ終了点までの長さ\n    const dragLength = ti.distance(pe);\n    // 角度と長さから分布荷重の終了点を計算する\n    const r = dragLength * Math.cos(angle);\n    const tj = ti.clone().add(beamDirection.clone().multiplyScalar(r));\n    // j端から分布荷重の終了点までの距離を取り直す\n    disEnd = bj.distance(tj);\n\n    // i端から開始点までの比率\n    const distanceI = round(disStart / beamLength, 3);\n    const distanceJ = round(disEnd / beamLength, 3);\n\n    const trapezoid: Trapezoid = {\n        id: uuid(),\n        name: 'Trapezoid_N', //仮に名前を設定\n        beam: beamId,\n        forceI: 10,\n        forceJ: 10,\n        distanceI,\n        distanceJ,\n        angle: 90,\n        isGlobal: false,\n    };\n\n    return trapezoid;\n};\n","/**\n * 単位: 力\n */\nexport const ForceUnitValues = ['N', 'kN'] as const;\n\n/**\n * 単位: 長さ\n */\nexport const LengthUnitValues = ['mm', 'cm', 'm'] as const;\n\nexport type ForceUnitType = typeof ForceUnitValues[number];\nexport type LengthUnitType = typeof LengthUnitValues[number];\n\n/**\n * 単位\n */\nexport interface Unit {\n    force: ForceUnitType;\n    length: LengthUnitType;\n}\n\nexport const NodePinTypes = ['free', 'pin', 'pinX', 'pinZ', 'fixX', 'fix'] as const;\nexport type NodePinType = typeof NodePinTypes[number];\n\nexport const isNodePinType = (item: unknown): item is NodePinType => {\n    if (typeof item === 'string') {\n        return NodePinTypes.some((type) => type === item);\n    }\n    return false;\n};\n\nexport interface Node {\n    id: string;\n    x: number;\n    y: number;\n    pin?: NodePinType;\n}\n\nexport const isNode = (item: unknown): item is Node => {\n    if (item && typeof item === 'object') {\n        const value = item as Record<string, unknown>;\n        return (\n            typeof value.id === 'string' &&\n            typeof value.x === 'number' &&\n            typeof value.y === 'number'\n        );\n    }\n    return false;\n};\n\nexport interface Beam {\n    id: string;\n    name: string;\n    nodeI: string;\n    nodeJ: string;\n}\n\nexport interface Force {\n    id: string;\n    name: string;\n    beam: string;\n    force: number;\n    // i端からの距離 (0 〜 1)\n    distanceI: number;\n}\nexport const isForce = (item: unknown): item is Force => {\n    if (item && typeof item === 'object') {\n        const value = item as Record<string, unknown>;\n        return (\n            typeof value.id === 'string' &&\n            typeof value.name === 'string' &&\n            typeof value.beam === 'string' &&\n            typeof value.force === 'number' &&\n            typeof value.distanceI === 'number'\n        );\n    }\n    return false;\n};\n\nexport interface Trapezoid {\n    id: string;\n    name: string;\n    beam: string;\n    // kN/m\n    forceI: number;\n    // kN/m\n    forceJ: number;\n    // i端からの距離 (0 〜 1, distanceI + distanceJ <= 1)\n    distanceI: number;\n    // j端からの距離 (0 〜 1, distanceI + distanceJ <= 1)\n    distanceJ: number;\n    // 角度、デフォルト 90度、-179 〜 180 度の間で指定 (-180 = 180)\n    angle?: number;\n    // 全体座標系に垂直か、部材に垂直か デフォルト false\n    isGlobal?: boolean;\n}\n\nexport const isTrapezoid = (item: unknown): item is Trapezoid => {\n    if (item && typeof item === 'object') {\n        const value = item as Record<string, unknown>;\n        return (\n            typeof value.id === 'string' &&\n            typeof value.name === 'string' &&\n            typeof value.beam === 'string' &&\n            typeof value.forceI === 'number' &&\n            typeof value.distanceI === 'number' &&\n            typeof value.forceJ === 'number' &&\n            typeof value.distanceJ === 'number'\n        );\n    }\n    return false;\n};\n\nexport interface Structure {\n    unit: Unit;\n    nodes: Node[];\n    beams: Beam[];\n    forces: Force[];\n    trapezoids: Trapezoid[];\n}\n\nexport type StructureFieldType = keyof Omit<Structure, 'unit'>;\n\nexport const defaultUnit: Unit = {\n    force: 'kN',\n    length: 'm',\n};\n\nexport const emptyStructure: Structure = {\n    unit: defaultUnit,\n    nodes: [],\n    beams: [],\n    forces: [],\n    trapezoids: [],\n};\n","import { LineCap, LineJoin } from 'konva/lib/Shape';\nimport { DOMSize } from './common';\nimport { emptyStructure, Structure } from './shape';\n\nconst NoteModes = ['select', 'edit'] as const;\nexport type NoteMode = typeof NoteModes[number];\nexport const isNoteMode = (item: unknown): item is NoteMode => {\n    if (typeof item === 'string') {\n        return NoteModes.some((mode) => mode === item);\n    }\n    return false;\n};\n\nexport const PageSizeTypes = ['A4', 'A3', 'B5', 'B4'] as const;\nexport type PageSizeType = typeof PageSizeTypes[number];\n\nexport const PageSize: Record<PageSizeType, DOMSize> = {\n    A3: {\n        width: 0,\n        height: 0,\n    },\n    A4: {\n        width: 2970,\n        height: 2100,\n    },\n    B4: {\n        width: 0,\n        height: 0,\n    },\n    B5: {\n        width: 0,\n        height: 0,\n    },\n};\n\nexport interface StructureCanvasProps {\n    data: Structure;\n    image?: string;\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n}\n\nexport const MinCanvasSize: DOMSize = {\n    width: 160,\n    height: 90,\n};\n\nexport interface DrawingProps {\n    stroke: string;\n    strokeWidth: number;\n    eraser?: boolean;\n    points: number[];\n    lineJoin?: LineJoin;\n    lineCap?: LineCap;\n}\nexport type DrawSettings = Omit<DrawingProps, 'points'>;\nexport const defaultDrawSettings: DrawSettings = {\n    stroke: '#000000',\n    strokeWidth: 4,\n    eraser: false,\n    lineJoin: 'round',\n    lineCap: 'round',\n};\n\nexport interface PageProps {\n    size: PageSizeType;\n    drawings: DrawingProps[];\n    structures: StructureCanvasProps[];\n}\n\nexport const defaultPageProps: PageProps = {\n    size: 'A4',\n    drawings: [],\n    structures: [\n        {\n            data: emptyStructure,\n            x: 100,\n            y: 100,\n            ...MinCanvasSize,\n        },\n    ],\n};\n","import {\n    createContext,\n    Dispatch,\n    RefObject,\n    SetStateAction,\n    useCallback,\n    useRef,\n    useState,\n} from 'react';\nimport { CanvasHandler } from '../components/Canvas';\nimport { clone } from '../components/Canvas/util';\nimport { AppMode, ShapeBaseProps } from '../types/common';\nimport { defaultPageProps, PageProps } from '../types/note';\n\ninterface Props {\n    children: React.ReactNode;\n}\n\ninterface IAppSettingsContext {\n    mode: AppMode;\n    onChangeMode: Dispatch<SetStateAction<AppMode>>;\n    page: PageProps;\n    onChange: Dispatch<SetStateAction<PageProps>>;\n    selectedCanvasIndex?: number;\n    onSelectCanvas: Dispatch<SetStateAction<number | undefined>>;\n    canvasProps?: ShapeBaseProps;\n    editCanvas: (props: ShapeBaseProps) => void;\n    closeCanvas: VoidFunction;\n    canvasRef: RefObject<CanvasHandler>;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\nexport const AppSettingsContext = createContext<IAppSettingsContext>(undefined!);\n\nconst AppSettingsProvider: React.VFC<Props> = ({ children }) => {\n    const [mode, setMode] = useState<AppMode>('note');\n    const [page, setPage] = useState<PageProps>(defaultPageProps);\n    const [selectedCanvasIndex, setCanvasIndex] = useState<number>();\n    const [canvasProps, setCanvasProps] = useState<ShapeBaseProps>();\n    const canvasRef = useRef<CanvasHandler>(null);\n\n    const editCanvas = useCallback((props: ShapeBaseProps) => {\n        setMode('canvas');\n        setCanvasProps(props);\n    }, []);\n\n    const closeCanvas = useCallback(() => {\n        if (canvasRef.current) {\n            // 更新した構造データを取得する\n            const structure = canvasRef.current.getStructure();\n            const image = canvasRef.current.toDataURL();\n\n            // 選択中のキャンバスのデータを更新\n            if (typeof selectedCanvasIndex === 'number') {\n                setPage((state) => {\n                    const data = clone(state);\n                    data.structures[selectedCanvasIndex].data = structure;\n                    data.structures[selectedCanvasIndex].image = image;\n                    return data;\n                });\n            }\n        }\n\n        // 状態をリセット\n        setMode('note');\n        setCanvasProps(undefined);\n    }, [selectedCanvasIndex]);\n\n    return (\n        <AppSettingsContext.Provider\n            value={{\n                mode,\n                onChangeMode: setMode,\n                page,\n                onChange: setPage,\n                selectedCanvasIndex,\n                onSelectCanvas: setCanvasIndex,\n                canvasProps,\n                editCanvas,\n                closeCanvas,\n                canvasRef,\n            }}\n        >\n            {children}\n        </AppSettingsContext.Provider>\n    );\n};\n\nexport default AppSettingsProvider;\n","import { createContext, useState } from 'react';\nimport { CanvasTool } from '../types/common';\n\ninterface Props {\n    children: React.ReactNode;\n}\n\ninterface IConfigurationContext {\n    tool: CanvasTool;\n    setTool: (tool: CanvasTool) => void;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\nexport const ConfigurationContext = createContext<IConfigurationContext>(undefined!);\n\nconst ConfigurationProvider: React.VFC<Props> = ({ children }) => {\n    const [tool, setTool] = useState<CanvasTool>('select');\n\n    return (\n        <ConfigurationContext.Provider value={{ tool, setTool }}>\n            {children}\n        </ConfigurationContext.Provider>\n    );\n};\n\nexport default ConfigurationProvider;\n","import { createContext, Dispatch, SetStateAction, useState } from 'react';\nimport { defaultDrawSettings, DrawSettings, NoteMode } from '../types/note';\n\ninterface Props {\n    children: React.ReactNode;\n}\n\ninterface INoteSettingsContext {\n    mode: NoteMode;\n    settings: DrawSettings;\n    onChangeMode: Dispatch<SetStateAction<NoteMode>>;\n    onChangeDrawSettings: Dispatch<SetStateAction<DrawSettings>>;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\nexport const NoteSettingsContext = createContext<INoteSettingsContext>(undefined!);\n\nconst NoteSettingsProvider: React.VFC<Props> = ({ children }) => {\n    const [mode, setMode] = useState<NoteMode>('select');\n    const [settings, setSettings] = useState<DrawSettings>(defaultDrawSettings);\n\n    return (\n        <NoteSettingsContext.Provider\n            value={{ mode, settings, onChangeMode: setMode, onChangeDrawSettings: setSettings }}\n        >\n            {children}\n        </NoteSettingsContext.Provider>\n    );\n};\n\nexport default NoteSettingsProvider;\n","import { Typography } from '@mui/material';\n\nconst hash = process.env.REACT_APP_GIT_COMMIT_HASH?.substring(0, 7) ?? '';\nconst date = process.env.REACT_APP_GIT_COMMIT_DATE ?? '';\nconst version = process.env.REACT_APP_PACKAGE_VERSION ?? '';\n\nconst Version: React.VFC = () => {\n    return (\n        <Typography\n            variant=\"caption\"\n            sx={{ ml: 2 }}\n        >{`ver ${version} (${hash}: ${date})`}</Typography>\n    );\n};\n\nexport default Version;\n","import { AppBar, Toolbar, Typography } from '@mui/material';\nimport Version from './Version';\n\nconst Header: React.VFC = () => {\n    return (\n        <AppBar position=\"static\">\n            <Toolbar variant=\"dense\">\n                <Typography component=\"h1\" variant=\"h6\" color=\"inherit\">\n                    Drawing Sample\n                </Typography>\n                <Version />\n            </Toolbar>\n        </AppBar>\n    );\n};\n\nexport default Header;\n","/* eslint-disable @typescript-eslint/explicit-module-boundary-types */\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable react-hooks/rules-of-hooks */\nimport * as React from 'react';\n\n// https://github.com/pmndrs/drei/blob/master/src/core/useContextBridge.tsx\nexport const useContextBridge = (...contexts: Array<React.Context<any>>) => {\n    const cRef = React.useRef<Array<React.Context<any>>>([]);\n    cRef.current = contexts.map((context) => React.useContext(context));\n\n    return React.useMemo(\n        () =>\n            ({ children }: { children: React.ReactNode }): JSX.Element =>\n                contexts.reduceRight(\n                    (acc, Context, i) => (\n                        <Context.Provider value={cRef.current[i]} children={acc} />\n                    ),\n                    children\n                ) as unknown as JSX.Element,\n        [contexts]\n    );\n};\n","// --- app 共通 ---\nexport interface DOMSize {\n    width: number;\n    height: number;\n}\n\nexport interface ShapePosition {\n    x: number;\n    y: number;\n}\n\nexport type ShapeBaseProps = DOMSize & ShapePosition;\n\nexport const AppModes = ['note', 'canvas'] as const;\nexport type AppMode = typeof AppModes[number];\n\n// --- canvas関係 ---\n\nexport const CanvasTools = ['select', 'pen', 'force', 'trapezoid', 'delete'] as const;\nexport type CanvasTool = typeof CanvasTools[number];\nexport const isCanvasTool = (item: unknown): item is CanvasTool => {\n    if (typeof item === 'string') {\n        return CanvasTools.some((tool) => tool === item);\n    }\n    return false;\n};\n\nexport const isNumberArray = (item: unknown): item is number[] => {\n    if (Array.isArray(item)) {\n        if (item.length === 0) {\n            return true;\n        }\n\n        return item.every((value) => typeof value === 'number');\n    }\n    return false;\n};\n","import { createContext, Dispatch, SetStateAction, useCallback, useState } from 'react';\nimport { CanvasTool, DOMSize } from '../../../types/common';\nimport { Force, Structure } from '../../../types/shape';\nimport { clone, createForce } from '../util';\n\nexport interface StructureProviderProps {\n    children: React.ReactNode;\n    size: DOMSize;\n    structure: Structure;\n    gridSize?: number;\n    snapSize?: number;\n    tool?: CanvasTool;\n    readonly?: boolean;\n}\n\ntype AddForceFunction = (params: Omit<Force, 'id' | 'name'>) => void;\n\ninterface IStructureContext {\n    // 選択されているツール\n    tool: CanvasTool;\n    // 編集可否\n    readonly?: boolean;\n    // キャンバスのサイズ\n    size: DOMSize;\n    // グリッドの幅\n    gridSize: number;\n    // スナップする単位\n    snapSize: number;\n    // 単位変換された構造データ\n    structure: Structure;\n    // 集中荷重の追加\n    addForce: AddForceFunction;\n    // 集中荷重の削除\n    deleteForce: (id: string) => void;\n    // 分布荷重の削除\n    deleteTrapezoid: (id: string) => void;\n    // 梁要素の削除\n    deleteBeam: (id: string) => void;\n    // 構造データの更新\n    setStructure?: Dispatch<SetStateAction<Structure>>;\n}\n\n// Context | React TypeScript Cheatsheets\n// https://react-typescript-cheatsheet.netlify.app/docs/basic/getting-started/context/\n// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\nexport const StructureContext = createContext<IStructureContext>(undefined!);\n\nconst StructureProvider: React.VFC<StructureProviderProps> = ({\n    children,\n    tool = 'select',\n    readonly = false,\n    size,\n    gridSize = 25,\n    snapSize = 25,\n    structure: source,\n}) => {\n    // データ\n    const [structure, setStructure] = useState(source);\n\n    const addForce = useCallback(\n        (params: Omit<Force, 'id' | 'name'>) => {\n            if (readonly) {\n                return;\n            }\n\n            const data = clone(structure);\n            const name = `Force_${data.forces.length + 1}`;\n            const force = createForce({ name, ...params });\n            data.forces.push(force);\n            setStructure(data);\n        },\n        [readonly, structure]\n    );\n\n    const deleteForce = useCallback(\n        (id: string) => {\n            if (readonly) {\n                return;\n            }\n\n            const index = structure.forces.findIndex(({ id: itemId }) => itemId === id);\n            if (index >= 0) {\n                const data = clone(structure);\n                data.forces.splice(index, 1);\n                setStructure(data);\n            }\n        },\n        [readonly, structure]\n    );\n\n    const deleteTrapezoid = useCallback(\n        (id: string) => {\n            if (readonly) {\n                return;\n            }\n\n            const index = structure.trapezoids.findIndex(({ id: itemId }) => itemId === id);\n            if (index >= 0) {\n                const data = clone(structure);\n                data.trapezoids.splice(index, 1);\n                setStructure(data);\n            }\n        },\n        [readonly, structure]\n    );\n\n    const deleteBeam = useCallback(\n        (id: string) => {\n            if (readonly) {\n                return;\n            }\n\n            const index = structure.beams.findIndex(({ id: itemId }) => itemId === id);\n            if (index >= 0) {\n                const { nodeI, nodeJ } = structure.beams[index];\n                // 梁要素を削除\n                const data = clone(structure);\n                data.beams.splice(index, 1);\n\n                // beam の両端の節点について、該当 beam 以外で使用していなければ削除\n                [nodeI, nodeJ].forEach((node) => {\n                    // 他 beam で使用されていないかチェック\n                    const exists = data.beams.some(({ nodeI: i, nodeJ: j }) => {\n                        return node === i || node === j;\n                    });\n\n                    if (!exists) {\n                        // 該当 node を削除\n                        const i = data.nodes.findIndex(({ id: nodeId }) => nodeId === node);\n                        if (i >= 0) {\n                            data.nodes.splice(i, 1);\n                        }\n                    }\n                });\n\n                // beam に紐づく集中荷重を削除\n                const forces = data.forces.filter(({ beam }) => beam !== id);\n                data.forces = forces;\n                // beam に紐づく分布荷重を削除\n                const trapezoids = data.trapezoids.filter(({ beam }) => beam !== id);\n                data.trapezoids = trapezoids;\n\n                setStructure(data);\n            }\n        },\n        [readonly, structure]\n    );\n\n    return (\n        <StructureContext.Provider\n            value={{\n                tool,\n                readonly,\n                size,\n                gridSize,\n                snapSize,\n                structure,\n                addForce,\n                deleteForce,\n                deleteTrapezoid,\n                deleteBeam,\n                setStructure,\n            }}\n        >\n            {children}\n        </StructureContext.Provider>\n    );\n};\n\nexport default StructureProvider;\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport {\n    createContext,\n    ReactNode,\n    useCallback,\n    useContext,\n    useMemo,\n    useRef,\n    useState,\n} from 'react';\nimport { isNumberArray } from '../../../types/common';\nimport { clone, createBeam, createNode, createTrapezoid, DEFAULT_SNAP_SIZE, snap } from '../util';\nimport { StructureContext } from './StructureProvider';\n\ninterface IDrawContext {\n    points: number[];\n    onPointerDown: (event: KonvaEventObject<Event>) => void;\n    onPointerMove: (event: KonvaEventObject<Event>) => void;\n    onPointerUp: (event: KonvaEventObject<Event>) => void;\n}\n\ninterface Props {\n    children: ReactNode;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\nexport const DrawContext = createContext<IDrawContext>(undefined!);\n\ntype BeamAttrs = {\n    id: string;\n    points: number[];\n};\n\nconst DrawProvider: React.VFC<Props> = ({ children }) => {\n    const { tool, readonly = false, setStructure } = useContext(StructureContext);\n    // 描画する点\n    const [points, setPoints] = useState<number[]>([]);\n\n    const isDrawing = useRef<boolean>();\n    const beamRef = useRef<BeamAttrs>();\n\n    const disabled = useMemo(() => {\n        if (!readonly && typeof setStructure !== 'undefined') {\n            return !(tool === 'pen' || tool === 'trapezoid');\n        }\n        return true;\n    }, [readonly, setStructure, tool]);\n\n    const handlePointerDown = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            if (disabled) {\n                return;\n            }\n\n            if (tool === 'trapezoid') {\n                // 梁要素の選択でなければ無視する\n                if (event.target.attrs['type'] !== 'beam') {\n                    return;\n                }\n                const beamId = event.target.attrs['id'];\n                const beamPoints = event.target.attrs['points'];\n                if (isNumberArray(beamPoints) && typeof beamId === 'string') {\n                    beamRef.current = {\n                        id: beamId,\n                        points: beamPoints,\n                    };\n                }\n            }\n\n            const point = event.target.getStage()?.getPointerPosition();\n            if (point) {\n                isDrawing.current = true;\n                setPoints([point.x, point.y]);\n            }\n        },\n        [disabled, setPoints, tool]\n    );\n\n    const handlePointerMove = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            if (disabled) {\n                return;\n            }\n            if (!isDrawing.current) {\n                return;\n            }\n\n            const point = event.target.getStage()?.getPointerPosition();\n            if (point) {\n                setPoints((state) => [...state, point.x, point.y]);\n            }\n        },\n        [disabled, setPoints]\n    );\n\n    const makeBeam = useCallback(\n        (start: number[], end: number[]) => {\n            if (setStructure) {\n                // スナップさせる\n                const edgeI = snap([start[0], start[1]], DEFAULT_SNAP_SIZE);\n                const edgeJ = snap([end[0], end[1]], DEFAULT_SNAP_SIZE);\n\n                setStructure((structure) => {\n                    const data = clone(structure);\n                    const nodeI = createNode(...edgeI);\n                    // 同一座標の節点が存在するか？\n                    const n1 = data.nodes.find((node) => node.x === nodeI.x && node.y === nodeI.y);\n                    if (n1) {\n                        // 既存の節点を使用する\n                        nodeI.id = n1.id;\n                    } else {\n                        // 新規追加\n                        data.nodes.push(nodeI);\n                    }\n\n                    const nodeJ = createNode(...edgeJ);\n                    const n2 = data.nodes.find((node) => node.x === nodeJ.x && node.y === nodeJ.y);\n                    if (n2) {\n                        // 既存の節点を使用する\n                        nodeJ.id = n2.id;\n                    } else {\n                        // 新規追加\n                        data.nodes.push(nodeJ);\n                    }\n\n                    const name = `Beam_${data.beams.length + 1}`;\n                    const beam = createBeam(name, nodeI.id, nodeJ.id);\n                    data.beams.push(beam);\n\n                    return data;\n                });\n            }\n        },\n        [setStructure]\n    );\n\n    const makeTrapezoid = useCallback(\n        (start: number[], end: number[], attrs: BeamAttrs) => {\n            if (setStructure) {\n                // 分布荷重の登録\n                const trapezoid = createTrapezoid(start, end, attrs.id, attrs.points);\n                setStructure((structure) => {\n                    const data = clone(structure);\n\n                    // 分布荷重を追加\n                    const name = `Trapezoid_${data.trapezoids.length + 1}`;\n                    trapezoid.name = name;\n                    data.trapezoids.push(trapezoid);\n\n                    return data;\n                });\n            }\n        },\n        [setStructure]\n    );\n\n    const handlePointerUp = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            if (disabled) {\n                return;\n            }\n\n            if (isDrawing.current) {\n                isDrawing.current = false;\n\n                if (points.length >= 4) {\n                    // 開始点\n                    const start = points.slice(0, 2);\n                    // 終了点\n                    const end = points.slice(-2);\n\n                    if (tool === 'pen') {\n                        // 梁要素の生成\n                        makeBeam(start, end);\n                    } else if (tool === 'trapezoid' && beamRef.current) {\n                        // 分布荷重の生成\n                        makeTrapezoid(start, end, beamRef.current);\n                    }\n\n                    setPoints([]);\n                    beamRef.current = undefined;\n                }\n            }\n        },\n        [disabled, makeBeam, makeTrapezoid, points, setPoints, tool]\n    );\n\n    return (\n        <DrawContext.Provider\n            value={{\n                points,\n                onPointerDown: handlePointerDown,\n                onPointerMove: handlePointerMove,\n                onPointerUp: handlePointerUp,\n            }}\n        >\n            {children}\n        </DrawContext.Provider>\n    );\n};\n\nexport default DrawProvider;\n","import { useContext, useMemo } from 'react';\nimport { Layer, Line } from 'react-konva';\nimport { CanvasTool } from '../../../types/common';\nimport { DrawContext } from '../provider/DrawProvider';\nimport { StructureContext } from '../provider/StructureProvider';\n\ninterface Props {\n    tool: CanvasTool;\n    points: number[];\n}\n\nconst DrawLayer: React.VFC<Props> = ({ tool, points }) => {\n    const color = useMemo(() => {\n        switch (tool) {\n            case 'pen':\n                return 'blue';\n            case 'trapezoid':\n                return 'red';\n            default:\n                return 'black';\n        }\n    }, [tool]);\n\n    return (\n        <Layer>\n            <Line points={points} strokeWidth={3} stroke={color} />\n        </Layer>\n    );\n};\n\nconst ConnectedDrawLayer: React.VFC = () => {\n    const { tool } = useContext(StructureContext);\n    const { points } = useContext(DrawContext);\n    return <DrawLayer tool={tool} points={points} />;\n};\n\nexport default ConnectedDrawLayer;\n","import { useContext, useMemo } from 'react';\nimport { Layer, Line } from 'react-konva';\nimport { StructureContext } from '../provider/StructureProvider';\n\ninterface LineProps {\n    id: string;\n    points: number[];\n    stroke: string;\n    strokeWidth: number;\n    dash: [number, number];\n    listening: boolean;\n}\n\nconst defaultLineProps: LineProps = {\n    id: '',\n    points: [],\n    stroke: '#c9e1ff',\n    strokeWidth: 1,\n    dash: [5, 3],\n    listening: false,\n};\n\nconst GridLayer: React.VFC = () => {\n    // キャンバスサイズ, グリッドの幅\n    const { size, gridSize } = useContext(StructureContext);\n\n    const horizontalLines: LineProps[] = useMemo(() => {\n        const lines: LineProps[] = [];\n        let count = 1;\n        for (let y = 0; y <= size.height; y += gridSize) {\n            lines.push({\n                ...defaultLineProps,\n                id: `Horizontal_${count}`,\n                points: [0, y, size.width, y],\n            });\n            count++;\n        }\n        return lines;\n    }, [gridSize, size.height, size.width]);\n\n    const verticalLines: LineProps[] = useMemo(() => {\n        const lines: LineProps[] = [];\n        let count = 1;\n        for (let x = 0; x <= size.width; x += gridSize) {\n            lines.push({\n                ...defaultLineProps,\n                id: `Vertical_${count}`,\n                points: [x, 0, x, size.height],\n            });\n            count++;\n        }\n        return lines;\n    }, [gridSize, size.height, size.width]);\n\n    return (\n        <Layer listening={false}>\n            {/* horizontal */}\n            {horizontalLines.map((props) => (\n                <Line key={props.id} {...props} />\n            ))}\n            {/* vertical */}\n            {verticalLines.map((props) => (\n                <Line key={props.id} {...props} />\n            ))}\n        </Layer>\n    );\n};\n\nexport default GridLayer;\n","import { createContext, Dispatch, ReactNode, SetStateAction, useCallback, useState } from 'react';\nimport { Shape } from '../types';\n\ninterface ISelectContext {\n    selected: Shape[];\n    setSelected: Dispatch<SetStateAction<Shape[]>>;\n    isSelected: (item: Shape) => boolean;\n    select: (item: Shape) => void;\n    toggle: (item: Shape) => void;\n}\n\ninterface Props {\n    children: ReactNode;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\nexport const SelectContext = createContext<ISelectContext>(undefined!);\n\n/**\n * 要素選択 provider\n */\nconst SelectProvider: React.VFC<Props> = ({ children }) => {\n    // 選択要素\n    const [selected, setSelected] = useState<Shape[]>([]);\n\n    const isSelected = useCallback(\n        (item: Shape) => {\n            return selected.some(({ type, id }) => type === item.type && id === item.id);\n        },\n        [selected]\n    );\n\n    const select = useCallback(\n        (item: Shape) => {\n            if (!isSelected(item)) {\n                setSelected((state) => [...state, item]);\n            }\n        },\n        [isSelected, setSelected]\n    );\n\n    const toggle = useCallback(\n        (item: Shape) => {\n            if (isSelected(item)) {\n                // 削除\n                setSelected((state) =>\n                    state.filter(({ type, id }) => !(type === item.type && id === item.id))\n                );\n            } else {\n                // 追加\n                setSelected((state) => [...state, item]);\n            }\n        },\n        [isSelected, setSelected]\n    );\n\n    return (\n        <SelectContext.Provider\n            value={{\n                selected,\n                setSelected,\n                isSelected,\n                select,\n                toggle,\n            }}\n        >\n            {children}\n        </SelectContext.Provider>\n    );\n};\n\nexport default SelectProvider;\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport { Vector2d } from 'konva/lib/types';\nimport { useCallback, useContext, useEffect, useRef, useState } from 'react';\nimport { Line, Text } from 'react-konva';\nimport { Guide } from '.';\nimport { CanvasTool } from '../../../types/common';\nimport { SelectContext } from '../provider/SelectProvider';\nimport { StructureContext } from '../provider/StructureProvider';\nimport { BeamProps, Point } from '../types';\nimport { createForceParams, Vector, verticalNormalizeVector } from '../util';\n\ninterface Props extends BeamProps {\n    tool: CanvasTool;\n    selected?: boolean;\n    addForce: (point: Vector2d, vi: Vector, vj: Vector) => void;\n    onDelete: VoidFunction;\n    onSelect: VoidFunction;\n}\n\nconst Beam: React.VFC<Props> = ({\n    id,\n    name,\n    nodeI,\n    nodeJ,\n    tool,\n    selected = false,\n    addForce,\n    onDelete,\n    onSelect,\n}) => {\n    const [points, setPoints] = useState<number[]>([]);\n    const [labelPosition, setLabelPosition] = useState<Point>([0, 0]);\n    const [labelWidth, setLabelWidth] = useState(0);\n    const [labelAngle, setLabelAngle] = useState(0);\n    const [guidePoints, setGuidePoints] = useState<[Point, Point]>([\n        [0, 0],\n        [0, 0],\n    ]);\n    const viRef = useRef<Vector>(new Vector(0, 0));\n    const vjRef = useRef<Vector>(new Vector(0, 0));\n\n    /**\n     * beam をクリック\n     * - 該当位置に集中荷重を追加する\n     * - 該当要素を削除\n     */\n    const handleClick = useCallback(\n        (event: KonvaEventObject<MouseEvent>) => {\n            // 集中荷重の追加モードの場合\n            if (tool === 'force') {\n                // クリック位置\n                const point = event.target.getStage()?.getPointerPosition();\n                if (point) {\n                    addForce(point, viRef.current, vjRef.current);\n                    // イベントの伝播を止める\n                    event.cancelBubble = true;\n                }\n            } else if (tool === 'delete') {\n                // 梁要素の削除\n                onDelete();\n                // イベントの伝播を止める\n                event.cancelBubble = true;\n            } else if (tool === 'select') {\n                // 梁要素の選択\n                onSelect();\n                // イベントの伝播を止める\n                event.cancelBubble = true;\n            }\n        },\n        [addForce, onDelete, onSelect, tool]\n    );\n\n    useEffect(() => {\n        setPoints([nodeI.x, nodeI.y, nodeJ.x, nodeJ.y]);\n        viRef.current.x = nodeI.x;\n        viRef.current.y = nodeI.y;\n        vjRef.current.x = nodeJ.x;\n        vjRef.current.y = nodeJ.y;\n\n        if (selected) {\n            // 必ず左から右になるようにする\n            let vi = viRef.current;\n            let vj = vjRef.current;\n            if (vi.x > vj.x) {\n                [vi, vj] = [vj, vi];\n            }\n\n            // 梁要素の長さ\n            const distance = vi.distance(vj);\n            // 梁要素に対して垂直なベクトル\n            const dir = verticalNormalizeVector(vi, vj);\n            // ラベル位置\n            const label = vi.clone().add(dir.clone().multiplyScalar(16));\n            // ラベル方向\n            const angle = vj.clone().subtract(vi).angleDeg();\n            // 寸法線位置\n            const guideDir = dir.clone().multiplyScalar(75);\n            const guideI = vi.clone().add(guideDir);\n            const guideJ = vj.clone().add(guideDir);\n\n            setLabelWidth(distance);\n            setLabelPosition([label.x, label.y]);\n            setLabelAngle(angle);\n            setGuidePoints([\n                [guideI.x, guideI.y],\n                [guideJ.x, guideJ.y],\n            ]);\n        }\n    }, [nodeI.x, nodeI.y, nodeJ.x, nodeJ.y, selected]);\n\n    return (\n        <>\n            <Line\n                id={id}\n                type=\"beam\"\n                points={points}\n                stroke={selected ? 'blue' : 'black'}\n                strokeWidth={4}\n                onClick={handleClick}\n                onTap={handleClick}\n            />\n            {selected && (\n                <>\n                    {/* ラベル */}\n                    <Text\n                        x={labelPosition[0]}\n                        y={labelPosition[1]}\n                        rotation={labelAngle}\n                        text={name}\n                        fontSize={12}\n                        width={labelWidth}\n                        fill=\"blue\"\n                        align=\"center\"\n                        wrap=\"none\"\n                        ellipsis\n                        listening={false}\n                    />\n                    {/* 寸法線 */}\n                    <Guide start={guidePoints[0]} end={guidePoints[1]} />\n                </>\n            )}\n        </>\n    );\n};\n\nconst ConnectedBeam: React.VFC<BeamProps> = (props) => {\n    const { tool, addForce, deleteBeam } = useContext(StructureContext);\n    const { isSelected, toggle } = useContext(SelectContext);\n\n    const handleAddForce = useCallback(\n        (point: Vector2d, vi: Vector, vj: Vector) => {\n            const vp = new Vector(point.x, point.y);\n            const force = createForceParams(props.id, vi, vj, vp);\n            addForce(force);\n        },\n        [addForce, props.id]\n    );\n\n    const handleDelete = useCallback(() => {\n        deleteBeam(props.id);\n    }, [deleteBeam, props.id]);\n\n    const handleSelect = useCallback(() => {\n        toggle({ type: 'beams', id: props.id });\n    }, [props.id, toggle]);\n\n    return (\n        <Beam\n            {...props}\n            tool={tool}\n            selected={isSelected({ type: 'beams', id: props.id })}\n            addForce={handleAddForce}\n            onDelete={handleDelete}\n            onSelect={handleSelect}\n        />\n    );\n};\n\nexport default ConnectedBeam;\n","import { createContext, Dispatch, ReactNode, SetStateAction, useCallback, useState } from 'react';\nimport { PopupParams, PopupPosition, PopupType } from '../popup/types';\n\ninterface IPopupContext {\n    popupType?: PopupType;\n    setPopupType: Dispatch<SetStateAction<PopupType | undefined>>;\n    popupPosition: PopupPosition;\n    setPopupPosition: Dispatch<SetStateAction<PopupPosition>>;\n    open: (popup: PopupType, position: PopupPosition, popupParams?: PopupParams) => void;\n    close: VoidFunction;\n    popupParams?: PopupParams;\n}\n\ninterface Props {\n    children: ReactNode;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\nexport const PopupContext = createContext<IPopupContext>(undefined!);\n\nconst PopupProvider: React.VFC<Props> = ({ children }) => {\n    // ポップアップの種類\n    const [popupType, setPopupType] = useState<PopupType>();\n    // ポップアップの位置\n    const [popupPosition, setPopupPosition] = useState<PopupPosition>({ top: 0, left: 0 });\n    // パラメータ\n    const [popupParams, setPopupParams] = useState<PopupParams>({});\n\n    const open = useCallback(\n        (type: PopupType, position: PopupPosition, params?: PopupParams) => {\n            setPopupType(type);\n            setPopupPosition(position);\n            if (params) {\n                setPopupParams(params);\n            }\n        },\n        [setPopupPosition, setPopupType]\n    );\n\n    const close = useCallback(() => {\n        setPopupType(undefined);\n        setPopupPosition({ top: 0, left: 0 });\n        setPopupParams({});\n    }, [setPopupPosition, setPopupType]);\n\n    return (\n        <PopupContext.Provider\n            value={{\n                popupType,\n                setPopupType,\n                popupPosition,\n                setPopupPosition,\n                open,\n                close,\n                popupParams,\n            }}\n        >\n            {children}\n        </PopupContext.Provider>\n    );\n};\n\nexport default PopupProvider;\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport { useCallback, useContext, useEffect, useMemo, useRef, useState } from 'react';\nimport { Arrow, Text } from 'react-konva';\nimport { CanvasTool } from '../../../types/common';\nimport { Force as IForce } from '../../../types/shape';\nimport { PopupParams, PopupPosition } from '../popup/types';\nimport { PopupContext } from '../provider/PopupProvider';\nimport { SelectContext } from '../provider/SelectProvider';\nimport { StructureContext } from '../provider/StructureProvider';\nimport { ForceProps, Point } from '../types';\nimport { lerp, Vector, verticalNormalizeVector, vX } from '../util';\n\ninterface Props extends ForceProps {\n    tool: CanvasTool;\n    selected?: boolean;\n    onDelete: VoidFunction;\n    onSelect: VoidFunction;\n    onEdit: (position: PopupPosition) => void;\n}\n\nconst BaseLength = 30;\n\nconst Force: React.VFC<Props> = ({\n    beam,\n    distanceI,\n    force,\n    forceRatio,\n    tool,\n    selected = false,\n    onDelete,\n    onSelect,\n    onEdit,\n}) => {\n    const [points, setPoints] = useState<number[]>([]);\n    const [distance, setDistance] = useState(0);\n    const [rotation, setRotation] = useState(0);\n    const [labelPosition, setLabelPosition] = useState<Point>([0, 0]);\n\n    const viRef = useRef<Vector>(new Vector(0, 0));\n    const vjRef = useRef<Vector>(new Vector(0, 0));\n\n    useEffect(() => {\n        const { nodeI, nodeJ } = beam;\n\n        // i端、j端\n        viRef.current.x = nodeI.x;\n        viRef.current.y = nodeI.y;\n        vjRef.current.x = nodeJ.x;\n        vjRef.current.y = nodeJ.y;\n        // 矢印の先端\n        const tail = lerp(viRef.current, vjRef.current, distanceI);\n        // 梁に直交する単位ベクトル\n        const vertical = verticalNormalizeVector(viRef.current, vjRef.current);\n        // 矢印の開始点\n        const arrowLength = BaseLength * forceRatio;\n        const head = tail.clone().add(vertical.multiplyScalar(arrowLength));\n\n        setPoints([head.x, head.y, tail.x, tail.y]);\n\n        // ラベル描画用\n        setDistance(Math.max(arrowLength, 140));\n        const angle = vertical.clone().angleDeg();\n        setRotation(angle);\n        const dir = viRef.current.clone().subtract(vjRef.current).normalize();\n        if (vX.dot(dir) < 0) {\n            dir.invert();\n        }\n        const p = tail.clone().add(dir.multiplyScalar(6));\n        setLabelPosition([p.x, p.y]);\n    }, [beam, distanceI, forceRatio]);\n\n    const handleClick = useCallback(\n        (event: KonvaEventObject<MouseEvent>) => {\n            if (tool === 'delete') {\n                onDelete();\n                // イベントの伝播を止める\n                event.cancelBubble = true;\n            } else if (tool === 'select') {\n                onSelect();\n                // イベントの伝播を止める\n                event.cancelBubble = true;\n            }\n        },\n        [onDelete, onSelect, tool]\n    );\n\n    const handleLabelClick = useCallback((event: KonvaEventObject<MouseEvent>) => {\n        // ダブルクリック時にはクリックイベントも発生する\n        // 何もバインドしていないと Stage のクリックイベント（選択解除）が発生するので\n        // イベントの伝播を止めるだけのイベントハンドラを設定する\n        event.cancelBubble = true;\n    }, []);\n\n    const handleLabelDoubleClick = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            const point = event.target.getStage()?.getPointerPosition();\n            if (point) {\n                const { x, y } = point;\n                // ポップアップを開く\n                onEdit({ top: y, left: x });\n            }\n        },\n        [onEdit]\n    );\n\n    const color = useMemo(() => {\n        return selected ? 'red' : 'orange';\n    }, [selected]);\n\n    return (\n        <>\n            <Arrow\n                points={points}\n                pointerLength={6}\n                pointerWidth={6}\n                fill={color}\n                stroke={color}\n                strokeWidth={2}\n                onClick={handleClick}\n                onTap={handleClick}\n            />\n            {selected && (\n                <Text\n                    x={labelPosition[0]}\n                    y={labelPosition[1]}\n                    offsetX={-6}\n                    text={`${force}kN`}\n                    fontSize={12}\n                    width={distance}\n                    rotation={rotation}\n                    fill={color}\n                    wrap=\"none\"\n                    ellipsis\n                    onClick={handleLabelClick}\n                    onTap={handleLabelClick}\n                    onDblClick={handleLabelDoubleClick}\n                    onDblTap={handleLabelDoubleClick}\n                />\n            )}\n        </>\n    );\n};\n\nconst ConnectedForce: React.VFC<ForceProps> = (props) => {\n    const { tool, deleteForce } = useContext(StructureContext);\n    const { isSelected, toggle } = useContext(SelectContext);\n    const { open } = useContext(PopupContext);\n\n    const handleDelete = useCallback(() => {\n        deleteForce(props.id);\n    }, [deleteForce, props.id]);\n\n    const handleSelect = useCallback(() => {\n        toggle({ type: 'forces', id: props.id });\n    }, [props.id, toggle]);\n\n    const handleEdit = useCallback(\n        (position: PopupPosition) => {\n            const force: IForce = {\n                ...props,\n                beam: props.beam.id,\n            };\n            // ポップアップを表示\n            open('forces', position, force as unknown as PopupParams);\n        },\n        [open, props]\n    );\n\n    return (\n        <Force\n            {...props}\n            tool={tool}\n            selected={isSelected({ type: 'forces', id: props.id })}\n            onDelete={handleDelete}\n            onSelect={handleSelect}\n            onEdit={handleEdit}\n        />\n    );\n};\n\nexport default ConnectedForce;\n","import { useEffect, useRef, useState } from 'react';\nimport { Arrow, Group, Line, Text } from 'react-konva';\nimport { Point } from '../types';\nimport { Vector } from '../util';\n\ninterface Props {\n    start: Point;\n    end: Point;\n}\n\ninterface GuideProps {\n    fill: string;\n    stroke: string;\n    strokeWidth: number;\n    listening: boolean;\n}\n\ninterface GuideArrowProps extends GuideProps {\n    pointerLength: number;\n    pointerWidth: number;\n    pointerAtBeginning: boolean;\n}\n\nconst defaultGuideProps: GuideProps = {\n    fill: 'silver',\n    stroke: 'silver',\n    strokeWidth: 1,\n    listening: false,\n};\n\nconst defaultGuideArrowProps: GuideArrowProps = {\n    pointerLength: 6,\n    pointerWidth: 6,\n    pointerAtBeginning: true,\n    ...defaultGuideProps,\n};\n\nconst GuideLine: React.VFC<Props> = ({ start, end }) => {\n    const v1Ref = useRef<Vector>(new Vector(0, 0));\n    const v2Ref = useRef<Vector>(new Vector(0, 0));\n\n    const [distance, setDistance] = useState(0);\n    const [rotation, setRotation] = useState(0);\n    const [basis, setBasis] = useState<Point>([0, 0]);\n\n    useEffect(() => {\n        v1Ref.current.x = start[0];\n        v1Ref.current.y = start[1];\n        v2Ref.current.x = end[0];\n        v2Ref.current.y = end[1];\n\n        const dist = v1Ref.current.distance(v2Ref.current);\n        const dir = v2Ref.current.clone().subtract(v1Ref.current).normalize();\n        const angle = dir.angleDeg();\n\n        setDistance(Math.round(dist));\n        setRotation(angle === 90 ? -90 : angle);\n        setBasis(angle === 90 ? end : start);\n    }, [end, start]);\n\n    return (\n        <Group x={basis[0]} y={basis[1]} rotation={rotation}>\n            {/* 左端 */}\n            <Line points={[0, 0, 0, 10]} {...defaultGuideProps} />\n            {/* 矢印部分 */}\n            <Arrow points={[0, 5, distance, 5]} {...defaultGuideArrowProps} />\n            {/* 右端 */}\n            <Line points={[distance, 0, distance, 10]} {...defaultGuideProps} />\n            {/* ラベル */}\n            <Text\n                x={0}\n                y={-8}\n                text={`${distance}px`}\n                fontSize={12}\n                fill=\"silver\"\n                width={distance}\n                align=\"center\"\n                listening={false}\n                wrap=\"none\"\n                ellipsis\n            />\n        </Group>\n    );\n};\n\nexport default GuideLine;\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport { Vector2d } from 'konva/lib/types';\nimport { useCallback, useContext, useEffect, useMemo, useRef, useState } from 'react';\nimport { Circle, Image } from 'react-konva';\nimport useImage from 'use-image';\nimport { CanvasTool } from '../../../types/common';\nimport { Node as NodeProps, NodePinType } from '../../../types/shape';\nimport { PopupParams, PopupPosition } from '../popup/types';\nimport { PopupContext } from '../provider/PopupProvider';\nimport { StructureContext } from '../provider/StructureProvider';\nimport { clone, replaceNode, snap } from '../util';\n\ninterface Props extends NodeProps {\n    tool: CanvasTool;\n    draggable?: boolean;\n    onChange?: (node: NodeProps) => void;\n    onCommit?: (node: NodeProps) => void;\n    onEdit: (position: PopupPosition) => void;\n}\n\nconst Pins: Record<NodePinType, string> = {\n    free: '/assets/images/pins/pin_1.svg', // とりあえずダミーで指定\n    pin: '/assets/images/pins/pin_1.svg',\n    pinX: '/assets/images/pins/pin_2.svg',\n    pinZ: '/assets/images/pins/pin_2.svg',\n    fixX: '/assets/images/pins/pin_3.svg',\n    fix: '/assets/images/pins/pin_4.svg',\n};\n\nconst DrawInterval = 100;\n\nconst Node: React.VFC<Props> = ({\n    id,\n    x,\n    y,\n    pin = 'free',\n    tool,\n    draggable = false,\n    onChange,\n    onCommit,\n    onEdit,\n}) => {\n    const [isDragging, setIsDragging] = useState(false);\n    const pointRef = useRef<Vector2d>({ x, y });\n    const timerRef = useRef<NodeJS.Timer>();\n\n    const imageUrl = useMemo(() => {\n        return `${process.env.PUBLIC_URL}${Pins[pin]}`;\n    }, [pin]);\n\n    const [image] = useImage(imageUrl);\n\n    const redraw = useCallback(() => {\n        if (draggable) {\n            const node: NodeProps = { id, x: pointRef.current.x, y: pointRef.current.y };\n            onChange && onChange(node);\n        }\n    }, [draggable, id, onChange]);\n\n    const handleDragStart = useCallback((event: KonvaEventObject<DragEvent>) => {\n        const point = event.target.getStage()?.getPointerPosition();\n        if (point) {\n            pointRef.current = point;\n            setIsDragging(true);\n        }\n    }, []);\n\n    const handleDragMove = useCallback((event: KonvaEventObject<DragEvent>) => {\n        const point = event.target.getStage()?.getPointerPosition();\n        if (point) {\n            pointRef.current = point;\n        }\n    }, []);\n\n    const handleDragEnd = useCallback(\n        (event: KonvaEventObject<DragEvent>) => {\n            const point = event.target.getStage()?.getPointerPosition();\n            if (point) {\n                pointRef.current = point;\n                setIsDragging(false);\n                if (timerRef.current) {\n                    clearInterval(timerRef.current);\n                    timerRef.current = undefined;\n                }\n\n                // 節点のマージ処理\n                const node: NodeProps = { id, x: pointRef.current.x, y: pointRef.current.y };\n                onCommit && onCommit(node);\n            }\n        },\n        [id, onCommit]\n    );\n\n    const handleClick = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            if (tool === 'select') {\n                // イベントの伝播を止める\n                event.cancelBubble = true;\n            }\n        },\n        [tool]\n    );\n\n    const handleDoubleClick = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            if (tool === 'select') {\n                const point = event.target.getStage()?.getPointerPosition();\n                if (point) {\n                    const { x, y } = point;\n                    // ポップアップを開く\n                    onEdit({ top: y, left: x });\n                }\n            }\n        },\n        [onEdit, tool]\n    );\n\n    useEffect(() => {\n        const timer = timerRef.current;\n        if (draggable) {\n            if (isDragging) {\n                redraw();\n                timerRef.current = setInterval(redraw, DrawInterval);\n            }\n        }\n\n        return () => {\n            if (timer) {\n                clearInterval(timer);\n            }\n        };\n    }, [draggable, isDragging, redraw]);\n\n    return (\n        <>\n            <Circle\n                id={id}\n                x={x}\n                y={y}\n                fill={isDragging ? 'blue' : 'black'}\n                radius={4}\n                draggable={draggable}\n                onDragStart={handleDragStart}\n                onDragMove={handleDragMove}\n                onDragEnd={handleDragEnd}\n                onClick={handleClick}\n                onTap={handleClick}\n                onDblClick={handleDoubleClick}\n                onDblTap={handleDoubleClick}\n                _useStrictMode\n            />\n            {!isDragging && pin !== 'free' && (\n                <Image\n                    x={x}\n                    y={y}\n                    offsetX={12}\n                    offsetY={-4}\n                    rotation={pin === 'pinZ' ? -90 : 0}\n                    image={image}\n                    width={24}\n                    height={24}\n                    listening={false}\n                />\n            )}\n        </>\n    );\n};\n\nconst ConnectedNode: React.VFC<NodeProps> = (props) => {\n    const { tool, snapSize, setStructure } = useContext(StructureContext);\n    const { open } = useContext(PopupContext);\n\n    const draggable = useMemo(() => {\n        return tool !== 'pen' && Boolean(setStructure);\n    }, [setStructure, tool]);\n\n    const handleChange = useCallback(\n        ({ id, x, y }: NodeProps) => {\n            if (setStructure) {\n                const [px, py] = snap([x, y], snapSize);\n                setStructure((values) => {\n                    const data = clone(values);\n                    const node = data.nodes.find((item) => item.id === id);\n                    if (node) {\n                        node.x = px;\n                        node.y = py;\n                    }\n                    return data;\n                });\n            }\n        },\n        [setStructure, snapSize]\n    );\n\n    const handleCommit = useCallback(\n        ({ id, x, y }: NodeProps) => {\n            if (setStructure) {\n                const [px, py] = snap([x, y], snapSize);\n                setStructure((values) => {\n                    const data = clone(values);\n                    // 該当ID の index\n                    const index = data.nodes.findIndex((item) => item.id === id);\n                    if (index >= 0) {\n                        // 座標が一致する別の節点が存在する？\n                        const node = data.nodes.find((item) => {\n                            return item.id !== id && item.x === px && item.y === py;\n                        });\n                        if (node) {\n                            // 現在の node を座標が一致する node に置き換える\n                            replaceNode(data, id, node.id);\n                            // 不要となった現在の node を削除する\n                            data.nodes.splice(index, 1);\n                        }\n                    }\n\n                    return data;\n                });\n            }\n        },\n        [setStructure, snapSize]\n    );\n\n    const handleEdit = useCallback(\n        (position: PopupPosition) => {\n            // ポップアップを表示\n            open('nodes', position, props as unknown as PopupParams);\n        },\n        [open, props]\n    );\n\n    return (\n        <Node\n            {...props}\n            draggable={draggable}\n            tool={tool}\n            onChange={handleChange}\n            onCommit={handleCommit}\n            onEdit={handleEdit}\n        />\n    );\n};\n\nexport default ConnectedNode;\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport { useCallback, useContext, useEffect, useMemo, useState } from 'react';\nimport { Arrow, Group, Line, Text } from 'react-konva';\nimport { CanvasTool } from '../../../types/common';\nimport { Trapezoid as ITrapezoid } from '../../../types/shape';\nimport { PopupParams, PopupPosition } from '../popup/types';\nimport { PopupContext } from '../provider/PopupProvider';\nimport { SelectContext } from '../provider/SelectProvider';\nimport { StructureContext } from '../provider/StructureProvider';\nimport { Point, TrapezoidProps } from '../types';\nimport { getInsidePoints, intercectPoint, Vector, vX } from '../util';\nimport Guide from './Guide';\n\ninterface Props extends TrapezoidProps {\n    tool: CanvasTool;\n    selected?: boolean;\n    onDelete: VoidFunction;\n    onSelect: VoidFunction;\n    onEdit: (position: PopupPosition) => void;\n}\n\ntype LinePoints = [number, number, number, number];\n\ninterface LineProps {\n    stroke: string;\n    strokeWidth: number;\n}\n\ninterface ArrowProps extends LineProps {\n    pointerLength: number;\n    pointerWidth: number;\n    fill: string;\n}\n\nconst defaultLineProps: LineProps = {\n    stroke: 'pink',\n    strokeWidth: 2,\n};\n\nconst defaultArrowProps: ArrowProps = {\n    pointerLength: 6,\n    pointerWidth: 6,\n    fill: 'pink',\n    ...defaultLineProps,\n};\n\ninterface LabelProps {\n    offsetX: number;\n    offsetY: number;\n    fontSize: number;\n    wrap: string;\n    ellipsis: boolean;\n}\nconst defaultLabelProps: LabelProps = {\n    offsetX: -6,\n    offsetY: 14,\n    fontSize: 12,\n    wrap: 'none',\n    ellipsis: true,\n};\n\ninterface LabelAttrs {\n    x: number;\n    y: number;\n    text: string;\n    width: number;\n    rotation: number;\n}\n\nconst Trapezoid: React.VFC<Props> = ({\n    beam,\n    forceI,\n    forceJ,\n    distanceI,\n    distanceJ,\n    angle = 90,\n    isGlobal = false,\n    tool,\n    selected = false,\n    onDelete,\n    onSelect,\n    onEdit,\n}) => {\n    // 分布荷重の矢印\n    const [arrows, setArrows] = useState<LinePoints[]>([]);\n    // 分布荷重の上端\n    const [line, setLine] = useState<LinePoints>([0, 0, 0, 0]);\n    // ラベル\n    const [labelI, setLabelI] = useState<LabelAttrs>();\n    const [labelJ, setLabelJ] = useState<LabelAttrs>();\n    // 寸法線\n    const [guidePoints, setGuidePoints] = useState<[Point, Point]>([\n        [0, 0],\n        [0, 0],\n    ]);\n\n    useEffect(() => {\n        // 梁要素\n        const { nodeI, nodeJ } = beam;\n        const vI = new Vector(nodeI.x, nodeI.y);\n        const vJ = new Vector(nodeJ.x, nodeJ.y);\n        // 梁要素の方向\n        const vd = vJ.clone().subtract(vI).normalize();\n        // 分布荷重の方向\n        let dir: Vector;\n        if (isGlobal) {\n            dir = vX.clone().rotateDeg(angle * -1);\n        } else {\n            dir = vd\n                .clone()\n                .rotateDeg(angle * -1)\n                .normalize();\n        }\n        // 梁要素の長さ\n        const beamLength = vI.distance(vJ);\n        // 分布荷重の下端の位置\n        const bi = vI.clone().add(vd.clone().multiplyScalar(beamLength * distanceI));\n        const bj = vJ.clone().add(\n            vd\n                .clone()\n                .invert()\n                .multiplyScalar(beamLength * distanceJ)\n        );\n        // 分布荷重の上端の位置\n        const pi = bi.clone().add(dir.clone().multiplyScalar(forceI * 10));\n        const pj = bj.clone().add(dir.clone().multiplyScalar(forceJ * 10));\n\n        // 下端を等間隔に分割する点を取得\n        const points = getInsidePoints(bi, bj, vd);\n        // 上端の傾き\n        const slope = pj.x - pi.x !== 0 ? (pj.y - pi.y) / (pj.x - pi.x) : NaN;\n        // 上端の切片\n        const intercept = isNaN(slope) ? NaN : pi.y - slope * pi.x;\n\n        // 内側の矢印\n        const insideArrows: LinePoints[] = [];\n        points.forEach((pd) => {\n            // pd から分布荷重の方向に線を伸ばして上端と交差する点\n            const pu = intercectPoint([pi, pj, slope, intercept], pd, dir);\n            if (pu) {\n                const arrow: LinePoints = [pu[0], pu[1], pd.x, pd.y];\n                insideArrows.push(arrow);\n            }\n        });\n\n        const labelAngle = dir.angleDeg();\n        // ラベル (i端)\n        setLabelI({\n            x: bi.x,\n            y: bi.y,\n            text: `${forceI}kN/m`,\n            width: bi.distance(pi),\n            rotation: labelAngle,\n        });\n        // ラベル (j端)\n        setLabelJ({\n            x: bj.x,\n            y: bj.y,\n            text: `${forceJ}kN/m`,\n            width: bj.distance(pj),\n            rotation: labelAngle,\n        });\n\n        // 寸法線の位置\n        const force = Math.max(forceI, forceJ) * 10;\n        const guidePosition = dir.clone().multiplyScalar(force + 50);\n        const gi = bi.clone().add(guidePosition);\n        const gj = bj.clone().add(guidePosition);\n        setGuidePoints([\n            [gi.x, gi.y],\n            [gj.x, gj.y],\n        ]);\n\n        // 上端\n        setLine([pi.x, pi.y, pj.x, pj.y]);\n        // 矢印\n        setArrows([\n            // 左端\n            [pi.x, pi.y, bi.x, bi.y],\n            // 内側の矢印\n            ...insideArrows,\n            // 右端\n            [pj.x, pj.y, bj.x, bj.y],\n        ]);\n    }, [angle, beam, distanceI, distanceJ, forceI, forceJ, isGlobal]);\n\n    const handleClick = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            if (tool === 'select') {\n                onSelect();\n            } else if (tool === 'delete') {\n                onDelete();\n            }\n            // イベントの伝播を止める\n            event.cancelBubble = true;\n        },\n        [onDelete, onSelect, tool]\n    );\n\n    const handleDoubleClick = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            if (tool === 'select') {\n                const point = event.target.getStage()?.getPointerPosition();\n                if (point) {\n                    const { x, y } = point;\n                    // ポップアップを開く\n                    onEdit({ top: y, left: x });\n                }\n            }\n        },\n        [onEdit, tool]\n    );\n\n    const color = useMemo(() => {\n        return selected ? 'red' : 'pink';\n    }, [selected]);\n\n    return (\n        <Group\n            onClick={handleClick}\n            onTap={handleClick}\n            onDblClick={handleDoubleClick}\n            onDblTap={handleDoubleClick}\n        >\n            {/* 上端 */}\n            <Line points={line} {...defaultLineProps} stroke={color} />\n            {/* 矢印 */}\n            {arrows.map((arrow, index) => (\n                <Arrow\n                    key={`arrow_${index}`}\n                    points={arrow}\n                    {...defaultArrowProps}\n                    stroke={color}\n                    fill={color}\n                />\n            ))}\n            {/* ラベルと寸法線 */}\n            {selected && (\n                <>\n                    {/* I端側ラベル */}\n                    <Text {...defaultLabelProps} {...labelI} fill={color} />\n                    {/* J端側ラベル */}\n                    <Text {...defaultLabelProps} {...labelJ} fill={color} />\n                    {/* 寸法線 */}\n                    <Guide start={guidePoints[0]} end={guidePoints[1]} />\n                </>\n            )}\n        </Group>\n    );\n};\n\nconst ConnectedTrapezoid: React.VFC<TrapezoidProps> = (props) => {\n    const { tool, deleteTrapezoid } = useContext(StructureContext);\n    const { isSelected, toggle } = useContext(SelectContext);\n    const { open } = useContext(PopupContext);\n\n    const handleDelete = useCallback(() => {\n        deleteTrapezoid(props.id);\n    }, [deleteTrapezoid, props.id]);\n\n    const handleSelect = useCallback(() => {\n        toggle({ type: 'trapezoids', id: props.id });\n    }, [props.id, toggle]);\n\n    const handleEdit = useCallback(\n        (position: PopupPosition) => {\n            const trapezoid: ITrapezoid = {\n                ...props,\n                beam: props.beam.id,\n            };\n            // ポップアップを表示\n            open('trapezoids', position, trapezoid as unknown as PopupParams);\n        },\n        [open, props]\n    );\n\n    return (\n        <Trapezoid\n            {...props}\n            tool={tool}\n            selected={isSelected({ type: 'trapezoids', id: props.id })}\n            onDelete={handleDelete}\n            onSelect={handleSelect}\n            onEdit={handleEdit}\n        />\n    );\n};\n\nexport default ConnectedTrapezoid;\n","import { useContext, useMemo } from 'react';\nimport { Layer } from 'react-konva';\nimport { StructureContext } from '../provider/StructureProvider';\nimport { Guide as GuideLine } from '../shape';\n\ninterface GuideLineProps {\n    key: string;\n    start: [number, number];\n    end: [number, number];\n}\n\ninterface GuidePoint {\n    minX: number;\n    maxX: number;\n    guidesX: GuideLineProps[];\n    minY: number;\n    maxY: number;\n    guidesY: GuideLineProps[];\n}\n\nconst GuideInterval = 25;\n\nconst GuideLayer: React.VFC = () => {\n    const { structure } = useContext(StructureContext);\n\n    const { minX, maxX, guidesX, minY, maxY, guidesY }: GuidePoint = useMemo(() => {\n        const guide: GuidePoint = {\n            maxX: Number.MIN_SAFE_INTEGER,\n            minX: Number.MAX_SAFE_INTEGER,\n            guidesX: [],\n            maxY: Number.MIN_SAFE_INTEGER,\n            minY: Number.MAX_SAFE_INTEGER,\n            guidesY: [],\n        };\n\n        const pointsX = new Set<number>();\n        const pointsY = new Set<number>();\n        structure.nodes.forEach(({ x, y }) => {\n            if (guide.maxX < x) {\n                guide.maxX = x;\n            }\n            if (guide.minX > x) {\n                guide.minX = x;\n            }\n            if (!pointsX.has(x)) {\n                pointsX.add(x);\n            }\n            if (guide.maxY < y) {\n                guide.maxY = y;\n            }\n            if (guide.minY > y) {\n                guide.minY = y;\n            }\n            if (!pointsY.has(y)) {\n                pointsY.add(y);\n            }\n        });\n\n        // ガイドの生成\n        if (pointsX.size > 1) {\n            const array = Array.from(pointsX).sort((a, b) => (a < b ? -1 : 1));\n            let prev = array[0];\n            for (let i = 1; i < array.length; i++) {\n                const current = array[i];\n                const props: GuideLineProps = {\n                    key: `LocalGuideX_${i}`,\n                    start: [prev, guide.maxY + GuideInterval * 4],\n                    end: [current, guide.maxY + GuideInterval * 4],\n                };\n                prev = current;\n                guide.guidesX.push(props);\n            }\n        }\n        if (pointsY.size > 1) {\n            const array = Array.from(pointsY).sort((a, b) => (a < b ? -1 : 1));\n            let prev = array[0];\n            const localX = Math.max(guide.minX - GuideInterval * 4, GuideInterval * 2);\n            for (let i = 1; i < array.length; i++) {\n                const current = array[i];\n                const props: GuideLineProps = {\n                    key: `LocalGuideY_${i}`,\n                    start: [localX, prev],\n                    end: [localX, current],\n                };\n                prev = current;\n                guide.guidesY.push(props);\n            }\n        }\n\n        return guide;\n    }, [structure.nodes]);\n\n    const GlobalVerticalGuidePositionX = useMemo(() => {\n        if (minX !== Number.MAX_SAFE_INTEGER) {\n            return Math.max(GuideInterval, minX - GuideInterval * 5);\n        }\n        return 0;\n    }, [minX]);\n\n    const GlobalHorizontalGuidePositionY = useMemo(() => {\n        if (maxY !== Number.MIN_SAFE_INTEGER) {\n            return maxY + GuideInterval * 5;\n        }\n        return 0;\n    }, [maxY]);\n\n    return (\n        <Layer listening={false}>\n            {/* Horizontal */}\n            {minX !== Number.MAX_SAFE_INTEGER && maxX !== Number.MIN_SAFE_INTEGER && (\n                <GuideLine\n                    start={[minX, GlobalHorizontalGuidePositionY]}\n                    end={[maxX, GlobalHorizontalGuidePositionY]}\n                />\n            )}\n            {guidesX.map((props) => (\n                <GuideLine {...props} />\n            ))}\n            {/* Vertical */}\n            {minY !== Number.MAX_SAFE_INTEGER && maxY !== Number.MIN_SAFE_INTEGER && (\n                <GuideLine\n                    start={[GlobalVerticalGuidePositionX, minY]}\n                    end={[GlobalVerticalGuidePositionX, maxY]}\n                />\n            )}\n            {guidesY.map((props) => (\n                <GuideLine {...props} />\n            ))}\n        </Layer>\n    );\n};\n\nexport default GuideLayer;\n","import { useContext, useMemo } from 'react';\nimport { Layer } from 'react-konva';\nimport { ShapePosition } from '../../../types/common';\nimport { Node as NodeProps, Structure } from '../../../types/shape';\nimport { StructureContext } from '../provider/StructureProvider';\nimport { Beam, Force, Node, Trapezoid } from '../shape';\nimport { BeamProps, ForceProps, TrapezoidProps } from '../types';\n\ninterface Props extends Partial<ShapePosition> {\n    structure: Structure;\n}\n\nexport const ShapeLayerCore: React.VFC<Props> = ({ structure, ...layerProps }) => {\n    const nodes = useMemo(() => {\n        const map: Record<string, NodeProps> = {};\n\n        structure.nodes.forEach((node) => {\n            map[node.id] = node;\n        });\n\n        return map;\n    }, [structure.nodes]);\n\n    const beams = useMemo(() => {\n        const map: Record<string, BeamProps> = {};\n\n        structure.beams.forEach(({ nodeI, nodeJ, ...beam }) => {\n            const item: BeamProps = {\n                ...beam,\n                nodeI: nodes[nodeI],\n                nodeJ: nodes[nodeJ],\n            };\n            map[beam.id] = item;\n        });\n\n        return map;\n    }, [nodes, structure.beams]);\n\n    const forces = useMemo(() => {\n        const { forces: items } = structure;\n        const map: Record<string, ForceProps> = {};\n\n        if (items.length > 0) {\n            const total = items.map((item) => item.force).reduce((p, c) => p + c);\n            const average = total / items.length;\n            items.forEach(({ beam, force: value, ...force }) => {\n                const forceRatio = value / average;\n                map[force.id] = {\n                    ...force,\n                    force: value,\n                    forceRatio,\n                    beam: beams[beam],\n                };\n            });\n        }\n\n        return map;\n    }, [beams, structure]);\n\n    const trapezoids = useMemo(() => {\n        const { trapezoids: items } = structure;\n        const map: Record<string, TrapezoidProps> = {};\n\n        items.forEach(({ beam, ...props }) => {\n            map[props.id] = {\n                ...props,\n                beam: beams[beam],\n            };\n        });\n\n        return map;\n    }, [beams, structure]);\n\n    return (\n        <Layer {...layerProps}>\n            {Object.entries(beams).map(([key, beam]) => (\n                <Beam key={key} {...beam} />\n            ))}\n            {Object.entries(nodes).map(([key, node]) => (\n                <Node key={key} {...node} />\n            ))}\n            {Object.entries(forces).map(([key, force]) => (\n                <Force key={key} {...force} />\n            ))}\n            {Object.entries(trapezoids).map(([key, trapezoid]) => (\n                <Trapezoid key={key} {...trapezoid} />\n            ))}\n        </Layer>\n    );\n};\n\nconst ShapeLayer: React.VFC = () => {\n    const { structure } = useContext(StructureContext);\n    return <ShapeLayerCore structure={structure} />;\n};\n\nexport default ShapeLayer;\n","import { Button, InputAdornment, Paper, Stack, TextField } from '@mui/material';\nimport { ChangeEvent, FormEvent, useCallback, useEffect, useMemo, useState } from 'react';\nimport { Force, isForce } from '../../../types/shape';\nimport { PopupParams } from './types';\n\ninterface Props {\n    values: PopupParams;\n    onClose: VoidFunction;\n    onChange: (force: Force) => void;\n}\n\ninterface ForceEditorProps extends Omit<Props, 'values'> {\n    force: Force;\n}\n\nconst ForceEditor: React.VFC<ForceEditorProps> = ({ force, onChange, onClose }) => {\n    const [value, setValue] = useState('');\n    const [error, setError] = useState<string>();\n\n    const handleSubmit = useCallback(\n        (event: FormEvent<HTMLFormElement>) => {\n            event.preventDefault();\n\n            if (event.currentTarget.checkValidity() && typeof error === 'undefined') {\n                const num = parseFloat(value);\n                if (!isNaN(num)) {\n                    // 更新\n                    onChange({\n                        ...force,\n                        force: num,\n                    });\n                    // ポップアップ閉じる\n                    onClose();\n                }\n            }\n        },\n        [error, onChange, onClose, value, force]\n    );\n\n    const handleChange = useCallback((event: ChangeEvent<HTMLInputElement>) => {\n        const { value } = event.currentTarget;\n        let errorMessage: string | undefined;\n        setValue(value);\n\n        // 必須\n        if (value.length === 0) {\n            errorMessage = '数値を入力してください';\n        }\n        // 数値？\n        const num = parseFloat(value);\n        if (isNaN(num)) {\n            errorMessage = '数値を入力してください';\n        }\n        if (0 > num || num > Number.MAX_SAFE_INTEGER) {\n            errorMessage = '0 より大きい値を入力してください';\n        }\n\n        setError(errorMessage);\n    }, []);\n\n    useEffect(() => {\n        setValue(`${force.force}`);\n        setError(undefined);\n    }, [force]);\n\n    return (\n        <Paper>\n            <Stack\n                direction=\"column\"\n                spacing={1}\n                sx={{ p: 1, width: 240 }}\n                component=\"form\"\n                autoComplete=\"off\"\n                noValidate\n                onSubmit={handleSubmit}\n            >\n                <TextField\n                    variant=\"outlined\"\n                    margin=\"dense\"\n                    size=\"small\"\n                    label=\"集中荷重\"\n                    value={value}\n                    required\n                    fullWidth\n                    onChange={handleChange}\n                    InputProps={{\n                        endAdornment: <InputAdornment position=\"end\">kN</InputAdornment>,\n                    }}\n                    error={Boolean(error)}\n                    helperText={error}\n                />\n                <Stack direction=\"row\" justifyContent=\"flex-end\" spacing={1}>\n                    <Button size=\"small\" onClick={onClose}>\n                        キャンセル\n                    </Button>\n                    <Button type=\"submit\" size=\"small\" variant=\"contained\">\n                        OK\n                    </Button>\n                </Stack>\n            </Stack>\n        </Paper>\n    );\n};\n\nconst ConnectedForceEditor: React.VFC<Props> = ({ values, ...props }) => {\n    const force = useMemo(() => {\n        if (isForce(values)) {\n            return values;\n        }\n        // 空の force を渡す\n        return {\n            id: '',\n            name: '',\n            beam: '',\n            force: 0,\n            distanceI: 0,\n        };\n    }, [values]);\n\n    return <ForceEditor {...props} force={force} />;\n};\n\nexport default ConnectedForceEditor;\n","var _path, _circle, _circle2, _line;\n\nvar _excluded = [\"title\", \"titleId\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgPin2(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    id: \"svg\",\n    viewBox: \"0 0 160 160\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M80 0 L30 80 L130 80 Z\",\n    strokeWidth: 6,\n    stroke: \"gray\",\n    fill: \"transparent\"\n  })), _circle || (_circle = /*#__PURE__*/React.createElement(\"circle\", {\n    stroke: \"gray\",\n    strokeWidth: 6,\n    fill: \"transparent\",\n    cx: 45,\n    cy: 115,\n    r: 20\n  })), _circle2 || (_circle2 = /*#__PURE__*/React.createElement(\"circle\", {\n    stroke: \"gray\",\n    strokeWidth: 6,\n    fill: \"transparent\",\n    cx: 115,\n    cy: 115,\n    r: 20\n  })), _line || (_line = /*#__PURE__*/React.createElement(\"line\", {\n    x1: 30,\n    y1: 150,\n    x2: 130,\n    y2: 150,\n    stroke: \"gray\",\n    strokeWidth: 6\n  })));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgPin2);\nexport default __webpack_public_path__ + \"static/media/pin_2.2b2bb714.svg\";\nexport { ForwardRef as ReactComponent };","var _path, _circle, _circle2, _line;\n\nvar _excluded = [\"title\", \"titleId\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgPin3(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    id: \"svg\",\n    style: {\n      width: 64\n    },\n    viewBox: \"0 0 160 160\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M30 3 L30 80 L130 80 L130 3 Z\",\n    strokeWidth: 6,\n    stroke: \"gray\",\n    fill: \"transparent\"\n  })), _circle || (_circle = /*#__PURE__*/React.createElement(\"circle\", {\n    stroke: \"gray\",\n    strokeWidth: 6,\n    fill: \"transparent\",\n    cx: 45,\n    cy: 115,\n    r: 20\n  })), _circle2 || (_circle2 = /*#__PURE__*/React.createElement(\"circle\", {\n    stroke: \"gray\",\n    strokeWidth: 6,\n    fill: \"transparent\",\n    cx: 115,\n    cy: 115,\n    r: 20\n  })), _line || (_line = /*#__PURE__*/React.createElement(\"line\", {\n    x1: 30,\n    y1: 150,\n    x2: 130,\n    y2: 150,\n    stroke: \"gray\",\n    strokeWidth: 6\n  })));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgPin3);\nexport default __webpack_public_path__ + \"static/media/pin_3.d7b6571b.svg\";\nexport { ForwardRef as ReactComponent };","var _line, _line2, _line3, _line4, _line5;\n\nvar _excluded = [\"title\", \"titleId\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgPin4(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    id: \"svg\",\n    style: {\n      width: 64\n    },\n    viewBox: \"0 0 160 160\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _line || (_line = /*#__PURE__*/React.createElement(\"line\", {\n    x1: 0,\n    y1: 3,\n    x2: 160,\n    y2: 3,\n    stroke: \"gray\",\n    strokeWidth: 6\n  })), _line2 || (_line2 = /*#__PURE__*/React.createElement(\"line\", {\n    x1: 20,\n    y1: 0,\n    x2: 0,\n    y2: 60,\n    stroke: \"gray\",\n    strokeWidth: 6\n  })), _line3 || (_line3 = /*#__PURE__*/React.createElement(\"line\", {\n    x1: 60,\n    y1: 0,\n    x2: 40,\n    y2: 60,\n    stroke: \"gray\",\n    strokeWidth: 6\n  })), _line4 || (_line4 = /*#__PURE__*/React.createElement(\"line\", {\n    x1: 100,\n    y1: 0,\n    x2: 80,\n    y2: 60,\n    stroke: \"gray\",\n    strokeWidth: 6\n  })), _line5 || (_line5 = /*#__PURE__*/React.createElement(\"line\", {\n    x1: 140,\n    y1: 0,\n    x2: 120,\n    y2: 60,\n    stroke: \"gray\",\n    strokeWidth: 6\n  })));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgPin4);\nexport default __webpack_public_path__ + \"static/media/pin_4.4442f3d6.svg\";\nexport { ForwardRef as ReactComponent };","import CircleOutlinedIcon from '@mui/icons-material/CircleOutlined';\nimport {\n    Button,\n    Paper,\n    Stack,\n    SvgIcon,\n    ToggleButton,\n    ToggleButtonGroup,\n    ToggleButtonProps,\n    Typography,\n} from '@mui/material';\nimport {\n    FormEvent,\n    MouseEvent,\n    ReactElement,\n    useCallback,\n    useEffect,\n    useMemo,\n    useState,\n} from 'react';\nimport { isNode, isNodePinType, Node, NodePinType } from '../../../types/shape';\nimport { ReactComponent as PinIcon1 } from './pins/pin_1.svg';\nimport { ReactComponent as PinIcon2 } from './pins/pin_2.svg';\nimport { ReactComponent as PinIcon3 } from './pins/pin_3.svg';\nimport { ReactComponent as PinIcon4 } from './pins/pin_4.svg';\nimport { PopupParams } from './types';\n\ninterface Props {\n    values: PopupParams;\n    onClose: VoidFunction;\n    onChange: (node: Node) => void;\n}\n\ninterface PinSelectorProps extends Omit<Props, 'values'> {\n    node: Node;\n}\n\ninterface PinButtonProps {\n    type: NodePinType;\n    icon: ReactElement;\n    label: string;\n}\n\nconst PinButtons: Readonly<Record<NodePinType, PinButtonProps>> = {\n    free: {\n        type: 'free',\n        icon: <CircleOutlinedIcon />,\n        label: '完全フリー',\n    },\n    pin: {\n        type: 'pin',\n        icon: (\n            <SvgIcon sx={{ width: 24 }} viewBox=\"0 0 160 160\">\n                <PinIcon1 />\n            </SvgIcon>\n        ),\n        label: '完全ピン',\n    },\n    pinX: {\n        type: 'pinX',\n        icon: (\n            <SvgIcon sx={{ width: 24 }} viewBox=\"0 0 160 160\">\n                <PinIcon2 />\n            </SvgIcon>\n        ),\n        label: 'ピンXローラー',\n    },\n    pinZ: {\n        type: 'pinZ',\n        icon: (\n            <SvgIcon sx={{ width: 24, transform: 'rotate(-90deg)' }} viewBox=\"0 0 160 160\">\n                <PinIcon2 />\n            </SvgIcon>\n        ),\n        label: 'ピンZローラー',\n    },\n    fixX: {\n        type: 'fixX',\n        icon: (\n            <SvgIcon sx={{ width: 24 }} viewBox=\"0 0 160 160\">\n                <PinIcon3 />\n            </SvgIcon>\n        ),\n        label: '固定Xローラー',\n    },\n    fix: {\n        type: 'fix',\n        icon: (\n            <SvgIcon sx={{ width: 24 }} viewBox=\"0 0 160 160\">\n                <PinIcon4 />\n            </SvgIcon>\n        ),\n        label: '完全固定',\n    },\n};\n\nconst defaultButtonProps: Partial<ToggleButtonProps> = {\n    sx: { justifyContent: 'flex-start', alignItems: 'center' },\n};\n\nconst PinSelector: React.VFC<PinSelectorProps> = ({ node, onChange, onClose }) => {\n    const [pin, setPin] = useState<NodePinType>();\n\n    const handleSubmit = useCallback(\n        (event: FormEvent) => {\n            event.preventDefault();\n\n            const values: Node = {\n                ...node,\n                pin,\n            };\n            onChange(values);\n            onClose();\n        },\n        [node, onChange, onClose, pin]\n    );\n\n    const handleChange = useCallback((_: MouseEvent<HTMLElement>, newValue: string | null) => {\n        if (newValue !== null && isNodePinType(newValue)) {\n            setPin(newValue);\n        }\n    }, []);\n\n    useEffect(() => {\n        setPin(node.pin ?? 'free');\n    }, [node.pin]);\n\n    return (\n        <Paper>\n            <Stack\n                direction=\"column\"\n                spacing={1}\n                sx={{ p: 1, width: 240 }}\n                component=\"form\"\n                autoComplete=\"off\"\n                noValidate\n                onSubmit={handleSubmit}\n            >\n                <ToggleButtonGroup\n                    orientation=\"vertical\"\n                    value={pin}\n                    size=\"small\"\n                    exclusive\n                    fullWidth\n                    onChange={handleChange}\n                >\n                    {Object.entries(PinButtons).map(([key, { icon, label }]) => (\n                        <ToggleButton key={key} value={key} {...defaultButtonProps}>\n                            {icon}\n                            <Typography variant=\"caption\" sx={{ ml: 1 }}>\n                                {label}\n                            </Typography>\n                        </ToggleButton>\n                    ))}\n                </ToggleButtonGroup>\n                <Stack direction=\"row\" justifyContent=\"flex-end\" spacing={1}>\n                    <Button size=\"small\" onClick={onClose}>\n                        キャンセル\n                    </Button>\n                    <Button type=\"submit\" size=\"small\" variant=\"contained\">\n                        OK\n                    </Button>\n                </Stack>\n            </Stack>\n        </Paper>\n    );\n};\n\nconst ConnectedPinSelector: React.VFC<Props> = ({ values, ...props }) => {\n    const node = useMemo(() => {\n        if (isNode(values)) {\n            return values;\n        }\n        return {\n            id: '',\n            x: 0,\n            y: 0,\n        };\n    }, [values]);\n\n    return <PinSelector {...props} node={node} />;\n};\n\nexport default ConnectedPinSelector;\n","import {\n    Button,\n    Checkbox,\n    FormControlLabel,\n    InputAdornment,\n    Paper,\n    Stack,\n    TextField,\n} from '@mui/material';\nimport { ChangeEvent, FormEvent, useCallback, useEffect, useMemo, useState } from 'react';\nimport { isTrapezoid, Trapezoid } from '../../../types/shape';\nimport { round } from '../util';\nimport { PopupParams } from './types';\n\ninterface Props {\n    values: PopupParams;\n    onClose: VoidFunction;\n    onChange: (trapezoid: Trapezoid) => void;\n}\n\ninterface FormProps extends Omit<Props, 'values'> {\n    trapezoid: Trapezoid;\n}\n\ninterface TrapezoidAttrs {\n    forceI: number;\n    forceJ: number;\n    angle: number;\n    isGlobal: boolean;\n}\ninterface FormValues {\n    forceI: string;\n    forceJ: string;\n    angle: string;\n    isGlobal: boolean;\n}\n\ntype ValidateTuple = [value: number, valid: boolean, error: string];\n\n/**\n * 必須かつ 0以上の数値\n * @param value\n */\nconst validateForce = (value: string): ValidateTuple => {\n    if (value.length === 0) {\n        // 必須\n        return [NaN, false, '数値を入力してください'];\n    } else {\n        const val = parseFloat(value);\n        if (isNaN(val)) {\n            // 数値でない\n            return [NaN, false, '数値を入力してください'];\n        } else if (0 >= val && val > Number.MAX_SAFE_INTEGER) {\n            // 数値が範囲外\n            return [val, false, '0 以上の数値を入力してください'];\n        }\n        // OK\n        return [round(val, 3), true, ''];\n    }\n};\n\n/**\n * -180 から 180 の範囲の数値\n * -180 の場合は 180 とする\n * @param value\n */\nconst validateAngle = (value: string): ValidateTuple => {\n    if (value.length > 0) {\n        let val = parseInt(value, 10);\n        if (isNaN(val) || value.indexOf('.') >= 0) {\n            // 整数でない\n            return [NaN, false, '整数を入力してください'];\n        } else if (-180 > val || 180 < val) {\n            // 180 から 180 の範囲外\n            return [val, false, '-180 〜 180 で入力してください'];\n        }\n        if (val === -180) {\n            // -180 の場合は 180 とする\n            val = 180;\n        }\n        // OK\n        return [val, true, ''];\n    }\n    // 未指定の場合は 90 を返す\n    return [90, true, ''];\n};\n\nconst parseFormValues = (values: Partial<FormValues>): [boolean, TrapezoidAttrs] => {\n    const attrs: TrapezoidAttrs = {\n        forceI: 0,\n        forceJ: 0,\n        angle: 90,\n        isGlobal: false,\n    };\n\n    // forceI\n    const [value1, valid1] = validateForce(values.forceI ?? '');\n    const [value2, valid2] = validateForce(values.forceJ ?? '');\n    const [value3, valid3] = validateAngle(values.angle ?? '');\n    const valid = valid1 && valid2 && valid3;\n\n    attrs.forceI = value1;\n    attrs.forceJ = value2;\n    attrs.angle = value3;\n    attrs.isGlobal = values.isGlobal ?? false;\n\n    return [valid, attrs];\n};\n\nconst toFormValues = (trapezoid: Trapezoid): Partial<FormValues> => {\n    const values: Partial<FormValues> = {};\n\n    values.forceI = `${trapezoid.forceI}`;\n    values.forceJ = `${trapezoid.forceJ}`;\n    values.angle = `${trapezoid.angle ?? ''}`;\n    values.isGlobal = trapezoid.isGlobal;\n\n    return values;\n};\n\nconst TrapezoidEditor: React.VFC<FormProps> = ({ trapezoid, onChange, onClose }) => {\n    const [values, setValues] = useState<Partial<FormValues>>({});\n    const [errors, setErrors] = useState<Record<string, string>>({});\n\n    const handleSubmit = useCallback(\n        (event: FormEvent<HTMLFormElement>) => {\n            event.preventDefault();\n\n            if (event.currentTarget.checkValidity()) {\n                // エラーがあれば更新しない\n                const invalid = Object.values(errors).some((error) => error.length > 0);\n                if (!invalid) {\n                    // values を TrapezoidAttrs に変換する\n                    const [valid, attrs] = parseFormValues(values);\n                    console.log(valid, attrs);\n                    if (valid) {\n                        // 更新\n                        onChange({\n                            ...trapezoid,\n                            ...attrs,\n                        });\n                    }\n                    // ポップアップ閉じる\n                    onClose();\n                }\n            }\n        },\n        [errors, onChange, onClose, trapezoid, values]\n    );\n\n    const handleChange = useCallback((event: ChangeEvent<HTMLInputElement>) => {\n        const { name, value } = event.target;\n        let errorMessage = '';\n        switch (name) {\n            case 'forceI':\n            case 'forceJ':\n                // 必須かつ 0以上の数値\n                const [, valid1, error1] = validateForce(value);\n                if (!valid1) {\n                    errorMessage = error1;\n                }\n                break;\n            case 'angle':\n                const [, valid2, error2] = validateAngle(value);\n                if (!valid2) {\n                    errorMessage = error2;\n                }\n                break;\n        }\n\n        // エラー情報の更新\n        setErrors((state) => ({\n            ...state,\n            [name]: errorMessage,\n        }));\n\n        // 値を更新\n        setValues((state) => ({\n            ...state,\n            [name]: value,\n        }));\n    }, []);\n\n    const handleChangeIsGlobal = useCallback((event: ChangeEvent<HTMLInputElement>) => {\n        const { checked } = event.target;\n        setValues((state) => ({\n            ...state,\n            isGlobal: checked,\n        }));\n    }, []);\n\n    useEffect(() => {\n        setValues(toFormValues(trapezoid));\n        setErrors({});\n    }, [trapezoid]);\n\n    return (\n        <Paper>\n            <Stack\n                direction=\"column\"\n                spacing={1}\n                sx={{ p: 1, width: 240 }}\n                component=\"form\"\n                autoComplete=\"off\"\n                noValidate\n                onSubmit={handleSubmit}\n            >\n                {/* forceI */}\n                <TextField\n                    variant=\"outlined\"\n                    margin=\"dense\"\n                    size=\"small\"\n                    label=\"I端側の荷重\"\n                    name=\"forceI\"\n                    value={values['forceI'] ?? ''}\n                    required\n                    fullWidth\n                    onChange={handleChange}\n                    InputProps={{\n                        endAdornment: <InputAdornment position=\"end\">kN/m</InputAdornment>,\n                    }}\n                    error={Boolean(errors['forceI'])}\n                    helperText={errors['forceI'] ?? ''}\n                />\n                {/* forceJ */}\n                <TextField\n                    variant=\"outlined\"\n                    margin=\"dense\"\n                    size=\"small\"\n                    label=\"J端側の荷重\"\n                    name=\"forceJ\"\n                    value={values['forceJ'] ?? ''}\n                    required\n                    fullWidth\n                    onChange={handleChange}\n                    InputProps={{\n                        endAdornment: <InputAdornment position=\"end\">kN/m</InputAdornment>,\n                    }}\n                    error={Boolean(errors['forceJ'])}\n                    helperText={errors['forceJ'] ?? ''}\n                />\n                {/* angle */}\n                <TextField\n                    variant=\"outlined\"\n                    margin=\"dense\"\n                    size=\"small\"\n                    label=\"角度\"\n                    name=\"angle\"\n                    value={values['angle'] ?? ''}\n                    fullWidth\n                    onChange={handleChange}\n                    InputProps={{\n                        endAdornment: <InputAdornment position=\"end\">°</InputAdornment>,\n                    }}\n                    error={Boolean(errors['angle'])}\n                    helperText={errors['angle'] ?? ''}\n                />\n                {/* isGlobal */}\n                <FormControlLabel\n                    label=\"全体座標系\"\n                    control={\n                        <Checkbox\n                            name=\"isGlobal\"\n                            size=\"small\"\n                            checked={values.isGlobal ?? false}\n                            onChange={handleChangeIsGlobal}\n                        />\n                    }\n                />\n                <Stack direction=\"row\" justifyContent=\"flex-end\" spacing={1}>\n                    <Button size=\"small\" onClick={onClose}>\n                        キャンセル\n                    </Button>\n                    <Button type=\"submit\" size=\"small\" variant=\"contained\">\n                        OK\n                    </Button>\n                </Stack>\n            </Stack>\n        </Paper>\n    );\n};\n\nconst ConnectedTrapezoidEditor: React.VFC<Props> = ({ values, ...props }) => {\n    const trapezoid = useMemo(() => {\n        if (isTrapezoid(values)) {\n            return values;\n        }\n        // 空データを返す\n        return {\n            id: '',\n            name: '',\n            beam: '',\n            forceI: 0,\n            distanceI: 0,\n            forceJ: 0,\n            distanceJ: 0,\n        };\n    }, [values]);\n\n    return <TrapezoidEditor {...props} trapezoid={trapezoid} />;\n};\n\nexport default ConnectedTrapezoidEditor;\n","import { Box } from '@mui/material';\nimport { useCallback, useContext } from 'react';\nimport { Force, Node, Trapezoid } from '../../../types/shape';\nimport { PopupContext } from '../provider/PopupProvider';\nimport { StructureContext } from '../provider/StructureProvider';\nimport { clone } from '../util';\nimport ForceEditor from './ForceEditor';\nimport PinSelector from './PinSelector';\nimport TrapezoidEditor from './TrapezoidEditor';\n\nconst Popup: React.VFC = () => {\n    const { popupType, popupPosition, popupParams, close } = useContext(PopupContext);\n    const { setStructure } = useContext(StructureContext);\n\n    const handleChangeForce = useCallback(\n        (force: Force) => {\n            setStructure &&\n                setStructure((structure) => {\n                    const data = clone(structure);\n\n                    const index = data.forces.findIndex(({ id }) => id === force.id);\n                    if (index >= 0) {\n                        data.forces[index] = {\n                            ...force,\n                        };\n                    }\n\n                    return data;\n                });\n        },\n        [setStructure]\n    );\n\n    const handleChangeTrapezoid = useCallback(\n        (trapezoid: Trapezoid) => {\n            setStructure &&\n                setStructure((structure) => {\n                    const data = clone(structure);\n                    const index = data.trapezoids.findIndex(({ id }) => id === trapezoid.id);\n                    if (index >= 0) {\n                        data.trapezoids[index] = {\n                            ...trapezoid,\n                        };\n                    }\n                    return data;\n                });\n        },\n        [setStructure]\n    );\n\n    const handleChangeNode = useCallback(\n        (node: Node) => {\n            setStructure &&\n                setStructure((structure) => {\n                    const data = clone(structure);\n                    const index = data.nodes.findIndex(({ id }) => id === node.id);\n                    if (index >= 0) {\n                        data.nodes[index] = {\n                            ...node,\n                        };\n                    }\n                    return data;\n                });\n        },\n        [setStructure]\n    );\n\n    if (typeof popupType === 'undefined') {\n        return null;\n    }\n\n    return (\n        <Box\n            sx={{\n                position: 'absolute',\n                zIndex: 5000,\n                ...popupPosition,\n            }}\n        >\n            {popupType === 'forces' && (\n                <ForceEditor\n                    values={popupParams ?? {}}\n                    onClose={close}\n                    onChange={handleChangeForce}\n                />\n            )}\n            {popupType === 'trapezoids' && (\n                <TrapezoidEditor\n                    values={popupParams ?? {}}\n                    onClose={close}\n                    onChange={handleChangeTrapezoid}\n                />\n            )}\n            {popupType === 'nodes' && (\n                <PinSelector\n                    values={popupParams ?? {}}\n                    onClose={close}\n                    onChange={handleChangeNode}\n                />\n            )}\n        </Box>\n    );\n};\n\nexport default Popup;\n","import Konva from 'konva';\nimport { KonvaEventObject } from 'konva/lib/Node';\nimport { forwardRef, useCallback, useContext, useImperativeHandle, useRef } from 'react';\nimport { Stage } from 'react-konva';\nimport { useContextBridge } from '../../hooks/useContextBridge';\nimport DrawLayer from './layer/DrawLayer';\nimport GridLayer from './layer/GridLayer';\nimport GuideLayer from './layer/GuideLayer';\nimport ShapeLayer from './layer/ShapeLayer';\nimport Popup from './popup';\nimport { DrawContext } from './provider/DrawProvider';\nimport { PopupContext } from './provider/PopupProvider';\nimport { SelectContext } from './provider/SelectProvider';\nimport { StructureContext } from './provider/StructureProvider';\nimport { CanvasCoreHandler } from './types';\n\nconst CanvasCore: React.ForwardRefRenderFunction<CanvasCoreHandler> = (_, ref) => {\n    const { structure, tool, size } = useContext(StructureContext);\n    const { setSelected } = useContext(SelectContext);\n    const { close } = useContext(PopupContext);\n    const { onPointerDown, onPointerMove, onPointerUp } = useContext(DrawContext);\n\n    const ContextBridge = useContextBridge(\n        StructureContext,\n        PopupContext,\n        SelectContext,\n        DrawContext\n    );\n\n    const canvasRef = useRef<Konva.Stage>(null);\n\n    useImperativeHandle(\n        ref,\n        () => ({\n            toDataURL: () => {\n                if (canvasRef.current) {\n                    return canvasRef.current.toDataURL();\n                }\n            },\n            getStructure: () => structure,\n        }),\n        [structure]\n    );\n\n    /**\n     * Stage のクリック\n     */\n    const handleClick = useCallback(\n        (_: KonvaEventObject<PointerEvent>) => {\n            // ポップオーバーを閉じる\n            close();\n\n            if (tool === 'select') {\n                // 選択解除\n                setSelected([]);\n            }\n        },\n        [close, setSelected, tool]\n    );\n\n    return (\n        <>\n            <Stage\n                ref={canvasRef}\n                width={size.width}\n                height={size.height}\n                onClick={handleClick}\n                onTap={handleClick}\n                {...{ onPointerDown, onPointerMove, onPointerUp }}\n            >\n                <ContextBridge>\n                    <GridLayer />\n                    <GuideLayer />\n                    <ShapeLayer />\n                    <DrawLayer />\n                </ContextBridge>\n            </Stage>\n            {/* ポップアップ */}\n            <Popup />\n        </>\n    );\n};\n\nexport default forwardRef(CanvasCore);\n","import DrawProvider from './DrawProvider';\nimport PopupProvider from './PopupProvider';\nimport SelectProvider from './SelectProvider';\nimport StructureProvider, { StructureProviderProps } from './StructureProvider';\n\ntype Props = StructureProviderProps;\n\nconst CanvasProvider: React.VFC<Props> = ({ children, ...props }) => {\n    return (\n        <StructureProvider {...props}>\n            <PopupProvider>\n                <SelectProvider>\n                    <DrawProvider>{children}</DrawProvider>\n                </SelectProvider>\n            </PopupProvider>\n        </StructureProvider>\n    );\n};\n\nexport default CanvasProvider;\n","import { Box } from '@mui/material';\nimport { forwardRef, useEffect, useImperativeHandle, useRef, useState } from 'react';\nimport { CanvasTool, DOMSize } from '../../types/common';\nimport { emptyStructure, Structure } from '../../types/shape';\nimport CanvasCore from './core';\nimport CanvasProvider from './provider/CanvasProvider';\nimport { CanvasCoreHandler } from './types';\n\ninterface Props {\n    structure: Structure;\n    tool?: CanvasTool;\n    readonly?: boolean;\n}\n\nexport type CanvasHandler = CanvasCoreHandler;\n\nconst Canvas: React.ForwardRefRenderFunction<CanvasHandler, Props> = (\n    { tool = 'select', structure: source, readonly = false },\n    ref\n) => {\n    // キャンバス表示領域\n    const [size, setSize] = useState<DOMSize>({ width: 0, height: 0 });\n    // キャンバスの親要素\n    const containerRef = useRef<HTMLDivElement>(null);\n    // キャンバス本体\n    const canvasRef = useRef<CanvasCoreHandler>(null);\n\n    useImperativeHandle(\n        ref,\n        () => ({\n            toDataURL: () => {\n                if (canvasRef.current) {\n                    return canvasRef.current.toDataURL();\n                }\n            },\n            getStructure: () => {\n                if (canvasRef.current) {\n                    return canvasRef.current.getStructure();\n                }\n                return emptyStructure;\n            },\n        }),\n        []\n    );\n\n    // 要素のリサイズを監視\n    useEffect(() => {\n        const observer = new ResizeObserver((entries) => {\n            const { width, height } = entries[0].contentRect;\n            setSize({\n                width,\n                height,\n            });\n        });\n\n        if (containerRef.current) {\n            observer.observe(containerRef.current);\n        }\n\n        return () => {\n            observer.disconnect();\n        };\n    }, []);\n\n    return (\n        <Box\n            ref={containerRef}\n            sx={{\n                width: 'auto',\n                height: '100%',\n                backgroundColor: '#ffffff',\n                overscrollBehavior: 'contain',\n            }}\n        >\n            <CanvasProvider tool={tool} size={size} structure={source} readonly={readonly}>\n                <CanvasCore ref={canvasRef} />\n            </CanvasProvider>\n        </Box>\n    );\n};\n\nexport default forwardRef(Canvas);\n","import { Layer, Line } from 'react-konva';\nimport { DrawingProps, DrawSettings } from '../../../types/note';\n\ninterface Props {\n    drawings: DrawingProps[];\n    // 描画中のデータ\n    settings: DrawSettings;\n    points?: number[];\n}\n\nconst Draw: React.VFC<Props> = ({ drawings, settings, points }) => {\n    return (\n        <Layer>\n            {drawings.map(({ eraser = false, ...lineProps }, index) => (\n                <Line\n                    key={`note-drawing-${index}`}\n                    {...lineProps}\n                    globalCompositeOperation={eraser ? 'destination-out' : 'source-over'}\n                />\n            ))}\n            {points && (\n                <Line\n                    {...settings}\n                    points={points}\n                    globalCompositeOperation={settings.eraser ? 'destination-out' : 'source-over'}\n                />\n            )}\n        </Layer>\n    );\n};\n\nexport default Draw;\n","import CloseIcon from '@mui/icons-material/Close';\nimport EditIcon from '@mui/icons-material/Edit';\nimport MoreVertIcon from '@mui/icons-material/MoreVert';\nimport { IconButton, Menu, MenuItem, styled } from '@mui/material';\nimport { MouseEvent, MouseEventHandler, useCallback, useState } from 'react';\nimport { Html } from 'react-konva-utils';\nimport { AppMode } from '../../../../types/common';\n\ninterface Props {\n    visible?: boolean;\n    mode: AppMode;\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    onEdit?: MouseEventHandler<HTMLButtonElement>;\n    onCopy?: VoidFunction;\n    onDelete?: VoidFunction;\n    onCancel?: VoidFunction;\n}\n\nconst Background = styled('div')({\n    display: 'flex',\n    alignItems: 'center',\n    width: '100%',\n    padding: '0 8',\n});\nconst Spacer = styled('div')({\n    flex: 1,\n});\n\nconst HeaderMenu: React.VFC<Props> = ({\n    visible = false,\n    mode,\n    y: top,\n    x: left,\n    width,\n    onEdit,\n    onCopy,\n    onDelete,\n    onCancel,\n}) => {\n    const [anchorEl, setAnchorEl] = useState<HTMLButtonElement | null>(null);\n\n    const handleClickMore = useCallback((event: MouseEvent<HTMLButtonElement>) => {\n        setAnchorEl(event.currentTarget);\n    }, []);\n    const handleCloseMenu = useCallback(() => {\n        setAnchorEl(null);\n    }, []);\n\n    if (!visible) {\n        return null;\n    }\n\n    return (\n        <Html\n            divProps={{\n                style: {\n                    top: `${top - 42}px`,\n                    left: `${left}px`,\n                    width: `${width}px`,\n                },\n            }}\n        >\n            <Background>\n                {mode === 'canvas' && (\n                    <IconButton size=\"small\" onClick={onCancel}>\n                        <CloseIcon />\n                    </IconButton>\n                )}\n                {mode === 'note' && (\n                    <>\n                        <IconButton size=\"small\" onClick={onEdit}>\n                            <EditIcon />\n                        </IconButton>\n                        <Spacer />\n                        <IconButton size=\"small\" onClick={handleClickMore}>\n                            <MoreVertIcon />\n                        </IconButton>\n                    </>\n                )}\n            </Background>\n            <Menu anchorEl={anchorEl} open={Boolean(anchorEl)} onClose={handleCloseMenu}>\n                <MenuItem onClick={onCopy}>コピー</MenuItem>\n                <MenuItem onClick={onDelete}>削除</MenuItem>\n            </Menu>\n        </Html>\n    );\n};\n\nexport default HeaderMenu;\n","import Konva from 'konva';\nimport { KonvaEventObject } from 'konva/lib/Node';\nimport { Box } from 'konva/lib/shapes/Transformer';\nimport {\n    Dispatch,\n    MouseEvent,\n    SetStateAction,\n    useCallback,\n    useContext,\n    useEffect,\n    useMemo,\n    useRef,\n    useState,\n} from 'react';\nimport { Image, Rect, Transformer } from 'react-konva';\nimport useImage from 'use-image';\nimport { AppSettingsContext } from '../../../../providers/AppSettingsProvider';\nimport { NoteSettingsContext } from '../../../../providers/NoteSettingsProvider';\nimport { ShapeBaseProps } from '../../../../types/common';\nimport {\n    MinCanvasSize,\n    PageProps,\n    PageSize,\n    PageSizeType,\n    StructureCanvasProps,\n} from '../../../../types/note';\nimport { clone } from '../../../Canvas/util';\nimport HeaderMenu from './HeaderMenu';\n\ninterface Props extends StructureCanvasProps {\n    // ページ情報\n    size: PageSizeType;\n    draggable?: boolean;\n    // キャンバス情報\n    index: number;\n    onChange: Dispatch<SetStateAction<PageProps>>;\n    // 選択状態\n    selected?: boolean;\n    onSelect: VoidFunction;\n}\n\nconst CanvasHandle: React.VFC<Props> = ({\n    size,\n    draggable = false,\n    index,\n    onChange,\n    selected = false,\n    onSelect,\n    data,\n    image: dataURL,\n    ...props\n}) => {\n    const rectRef = useRef<Konva.Rect>(null);\n    const tfRef = useRef<Konva.Transformer>(null);\n    const [isDragging, setDragging] = useState(false);\n    const [image] = useImage(dataURL ?? '');\n\n    const { mode: noteMode } = useContext(NoteSettingsContext);\n    const { mode: appMode, editCanvas, closeCanvas } = useContext(AppSettingsContext);\n\n    const pageSize = useMemo(() => {\n        return PageSize[size];\n    }, [size]);\n\n    const visibleMenu = useMemo(() => {\n        return selected && !isDragging && noteMode === 'select';\n    }, [isDragging, noteMode, selected]);\n\n    const visibleTransformer = useMemo(() => {\n        return draggable && selected;\n    }, [draggable, selected]);\n\n    // 選択時にサイズ変更を可能にする\n    useEffect(() => {\n        if (selected && tfRef.current && rectRef.current) {\n            tfRef.current.nodes([rectRef.current]);\n            // 強制描画\n            tfRef.current.getLayer()?.batchDraw();\n        }\n    }, [selected]);\n\n    /**\n     * 位置/サイズ変更の確定\n     */\n    const handleChange = useCallback(\n        (rect: ShapeBaseProps) => {\n            onChange((page) => {\n                const newPage = clone(page);\n                const structure = newPage.structures[index];\n                newPage.structures[index] = {\n                    ...structure,\n                    ...rect,\n                };\n\n                return newPage;\n            });\n        },\n        [index, onChange]\n    );\n\n    /**\n     * ドラッグ開始\n     */\n    const handleDragStart = useCallback(() => {\n        setDragging(true);\n    }, []);\n\n    /**\n     * 移動\n     */\n    const handleDragMove = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            // イベントを伝播させない\n            event.cancelBubble = true;\n\n            if (rectRef.current) {\n                // ドラッグした位置\n                const { x, y } = event.target.attrs;\n                if (typeof x === 'number' && typeof y === 'number') {\n                    // 位置がページサイズの範囲内になるように x, y を補正\n                    const { width, height } = rectRef.current.getSize();\n                    let [newX, newY] = [x, y];\n\n                    if (newX < 0) {\n                        newX = 0;\n                    } else if (newX > pageSize.width - width) {\n                        newX = pageSize.width - width;\n                    }\n                    if (newY < 0) {\n                        newY = 0;\n                    } else if (newY > pageSize.height - height) {\n                        newY = pageSize.height - height;\n                    }\n\n                    if (x !== newX || y !== newY) {\n                        rectRef.current.setPosition({ x: newX, y: newY });\n                    }\n                }\n            }\n        },\n        [pageSize.height, pageSize.width]\n    );\n\n    /**\n     * 移動の確定\n     */\n    const handleDragEnd = useCallback(\n        (_: KonvaEventObject<Event>) => {\n            if (rectRef.current) {\n                // 現在位置を取得\n                const { x, y } = rectRef.current.getPosition();\n                const { width, height } = rectRef.current.getSize();\n                const newRectProps: ShapeBaseProps = {\n                    x,\n                    y,\n                    width,\n                    height,\n                };\n                // ドラッグ終了\n                setDragging(false);\n                // 更新\n                handleChange(newRectProps);\n            }\n        },\n        [handleChange]\n    );\n\n    /**\n     * サイズを最小値以下にできないように制限\n     */\n    const handleChangeBoundBox = useCallback((oldBox: Box, newBox: Box) => {\n        if (newBox.width < MinCanvasSize.width || newBox.height < MinCanvasSize.height) {\n            return oldBox;\n        }\n        return newBox;\n    }, []);\n\n    /**\n     * サイズ変更の確定\n     */\n    const handleTransformEnd = useCallback(() => {\n        if (rectRef.current) {\n            const rect = rectRef.current;\n            const { x: scaleX, y: scaleY } = rect.scale();\n            // reset scale\n            rect.scale({ x: 1, y: 1 });\n            const newRectProps: ShapeBaseProps = {\n                x: rect.x(),\n                y: rect.y(),\n                width: Math.max(MinCanvasSize.width, rect.width() * scaleX),\n                height: Math.max(MinCanvasSize.height, rect.height() * scaleY),\n            };\n\n            handleChange(newRectProps);\n        }\n    }, [handleChange]);\n\n    const handleEdit = useCallback(\n        (event: MouseEvent<HTMLButtonElement>) => {\n            // ボタンの位置\n            const { top, left } = event.currentTarget.getBoundingClientRect();\n\n            // 編集開始\n            const canvasProps: ShapeBaseProps = {\n                x: left,\n                y: top + 42,\n                width: props.width,\n                height: props.height,\n            };\n            editCanvas(canvasProps);\n        },\n        [editCanvas, props.height, props.width]\n    );\n\n    return (\n        <>\n            <Rect {...props} fill=\"white\" />\n            {image && <Image {...props} image={image} />}\n            <Rect\n                ref={rectRef}\n                stroke=\"black\"\n                strokeWidth={2}\n                draggable={draggable}\n                {...props}\n                onClick={onSelect}\n                onTap={onSelect}\n                onDragStart={handleDragStart}\n                onDragMove={handleDragMove}\n                onDragEnd={handleDragEnd}\n                onTransformEnd={handleTransformEnd}\n            />\n            <HeaderMenu\n                visible={visibleMenu}\n                mode={appMode}\n                {...props}\n                onEdit={handleEdit}\n                onCancel={closeCanvas}\n            />\n            <Transformer\n                ref={tfRef}\n                visible={visibleTransformer}\n                rotateEnabled={false}\n                boundBoxFunc={handleChangeBoundBox}\n            />\n        </>\n    );\n};\n\nexport default CanvasHandle;\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport { Dispatch, SetStateAction, useCallback, useContext, useMemo } from 'react';\nimport { Layer, Rect } from 'react-konva';\nimport { AppSettingsContext } from '../../../providers/AppSettingsProvider';\nimport { PageProps, PageSize } from '../../../types/note';\nimport CanvasHandle from '../nodes/CanvasHandle';\n\ninterface Props extends Pick<PageProps, 'size' | 'structures'> {\n    draggable?: boolean;\n    onChange: Dispatch<SetStateAction<PageProps>>;\n}\n\nconst Frame: React.VFC<Props> = ({ size, structures, draggable = false, onChange }) => {\n    const { selectedCanvasIndex, onSelectCanvas } = useContext(AppSettingsContext);\n\n    const pageSize = useMemo(() => {\n        return PageSize[size];\n    }, [size]);\n\n    const handleClick = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            if (event.target.attrs.type === 'background') {\n                onSelectCanvas(undefined);\n            }\n        },\n        [onSelectCanvas]\n    );\n\n    return (\n        <Layer>\n            {/* クリックが空振りしたときに選択解除する */}\n            <Rect\n                x={0}\n                y={0}\n                {...pageSize}\n                attrs={{ type: 'background' }}\n                onClick={handleClick}\n                onTap={handleClick}\n            />\n            {structures.map((structure, index) => (\n                <CanvasHandle\n                    key={`handle-${index}`}\n                    size={size}\n                    draggable={draggable}\n                    index={index}\n                    onChange={onChange}\n                    selected={index === selectedCanvasIndex}\n                    onSelect={() => onSelectCanvas(index)}\n                    {...structure}\n                />\n            ))}\n        </Layer>\n    );\n};\n\nexport default Frame;\n","import { useMemo } from 'react';\nimport { Layer, Line } from 'react-konva';\nimport { PageSize, PageSizeType } from '../../../types/note';\n\ninterface LineProps {\n    id: string;\n    points: number[];\n    stroke: string;\n    strokeWidth: number;\n    dash: [number, number];\n    listening: boolean;\n}\n\nconst defaultLineProps: LineProps = {\n    id: '',\n    points: [],\n    stroke: '#c9e1ff',\n    strokeWidth: 1,\n    dash: [5, 3],\n    listening: false,\n};\n\nconst GridSize = 50;\n\ninterface Props {\n    size: PageSizeType;\n}\n\nconst Grid: React.VFC<Props> = ({ size }) => {\n    const layerSize = useMemo(() => {\n        return PageSize[size];\n    }, [size]);\n\n    const horizontalLines: LineProps[] = useMemo(() => {\n        const lines: LineProps[] = [];\n        let count = 1;\n        for (let y = 0; y <= layerSize.height; y += GridSize) {\n            lines.push({\n                ...defaultLineProps,\n                id: `Horizontal_${count}`,\n                points: [0, y, layerSize.width, y],\n            });\n            count++;\n        }\n        return lines;\n    }, [layerSize]);\n\n    const verticalLines: LineProps[] = useMemo(() => {\n        const lines: LineProps[] = [];\n        let count = 1;\n        for (let x = 0; x <= layerSize.width; x += GridSize) {\n            lines.push({\n                ...defaultLineProps,\n                id: `Vertical_${count}`,\n                points: [x, 0, x, layerSize.height],\n            });\n            count++;\n        }\n        return lines;\n    }, [layerSize]);\n\n    return (\n        <Layer>\n            {/* horizontal */}\n            {horizontalLines.map((props) => (\n                <Line key={props.id} {...props} />\n            ))}\n            {/* vertical */}\n            {verticalLines.map((props) => (\n                <Line key={props.id} {...props} />\n            ))}\n        </Layer>\n    );\n};\n\nexport default Grid;\n","import Konva from 'konva';\nimport { KonvaEventObject } from 'konva/lib/Node';\nimport {\n    Dispatch,\n    SetStateAction,\n    useCallback,\n    useContext,\n    useMemo,\n    useRef,\n    useState,\n} from 'react';\nimport { Stage } from 'react-konva';\nimport { useContextBridge } from '../../hooks/useContextBridge';\nimport { AppSettingsContext } from '../../providers/AppSettingsProvider';\nimport { ConfigurationContext } from '../../providers/ConfigurationProvider';\nimport { NoteSettingsContext } from '../../providers/NoteSettingsProvider';\nimport { DOMSize } from '../../types/common';\nimport { PageProps, PageSize } from '../../types/note';\nimport { clone } from '../Canvas/util';\nimport Draw from './layer/Draw';\nimport Frame from './layer/Frame';\nimport Grid from './layer/Grid';\n\ninterface Props extends PageProps {\n    viewBox: DOMSize;\n    onChange: Dispatch<SetStateAction<PageProps>>;\n}\n\nconst Page: React.VFC<Props> = ({ viewBox, size, drawings, structures, onChange }) => {\n    const stageRef = useRef<Konva.Stage>(null);\n    const { mode: noteMode, settings } = useContext(NoteSettingsContext);\n    const { mode: appMode } = useContext(AppSettingsContext);\n\n    // Stage 以降で使用する Context を Bridge する\n    const ContextBridge = useContextBridge(\n        AppSettingsContext,\n        ConfigurationContext,\n        NoteSettingsContext\n    );\n\n    // 描画用\n    const isDrawing = useRef<boolean>();\n    const [points, setPoints] = useState<number[]>([]);\n\n    const pageSize = useMemo(() => {\n        return PageSize[size];\n    }, [size]);\n\n    const draggable = useMemo(() => {\n        return appMode === 'note' && noteMode === 'select';\n    }, [appMode, noteMode]);\n\n    /**\n     * ページサイズの範囲で表示領域を移動する\n     */\n    const handleDragMove = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            const { x, y } = event.target.attrs;\n            if (stageRef.current && typeof x === 'number' && typeof y === 'number') {\n                let [newX, newY] = [x, y];\n                let modified = false;\n\n                if (newX > 0) {\n                    newX = 0;\n                    modified = true;\n                } else if (Math.abs(newX) + viewBox.width > pageSize.width) {\n                    newX = viewBox.width - pageSize.width;\n                    modified = true;\n                }\n\n                if (newY > 0) {\n                    newY = 0;\n                    modified = true;\n                } else if (Math.abs(newY) + viewBox.height > pageSize.height) {\n                    newY = viewBox.height - pageSize.height;\n                    modified = true;\n                }\n\n                if (modified) {\n                    stageRef.current.setPosition({ x: newX, y: newY });\n                }\n            }\n        },\n        [pageSize.height, pageSize.width, viewBox.height, viewBox.width]\n    );\n\n    /**\n     * 描画の開始\n     */\n    const handlePointerDown = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            if (noteMode !== 'edit') {\n                return;\n            }\n\n            const point = event.target.getStage()?.getPointerPosition();\n            if (stageRef.current && point) {\n                isDrawing.current = true;\n\n                const { x, y } = stageRef.current.getPosition();\n                setPoints([point.x + Math.abs(x), point.y + Math.abs(y)]);\n            }\n        },\n        [noteMode]\n    );\n\n    /**\n     * ポインタの移動時に位置を取得\n     */\n    const handlePointerMove = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            if (noteMode !== 'edit') {\n                return;\n            }\n            if (!isDrawing.current) {\n                return;\n            }\n\n            const point = event.target.getStage()?.getPointerPosition();\n            if (stageRef.current && point) {\n                const { x, y } = stageRef.current.getPosition();\n                setPoints((state) => [...state, point.x + Math.abs(x), point.y + Math.abs(y)]);\n            }\n        },\n        [noteMode]\n    );\n\n    /**\n     * 描画の確定\n     */\n    const handlePointerUp = useCallback(\n        (_: KonvaEventObject<Event>) => {\n            if (noteMode !== 'edit') {\n                return;\n            }\n            if (!isDrawing.current) {\n                return;\n            }\n\n            isDrawing.current = false;\n            // 更新を確定\n            onChange((page) => {\n                const data = clone(page);\n                // 描画データを追加\n                data.drawings.push({\n                    ...settings,\n                    points,\n                });\n\n                return data;\n            });\n            // 現在の描画データをクリア\n            setPoints([]);\n        },\n        [noteMode, onChange, points, settings]\n    );\n\n    return (\n        <Stage\n            ref={stageRef}\n            width={viewBox.width}\n            height={viewBox.height}\n            draggable={draggable}\n            onDragMove={handleDragMove}\n            onPointerDown={handlePointerDown}\n            onPointerMove={handlePointerMove}\n            onPointerUp={handlePointerUp}\n        >\n            <ContextBridge>\n                <Grid size={size} />\n                <Frame\n                    size={size}\n                    structures={structures}\n                    draggable={draggable}\n                    onChange={onChange}\n                />\n                <Draw drawings={drawings} settings={settings} points={points} />\n            </ContextBridge>\n        </Stage>\n    );\n};\n\nexport default Page;\n","import { Box } from '@mui/material';\nimport { useContext, useEffect, useRef, useState } from 'react';\nimport { AppSettingsContext } from '../../providers/AppSettingsProvider';\nimport { DOMSize } from '../../types/common';\nimport Page from './Page';\n\nconst Note: React.VFC = () => {\n    // キャンバスの親要素\n    const containerRef = useRef<HTMLDivElement>(null);\n    // 表示領域\n    const [viewBox, setViewBox] = useState<DOMSize>({ width: 0, height: 0 });\n    // ページデータ\n    const { page, onChange } = useContext(AppSettingsContext);\n\n    // 要素のリサイズを監視\n    useEffect(() => {\n        const observer = new ResizeObserver((entries) => {\n            const { width, height } = entries[0].contentRect;\n            setViewBox({\n                width,\n                height,\n            });\n        });\n\n        if (containerRef.current) {\n            observer.observe(containerRef.current);\n        }\n\n        return () => {\n            observer.disconnect();\n        };\n    }, []);\n\n    return (\n        <Box\n            ref={containerRef}\n            sx={{\n                width: 'auto',\n                height: '100%',\n                backgroundColor: '#ffffff',\n                overscrollBehavior: 'contain',\n                overflow: 'hidden',\n            }}\n        >\n            <Page viewBox={viewBox} {...page} onChange={onChange} />\n        </Box>\n    );\n};\n\nexport default Note;\n","import { Box } from '@mui/material';\nimport { useContext, useMemo } from 'react';\nimport { AppSettingsContext } from '../providers/AppSettingsProvider';\nimport { ConfigurationContext } from '../providers/ConfigurationProvider';\nimport { emptyStructure } from '../types/shape';\nimport Canvas from './Canvas';\nimport Note from './Note';\n\nconst MainContainer: React.VFC = () => {\n    const { page, selectedCanvasIndex, canvasProps, canvasRef } = useContext(AppSettingsContext);\n    const { tool } = useContext(ConfigurationContext);\n\n    const structure = useMemo(() => {\n        if (typeof selectedCanvasIndex === 'number') {\n            return page.structures[selectedCanvasIndex].data;\n        }\n    }, [page.structures, selectedCanvasIndex]);\n\n    return (\n        <>\n            <Box\n                sx={{\n                    boxSizing: 'border-box',\n                    ml: 1,\n                    mb: 1,\n                    flex: 1,\n                    border: (theme) => `1px solid ${theme.palette.divider}`,\n                    borderRadius: 1,\n                    overflow: 'hidden',\n                }}\n            >\n                <Note />\n            </Box>\n            {canvasProps && (\n                <Box\n                    sx={{\n                        position: 'absolute',\n                        top: canvasProps.y,\n                        left: canvasProps.x,\n                        width: canvasProps.width,\n                        height: canvasProps.height,\n                        backgroundColor: 'red',\n                    }}\n                >\n                    <Canvas ref={canvasRef} tool={tool} structure={structure ?? emptyStructure} />\n                </Box>\n            )}\n        </>\n    );\n};\n\nexport default MainContainer;\n","import { ArrowDownward, Delete, Edit, PanToolAlt, Texture } from '@mui/icons-material';\nimport { Stack, ToggleButton, ToggleButtonGroup, Typography } from '@mui/material';\nimport { MouseEvent, ReactElement, useCallback, useContext } from 'react';\nimport { ConfigurationContext } from '../../providers/ConfigurationProvider';\nimport { CanvasTool, isCanvasTool } from '../../types/common';\n\ninterface Props {\n    tool: CanvasTool;\n    onChange: (tool: CanvasTool) => void;\n}\n\ninterface ButtonProps {\n    tool: CanvasTool;\n    icon: ReactElement;\n    label: string;\n}\n\nconst ToolboxButtons: Readonly<Record<CanvasTool, ButtonProps>> = {\n    select: {\n        tool: 'select',\n        icon: <PanToolAlt />,\n        label: '選択',\n    },\n    pen: {\n        tool: 'pen',\n        icon: <Edit />,\n        label: '梁要素の描画',\n    },\n    force: {\n        tool: 'force',\n        icon: <ArrowDownward />,\n        label: '集中荷重の追加',\n    },\n    trapezoid: {\n        tool: 'trapezoid',\n        icon: <Texture />,\n        label: '分布荷重の追加',\n    },\n    delete: {\n        tool: 'delete',\n        icon: <Delete />,\n        label: '要素の削除',\n    },\n};\n\nconst CanvasToolboxCore: React.VFC<Props> = ({ tool, onChange }) => {\n    /**\n     * ツールの変更\n     */\n    const handleChange = useCallback(\n        (_: MouseEvent<HTMLElement>, newValue: string | null) => {\n            if (newValue !== null && isCanvasTool(newValue)) {\n                onChange(newValue);\n            }\n        },\n        [onChange]\n    );\n\n    return (\n        <Stack sx={{ width: 160 }} alignItems=\"flex-start\">\n            <Typography variant=\"caption\">Toolbox</Typography>\n            <ToggleButtonGroup\n                orientation=\"vertical\"\n                value={tool}\n                exclusive\n                fullWidth\n                onChange={handleChange}\n            >\n                {Object.entries(ToolboxButtons).map(([key, { icon, label }]) => (\n                    <ToggleButton\n                        key={key}\n                        value={key}\n                        sx={{ justifyContent: 'flex-start', alignItems: 'center' }}\n                    >\n                        {icon}\n                        <Typography variant=\"caption\" sx={{ ml: 1 }}>\n                            {label}\n                        </Typography>\n                    </ToggleButton>\n                ))}\n            </ToggleButtonGroup>\n        </Stack>\n    );\n};\n\nconst CanvasToolbox: React.VFC = () => {\n    const { tool, setTool } = useContext(ConfigurationContext);\n    return <CanvasToolboxCore tool={tool} onChange={setTool} />;\n};\n\nexport default CanvasToolbox;\n","import { AutoFixNormal, Edit, PanToolAlt } from '@mui/icons-material';\nimport {\n    Slider,\n    Stack,\n    TextField,\n    ToggleButton,\n    ToggleButtonGroup,\n    Typography,\n} from '@mui/material';\nimport {\n    ChangeEvent,\n    Dispatch,\n    MouseEvent,\n    ReactElement,\n    SetStateAction,\n    useCallback,\n    useContext,\n} from 'react';\nimport { NoteSettingsContext } from '../../providers/NoteSettingsProvider';\nimport { DrawSettings, isNoteMode, NoteMode } from '../../types/note';\n\ninterface Props {\n    mode: NoteMode;\n    settings: DrawSettings;\n    onChangeMode: Dispatch<SetStateAction<NoteMode>>;\n    onChangeDrawSettings: Dispatch<SetStateAction<DrawSettings>>;\n}\n\nconst DrawModes = ['pen', 'eraser'] as const;\ntype DrawMode = typeof DrawModes[number];\nconst isDrawMode = (item: unknown): item is DrawMode => {\n    if (typeof item === 'string') {\n        return DrawModes.some((mode) => mode === item);\n    }\n    return false;\n};\n\ninterface ButtonProps {\n    mode: NoteMode | DrawMode;\n    icon: ReactElement;\n    label: string;\n}\n\nconst NoteModeButtons: Readonly<Record<NoteMode, ButtonProps>> = {\n    select: {\n        mode: 'select',\n        icon: <PanToolAlt />,\n        label: '選択',\n    },\n    edit: {\n        mode: 'edit',\n        icon: <Edit />,\n        label: '描画',\n    },\n};\n\nconst DrawModeButtons: Readonly<Record<DrawMode, ButtonProps>> = {\n    pen: {\n        mode: 'pen',\n        icon: <Edit />,\n        label: 'ペンツール',\n    },\n    eraser: {\n        mode: 'eraser',\n        icon: <AutoFixNormal />,\n        label: '消しゴム',\n    },\n};\n\nconst MinStrokeWidth = 4;\nconst MaxStrokeWidth = 20;\nconst StrokeWidthStep = 4;\n\nconst NoteToolboxCore: React.VFC<Props> = ({\n    mode,\n    settings,\n    onChangeMode,\n    onChangeDrawSettings,\n}) => {\n    /**\n     * モードの変更\n     */\n    const handleChangeMode = useCallback(\n        (_: MouseEvent<HTMLElement>, newValue: string | null) => {\n            if (newValue !== null && isNoteMode(newValue)) {\n                onChangeMode(newValue);\n            }\n        },\n        [onChangeMode]\n    );\n\n    /**\n     * 描画ツールの選択\n     */\n    const handleChangeTool = useCallback(\n        (_: MouseEvent<HTMLElement>, newValue: string | null) => {\n            if (newValue !== null && isDrawMode(newValue)) {\n                onChangeDrawSettings((state) => ({\n                    ...state,\n                    eraser: newValue === 'eraser',\n                }));\n            }\n        },\n        [onChangeDrawSettings]\n    );\n\n    const handleChangeStrokeWidth = useCallback(\n        (_: Event, value: number | number[]) => {\n            if (typeof value === 'number') {\n                onChangeDrawSettings((state) => ({\n                    ...state,\n                    strokeWidth: value,\n                }));\n            }\n        },\n        [onChangeDrawSettings]\n    );\n\n    const handleChangeStroke = useCallback(\n        (event: ChangeEvent<HTMLInputElement>) => {\n            if (event.target.checkValidity()) {\n                const { value } = event.target;\n                onChangeDrawSettings((state) => ({\n                    ...state,\n                    stroke: value,\n                }));\n            }\n        },\n        [onChangeDrawSettings]\n    );\n\n    return (\n        <Stack sx={{ width: 160 }} alignItems=\"flex-start\">\n            <Typography variant=\"caption\">Toolbox</Typography>\n            {/* 選択 / 編集の切り替え */}\n            <ToggleButtonGroup\n                orientation=\"vertical\"\n                value={mode}\n                exclusive\n                fullWidth\n                onChange={handleChangeMode}\n            >\n                {Object.entries(NoteModeButtons).map(([key, { icon, label }]) => (\n                    <ToggleButton\n                        key={key}\n                        value={key}\n                        sx={{ justifyContent: 'flex-start', alignItems: 'center' }}\n                    >\n                        {icon}\n                        <Typography variant=\"caption\" sx={{ ml: 1 }}>\n                            {label}\n                        </Typography>\n                    </ToggleButton>\n                ))}\n            </ToggleButtonGroup>\n            <Typography variant=\"caption\" sx={{ mt: 1 }}>\n                描画ツール\n            </Typography>\n            {/* eraser */}\n            <ToggleButtonGroup\n                orientation=\"vertical\"\n                value={settings.eraser ? 'eraser' : 'pen'}\n                exclusive\n                fullWidth\n                disabled={mode === 'select'}\n                onChange={handleChangeTool}\n            >\n                {Object.entries(DrawModeButtons).map(([key, { icon, label }]) => (\n                    <ToggleButton\n                        key={key}\n                        value={key}\n                        sx={{ justifyContent: 'flex-start', alignItems: 'center' }}\n                    >\n                        {icon}\n                        <Typography variant=\"caption\" sx={{ ml: 1 }}>\n                            {label}\n                        </Typography>\n                    </ToggleButton>\n                ))}\n            </ToggleButtonGroup>\n            {/* strokeWidth */}\n            <Typography variant=\"caption\" sx={{ mt: 1 }}>\n                太さ\n            </Typography>\n            <Slider\n                sx={{ ml: 1, mb: 2, boxSizing: 'border-box', width: 140 }}\n                value={settings.strokeWidth}\n                min={MinStrokeWidth}\n                max={MaxStrokeWidth}\n                step={StrokeWidthStep}\n                marks\n                valueLabelDisplay=\"auto\"\n                disabled={mode === 'select'}\n                onChange={handleChangeStrokeWidth}\n            />\n            {/* stroke */}\n            <TextField\n                type=\"color\"\n                label=\"ペンの色\"\n                value={settings.stroke}\n                disabled={mode === 'select' || settings.eraser}\n                fullWidth\n                margin=\"dense\"\n                size=\"small\"\n                onChange={handleChangeStroke}\n            />\n        </Stack>\n    );\n};\n\nconst NoteToolbox: React.VFC = () => {\n    const props = useContext(NoteSettingsContext);\n    return <NoteToolboxCore {...props} />;\n};\n\nexport default NoteToolbox;\n","import { useContext } from 'react';\nimport { AppSettingsContext } from '../../providers/AppSettingsProvider';\nimport CanvasToolbox from './CanvasToolbox';\nimport NoteToolbox from './NoteToolbox';\n\nconst Toolbox: React.VFC = () => {\n    const { mode } = useContext(AppSettingsContext);\n    if (mode === 'canvas') {\n        return <CanvasToolbox />;\n    }\n    return <NoteToolbox />;\n};\n\nexport default Toolbox;\n","import { Box } from '@mui/material';\nimport { useCallback, useEffect, useState } from 'react';\nimport { DOMSize } from '../types/common';\nimport Header from './Header';\nimport MainContainer from './MainContainer';\nimport Toolbox from './Toolbox';\n\nconst Layout: React.VFC = () => {\n    const [windowRect, setWindowRect] = useState<DOMSize>({ width: 0, height: 0 });\n\n    const fitWindowSize = useCallback(() => {\n        const { innerHeight, innerWidth } = window;\n        setWindowRect({\n            height: innerHeight,\n            width: innerWidth,\n        });\n    }, []);\n\n    useEffect(() => {\n        fitWindowSize();\n        window.addEventListener('resize', fitWindowSize);\n\n        return () => {\n            window.removeEventListener('resize', fitWindowSize);\n        };\n    }, [fitWindowSize]);\n\n    return (\n        <Box sx={{ ...windowRect, overflow: 'hidden' }}>\n            <Header />\n            <Box\n                sx={{\n                    boxSizing: 'border-box',\n                    width: 'auto',\n                    height: 'calc(100% - 48px)',\n                    display: 'flex',\n                    flexDirection: 'row',\n                    flexWrap: 'nowrap',\n                    alignItems: 'stretch',\n                    pt: 1,\n                    px: 1,\n                }}\n            >\n                <Toolbox />\n                <MainContainer />\n            </Box>\n        </Box>\n    );\n};\n\nexport default Layout;\n","import { createTheme, CssBaseline, ThemeProvider } from '@mui/material';\nimport React from 'react';\nimport AppSettingsProvider from '../providers/AppSettingsProvider';\nimport ConfigurationProvider from '../providers/ConfigurationProvider';\nimport NoteSettingsProvider from '../providers/NoteSettingsProvider';\nimport Layout from './Layout';\n\nconst theme = createTheme();\n\nconst App: React.VFC = () => {\n    return (\n        <ThemeProvider theme={theme}>\n            <AppSettingsProvider>\n                <ConfigurationProvider>\n                    <NoteSettingsProvider>\n                        <CssBaseline />\n                        <Layout />\n                    </NoteSettingsProvider>\n                </ConfigurationProvider>\n            </AppSettingsProvider>\n        </ThemeProvider>\n    );\n};\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler): void => {\n    if (onPerfEntry && onPerfEntry instanceof Function) {\n        import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n            getCLS(onPerfEntry);\n            getFID(onPerfEntry);\n            getFCP(onPerfEntry);\n            getLCP(onPerfEntry);\n            getTTFB(onPerfEntry);\n        });\n    }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './components/App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n    <React.StrictMode>\n        <App />\n    </React.StrictMode>,\n    document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}