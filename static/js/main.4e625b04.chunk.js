(this["webpackJsonpdrawing-sample"]=this["webpackJsonpdrawing-sample"]||[]).push([[0],{123:function(e,t,n){"use strict";n.r(t);var r,c,a,i,o,s=n(0),l=n.n(s),u=n(30),b=n.n(u),j=n(95),d=n(184),f=n(174),O=n(5),x=n(55),v=n.n(x),h=new v.a(1,0),p=new v.a(0,1),g=function(e,t,n){if(n>=1)return t;if(n<=0)return e;var r=t.clone().subtract(e).normalize(),c=e.distance(t),a=r.multiplyScalar(c*n);return e.clone().add(a)},m=function(e,t){var n=t.clone().subtract(e).normalize(),r=new v.a(n.y,-1*n.x).normalize();return p.dot(r)>0&&r.invert(),r},y=function(e){return JSON.parse(JSON.stringify(e))},C=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=Math.pow(10,t),r=Math.round(e*n)/n;return r},w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,n=e/t,r=Math.round(n)*t;return r},k=function(e){var t=Object(O.a)(e,2),n=t[0],r=t[1],c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25;return[w(n,c),w(r,c)]},S=n(4),E=n(180),I=function(e,t){return{id:Object(E.a)(),x:e,y:t}},z=["free","pin","pinX","pinZ","fixX","fix"],P={unit:{force:"kN",length:"m"},nodes:[],beams:[],forces:[],trapezoids:[]},M=["select","edit"],N={A3:{width:0,height:0},A4:{width:2970,height:2100},B4:{width:0,height:0},B5:{width:0,height:0}},R={width:160,height:90},T={stroke:"#000000",strokeWidth:4,eraser:!1,lineJoin:"round",lineCap:"round"},D={size:"A4",drawings:[],structures:[Object(S.a)({data:P,x:100,y:100},R)]},_=n(1),W=Object(s.createContext)(void 0),B=function(e){var t=e.children,n=Object(s.useState)("note"),r=Object(O.a)(n,2),c=r[0],a=r[1],i=Object(s.useState)(D),o=Object(O.a)(i,2),l=o[0],u=o[1],b=Object(s.useState)(),j=Object(O.a)(b,2),d=j[0],f=j[1],x=Object(s.useState)(),v=Object(O.a)(x,2),h=v[0],p=v[1],g=Object(s.useRef)(null),m=Object(s.useCallback)((function(e){a("canvas"),p(e)}),[]),C=Object(s.useCallback)((function(){if(g.current){var e=g.current.getStructure(),t=g.current.toDataURL();"number"===typeof d&&u((function(n){var r=y(n);return r.structures[d].data=e,r.structures[d].image=t,r}))}a("note"),p(void 0)}),[d]);return Object(_.jsx)(W.Provider,{value:{mode:c,onChangeMode:a,page:l,onChange:u,selectedCanvasIndex:d,onSelectCanvas:f,canvasProps:h,editCanvas:m,closeCanvas:C,canvasRef:g},children:t})},F=Object(s.createContext)(void 0),J=function(e){var t=e.children,n=Object(s.useState)("select"),r=Object(O.a)(n,2),c=r[0],a=r[1];return Object(_.jsx)(F.Provider,{value:{tool:c,setTool:a},children:t})},X=Object(s.createContext)(void 0),A=function(e){var t=e.children,n=Object(s.useState)("select"),r=Object(O.a)(n,2),c=r[0],a=r[1],i=Object(s.useState)(T),o=Object(O.a)(i,2),l=o[0],u=o[1];return Object(_.jsx)(X.Provider,{value:{mode:c,settings:l,onChangeMode:a,onChangeDrawSettings:u},children:t})},G=n(192),L=n(186),Y=n(188),U=n(185),Z=null!==(r=null===(c="f8de090ada1a3ef955ba73a8d7d5825658b35e8b\n")?void 0:c.substring(0,7))&&void 0!==r?r:"",V=null!==(a="2022/01/11 14:05:50")?a:"",H=null!==(i="0.1.0")?i:"",q=function(){return Object(_.jsx)(U.a,{variant:"caption",sx:{ml:2},children:"ver ".concat(H," (").concat(Z,": ").concat(V,")")})},K=function(){return Object(_.jsx)(L.a,{position:"static",children:Object(_.jsxs)(Y.a,{variant:"dense",children:[Object(_.jsx)(U.a,{component:"h1",variant:"h6",color:"inherit",children:"Drawing Sample"}),Object(_.jsx)(q,{})]})})},Q=n(18),$=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=s.useRef([]);return r.current=t.map((function(e){return s.useContext(e)})),s.useMemo((function(){return function(e){var n=e.children;return t.reduceRight((function(e,t,n){return Object(_.jsx)(t.Provider,{value:r.current[n],children:e})}),n)}}),[t])},ee=n(19),te=["select","pen","force","trapezoid","delete"],ne=Object(s.createContext)(void 0),re=function(e){var t=e.children,n=e.tool,r=void 0===n?"select":n,c=e.readonly,a=void 0!==c&&c,i=e.size,o=e.gridSize,l=void 0===o?25:o,u=e.snapSize,b=void 0===u?25:u,j=e.structure,d=Object(s.useState)(j),f=Object(O.a)(d,2),x=f[0],v=f[1],h=Object(s.useCallback)((function(e){if(!a){var t=y(x),n="Force_".concat(t.forces.length+1),r=function(e){return Object(S.a)(Object(S.a)({},e),{},{id:Object(E.a)()})}(Object(S.a)({name:n},e));t.forces.push(r),v(t)}}),[a,x]),p=Object(s.useCallback)((function(e){if(!a){var t=x.forces.findIndex((function(t){return t.id===e}));if(t>=0){var n=y(x);n.forces.splice(t,1),v(n)}}}),[a,x]),g=Object(s.useCallback)((function(e){if(!a){var t=x.trapezoids.findIndex((function(t){return t.id===e}));if(t>=0){var n=y(x);n.trapezoids.splice(t,1),v(n)}}}),[a,x]),m=Object(s.useCallback)((function(e){if(!a){var t=x.beams.findIndex((function(t){return t.id===e}));if(t>=0){var n=x.beams[t],r=n.nodeI,c=n.nodeJ,i=y(x);i.beams.splice(t,1),[r,c].forEach((function(e){var t=i.beams.some((function(t){var n=t.nodeI,r=t.nodeJ;return e===n||e===r}));if(!t){var n=i.nodes.findIndex((function(t){return t.id===e}));n>=0&&i.nodes.splice(n,1)}}));var o=i.forces.filter((function(t){return t.beam!==e}));i.forces=o;var s=i.trapezoids.filter((function(t){return t.beam!==e}));i.trapezoids=s,v(i)}}}),[a,x]);return Object(_.jsx)(ne.Provider,{value:{tool:r,readonly:a,size:i,gridSize:l,snapSize:b,structure:x,addForce:h,deleteForce:p,deleteTrapezoid:g,deleteBeam:m,setStructure:v},children:t})},ce=Object(s.createContext)(void 0),ae=function(e){var t=e.children,n=Object(s.useContext)(ne),r=n.tool,c=n.readonly,a=void 0!==c&&c,i=n.setStructure,o=Object(s.useState)([]),l=Object(O.a)(o,2),u=l[0],b=l[1],j=Object(s.useRef)(),d=Object(s.useRef)(),f=Object(s.useMemo)((function(){return!(!a&&"undefined"!==typeof i)||!("pen"===r||"trapezoid"===r)}),[a,i,r]),x=Object(s.useCallback)((function(e){var t;if(!f){if("trapezoid"===r){if("beam"!==e.target.attrs.type)return;var n=e.target.attrs.id,c=e.target.attrs.points;a=c,Array.isArray(a)&&(0===a.length||a.every((function(e){return"number"===typeof e})))&&"string"===typeof n&&(d.current={id:n,points:c})}var a,i=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();i&&(j.current=!0,b([i.x,i.y]))}}),[f,b,r]),h=Object(s.useCallback)((function(e){var t;if(!f&&j.current){var n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&b((function(e){return[].concat(Object(ee.a)(e),[n.x,n.y])}))}}),[f,b]),p=Object(s.useCallback)((function(e,t){if(i){var n=k([e[0],e[1]],25),r=k([t[0],t[1]],25);i((function(e){var t=y(e),c=I.apply(void 0,Object(ee.a)(n)),a=t.nodes.find((function(e){return e.x===c.x&&e.y===c.y}));a?c.id=a.id:t.nodes.push(c);var i=I.apply(void 0,Object(ee.a)(r)),o=t.nodes.find((function(e){return e.x===i.x&&e.y===i.y}));o?i.id=o.id:t.nodes.push(i);var s=function(e,t,n){return{id:Object(E.a)(),name:e,nodeI:t,nodeJ:n}}("Beam_".concat(t.beams.length+1),c.id,i.id);return t.beams.push(s),t}))}}),[i]),g=Object(s.useCallback)((function(e,t,n){if(i){var r=function(e,t,n,r){var c=r.slice(0,2),a=r.slice(-2),i=new v.a(c[0],c[1]),o=new v.a(a[0],a[1]),s=i.distance(o),l=o.clone().subtract(i).normalize(),u=new v.a(e[0],e[1]),b=new v.a(t[0],t[1]),j=i.distance(u),d=i.distance(b);if(j>d){var f=[b,u];u=f[0],b=f[1];var O=[d,j];j=O[0],d=O[1]}var x=i.clone().add(l.clone().multiplyScalar(j)),h=b.clone().subtract(x).normalize(),p=l.angle()-h.angle(),g=x.distance(b)*Math.cos(p),m=x.clone().add(l.clone().multiplyScalar(g));d=o.distance(m);var y=C(j/s,3),w=C(d/s,3);return{id:Object(E.a)(),name:"Trapezoid_N",beam:n,forceI:10,forceJ:10,distanceI:y,distanceJ:w,angle:90,isGlobal:!1}}(e,t,n.id,n.points);i((function(e){var t=y(e),n="Trapezoid_".concat(t.trapezoids.length+1);return r.name=n,t.trapezoids.push(r),t}))}}),[i]),m=Object(s.useCallback)((function(e){if(!f&&j.current&&(j.current=!1,u.length>=4)){var t=u.slice(0,2),n=u.slice(-2);"pen"===r?p(t,n):"trapezoid"===r&&d.current&&g(t,n,d.current),b([]),d.current=void 0}}),[f,p,g,u,b,r]);return Object(_.jsx)(ce.Provider,{value:{points:u,onPointerDown:x,onPointerMove:h,onPointerUp:m},children:t})},ie=function(e){var t=e.tool,n=e.points,r=Object(s.useMemo)((function(){switch(t){case"pen":return"blue";case"trapezoid":return"red";default:return"black"}}),[t]);return Object(_.jsx)(Q.e,{children:Object(_.jsx)(Q.f,{points:n,strokeWidth:3,stroke:r})})},oe=function(){var e=Object(s.useContext)(ne).tool,t=Object(s.useContext)(ce).points;return Object(_.jsx)(ie,{tool:e,points:t})},se={id:"",points:[],stroke:"#c9e1ff",strokeWidth:1,dash:[5,3],listening:!1},le=function(){var e=Object(s.useContext)(ne),t=e.size,n=e.gridSize,r=Object(s.useMemo)((function(){for(var e=[],r=1,c=0;c<=t.height;c+=n)e.push(Object(S.a)(Object(S.a)({},se),{},{id:"Horizontal_".concat(r),points:[0,c,t.width,c]})),r++;return e}),[n,t.height,t.width]),c=Object(s.useMemo)((function(){for(var e=[],r=1,c=0;c<=t.width;c+=n)e.push(Object(S.a)(Object(S.a)({},se),{},{id:"Vertical_".concat(r),points:[c,0,c,t.height]})),r++;return e}),[n,t.height,t.width]);return Object(_.jsxs)(Q.e,{listening:!1,children:[r.map((function(e){return Object(_.jsx)(Q.f,Object(S.a)({},e),e.id)})),c.map((function(e){return Object(_.jsx)(Q.f,Object(S.a)({},e),e.id)}))]})},ue=Object(s.createContext)(void 0),be=function(e){var t=e.children,n=Object(s.useState)([]),r=Object(O.a)(n,2),c=r[0],a=r[1],i=Object(s.useCallback)((function(e){return c.some((function(t){var n=t.type,r=t.id;return n===e.type&&r===e.id}))}),[c]),o=Object(s.useCallback)((function(e){i(e)||a((function(t){return[].concat(Object(ee.a)(t),[e])}))}),[i,a]),l=Object(s.useCallback)((function(e){i(e)?a((function(t){return t.filter((function(t){var n=t.type,r=t.id;return!(n===e.type&&r===e.id)}))})):a((function(t){return[].concat(Object(ee.a)(t),[e])}))}),[i,a]);return Object(_.jsx)(ue.Provider,{value:{selected:c,setSelected:a,isSelected:i,select:o,toggle:l},children:t})},je=function(e){var t=e.id,n=e.name,r=e.nodeI,c=e.nodeJ,a=e.tool,i=e.selected,o=void 0!==i&&i,l=e.addForce,u=e.onDelete,b=e.onSelect,j=Object(s.useState)([]),d=Object(O.a)(j,2),f=d[0],x=d[1],h=Object(s.useState)([0,0]),p=Object(O.a)(h,2),g=p[0],y=p[1],C=Object(s.useState)(0),w=Object(O.a)(C,2),k=w[0],S=w[1],E=Object(s.useState)(0),I=Object(O.a)(E,2),z=I[0],P=I[1],M=Object(s.useState)([[0,0],[0,0]]),N=Object(O.a)(M,2),R=N[0],T=N[1],D=Object(s.useRef)(new v.a(0,0)),W=Object(s.useRef)(new v.a(0,0)),B=Object(s.useCallback)((function(e){if("force"===a){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&(l(n,D.current,W.current),e.cancelBubble=!0)}else"delete"===a?(u(),e.cancelBubble=!0):"select"===a&&(b(),e.cancelBubble=!0)}),[l,u,b,a]);return Object(s.useEffect)((function(){if(x([r.x,r.y,c.x,c.y]),D.current.x=r.x,D.current.y=r.y,W.current.x=c.x,W.current.y=c.y,o){var e=D.current,t=W.current;if(e.x>t.x){var n=[t,e];e=n[0],t=n[1]}var a=e.distance(t),i=m(e,t),s=e.clone().add(i.clone().multiplyScalar(16)),l=t.clone().subtract(e).angleDeg(),u=i.clone().multiplyScalar(75),b=e.clone().add(u),j=t.clone().add(u);S(a),y([s.x,s.y]),P(l),T([[b.x,b.y],[j.x,j.y]])}}),[r.x,r.y,c.x,c.y,o]),Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(Q.f,{id:t,type:"beam",points:f,stroke:o?"blue":"black",strokeWidth:4,onClick:B,onTap:B}),o&&Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(Q.i,{x:g[0],y:g[1],rotation:z,text:n,fontSize:12,width:k,fill:"blue",align:"center",wrap:"none",ellipsis:!0,listening:!1}),Object(_.jsx)(ge,{start:R[0],end:R[1]})]})]})},de=function(e){var t=Object(s.useContext)(ne),n=t.tool,r=t.addForce,c=t.deleteBeam,a=Object(s.useContext)(ue),i=a.isSelected,o=a.toggle,l=Object(s.useCallback)((function(t,n,c){var a=new v.a(t.x,t.y),i=function(e,t,n,r){var c=t.distance(n),a=t.distance(r);return{beam:e,force:10,distanceI:C(a/c)}}(e.id,n,c,a);r(i)}),[r,e.id]),u=Object(s.useCallback)((function(){c(e.id)}),[c,e.id]),b=Object(s.useCallback)((function(){o({type:"beams",id:e.id})}),[e.id,o]);return Object(_.jsx)(je,Object(S.a)(Object(S.a)({},e),{},{tool:n,selected:i({type:"beams",id:e.id}),addForce:l,onDelete:u,onSelect:b}))},fe=Object(s.createContext)(void 0),Oe=function(e){var t=e.children,n=Object(s.useState)(),r=Object(O.a)(n,2),c=r[0],a=r[1],i=Object(s.useState)({top:0,left:0}),o=Object(O.a)(i,2),l=o[0],u=o[1],b=Object(s.useState)({}),j=Object(O.a)(b,2),d=j[0],f=j[1],x=Object(s.useCallback)((function(e,t,n){a(e),u(t),n&&f(n)}),[u,a]),v=Object(s.useCallback)((function(){a(void 0),u({top:0,left:0}),f({})}),[u,a]);return Object(_.jsx)(fe.Provider,{value:{popupType:c,setPopupType:a,popupPosition:l,setPopupPosition:u,open:x,close:v,popupParams:d},children:t})},xe=function(e){var t=e.beam,n=e.distanceI,r=e.force,c=e.forceRatio,a=e.tool,i=e.selected,o=void 0!==i&&i,l=e.onDelete,u=e.onSelect,b=e.onEdit,j=Object(s.useState)([]),d=Object(O.a)(j,2),f=d[0],x=d[1],p=Object(s.useState)(0),y=Object(O.a)(p,2),C=y[0],w=y[1],k=Object(s.useState)(0),S=Object(O.a)(k,2),E=S[0],I=S[1],z=Object(s.useState)([0,0]),P=Object(O.a)(z,2),M=P[0],N=P[1],R=Object(s.useRef)(new v.a(0,0)),T=Object(s.useRef)(new v.a(0,0));Object(s.useEffect)((function(){var e=t.nodeI,r=t.nodeJ;R.current.x=e.x,R.current.y=e.y,T.current.x=r.x,T.current.y=r.y;var a=g(R.current,T.current,n),i=m(R.current,T.current),o=30*c,s=a.clone().add(i.multiplyScalar(o));x([s.x,s.y,a.x,a.y]),w(Math.max(o,140));var l=i.clone().angleDeg();I(l);var u=R.current.clone().subtract(T.current).normalize();h.dot(u)<0&&u.invert();var b=a.clone().add(u.multiplyScalar(6));N([b.x,b.y])}),[t,n,c]);var D=Object(s.useCallback)((function(e){"delete"===a?(l(),e.cancelBubble=!0):"select"===a&&(u(),e.cancelBubble=!0)}),[l,u,a]),W=Object(s.useCallback)((function(e){e.cancelBubble=!0}),[]),B=Object(s.useCallback)((function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();if(n){var r=n.x,c=n.y;b({top:c,left:r})}}),[b]),F=Object(s.useMemo)((function(){return o?"red":"orange"}),[o]);return Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(Q.a,{points:f,pointerLength:6,pointerWidth:6,fill:F,stroke:F,strokeWidth:2,onClick:D,onTap:D}),o&&Object(_.jsx)(Q.i,{x:M[0],y:M[1],offsetX:-6,text:"".concat(r,"kN"),fontSize:12,width:C,rotation:E,fill:F,wrap:"none",ellipsis:!0,onClick:W,onTap:W,onDblClick:B,onDblTap:B})]})},ve=function(e){var t=Object(s.useContext)(ne),n=t.tool,r=t.deleteForce,c=Object(s.useContext)(ue),a=c.isSelected,i=c.toggle,o=Object(s.useContext)(fe).open,l=Object(s.useCallback)((function(){r(e.id)}),[r,e.id]),u=Object(s.useCallback)((function(){i({type:"forces",id:e.id})}),[e.id,i]),b=Object(s.useCallback)((function(t){var n=Object(S.a)(Object(S.a)({},e),{},{beam:e.beam.id});o("forces",t,n)}),[o,e]);return Object(_.jsx)(xe,Object(S.a)(Object(S.a)({},e),{},{tool:n,selected:a({type:"forces",id:e.id}),onDelete:l,onSelect:u,onEdit:b}))},he={fill:"silver",stroke:"silver",strokeWidth:1,listening:!1},pe=Object(S.a)({pointerLength:6,pointerWidth:6,pointerAtBeginning:!0},he),ge=function(e){var t=e.start,n=e.end,r=Object(s.useRef)(new v.a(0,0)),c=Object(s.useRef)(new v.a(0,0)),a=Object(s.useState)(0),i=Object(O.a)(a,2),o=i[0],l=i[1],u=Object(s.useState)(0),b=Object(O.a)(u,2),j=b[0],d=b[1],f=Object(s.useState)([0,0]),x=Object(O.a)(f,2),h=x[0],p=x[1];return Object(s.useEffect)((function(){r.current.x=t[0],r.current.y=t[1],c.current.x=n[0],c.current.y=n[1];var e=r.current.distance(c.current),a=c.current.clone().subtract(r.current).normalize().angleDeg();l(Math.round(e)),d(90===a?-90:a),p(90===a?n:t)}),[n,t]),Object(_.jsxs)(Q.c,{x:h[0],y:h[1],rotation:j,children:[Object(_.jsx)(Q.f,Object(S.a)({points:[0,0,0,10]},he)),Object(_.jsx)(Q.a,Object(S.a)({points:[0,5,o,5]},pe)),Object(_.jsx)(Q.f,Object(S.a)({points:[o,0,o,10]},he)),Object(_.jsx)(Q.i,{x:0,y:-8,text:"".concat(o,"px"),fontSize:12,fill:"silver",width:o,align:"center",listening:!1,wrap:"none",ellipsis:!0})]})},me=n(44),ye=n.n(me),Ce={free:"/assets/images/pins/pin_1.svg",pin:"/assets/images/pins/pin_1.svg",pinX:"/assets/images/pins/pin_2.svg",pinZ:"/assets/images/pins/pin_2.svg",fixX:"/assets/images/pins/pin_3.svg",fix:"/assets/images/pins/pin_4.svg"},we=function(e){var t=e.id,n=e.x,r=e.y,c=e.pin,a=void 0===c?"free":c,i=e.tool,o=e.draggable,l=void 0!==o&&o,u=e.onChange,b=e.onCommit,j=e.onEdit,d=Object(s.useState)(!1),f=Object(O.a)(d,2),x=f[0],v=f[1],h=Object(s.useRef)({x:n,y:r}),p=Object(s.useRef)(),g=Object(s.useMemo)((function(){return"".concat("/drawing-sample").concat(Ce[a])}),[a]),m=ye()(g),y=Object(O.a)(m,1)[0],C=Object(s.useCallback)((function(){if(l){var e={id:t,x:h.current.x,y:h.current.y};u&&u(e)}}),[l,t,u]),w=Object(s.useCallback)((function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&(h.current=n,v(!0))}),[]),k=Object(s.useCallback)((function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&(h.current=n)}),[]),S=Object(s.useCallback)((function(e){var n,r=null===(n=e.target.getStage())||void 0===n?void 0:n.getPointerPosition();if(r){h.current=r,v(!1),p.current&&(clearInterval(p.current),p.current=void 0);var c={id:t,x:h.current.x,y:h.current.y};b&&b(c)}}),[t,b]),E=Object(s.useCallback)((function(e){"select"===i&&(e.cancelBubble=!0)}),[i]),I=Object(s.useCallback)((function(e){if("select"===i){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();if(n){var r=n.x,c=n.y;j({top:c,left:r})}}}),[j,i]);return Object(s.useEffect)((function(){var e=p.current;return l&&x&&(C(),p.current=setInterval(C,100)),function(){e&&clearInterval(e)}}),[l,x,C]),Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(Q.b,{id:t,x:n,y:r,fill:x?"blue":"black",radius:4,draggable:l,onDragStart:w,onDragMove:k,onDragEnd:S,onClick:E,onTap:E,onDblClick:I,onDblTap:I,_useStrictMode:!0}),!x&&"free"!==a&&Object(_.jsx)(Q.d,{x:n,y:r,offsetX:12,offsetY:-4,rotation:"pinZ"===a?-90:0,image:y,width:24,height:24,listening:!1})]})},ke=function(e){var t=Object(s.useContext)(ne),n=t.tool,r=t.snapSize,c=t.setStructure,a=Object(s.useContext)(fe).open,i=Object(s.useMemo)((function(){return"pen"!==n&&Boolean(c)}),[c,n]),o=Object(s.useCallback)((function(e){var t=e.id,n=e.x,a=e.y;if(c){var i=k([n,a],r),o=Object(O.a)(i,2),s=o[0],l=o[1];c((function(e){var n=y(e),r=n.nodes.find((function(e){return e.id===t}));return r&&(r.x=s,r.y=l),n}))}}),[c,r]),l=Object(s.useCallback)((function(e){var t=e.id,n=e.x,a=e.y;if(c){var i=k([n,a],r),o=Object(O.a)(i,2),s=o[0],l=o[1];c((function(e){var n,r,c,a=y(e),i=a.nodes.findIndex((function(e){return e.id===t}));if(i>=0){var o=a.nodes.find((function(e){return e.id!==t&&e.x===s&&e.y===l}));o&&(n=a,r=t,c=o.id,n.beams.forEach((function(e){e.nodeI===r&&(e.nodeI=c),e.nodeJ===r&&(e.nodeJ=c)})),a.nodes.splice(i,1))}return a}))}}),[c,r]),u=Object(s.useCallback)((function(t){a("nodes",t,e)}),[a,e]);return Object(_.jsx)(we,Object(S.a)(Object(S.a)({},e),{},{draggable:i,tool:n,onChange:o,onCommit:l,onEdit:u}))},Se={stroke:"pink",strokeWidth:2},Ee=Object(S.a)({pointerLength:6,pointerWidth:6,fill:"pink"},Se),Ie={offsetX:-6,offsetY:14,fontSize:12,wrap:"none",ellipsis:!0},ze=function(e){var t=e.beam,n=e.forceI,r=e.forceJ,c=e.distanceI,a=e.distanceJ,i=e.angle,o=void 0===i?90:i,l=e.isGlobal,u=void 0!==l&&l,b=e.tool,j=e.selected,d=void 0!==j&&j,f=e.onDelete,x=e.onSelect,p=e.onEdit,m=Object(s.useState)([]),y=Object(O.a)(m,2),C=y[0],w=y[1],k=Object(s.useState)([0,0,0,0]),E=Object(O.a)(k,2),I=E[0],z=E[1],P=Object(s.useState)(),M=Object(O.a)(P,2),N=M[0],R=M[1],T=Object(s.useState)(),D=Object(O.a)(T,2),W=D[0],B=D[1],F=Object(s.useState)([[0,0],[0,0]]),J=Object(O.a)(F,2),X=J[0],A=J[1];Object(s.useEffect)((function(){var e,i=t.nodeI,s=t.nodeJ,l=new v.a(i.x,i.y),b=new v.a(s.x,s.y),j=b.clone().subtract(l).normalize();e=u?h.clone().rotateDeg(-1*o):j.clone().rotateDeg(-1*o).normalize();var d=l.distance(b),f=l.clone().add(j.clone().multiplyScalar(d*c)),x=b.clone().add(j.clone().invert().multiplyScalar(d*a)),p=f.clone().add(e.clone().multiplyScalar(10*n)),m=x.clone().add(e.clone().multiplyScalar(10*r)),y=function(e,t,n){for(var r=[],c=e.distance(t),a=10,i=c/(a+1);i<25&&a>0;)i=c/(1+--a);if(a>0)for(var o=1;o<=a;o++){var s=e.clone().add(n.clone().multiplyScalar(i*o));r.push(s)}else if((i=c/2)>=10){var l=g(e,t,.5);r.push(l)}return r}(f,x,j),C=m.x-p.x!==0?(m.y-p.y)/(m.x-p.x):NaN,k=isNaN(C)?NaN:p.y-C*p.x,S=[];y.forEach((function(t){var n=function(e,t,n){var r=Object(O.a)(e,4),c=r[0],a=r[1],i=r[2],o=r[3],s=null;try{var l=t.clone().add(n),u=l.x-t.x!==0?(l.y-t.y)/(l.x-t.x):NaN,b=isNaN(u)?NaN:t.y-u*t.x;if(i===u)return null;if(isNaN(i)||isNaN(u)){if(isNaN(i)){var j=c.x;s=[j,j*u+b]}else if(isNaN(u)){var d=t.x;s=[d,d*i+o]}}else{var f=(b-o)/(i-u);s=[f,i*f+o]}if(s){var x=s,v=Object(O.a)(x,2),h=v[0],p=v[1],g=[c.x,a.x].sort((function(e,t){return e-t})),m=[c.y,a.y].sort((function(e,t){return e-t}));if(h>=g[0]&&h<=g[1]&&p>=m[0]&&p<=m[1])return s}return null}catch(y){console.error(y)}return null}([p,m,C,k],t,e);if(n){var r=[n[0],n[1],t.x,t.y];S.push(r)}}));var E=e.angleDeg();R({x:f.x,y:f.y,text:"".concat(n,"kN/m"),width:f.distance(p),rotation:E}),B({x:x.x,y:x.y,text:"".concat(r,"kN/m"),width:x.distance(m),rotation:E});var I=10*Math.max(n,r),P=e.clone().multiplyScalar(I+50),M=f.clone().add(P),N=x.clone().add(P);A([[M.x,M.y],[N.x,N.y]]),z([p.x,p.y,m.x,m.y]),w([[p.x,p.y,f.x,f.y]].concat(S,[[m.x,m.y,x.x,x.y]]))}),[o,t,c,a,n,r,u]);var G=Object(s.useCallback)((function(e){"select"===b?x():"delete"===b&&f(),e.cancelBubble=!0}),[f,x,b]),L=Object(s.useCallback)((function(e){if("select"===b){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();if(n){var r=n.x,c=n.y;p({top:c,left:r})}}}),[p,b]),Y=Object(s.useMemo)((function(){return d?"red":"pink"}),[d]);return Object(_.jsxs)(Q.c,{onClick:G,onTap:G,onDblClick:L,onDblTap:L,children:[Object(_.jsx)(Q.f,Object(S.a)(Object(S.a)({points:I},Se),{},{stroke:Y})),C.map((function(e,t){return Object(_.jsx)(Q.a,Object(S.a)(Object(S.a)({points:e},Ee),{},{stroke:Y,fill:Y}),"arrow_".concat(t))})),d&&Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(Q.i,Object(S.a)(Object(S.a)(Object(S.a)({},Ie),N),{},{fill:Y})),Object(_.jsx)(Q.i,Object(S.a)(Object(S.a)(Object(S.a)({},Ie),W),{},{fill:Y})),Object(_.jsx)(ge,{start:X[0],end:X[1]})]})]})},Pe=function(e){var t=Object(s.useContext)(ne),n=t.tool,r=t.deleteTrapezoid,c=Object(s.useContext)(ue),a=c.isSelected,i=c.toggle,o=Object(s.useContext)(fe).open,l=Object(s.useCallback)((function(){r(e.id)}),[r,e.id]),u=Object(s.useCallback)((function(){i({type:"trapezoids",id:e.id})}),[e.id,i]),b=Object(s.useCallback)((function(t){var n=Object(S.a)(Object(S.a)({},e),{},{beam:e.beam.id});o("trapezoids",t,n)}),[o,e]);return Object(_.jsx)(ze,Object(S.a)(Object(S.a)({},e),{},{tool:n,selected:a({type:"trapezoids",id:e.id}),onDelete:l,onSelect:u,onEdit:b}))},Me=25,Ne=function(){var e=Object(s.useContext)(ne).structure,t=Object(s.useMemo)((function(){var t={maxX:Number.MIN_SAFE_INTEGER,minX:Number.MAX_SAFE_INTEGER,guidesX:[],maxY:Number.MIN_SAFE_INTEGER,minY:Number.MAX_SAFE_INTEGER,guidesY:[]},n=new Set,r=new Set;if(e.nodes.forEach((function(e){var c=e.x,a=e.y;t.maxX<c&&(t.maxX=c),t.minX>c&&(t.minX=c),n.has(c)||n.add(c),t.maxY<a&&(t.maxY=a),t.minY>a&&(t.minY=a),r.has(a)||r.add(a)})),n.size>1)for(var c=Array.from(n).sort((function(e,t){return e<t?-1:1})),a=c[0],i=1;i<c.length;i++){var o=c[i],s={key:"LocalGuideX_".concat(i),start:[a,t.maxY+100],end:[o,t.maxY+100]};a=o,t.guidesX.push(s)}if(r.size>1)for(var l=Array.from(r).sort((function(e,t){return e<t?-1:1})),u=l[0],b=Math.max(t.minX-100,50),j=1;j<l.length;j++){var d=l[j],f={key:"LocalGuideY_".concat(j),start:[b,u],end:[b,d]};u=d,t.guidesY.push(f)}return t}),[e.nodes]),n=t.minX,r=t.maxX,c=t.guidesX,a=t.minY,i=t.maxY,o=t.guidesY,l=Object(s.useMemo)((function(){return n!==Number.MAX_SAFE_INTEGER?Math.max(Me,n-125):0}),[n]),u=Object(s.useMemo)((function(){return i!==Number.MIN_SAFE_INTEGER?i+125:0}),[i]);return Object(_.jsxs)(Q.e,{listening:!1,children:[n!==Number.MAX_SAFE_INTEGER&&r!==Number.MIN_SAFE_INTEGER&&Object(_.jsx)(ge,{start:[n,u],end:[r,u]}),c.map((function(e){return Object(_.jsx)(ge,Object(S.a)({},e))})),a!==Number.MAX_SAFE_INTEGER&&i!==Number.MIN_SAFE_INTEGER&&Object(_.jsx)(ge,{start:[l,a],end:[l,i]}),o.map((function(e){return Object(_.jsx)(ge,Object(S.a)({},e))}))]})},Re=n(22),Te=["structure"],De=["nodeI","nodeJ"],_e=["beam","force"],We=["beam"],Be=function(e){var t=e.structure,n=Object(Re.a)(e,Te),r=Object(s.useMemo)((function(){var e={};return t.nodes.forEach((function(t){e[t.id]=t})),e}),[t.nodes]),c=Object(s.useMemo)((function(){var e={};return t.beams.forEach((function(t){var n=t.nodeI,c=t.nodeJ,a=Object(Re.a)(t,De),i=Object(S.a)(Object(S.a)({},a),{},{nodeI:r[n],nodeJ:r[c]});e[a.id]=i})),e}),[r,t.beams]),a=Object(s.useMemo)((function(){var e=t.forces,n={};if(e.length>0){var r=e.map((function(e){return e.force})).reduce((function(e,t){return e+t}))/e.length;e.forEach((function(e){var t=e.beam,a=e.force,i=Object(Re.a)(e,_e),o=a/r;n[i.id]=Object(S.a)(Object(S.a)({},i),{},{force:a,forceRatio:o,beam:c[t]})}))}return n}),[c,t]),i=Object(s.useMemo)((function(){var e=t.trapezoids,n={};return e.forEach((function(e){var t=e.beam,r=Object(Re.a)(e,We);n[r.id]=Object(S.a)(Object(S.a)({},r),{},{beam:c[t]})})),n}),[c,t]);return Object(_.jsxs)(Q.e,Object(S.a)(Object(S.a)({},n),{},{children:[Object.entries(c).map((function(e){var t=Object(O.a)(e,2),n=t[0],r=t[1];return Object(_.jsx)(de,Object(S.a)({},r),n)})),Object.entries(r).map((function(e){var t=Object(O.a)(e,2),n=t[0],r=t[1];return Object(_.jsx)(ke,Object(S.a)({},r),n)})),Object.entries(a).map((function(e){var t=Object(O.a)(e,2),n=t[0],r=t[1];return Object(_.jsx)(ve,Object(S.a)({},r),n)})),Object.entries(i).map((function(e){var t=Object(O.a)(e,2),n=t[0],r=t[1];return Object(_.jsx)(Pe,Object(S.a)({},r),n)}))]}))},Fe=function(){var e=Object(s.useContext)(ne).structure;return Object(_.jsx)(Be,{structure:e})},Je=n(187),Xe=n(165),Ae=n(175),Ge=n(189),Le=n(182),Ye=["values"],Ue=function(e){var t=e.force,n=e.onChange,r=e.onClose,c=Object(s.useState)(""),a=Object(O.a)(c,2),i=a[0],o=a[1],l=Object(s.useState)(),u=Object(O.a)(l,2),b=u[0],j=u[1],d=Object(s.useCallback)((function(e){if(e.preventDefault(),e.currentTarget.checkValidity()&&"undefined"===typeof b){var c=parseFloat(i);isNaN(c)||(n(Object(S.a)(Object(S.a)({},t),{},{force:c})),r())}}),[b,n,r,i,t]),f=Object(s.useCallback)((function(e){var t,n=e.currentTarget.value;o(n),0===n.length&&(t="\u6570\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044");var r=parseFloat(n);isNaN(r)&&(t="\u6570\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"),(0>r||r>Number.MAX_SAFE_INTEGER)&&(t="0 \u3088\u308a\u5927\u304d\u3044\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"),j(t)}),[]);return Object(s.useEffect)((function(){o("".concat(t.force)),j(void 0)}),[t]),Object(_.jsx)(Je.a,{children:Object(_.jsxs)(Xe.a,{direction:"column",spacing:1,sx:{p:1,width:240},component:"form",autoComplete:"off",noValidate:!0,onSubmit:d,children:[Object(_.jsx)(Ae.a,{variant:"outlined",margin:"dense",size:"small",label:"\u96c6\u4e2d\u8377\u91cd",value:i,required:!0,fullWidth:!0,onChange:f,InputProps:{endAdornment:Object(_.jsx)(Ge.a,{position:"end",children:"kN"})},error:Boolean(b),helperText:b}),Object(_.jsxs)(Xe.a,{direction:"row",justifyContent:"flex-end",spacing:1,children:[Object(_.jsx)(Le.a,{size:"small",onClick:r,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),Object(_.jsx)(Le.a,{type:"submit",size:"small",variant:"contained",children:"OK"})]})]})})},Ze=function(e){var t=e.values,n=Object(Re.a)(e,Ye),r=Object(s.useMemo)((function(){return function(e){if(e&&"object"===typeof e){var t=e;return"string"===typeof t.id&&"string"===typeof t.name&&"string"===typeof t.beam&&"number"===typeof t.force&&"number"===typeof t.distanceI}return!1}(t)?t:{id:"",name:"",beam:"",force:0,distanceI:0}}),[t]);return Object(_.jsx)(Ue,Object(S.a)(Object(S.a)({},n),{},{force:r}))},Ve=n(90),He=n.n(Ve),qe=n(98),Ke=n(183),Qe=n(190),$e=["title","titleId"];function et(){return et=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},et.apply(this,arguments)}function tt(e,t){if(null==e)return{};var n,r,c=function(e,t){if(null==e)return{};var n,r,c={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(c[n]=e[n]);return c}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}function nt(e,t){var n=e.title,r=e.titleId,c=tt(e,$e);return s.createElement("svg",et({id:"svg",viewBox:"0 0 160 160",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},c),n?s.createElement("title",{id:r},n):null,o||(o=s.createElement("path",{d:"M80 0 L30 80 L130 80 Z",strokeWidth:6,stroke:"gray",fill:"transparent"})))}var rt,ct,at,it,ot=s.forwardRef(nt),st=(n.p,["title","titleId"]);function lt(){return lt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},lt.apply(this,arguments)}function ut(e,t){if(null==e)return{};var n,r,c=function(e,t){if(null==e)return{};var n,r,c={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(c[n]=e[n]);return c}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}function bt(e,t){var n=e.title,r=e.titleId,c=ut(e,st);return s.createElement("svg",lt({id:"svg",viewBox:"0 0 160 160",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},c),n?s.createElement("title",{id:r},n):null,rt||(rt=s.createElement("path",{d:"M80 0 L30 80 L130 80 Z",strokeWidth:6,stroke:"gray",fill:"transparent"})),ct||(ct=s.createElement("circle",{stroke:"gray",strokeWidth:6,fill:"transparent",cx:45,cy:115,r:20})),at||(at=s.createElement("circle",{stroke:"gray",strokeWidth:6,fill:"transparent",cx:115,cy:115,r:20})),it||(it=s.createElement("line",{x1:30,y1:150,x2:130,y2:150,stroke:"gray",strokeWidth:6})))}var jt,dt,ft,Ot,xt=s.forwardRef(bt),vt=(n.p,["title","titleId"]);function ht(){return ht=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ht.apply(this,arguments)}function pt(e,t){if(null==e)return{};var n,r,c=function(e,t){if(null==e)return{};var n,r,c={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(c[n]=e[n]);return c}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}function gt(e,t){var n=e.title,r=e.titleId,c=pt(e,vt);return s.createElement("svg",ht({id:"svg",style:{width:64},viewBox:"0 0 160 160",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},c),n?s.createElement("title",{id:r},n):null,jt||(jt=s.createElement("path",{d:"M30 3 L30 80 L130 80 L130 3 Z",strokeWidth:6,stroke:"gray",fill:"transparent"})),dt||(dt=s.createElement("circle",{stroke:"gray",strokeWidth:6,fill:"transparent",cx:45,cy:115,r:20})),ft||(ft=s.createElement("circle",{stroke:"gray",strokeWidth:6,fill:"transparent",cx:115,cy:115,r:20})),Ot||(Ot=s.createElement("line",{x1:30,y1:150,x2:130,y2:150,stroke:"gray",strokeWidth:6})))}var mt,yt,Ct,wt,kt,St=s.forwardRef(gt),Et=(n.p,["title","titleId"]);function It(){return It=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},It.apply(this,arguments)}function zt(e,t){if(null==e)return{};var n,r,c=function(e,t){if(null==e)return{};var n,r,c={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(c[n]=e[n]);return c}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}function Pt(e,t){var n=e.title,r=e.titleId,c=zt(e,Et);return s.createElement("svg",It({id:"svg",style:{width:64},viewBox:"0 0 160 160",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},c),n?s.createElement("title",{id:r},n):null,mt||(mt=s.createElement("line",{x1:0,y1:3,x2:160,y2:3,stroke:"gray",strokeWidth:6})),yt||(yt=s.createElement("line",{x1:20,y1:0,x2:0,y2:60,stroke:"gray",strokeWidth:6})),Ct||(Ct=s.createElement("line",{x1:60,y1:0,x2:40,y2:60,stroke:"gray",strokeWidth:6})),wt||(wt=s.createElement("line",{x1:100,y1:0,x2:80,y2:60,stroke:"gray",strokeWidth:6})),kt||(kt=s.createElement("line",{x1:140,y1:0,x2:120,y2:60,stroke:"gray",strokeWidth:6})))}var Mt=s.forwardRef(Pt),Nt=(n.p,["values"]),Rt={free:{type:"free",icon:Object(_.jsx)(He.a,{}),label:"\u5b8c\u5168\u30d5\u30ea\u30fc"},pin:{type:"pin",icon:Object(_.jsx)(qe.a,{sx:{width:24},viewBox:"0 0 160 160",children:Object(_.jsx)(ot,{})}),label:"\u5b8c\u5168\u30d4\u30f3"},pinX:{type:"pinX",icon:Object(_.jsx)(qe.a,{sx:{width:24},viewBox:"0 0 160 160",children:Object(_.jsx)(xt,{})}),label:"\u30d4\u30f3X\u30ed\u30fc\u30e9\u30fc"},pinZ:{type:"pinZ",icon:Object(_.jsx)(qe.a,{sx:{width:24,transform:"rotate(-90deg)"},viewBox:"0 0 160 160",children:Object(_.jsx)(xt,{})}),label:"\u30d4\u30f3Z\u30ed\u30fc\u30e9\u30fc"},fixX:{type:"fixX",icon:Object(_.jsx)(qe.a,{sx:{width:24},viewBox:"0 0 160 160",children:Object(_.jsx)(St,{})}),label:"\u56fa\u5b9aX\u30ed\u30fc\u30e9\u30fc"},fix:{type:"fix",icon:Object(_.jsx)(qe.a,{sx:{width:24},viewBox:"0 0 160 160",children:Object(_.jsx)(Mt,{})}),label:"\u5b8c\u5168\u56fa\u5b9a"}},Tt={sx:{justifyContent:"flex-start",alignItems:"center"}},Dt=function(e){var t=e.node,n=e.onChange,r=e.onClose,c=Object(s.useState)(),a=Object(O.a)(c,2),i=a[0],o=a[1],l=Object(s.useCallback)((function(e){e.preventDefault();var c=Object(S.a)(Object(S.a)({},t),{},{pin:i});n(c),r()}),[t,n,r,i]),u=Object(s.useCallback)((function(e,t){var n;null!==t&&("string"===typeof(n=t)&&z.some((function(e){return e===n})))&&o(t)}),[]);return Object(s.useEffect)((function(){var e;o(null!==(e=t.pin)&&void 0!==e?e:"free")}),[t.pin]),Object(_.jsx)(Je.a,{children:Object(_.jsxs)(Xe.a,{direction:"column",spacing:1,sx:{p:1,width:240},component:"form",autoComplete:"off",noValidate:!0,onSubmit:l,children:[Object(_.jsx)(Ke.a,{orientation:"vertical",value:i,size:"small",exclusive:!0,fullWidth:!0,onChange:u,children:Object.entries(Rt).map((function(e){var t=Object(O.a)(e,2),n=t[0],r=t[1],c=r.icon,a=r.label;return Object(_.jsxs)(Qe.a,Object(S.a)(Object(S.a)({value:n},Tt),{},{children:[c,Object(_.jsx)(U.a,{variant:"caption",sx:{ml:1},children:a})]}),n)}))}),Object(_.jsxs)(Xe.a,{direction:"row",justifyContent:"flex-end",spacing:1,children:[Object(_.jsx)(Le.a,{size:"small",onClick:r,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),Object(_.jsx)(Le.a,{type:"submit",size:"small",variant:"contained",children:"OK"})]})]})})},_t=function(e){var t=e.values,n=Object(Re.a)(e,Nt),r=Object(s.useMemo)((function(){return function(e){if(e&&"object"===typeof e){var t=e;return"string"===typeof t.id&&"number"===typeof t.x&&"number"===typeof t.y}return!1}(t)?t:{id:"",x:0,y:0}}),[t]);return Object(_.jsx)(Dt,Object(S.a)(Object(S.a)({},n),{},{node:r}))},Wt=n(3),Bt=n(191),Ft=n(177),Jt=["values"],Xt=function(e){if(0===e.length)return[NaN,!1,"\u6570\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"];var t=parseFloat(e);return isNaN(t)?[NaN,!1,"\u6570\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"]:0>=t&&t>Number.MAX_SAFE_INTEGER?[t,!1,"0 \u4ee5\u4e0a\u306e\u6570\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"]:[C(t,3),!0,""]},At=function(e){if(e.length>0){var t=parseInt(e,10);return isNaN(t)||e.indexOf(".")>=0?[NaN,!1,"\u6574\u6570\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"]:-180>t||180<t?[t,!1,"-180 \u301c 180 \u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"]:(-180===t&&(t=180),[t,!0,""])}return[90,!0,""]},Gt=function(e){var t,n,r,c,a,i,o,l=e.trapezoid,u=e.onChange,b=e.onClose,j=Object(s.useState)({}),d=Object(O.a)(j,2),f=d[0],x=d[1],v=Object(s.useState)({}),h=Object(O.a)(v,2),p=h[0],g=h[1],m=Object(s.useCallback)((function(e){if((e.preventDefault(),e.currentTarget.checkValidity())&&!Object.values(p).some((function(e){return e.length>0}))){var t=function(e){var t,n,r,c,a={forceI:0,forceJ:0,angle:90,isGlobal:!1},i=Xt(null!==(t=e.forceI)&&void 0!==t?t:""),o=Object(O.a)(i,2),s=o[0],l=o[1],u=Xt(null!==(n=e.forceJ)&&void 0!==n?n:""),b=Object(O.a)(u,2),j=b[0],d=b[1],f=At(null!==(r=e.angle)&&void 0!==r?r:""),x=Object(O.a)(f,2),v=x[0],h=x[1],p=l&&d&&h;return a.forceI=s,a.forceJ=j,a.angle=v,a.isGlobal=null!==(c=e.isGlobal)&&void 0!==c&&c,[p,a]}(f),n=Object(O.a)(t,2),r=n[0],c=n[1];console.log(r,c),r&&u(Object(S.a)(Object(S.a)({},l),c)),b()}}),[p,u,b,l,f]),y=Object(s.useCallback)((function(e){var t=e.target,n=t.name,r=t.value,c="";switch(n){case"forceI":case"forceJ":var a=Xt(r),i=Object(O.a)(a,3),o=i[1],s=i[2];o||(c=s);break;case"angle":var l=At(r),u=Object(O.a)(l,3),b=u[1],j=u[2];b||(c=j)}g((function(e){return Object(S.a)(Object(S.a)({},e),{},Object(Wt.a)({},n,c))})),x((function(e){return Object(S.a)(Object(S.a)({},e),{},Object(Wt.a)({},n,r))}))}),[]),C=Object(s.useCallback)((function(e){var t=e.target.checked;x((function(e){return Object(S.a)(Object(S.a)({},e),{},{isGlobal:t})}))}),[]);return Object(s.useEffect)((function(){x(function(e){var t,n={};return n.forceI="".concat(e.forceI),n.forceJ="".concat(e.forceJ),n.angle="".concat(null!==(t=e.angle)&&void 0!==t?t:""),n.isGlobal=e.isGlobal,n}(l)),g({})}),[l]),Object(_.jsx)(Je.a,{children:Object(_.jsxs)(Xe.a,{direction:"column",spacing:1,sx:{p:1,width:240},component:"form",autoComplete:"off",noValidate:!0,onSubmit:m,children:[Object(_.jsx)(Ae.a,{variant:"outlined",margin:"dense",size:"small",label:"I\u7aef\u5074\u306e\u8377\u91cd",name:"forceI",value:null!==(t=f.forceI)&&void 0!==t?t:"",required:!0,fullWidth:!0,onChange:y,InputProps:{endAdornment:Object(_.jsx)(Ge.a,{position:"end",children:"kN/m"})},error:Boolean(p.forceI),helperText:null!==(n=p.forceI)&&void 0!==n?n:""}),Object(_.jsx)(Ae.a,{variant:"outlined",margin:"dense",size:"small",label:"J\u7aef\u5074\u306e\u8377\u91cd",name:"forceJ",value:null!==(r=f.forceJ)&&void 0!==r?r:"",required:!0,fullWidth:!0,onChange:y,InputProps:{endAdornment:Object(_.jsx)(Ge.a,{position:"end",children:"kN/m"})},error:Boolean(p.forceJ),helperText:null!==(c=p.forceJ)&&void 0!==c?c:""}),Object(_.jsx)(Ae.a,{variant:"outlined",margin:"dense",size:"small",label:"\u89d2\u5ea6",name:"angle",value:null!==(a=f.angle)&&void 0!==a?a:"",fullWidth:!0,onChange:y,InputProps:{endAdornment:Object(_.jsx)(Ge.a,{position:"end",children:"\xb0"})},error:Boolean(p.angle),helperText:null!==(i=p.angle)&&void 0!==i?i:""}),Object(_.jsx)(Bt.a,{label:"\u5168\u4f53\u5ea7\u6a19\u7cfb",control:Object(_.jsx)(Ft.a,{name:"isGlobal",size:"small",checked:null!==(o=f.isGlobal)&&void 0!==o&&o,onChange:C})}),Object(_.jsxs)(Xe.a,{direction:"row",justifyContent:"flex-end",spacing:1,children:[Object(_.jsx)(Le.a,{size:"small",onClick:b,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),Object(_.jsx)(Le.a,{type:"submit",size:"small",variant:"contained",children:"OK"})]})]})})},Lt=function(e){var t=e.values,n=Object(Re.a)(e,Jt),r=Object(s.useMemo)((function(){return function(e){if(e&&"object"===typeof e){var t=e;return"string"===typeof t.id&&"string"===typeof t.name&&"string"===typeof t.beam&&"number"===typeof t.forceI&&"number"===typeof t.distanceI&&"number"===typeof t.forceJ&&"number"===typeof t.distanceJ}return!1}(t)?t:{id:"",name:"",beam:"",forceI:0,distanceI:0,forceJ:0,distanceJ:0}}),[t]);return Object(_.jsx)(Gt,Object(S.a)(Object(S.a)({},n),{},{trapezoid:r}))},Yt=function(){var e=Object(s.useContext)(fe),t=e.popupType,n=e.popupPosition,r=e.popupParams,c=e.close,a=Object(s.useContext)(ne).setStructure,i=Object(s.useCallback)((function(e){a&&a((function(t){var n=y(t),r=n.forces.findIndex((function(t){return t.id===e.id}));return r>=0&&(n.forces[r]=Object(S.a)({},e)),n}))}),[a]),o=Object(s.useCallback)((function(e){a&&a((function(t){var n=y(t),r=n.trapezoids.findIndex((function(t){return t.id===e.id}));return r>=0&&(n.trapezoids[r]=Object(S.a)({},e)),n}))}),[a]),l=Object(s.useCallback)((function(e){a&&a((function(t){var n=y(t),r=n.nodes.findIndex((function(t){return t.id===e.id}));return r>=0&&(n.nodes[r]=Object(S.a)({},e)),n}))}),[a]);return"undefined"===typeof t?null:Object(_.jsxs)(G.a,{sx:Object(S.a)({position:"absolute",zIndex:5e3},n),children:["forces"===t&&Object(_.jsx)(Ze,{values:null!==r&&void 0!==r?r:{},onClose:c,onChange:i}),"trapezoids"===t&&Object(_.jsx)(Lt,{values:null!==r&&void 0!==r?r:{},onClose:c,onChange:o}),"nodes"===t&&Object(_.jsx)(_t,{values:null!==r&&void 0!==r?r:{},onClose:c,onChange:l})]})},Ut=function(e,t){var n=Object(s.useContext)(ne),r=n.structure,c=n.tool,a=n.size,i=Object(s.useContext)(ue).setSelected,o=Object(s.useContext)(fe).close,l=Object(s.useContext)(ce),u=l.onPointerDown,b=l.onPointerMove,j=l.onPointerUp,d=$(ne,fe,ue,ce),f=Object(s.useRef)(null);Object(s.useImperativeHandle)(t,(function(){return{toDataURL:function(){if(f.current)return f.current.toDataURL()},getStructure:function(){return r}}}),[r]);var O=Object(s.useCallback)((function(e){o(),"select"===c&&i([])}),[o,i,c]);return Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(Q.h,{ref:f,width:a.width,height:a.height,onClick:O,onTap:O,onPointerDown:u,onPointerMove:b,onPointerUp:j,children:Object(_.jsxs)(d,{children:[Object(_.jsx)(le,{}),Object(_.jsx)(Ne,{}),Object(_.jsx)(Fe,{}),Object(_.jsx)(oe,{})]})}),Object(_.jsx)(Yt,{})]})},Zt=Object(s.forwardRef)(Ut),Vt=["children"],Ht=function(e){var t=e.children,n=Object(Re.a)(e,Vt);return Object(_.jsx)(re,Object(S.a)(Object(S.a)({},n),{},{children:Object(_.jsx)(Oe,{children:Object(_.jsx)(be,{children:Object(_.jsx)(ae,{children:t})})})}))},qt=function(e,t){var n=e.tool,r=void 0===n?"select":n,c=e.structure,a=e.readonly,i=void 0!==a&&a,o=Object(s.useState)({width:0,height:0}),l=Object(O.a)(o,2),u=l[0],b=l[1],j=Object(s.useRef)(null),d=Object(s.useRef)(null);return Object(s.useImperativeHandle)(t,(function(){return{toDataURL:function(){if(d.current)return d.current.toDataURL()},getStructure:function(){return d.current?d.current.getStructure():P}}}),[]),Object(s.useEffect)((function(){var e=new ResizeObserver((function(e){var t=e[0].contentRect,n=t.width,r=t.height;b({width:n,height:r})}));return j.current&&e.observe(j.current),function(){e.disconnect()}}),[]),Object(_.jsx)(G.a,{ref:j,sx:{width:"auto",height:"100%",backgroundColor:"#ffffff",overscrollBehavior:"contain"},children:Object(_.jsx)(Ht,{tool:r,size:u,structure:c,readonly:i,children:Object(_.jsx)(Zt,{ref:d})})})},Kt=Object(s.forwardRef)(qt),Qt=["eraser"],$t=function(e){var t=e.drawings,n=e.settings,r=e.points;return Object(_.jsxs)(Q.e,{children:[t.map((function(e,t){var n=e.eraser,r=void 0!==n&&n,c=Object(Re.a)(e,Qt);return Object(_.jsx)(Q.f,Object(S.a)(Object(S.a)({},c),{},{globalCompositeOperation:r?"destination-out":"source-over"}),"note-drawing-".concat(t))})),r&&Object(_.jsx)(Q.f,Object(S.a)(Object(S.a)({},n),{},{points:r,globalCompositeOperation:n.eraser?"destination-out":"source-over"}))]})},en=n(91),tn=n.n(en),nn=n(92),rn=n.n(nn),cn=n(93),an=n.n(cn),on=n(8),sn=n(193),ln=n(94),un=n(178),bn=n(96),jn=Object(on.a)("div")({display:"flex",alignItems:"center",width:"100%",padding:"0 8"}),dn=Object(on.a)("div")({flex:1}),fn=function(e){var t=e.visible,n=void 0!==t&&t,r=e.mode,c=e.y,a=e.x,i=e.width,o=e.onEdit,l=e.onCopy,u=e.onDelete,b=e.onCancel,j=Object(s.useState)(null),d=Object(O.a)(j,2),f=d[0],x=d[1],v=Object(s.useCallback)((function(e){x(e.currentTarget)}),[]),h=Object(s.useCallback)((function(){x(null)}),[]);return n?Object(_.jsxs)(bn.a,{divProps:{style:{top:"".concat(c-42,"px"),left:"".concat(a,"px"),width:"".concat(i,"px")}},children:[Object(_.jsxs)(jn,{children:["canvas"===r&&Object(_.jsx)(sn.a,{size:"small",onClick:b,children:Object(_.jsx)(tn.a,{})}),"note"===r&&Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(sn.a,{size:"small",onClick:o,children:Object(_.jsx)(rn.a,{})}),Object(_.jsx)(dn,{}),Object(_.jsx)(sn.a,{size:"small",onClick:v,children:Object(_.jsx)(an.a,{})})]})]}),Object(_.jsxs)(ln.a,{anchorEl:f,open:Boolean(f),onClose:h,children:[Object(_.jsx)(un.a,{onClick:l,children:"\u30b3\u30d4\u30fc"}),Object(_.jsx)(un.a,{onClick:u,children:"\u524a\u9664"})]})]}):null},On=["size","draggable","index","onChange","selected","onSelect","data","image"],xn=function(e){var t=e.size,n=e.draggable,r=void 0!==n&&n,c=e.index,a=e.onChange,i=e.selected,o=void 0!==i&&i,l=e.onSelect,u=(e.data,e.image),b=Object(Re.a)(e,On),j=Object(s.useRef)(null),d=Object(s.useRef)(null),f=Object(s.useState)(!1),x=Object(O.a)(f,2),v=x[0],h=x[1],p=ye()(null!==u&&void 0!==u?u:""),g=Object(O.a)(p,1)[0],m=Object(s.useContext)(X).mode,C=Object(s.useContext)(W),w=C.mode,k=C.editCanvas,E=C.closeCanvas,I=Object(s.useMemo)((function(){return N[t]}),[t]),z=Object(s.useMemo)((function(){return o&&!v&&"select"===m}),[v,m,o]),P=Object(s.useMemo)((function(){return r&&o}),[r,o]);Object(s.useEffect)((function(){var e;o&&d.current&&j.current&&(d.current.nodes([j.current]),null===(e=d.current.getLayer())||void 0===e||e.batchDraw())}),[o]);var M=Object(s.useCallback)((function(e){a((function(t){var n=y(t),r=n.structures[c];return n.structures[c]=Object(S.a)(Object(S.a)({},r),e),n}))}),[c,a]),T=Object(s.useCallback)((function(){h(!0)}),[]),D=Object(s.useCallback)((function(e){if(e.cancelBubble=!0,j.current){var t=e.target.attrs,n=t.x,r=t.y;if("number"===typeof n&&"number"===typeof r){var c=j.current.getSize(),a=c.width,i=c.height,o=n,s=r;o<0?o=0:o>I.width-a&&(o=I.width-a),s<0?s=0:s>I.height-i&&(s=I.height-i),n===o&&r===s||j.current.setPosition({x:o,y:s})}}}),[I.height,I.width]),B=Object(s.useCallback)((function(e){if(j.current){var t=j.current.getPosition(),n=t.x,r=t.y,c=j.current.getSize(),a={x:n,y:r,width:c.width,height:c.height};h(!1),M(a)}}),[M]),F=Object(s.useCallback)((function(e,t){return t.width<R.width||t.height<R.height?e:t}),[]),J=Object(s.useCallback)((function(){if(j.current){var e=j.current,t=e.scale(),n=t.x,r=t.y;e.scale({x:1,y:1});var c={x:e.x(),y:e.y(),width:Math.max(R.width,e.width()*n),height:Math.max(R.height,e.height()*r)};M(c)}}),[M]),A=Object(s.useCallback)((function(e){var t=e.currentTarget.getBoundingClientRect(),n=t.top,r={x:t.left,y:n+42,width:b.width,height:b.height};k(r)}),[k,b.height,b.width]);return Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(Q.g,Object(S.a)(Object(S.a)({},b),{},{fill:"white"})),g&&Object(_.jsx)(Q.d,Object(S.a)(Object(S.a)({},b),{},{image:g})),Object(_.jsx)(Q.g,Object(S.a)(Object(S.a)({ref:j,stroke:"black",strokeWidth:2,draggable:r},b),{},{onClick:l,onTap:l,onDragStart:T,onDragMove:D,onDragEnd:B,onTransformEnd:J})),Object(_.jsx)(fn,Object(S.a)(Object(S.a)({visible:z,mode:w},b),{},{onEdit:A,onCancel:E})),Object(_.jsx)(Q.j,{ref:d,visible:P,rotateEnabled:!1,boundBoxFunc:F})]})},vn=function(e){var t=e.size,n=e.structures,r=e.draggable,c=void 0!==r&&r,a=e.onChange,i=Object(s.useContext)(W),o=i.selectedCanvasIndex,l=i.onSelectCanvas,u=Object(s.useMemo)((function(){return N[t]}),[t]),b=Object(s.useCallback)((function(e){"background"===e.target.attrs.type&&l(void 0)}),[l]);return Object(_.jsxs)(Q.e,{children:[Object(_.jsx)(Q.g,Object(S.a)(Object(S.a)({x:0,y:0},u),{},{attrs:{type:"background"},onClick:b,onTap:b})),n.map((function(e,n){return Object(_.jsx)(xn,Object(S.a)({size:t,draggable:c,index:n,onChange:a,selected:n===o,onSelect:function(){return l(n)}},e),"handle-".concat(n))}))]})},hn={id:"",points:[],stroke:"#c9e1ff",strokeWidth:1,dash:[5,3],listening:!1},pn=function(e){var t=e.size,n=Object(s.useMemo)((function(){return N[t]}),[t]),r=Object(s.useMemo)((function(){for(var e=[],t=1,r=0;r<=n.height;r+=50)e.push(Object(S.a)(Object(S.a)({},hn),{},{id:"Horizontal_".concat(t),points:[0,r,n.width,r]})),t++;return e}),[n]),c=Object(s.useMemo)((function(){for(var e=[],t=1,r=0;r<=n.width;r+=50)e.push(Object(S.a)(Object(S.a)({},hn),{},{id:"Vertical_".concat(t),points:[r,0,r,n.height]})),t++;return e}),[n]);return Object(_.jsxs)(Q.e,{children:[r.map((function(e){return Object(_.jsx)(Q.f,Object(S.a)({},e),e.id)})),c.map((function(e){return Object(_.jsx)(Q.f,Object(S.a)({},e),e.id)}))]})},gn=function(e){var t=e.viewBox,n=e.size,r=e.drawings,c=e.structures,a=e.onChange,i=Object(s.useRef)(null),o=Object(s.useContext)(X),l=o.mode,u=o.settings,b=Object(s.useContext)(W).mode,j=$(W,F,X),d=Object(s.useRef)(),f=Object(s.useState)([]),x=Object(O.a)(f,2),v=x[0],h=x[1],p=Object(s.useMemo)((function(){return N[n]}),[n]),g=Object(s.useMemo)((function(){return"note"===b&&"select"===l}),[b,l]),m=Object(s.useCallback)((function(e){var n=e.target.attrs,r=n.x,c=n.y;if(i.current&&"number"===typeof r&&"number"===typeof c){var a=r,o=c,s=!1;a>0?(a=0,s=!0):Math.abs(a)+t.width>p.width&&(a=t.width-p.width,s=!0),o>0?(o=0,s=!0):Math.abs(o)+t.height>p.height&&(o=t.height-p.height,s=!0),s&&i.current.setPosition({x:a,y:o})}}),[p.height,p.width,t.height,t.width]),C=Object(s.useCallback)((function(e){var t;if("edit"===l){var n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();if(i.current&&n){d.current=!0;var r=i.current.getPosition(),c=r.x,a=r.y;h([n.x+Math.abs(c),n.y+Math.abs(a)])}}}),[l]),w=Object(s.useCallback)((function(e){var t;if("edit"===l&&d.current){var n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();if(i.current&&n){var r=i.current.getPosition(),c=r.x,a=r.y;h((function(e){return[].concat(Object(ee.a)(e),[n.x+Math.abs(c),n.y+Math.abs(a)])}))}}}),[l]),k=Object(s.useCallback)((function(e){"edit"===l&&d.current&&(d.current=!1,a((function(e){var t=y(e);return t.drawings.push(Object(S.a)(Object(S.a)({},u),{},{points:v})),t})),h([]))}),[l,a,v,u]);return Object(_.jsx)(Q.h,{ref:i,width:t.width,height:t.height,draggable:g,onDragMove:m,onPointerDown:C,onPointerMove:w,onPointerUp:k,children:Object(_.jsxs)(j,{children:[Object(_.jsx)(pn,{size:n}),Object(_.jsx)(vn,{size:n,structures:c,draggable:g,onChange:a}),Object(_.jsx)($t,{drawings:r,settings:u,points:v})]})})},mn=function(){var e=Object(s.useRef)(null),t=Object(s.useState)({width:0,height:0}),n=Object(O.a)(t,2),r=n[0],c=n[1],a=Object(s.useContext)(W),i=a.page,o=a.onChange;return Object(s.useEffect)((function(){var t=new ResizeObserver((function(e){var t=e[0].contentRect,n=t.width,r=t.height;c({width:n,height:r})}));return e.current&&t.observe(e.current),function(){t.disconnect()}}),[]),Object(_.jsx)(G.a,{ref:e,sx:{width:"auto",height:"100%",backgroundColor:"#ffffff",overscrollBehavior:"contain",overflow:"hidden"},children:Object(_.jsx)(gn,Object(S.a)(Object(S.a)({viewBox:r},i),{},{onChange:o}))})},yn=function(){var e=Object(s.useContext)(W),t=e.page,n=e.selectedCanvasIndex,r=e.canvasProps,c=e.canvasRef,a=Object(s.useContext)(F).tool,i=Object(s.useMemo)((function(){if("number"===typeof n)return t.structures[n].data}),[t.structures,n]);return Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(G.a,{sx:{boxSizing:"border-box",ml:1,mb:1,flex:1,border:function(e){return"1px solid ".concat(e.palette.divider)},borderRadius:1,overflow:"hidden"},children:Object(_.jsx)(mn,{})}),r&&Object(_.jsx)(G.a,{sx:{position:"absolute",top:r.y,left:r.x,width:r.width,height:r.height,backgroundColor:"red"},children:Object(_.jsx)(Kt,{ref:c,tool:a,structure:null!==i&&void 0!==i?i:P})})]})},Cn=n(168),wn=n(169),kn=n(170),Sn=n(171),En=n(172),In={select:{tool:"select",icon:Object(_.jsx)(Cn.a,{}),label:"\u9078\u629e"},pen:{tool:"pen",icon:Object(_.jsx)(wn.a,{}),label:"\u6881\u8981\u7d20\u306e\u63cf\u753b"},force:{tool:"force",icon:Object(_.jsx)(kn.a,{}),label:"\u96c6\u4e2d\u8377\u91cd\u306e\u8ffd\u52a0"},trapezoid:{tool:"trapezoid",icon:Object(_.jsx)(Sn.a,{}),label:"\u5206\u5e03\u8377\u91cd\u306e\u8ffd\u52a0"},delete:{tool:"delete",icon:Object(_.jsx)(En.a,{}),label:"\u8981\u7d20\u306e\u524a\u9664"}},zn=function(e){var t=e.tool,n=e.onChange,r=Object(s.useCallback)((function(e,t){var r;null!==t&&("string"===typeof(r=t)&&te.some((function(e){return e===r})))&&n(t)}),[n]);return Object(_.jsxs)(Xe.a,{sx:{width:160},alignItems:"flex-start",children:[Object(_.jsx)(U.a,{variant:"caption",children:"Toolbox"}),Object(_.jsx)(Ke.a,{orientation:"vertical",value:t,exclusive:!0,fullWidth:!0,onChange:r,children:Object.entries(In).map((function(e){var t=Object(O.a)(e,2),n=t[0],r=t[1],c=r.icon,a=r.label;return Object(_.jsxs)(Qe.a,{value:n,sx:{justifyContent:"flex-start",alignItems:"center"},children:[c,Object(_.jsx)(U.a,{variant:"caption",sx:{ml:1},children:a})]},n)}))})]})},Pn=function(){var e=Object(s.useContext)(F),t=e.tool,n=e.setTool;return Object(_.jsx)(zn,{tool:t,onChange:n})},Mn=n(173),Nn=n(179),Rn=["pen","eraser"],Tn={select:{mode:"select",icon:Object(_.jsx)(Cn.a,{}),label:"\u9078\u629e"},edit:{mode:"edit",icon:Object(_.jsx)(wn.a,{}),label:"\u63cf\u753b"}},Dn={pen:{mode:"pen",icon:Object(_.jsx)(wn.a,{}),label:"\u30da\u30f3\u30c4\u30fc\u30eb"},eraser:{mode:"eraser",icon:Object(_.jsx)(Mn.a,{}),label:"\u6d88\u3057\u30b4\u30e0"}},_n=function(e){var t=e.mode,n=e.settings,r=e.onChangeMode,c=e.onChangeDrawSettings,a=Object(s.useCallback)((function(e,t){var n;null!==t&&("string"===typeof(n=t)&&M.some((function(e){return e===n})))&&r(t)}),[r]),i=Object(s.useCallback)((function(e,t){var n;null!==t&&("string"===typeof(n=t)&&Rn.some((function(e){return e===n})))&&c((function(e){return Object(S.a)(Object(S.a)({},e),{},{eraser:"eraser"===t})}))}),[c]),o=Object(s.useCallback)((function(e,t){"number"===typeof t&&c((function(e){return Object(S.a)(Object(S.a)({},e),{},{strokeWidth:t})}))}),[c]),l=Object(s.useCallback)((function(e){if(e.target.checkValidity()){var t=e.target.value;c((function(e){return Object(S.a)(Object(S.a)({},e),{},{stroke:t})}))}}),[c]);return Object(_.jsxs)(Xe.a,{sx:{width:160},alignItems:"flex-start",children:[Object(_.jsx)(U.a,{variant:"caption",children:"Toolbox"}),Object(_.jsx)(Ke.a,{orientation:"vertical",value:t,exclusive:!0,fullWidth:!0,onChange:a,children:Object.entries(Tn).map((function(e){var t=Object(O.a)(e,2),n=t[0],r=t[1],c=r.icon,a=r.label;return Object(_.jsxs)(Qe.a,{value:n,sx:{justifyContent:"flex-start",alignItems:"center"},children:[c,Object(_.jsx)(U.a,{variant:"caption",sx:{ml:1},children:a})]},n)}))}),Object(_.jsx)(U.a,{variant:"caption",sx:{mt:1},children:"\u63cf\u753b\u30c4\u30fc\u30eb"}),Object(_.jsx)(Ke.a,{orientation:"vertical",value:n.eraser?"eraser":"pen",exclusive:!0,fullWidth:!0,disabled:"select"===t,onChange:i,children:Object.entries(Dn).map((function(e){var t=Object(O.a)(e,2),n=t[0],r=t[1],c=r.icon,a=r.label;return Object(_.jsxs)(Qe.a,{value:n,sx:{justifyContent:"flex-start",alignItems:"center"},children:[c,Object(_.jsx)(U.a,{variant:"caption",sx:{ml:1},children:a})]},n)}))}),Object(_.jsx)(U.a,{variant:"caption",sx:{mt:1},children:"\u592a\u3055"}),Object(_.jsx)(Nn.a,{sx:{ml:1,mb:2,boxSizing:"border-box",width:140},value:n.strokeWidth,min:4,max:20,step:4,marks:!0,valueLabelDisplay:"auto",disabled:"select"===t,onChange:o}),Object(_.jsx)(Ae.a,{type:"color",label:"\u30da\u30f3\u306e\u8272",value:n.stroke,disabled:"select"===t||n.eraser,fullWidth:!0,margin:"dense",size:"small",onChange:l})]})},Wn=function(){var e=Object(s.useContext)(X);return Object(_.jsx)(_n,Object(S.a)({},e))},Bn=function(){return"canvas"===Object(s.useContext)(W).mode?Object(_.jsx)(Pn,{}):Object(_.jsx)(Wn,{})},Fn=function(){var e=Object(s.useState)({width:0,height:0}),t=Object(O.a)(e,2),n=t[0],r=t[1],c=Object(s.useCallback)((function(){var e=window,t=e.innerHeight,n=e.innerWidth;r({height:t,width:n})}),[]);return Object(s.useEffect)((function(){return c(),window.addEventListener("resize",c),function(){window.removeEventListener("resize",c)}}),[c]),Object(_.jsxs)(G.a,{sx:Object(S.a)(Object(S.a)({},n),{},{overflow:"hidden"}),children:[Object(_.jsx)(K,{}),Object(_.jsxs)(G.a,{sx:{boxSizing:"border-box",width:"auto",height:"calc(100% - 48px)",display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"stretch",pt:1,px:1},children:[Object(_.jsx)(Bn,{}),Object(_.jsx)(yn,{})]})]})},Jn=Object(j.a)(),Xn=function(){return Object(_.jsx)(d.a,{theme:Jn,children:Object(_.jsx)(B,{children:Object(_.jsx)(J,{children:Object(_.jsxs)(A,{children:[Object(_.jsx)(f.a,{}),Object(_.jsx)(Fn,{})]})})})})},An=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,194)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),r(e),c(e),a(e),i(e)}))};b.a.render(Object(_.jsx)(l.a.StrictMode,{children:Object(_.jsx)(Xn,{})}),document.getElementById("root")),An()}},[[123,1,2]]]);
//# sourceMappingURL=main.4e625b04.chunk.js.map