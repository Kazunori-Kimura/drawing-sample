(this["webpackJsonpdrawing-sample"]=this["webpackJsonpdrawing-sample"]||[]).push([[0],{124:function(e,t,n){"use strict";n.r(t);var r,c,a,i,o,s=n(0),l=n.n(s),u=n(29),b=n.n(u),d=n(95),j=n(185),f=n(175),O=n(19),v=n(4),h=n(55),x=n.n(h),p=new x.a(1,0),g=new x.a(0,1),m=function(e,t,n){if(n>=1)return t;if(n<=0)return e;var r=t.clone().subtract(e).normalize(),c=e.distance(t),a=r.multiplyScalar(c*n);return e.clone().add(a)},y=function(e,t){var n=t.clone().subtract(e).normalize(),r=new x.a(n.y,-1*n.x).normalize();return g.dot(r)>0&&r.invert(),r},C=function(e){return JSON.parse(JSON.stringify(e))},w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=Math.pow(10,t),r=Math.round(e*n)/n;return r},k=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,n=e/t,r=Math.round(n)*t;return r},S=function(e){var t=Object(v.a)(e,2),n=t[0],r=t[1],c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25;return[k(n,c),k(r,c)]},I=n(6),E=n(181),z=function(e,t){return{id:Object(E.a)(),x:e,y:t}},M=["free","pin","pinX","pinZ","fixX","fix"],P=function(e){if(e&&"object"===typeof e){var t=e;return"string"===typeof t.id&&"number"===typeof t.x&&"number"===typeof t.y}return!1},N=function(e){if(e&&"object"===typeof e){var t=e;return"string"===typeof t.id&&"string"===typeof t.name&&"string"===typeof t.beam&&"number"===typeof t.force&&"number"===typeof t.distanceI}return!1},D=function(e){if(e&&"object"===typeof e){var t=e;return"string"===typeof t.id&&"string"===typeof t.name&&"string"===typeof t.beam&&"number"===typeof t.forceI&&"number"===typeof t.distanceI&&"number"===typeof t.forceJ&&"number"===typeof t.distanceJ}return!1},R={unit:{force:"kN",length:"m"},nodes:[],beams:[],forces:[],trapezoids:[]},T=["pan","select","edit"],_={default:{width:1e3,height:1e3},A3:{width:0,height:0},A4:{width:2970,height:2100},B4:{width:0,height:0},B5:{width:0,height:0}},W={width:160,height:90},B=Object(I.a)({id:"Canvas_1",data:R,x:100,y:100},W),J={stroke:"#000000",strokeWidth:4,eraser:!1},A=(Object(I.a)({},B),n(1)),F=Object(s.createContext)(void 0),X=function(e){var t=e.children,n=Object(s.useState)("note"),r=Object(v.a)(n,2),c=r[0],a=r[1],i=Object(s.useState)("default"),o=Object(v.a)(i,2),l=o[0],u=o[1],b=Object(s.useState)([B]),d=Object(v.a)(b,2),j=d[0],f=d[1],h=Object(s.useState)([]),x=Object(v.a)(h,2),p=x[0],g=x[1],m=Object(s.useState)(),y=Object(v.a)(m,2),w=y[0],k=y[1],S=Object(s.useState)(),I=Object(v.a)(S,2),E=I[0],z=I[1],M=Object(s.useRef)(null),P=Object(s.useCallback)((function(e){a("canvas"),z(e)}),[]),N=Object(s.useCallback)((function(){if(M.current){var e=M.current.getStructure(),t=M.current.toDataURL();"number"===typeof w&&f((function(n){var r=C(n);return r[w].data=e,r[w].image=t,r}))}a("note"),z(void 0)}),[w]),D=Object(s.useCallback)((function(e){g((function(t){return[].concat(Object(O.a)(t),[e])}))}),[]);return Object(A.jsx)(F.Provider,{value:{mode:c,onChangeMode:a,pageSizeType:l,pageSize:_[l],onChangePageSize:u,structures:j,onChangeStructures:f,drawings:p,addDrawing:D,selectedCanvasIndex:w,onSelectCanvas:k,canvasProps:E,editCanvas:P,closeCanvas:N,canvasRef:M},children:t})},G=Object(s.createContext)(void 0),L=function(e){var t=e.children,n=Object(s.useState)("select"),r=Object(v.a)(n,2),c=r[0],a=r[1];return Object(A.jsx)(G.Provider,{value:{tool:c,setTool:a},children:t})},Y=Object(s.createContext)(void 0),U=function(e){var t=e.children,n=Object(s.useState)("pan"),r=Object(v.a)(n,2),c=r[0],a=r[1],i=Object(s.useState)(J),o=Object(v.a)(i,2),l=o[0],u=o[1];return Object(A.jsx)(Y.Provider,{value:{mode:c,settings:l,onChangeMode:a,onChangeDrawSettings:u},children:t})},Z=n(193),V=n(187),H=n(189),q=n(186),K=null!==(r=null===(c="46d1d562d2410b9243f58be3ab867ff61853079d\n")?void 0:c.substring(0,7))&&void 0!==r?r:"",Q=null!==(a="2022/01/14 11:47:45")?a:"",$=null!==(i="0.1.0")?i:"",ee=function(){return Object(A.jsx)(q.a,{variant:"caption",sx:{ml:2},children:"ver ".concat($," (").concat(K,": ").concat(Q,")")})},te=function(){return Object(A.jsx)(V.a,{position:"static",children:Object(A.jsxs)(H.a,{variant:"dense",children:[Object(A.jsx)(q.a,{component:"h1",variant:"h6",color:"inherit",children:"Drawing Sample"}),Object(A.jsx)(ee,{})]})})},ne=n(18),re=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=l.a.useRef([]);return r.current=t.map((function(e){return l.a.useContext(e)})),l.a.useMemo((function(){return function(e){var n=e.children;return t.reduceRight((function(e,t,n){return Object(A.jsx)(t.Provider,{value:r.current[n],children:e})}),n)}}),[t])},ce=Object(s.createContext)(void 0),ae=function(e){var t=e.children,n=e.structure,r=e.size,c=e.gridSize,a=void 0===c?25:c,i=e.snapSize,o=void 0===i?25:i,l=e.tool,u=void 0===l?"select":l,b=e.readonly,d=void 0!==b&&b,j=Object(s.useState)([]),f=Object(v.a)(j,2),h=f[0],x=f[1],p=Object(s.useState)([]),g=Object(v.a)(p,2),m=g[0],y=g[1],w=Object(s.useState)([]),k=Object(v.a)(w,2),S=k[0],z=k[1],M=Object(s.useState)(0),R=Object(v.a)(M,2),T=R[0],_=R[1],W=Object(s.useState)([]),B=Object(v.a)(W,2),J=B[0],F=B[1],X=Object(s.useState)([]),G=Object(v.a)(X,2),L=G[0],Y=G[1];Object(s.useEffect)((function(){var e=n.nodes,t=n.beams,r=n.forces,c=n.trapezoids;x(e),y(t),z(r),F(c)}),[n]);var U=Object(s.useCallback)((function(){return{unit:n.unit,nodes:h,beams:m,forces:S,trapezoids:J}}),[m,S,h,n.unit,J]);Object(s.useEffect)((function(){var e=0;S.length>0&&(e=S.reduce((function(e,t){return Object(I.a)(Object(I.a)({},e),{},{force:e.force+t.force})})).force/S.length);_(e)}),[S]);var Z=Object(s.useMemo)((function(){var e={};return h.forEach((function(t){e[t.id]=t})),e}),[h]),V=Object(s.useMemo)((function(){var e={};return m.forEach((function(t){e[t.id]=t})),e}),[m]),H=Object(s.useCallback)((function(e){d||x((function(t){var n=C(t),r=n.findIndex((function(t){return t.id===e.id}));if(r>=0){var c=n[r];n[r]=Object(I.a)(Object(I.a)({},c),e)}return n}))}),[d]),q=Object(s.useCallback)((function(e){if(!d){var t=[];Array.isArray(e)?t.push.apply(t,Object(O.a)(e)):t.push(e);var n=[];t.forEach((function(e){"undefined"===typeof e.id&&(e.id=Object(E.a)()),P(e)&&n.push(e)})),x((function(e){return[].concat(Object(O.a)(e),n)}))}}),[d]),K=Object(s.useCallback)((function(e){d||(y((function(t){for(var n=C(t),r=n.findIndex((function(t){var n=t.nodeI,r=t.nodeJ;return n===e||r===e}));r>=0;)n.splice(r,1),r=n.findIndex((function(t){var n=t.nodeI,r=t.nodeJ;return n===e||r===e}));return n})),x((function(t){var n=C(t),r=n.findIndex((function(t){return t.id===e}));return r>=0&&n.splice(r,1),n})))}),[d]),Q=Object(s.useCallback)((function(e){d||y((function(t){var n=C(t),r=n.findIndex((function(t){return t.id===e.id}));if(r>=0){var c=n[r];n[r]=Object(I.a)(Object(I.a)({},c),e)}return n}))}),[d]),$=Object(s.useCallback)((function(e){if(!d){var t=Object(I.a)({},e);"undefined"===typeof t.id&&(t.id=Object(E.a)()),function(e){if(e&&"object"===typeof e){var t=e;return"string"===typeof t.id&&"string"===typeof t.name&&"string"===typeof t.nodeI&&"string"===typeof t.nodeJ}return!1}(t)&&y((function(e){return[].concat(Object(O.a)(e),[t])}))}}),[d]),ee=Object(s.useCallback)((function(e){if(!d){var t=m.find((function(t){return t.id===e}));if(t){var n=t.nodeI,r=t.nodeJ,c=new Set;m.forEach((function(t){var n=t.id,r=t.nodeI,a=t.nodeJ;n!==e&&(c.add(r),c.add(a))})),x((function(e){var t=C(e);return[n,r].forEach((function(e){if(!c.has(e)){var n=t.findIndex((function(t){return t.id===e}));n>=0&&t.splice(n,1)}})),t}))}z((function(t){for(var n=C(t),r=n.findIndex((function(t){return t.beam===e}));r>=0;)n.splice(r,1),r=n.findIndex((function(t){return t.beam===e}));return n})),F((function(t){for(var n=C(t),r=n.findIndex((function(t){return t.beam===e}));r>=0;)n.splice(r,1),r=n.findIndex((function(t){return t.beam===e}));return n})),y((function(t){var n=C(t),r=n.findIndex((function(t){return t.id===e}));return r>=0&&n.splice(r,1),n}))}}),[m,d]),te=Object(s.useCallback)((function(e){d||z((function(t){var n=C(t),r=n.findIndex((function(t){return t.id===e.id}));if(r>=0){var c=n[r];n[r]=Object(I.a)(Object(I.a)({},c),e)}return n}))}),[d]),ne=Object(s.useCallback)((function(e){if(!d){var t=Object(I.a)({},e);"undefined"===typeof t.id&&(t.id=Object(E.a)()),N(t)&&z((function(e){return[].concat(Object(O.a)(e),[t])}))}}),[d]),re=Object(s.useCallback)((function(e){d||z((function(t){var n=C(t),r=n.findIndex((function(t){return t.id===e}));return r>=0&&n.splice(r,1),n}))}),[d]),ae=Object(s.useCallback)((function(e){d||F((function(t){var n=C(t),r=n.findIndex((function(t){return t.id===e.id}));if(r>=0){var c=n[r];n[r]=Object(I.a)(Object(I.a)({},c),e)}return n}))}),[d]),ie=Object(s.useCallback)((function(e){if(!d){var t=Object(I.a)({},e);"undefined"===typeof t.id&&(t.id=Object(E.a)()),D(t)&&F((function(e){return[].concat(Object(O.a)(e),[t])}))}}),[d]),oe=Object(s.useCallback)((function(e){d||F((function(t){var n=C(t),r=n.findIndex((function(t){return t.id===e}));return r>=0&&n.splice(r,1),n}))}),[d]),se=Object(s.useCallback)((function(e){return L.some((function(t){var n=t.type,r=t.id;return n===e.type&&r===e.id}))}),[L]),le=Object(s.useCallback)((function(e){se(e)||Y((function(t){return[].concat(Object(O.a)(t),[e])}))}),[se,Y]),ue=Object(s.useCallback)((function(e){se(e)?Y((function(t){return t.filter((function(t){var n=t.type,r=t.id;return!(n===e.type&&r===e.id)}))})):Y((function(t){return[].concat(Object(O.a)(t),[e])}))}),[se,Y]),be=Object(s.useCallback)((function(){Y([])}),[]);return Object(A.jsx)(ce.Provider,{value:{size:r,gridSize:a,snapSize:o,tool:u,readonly:d,nodes:h,beams:m,forces:S,trapezoids:J,nodeMap:Z,beamMap:V,forceAverage:T,onChangeNode:H,onCreateNode:q,onDeleteNode:K,onChangeBeam:Q,onCreateBeam:$,onDeleteBeam:ee,onChangeForce:te,onCreateForce:ne,onDeleteForce:re,onChangeTrapezoid:ae,onCreateTrapezoid:ie,onDeleteTrapezoid:oe,selected:L,isSelected:se,select:le,toggleSelect:ue,clearSelection:be,getStructure:U},children:t})},ie=["select","pen","force","trapezoid","delete"],oe=function(e){return!!Array.isArray(e)&&(0===e.length||e.every((function(e){return"number"===typeof e})))},se=Object(s.createContext)(void 0),le=function(e){var t=e.children,n=Object(s.useContext)(ce),r=n.tool,c=n.readonly,a=void 0!==c&&c,i=n.nodes,o=n.beams,l=n.trapezoids,u=n.onCreateNode,b=n.onCreateBeam,d=n.onCreateTrapezoid,j=Object(s.useState)([]),f=Object(v.a)(j,2),h=f[0],p=f[1],g=Object(s.useRef)(),m=Object(s.useRef)(),y=Object(s.useMemo)((function(){return!!a||!("pen"===r||"trapezoid"===r)}),[a,r]),C=Object(s.useCallback)((function(e){var t;if(!y){if("trapezoid"===r){if("beam"!==e.target.attrs.type)return;var n=e.target.attrs.id,c=e.target.attrs.points;oe(c)&&"string"===typeof n&&(m.current={id:n,points:c})}var a=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();a&&(g.current=!0,p([a.x,a.y]))}}),[y,r]),k=Object(s.useCallback)((function(e){var t;if(!y&&g.current){var n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&p((function(e){return[].concat(Object(O.a)(e),[n.x,n.y])}))}}),[y]),I=Object(s.useCallback)((function(e,t){var n=S([e[0],e[1]],25),r=S([t[0],t[1]],25);if(n[0]!==r[0]||n[1]!==r[1]){var c=[],a={name:"Beam_".concat(o.length+1)};if(n[0]>r[0]){var s=[r,n];n=s[0],r=s[1]}else if(n[0]===r[0]&&n[1]>r[1]){var l=[r,n];n=l[0],r=l[1]}var d=z.apply(void 0,Object(O.a)(n)),j=i.find((function(e){return e.x===d.x&&e.y===d.y}));j?a.nodeI=j.id:(c.push(d),a.nodeI=d.id);var f=z.apply(void 0,Object(O.a)(r)),v=i.find((function(e){return e.x===f.x&&e.y===f.y}));v?a.nodeJ=v.id:(c.push(f),a.nodeJ=f.id),u(c),b(a)}}),[o.length,i,b,u]),M=Object(s.useCallback)((function(e,t,n){var r=function(e,t,n,r){var c=r.slice(0,2),a=r.slice(-2),i=new x.a(c[0],c[1]),o=new x.a(a[0],a[1]),s=i.distance(o),l=o.clone().subtract(i).normalize(),u=new x.a(e[0],e[1]),b=new x.a(t[0],t[1]),d=i.distance(u),j=i.distance(b);if(d>j){var f=[b,u];u=f[0],b=f[1];var O=[j,d];d=O[0],j=O[1]}var v=i.clone().add(l.clone().multiplyScalar(d)),h=b.clone().subtract(v).normalize(),p=l.angle()-h.angle(),g=v.distance(b)*Math.cos(p),m=v.clone().add(l.clone().multiplyScalar(g));j=o.distance(m);var y=w(d/s,3),C=w(j/s,3);return{id:Object(E.a)(),name:"Trapezoid_N",beam:n,forceI:10,forceJ:10,distanceI:y,distanceJ:C,angle:90,isGlobal:!1}}(e,t,n.id,n.points),c="Trapezoid_".concat(l.length+1);r.name=c,d(r)}),[d,l.length]),P=Object(s.useCallback)((function(e){if(!y&&g.current&&(g.current=!1,h.length>=4)){var t=h.slice(0,2),n=h.slice(-2);"pen"===r?I(t,n):"trapezoid"===r&&m.current&&M(t,n,m.current),p([]),m.current=void 0}}),[y,I,M,h,p,r]);return Object(A.jsx)(se.Provider,{value:{points:h,onPointerDown:C,onPointerMove:k,onPointerUp:P},children:t})},ue=function(){var e=Object(s.useContext)(ce).tool,t=Object(s.useContext)(se).points,n=Object(s.useMemo)((function(){switch(e){case"pen":return"blue";case"trapezoid":return"red";default:return"black"}}),[e]);return Object(A.jsx)(ne.e,{children:Object(A.jsx)(ne.f,{points:t,strokeWidth:3,stroke:n})})},be={id:"",points:[],stroke:"#c9e1ff",strokeWidth:1,dash:[5,3],listening:!1},de=function(){var e=Object(s.useContext)(ce),t=e.size,n=e.gridSize,r=Object(s.useMemo)((function(){for(var e=[],r=1,c=0;c<=t.height;c+=n)e.push(Object(I.a)(Object(I.a)({},be),{},{id:"Horizontal_".concat(r),points:[0,c,t.width,c]})),r++;return e}),[n,t.height,t.width]),c=Object(s.useMemo)((function(){for(var e=[],r=1,c=0;c<=t.width;c+=n)e.push(Object(I.a)(Object(I.a)({},be),{},{id:"Vertical_".concat(r),points:[c,0,c,t.height]})),r++;return e}),[n,t.height,t.width]);return Object(A.jsxs)(ne.e,{listening:!1,children:[r.map((function(e){return Object(A.jsx)(ne.f,Object(I.a)({},e),e.id)})),c.map((function(e){return Object(A.jsx)(ne.f,Object(I.a)({},e),e.id)}))]})},je=function(e,t){var n=e.id,r=e.name,c=e.nodeI,a=e.nodeJ,i=e.points,o=e.selected,l=void 0!==o&&o,u=e.onClick,b=Object(s.useState)([0,0]),d=Object(v.a)(b,2),j=d[0],f=d[1],O=Object(s.useState)(0),h=Object(v.a)(O,2),p=h[0],g=h[1],m=Object(s.useState)(0),C=Object(v.a)(m,2),w=C[0],k=C[1],S=Object(s.useState)([[0,0],[0,0]]),I=Object(v.a)(S,2),E=I[0],z=I[1],M=Object(s.useRef)(new x.a(0,0)),P=Object(s.useRef)(new x.a(0,0));return Object(s.useEffect)((function(){if(l){var e=Object(v.a)(i,4),t=e[0],n=e[1],r=e[2],c=e[3];M.current.x=t,M.current.y=n,P.current.x=r,P.current.y=c;var a=M.current,o=P.current;if(a.x>o.x){var s=[o,a];a=s[0],o=s[1]}var u=a.distance(o),b=y(a,o),d=a.clone().add(b.clone().multiplyScalar(16)),j=o.clone().subtract(a).angleDeg(),O=b.clone().multiplyScalar(75),h=a.clone().add(O),x=o.clone().add(O);g(u),f([d.x,d.y]),k(j),z([[h.x,h.y],[x.x,x.y]])}}),[i,l]),Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(ne.f,{ref:t,type:"beam",id:n,name:r,nodeI:c,nodeJ:a,points:i,stroke:l?"blue":"black",strokeWidth:4,onClick:u,onTap:u}),l&&Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(ne.i,{x:j[0],y:j[1],rotation:w,text:r,fontSize:12,width:p,fill:"blue",align:"center",wrap:"none",ellipsis:!0,listening:!1}),Object(A.jsx)(xe,{start:E[0],end:E[1]})]})]})},fe=Object(s.forwardRef)(je),Oe=function(e){var t=e.points,n=e.id,r=e.distanceI,c=e.force,a=e.ratio,i=e.visible,o=void 0!==i&&i,l=e.selected,u=void 0!==l&&l,b=e.onClick,d=e.onDblClick,j=Object(s.useState)([]),f=Object(v.a)(j,2),O=f[0],h=f[1],g=Object(s.useState)(0),C=Object(v.a)(g,2),w=C[0],k=C[1],S=Object(s.useState)(0),I=Object(v.a)(S,2),E=I[0],z=I[1],M=Object(s.useState)([0,0]),P=Object(v.a)(M,2),N=P[0],D=P[1],R=Object(s.useRef)(new x.a(0,0)),T=Object(s.useRef)(new x.a(0,0));Object(s.useEffect)((function(){var e=Object(v.a)(t,4),n=e[0],c=e[1],i=e[2],o=e[3];R.current.x=n,R.current.y=c,T.current.x=i,T.current.y=o;var s=m(R.current,T.current,r),l=y(R.current,T.current),u=isNaN(a)?30:30*a,b=s.clone().add(l.multiplyScalar(u));h([b.x,b.y,s.x,s.y]),k(Math.max(u,140));var d=l.clone().angleDeg();z(d);var j=R.current.clone().subtract(T.current).normalize();p.dot(j)<0&&j.invert();var f=s.clone().add(j.multiplyScalar(6));D([f.x,f.y])}),[t,r,a]);var _=Object(s.useMemo)((function(){return u?"red":"orange"}),[u]);return Object(A.jsxs)(ne.c,{type:"force",id:n,visible:o,onClick:b,onTap:b,onDblClick:d,onDblTap:d,children:[Object(A.jsx)(ne.a,{points:O,pointerLength:6,pointerWidth:6,fill:_,stroke:_,strokeWidth:2}),u&&Object(A.jsx)(ne.i,{x:N[0],y:N[1],offsetX:-6,text:"".concat(c,"kN"),fontSize:12,width:w,rotation:E,fill:_,wrap:"none",ellipsis:!0})]})},ve={fill:"silver",stroke:"silver",strokeWidth:1,listening:!1},he=Object(I.a)({pointerLength:6,pointerWidth:6,pointerAtBeginning:!0},ve),xe=function(e){var t=e.start,n=e.end,r=Object(s.useRef)(new x.a(0,0)),c=Object(s.useRef)(new x.a(0,0)),a=Object(s.useState)(0),i=Object(v.a)(a,2),o=i[0],l=i[1],u=Object(s.useState)(0),b=Object(v.a)(u,2),d=b[0],j=b[1],f=Object(s.useState)([0,0]),O=Object(v.a)(f,2),h=O[0],p=O[1];return Object(s.useEffect)((function(){r.current.x=t[0],r.current.y=t[1],c.current.x=n[0],c.current.y=n[1];var e=r.current.distance(c.current),a=c.current.clone().subtract(r.current).normalize().angleDeg();l(Math.round(e)),j(90===a?-90:a),p(90===a?n:t)}),[n,t]),Object(A.jsxs)(ne.c,{x:h[0],y:h[1],rotation:d,children:[Object(A.jsx)(ne.f,Object(I.a)({points:[0,0,0,10]},ve)),Object(A.jsx)(ne.a,Object(I.a)({points:[0,5,o,5]},he)),Object(A.jsx)(ne.f,Object(I.a)({points:[o,0,o,10]},ve)),Object(A.jsx)(ne.i,{x:0,y:-8,text:"".concat(o,"px"),fontSize:12,fill:"silver",width:o,align:"center",listening:!1,wrap:"none",ellipsis:!0})]})},pe=n(45),ge=n.n(pe),me={free:"/assets/images/pins/pin_1.svg",pin:"/assets/images/pins/pin_1.svg",pinX:"/assets/images/pins/pin_2.svg",pinZ:"/assets/images/pins/pin_2.svg",fixX:"/assets/images/pins/pin_3.svg",fix:"/assets/images/pins/pin_4.svg"},ye=function(e,t){var n=e.id,r=e.x,c=e.y,a=e.pin,i=e.draggable,o=void 0!==i&&i,l=e.isDragging,u=void 0!==l&&l,b=e.onDblClick,d=e.onDragStart,j=e.onDragMove,f=e.onDragEnd,O=Object(s.useMemo)((function(){return"".concat("/drawing-sample").concat(me[null!==a&&void 0!==a?a:"free"])}),[a]),h=ge()(O),x=Object(v.a)(h,1)[0],p=Object(s.useCallback)((function(e){e.cancelBubble=!0}),[]);return Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(ne.b,{ref:t,type:"node",id:n,x:r,y:c,pin:a,fill:u?"blue":"black",radius:4,draggable:o,onDragStart:d,onDragMove:j,onDragEnd:f,onClick:p,onTap:p,onDblClick:b,onDblTap:b,_useStrictMode:!0}),!u&&a&&"free"!==a&&Object(A.jsx)(ne.d,{x:r,y:c,offsetX:12,offsetY:-4,rotation:"pinZ"===a?-90:0,image:x,width:24,height:24,listening:!1})]})},Ce=Object(s.forwardRef)(ye),we={stroke:"pink",strokeWidth:2},ke=Object(I.a)({pointerLength:6,pointerWidth:6,fill:"pink"},we),Se={offsetX:-6,offsetY:14,fontSize:12,wrap:"none",ellipsis:!0},Ie=function(e){var t=e.points,n=e.id,r=e.beam,c=e.forceI,a=e.forceJ,i=e.distanceI,o=e.distanceJ,l=e.angle,u=void 0===l?90:l,b=e.isGlobal,d=void 0!==b&&b,j=e.visible,f=void 0!==j&&j,O=e.selected,h=void 0!==O&&O,g=e.onClick,y=e.onDblClick,C=Object(s.useState)([]),w=Object(v.a)(C,2),k=w[0],S=w[1],E=Object(s.useState)([0,0,0,0]),z=Object(v.a)(E,2),M=z[0],P=z[1],N=Object(s.useState)(),D=Object(v.a)(N,2),R=D[0],T=D[1],_=Object(s.useState)(),W=Object(v.a)(_,2),B=W[0],J=W[1],F=Object(s.useState)([[0,0],[0,0]]),X=Object(v.a)(F,2),G=X[0],L=X[1],Y=Object(s.useRef)(new x.a(0,0)),U=Object(s.useRef)(new x.a(0,0));Object(s.useEffect)((function(){var e=Y.current,n=U.current,r=Object(v.a)(t,4),s=r[0],l=r[1],b=r[2],j=r[3];e.x=s,e.y=l,n.x=b,n.y=j;var f,O=n.clone().subtract(e).normalize();f=d?p.clone().rotateDeg(-1*u):O.clone().rotateDeg(-1*u).normalize();var h=e.distance(n),x=e.clone().add(O.clone().multiplyScalar(h*i)),g=n.clone().add(O.clone().invert().multiplyScalar(h*o)),y=x.clone().add(f.clone().multiplyScalar(10*c)),C=g.clone().add(f.clone().multiplyScalar(10*a)),w=function(e,t,n){for(var r=[],c=e.distance(t),a=10,i=c/(a+1);i<25&&a>0;)i=c/(1+--a);if(a>0)for(var o=1;o<=a;o++){var s=e.clone().add(n.clone().multiplyScalar(i*o));r.push(s)}else if((i=c/2)>=10){var l=m(e,t,.5);r.push(l)}return r}(x,g,O),k=C.x-y.x!==0?(C.y-y.y)/(C.x-y.x):NaN,I=isNaN(k)?NaN:y.y-k*y.x,E=[];w.forEach((function(e){var t=function(e,t,n){var r=Object(v.a)(e,4),c=r[0],a=r[1],i=r[2],o=r[3],s=null;try{var l=t.clone().add(n),u=l.x-t.x!==0?(l.y-t.y)/(l.x-t.x):NaN,b=isNaN(u)?NaN:t.y-u*t.x;if(i===u)return null;if(isNaN(i)||isNaN(u)){if(isNaN(i)){var d=c.x;s=[d,d*u+b]}else if(isNaN(u)){var j=t.x;s=[j,j*i+o]}}else{var f=(b-o)/(i-u);s=[f,i*f+o]}if(s){var O=s,h=Object(v.a)(O,2),x=h[0],p=h[1],g=[c.x,a.x].sort((function(e,t){return e-t})),m=[c.y,a.y].sort((function(e,t){return e-t}));if(x>=g[0]&&x<=g[1]&&p>=m[0]&&p<=m[1])return s}return null}catch(y){console.error(y)}return null}([y,C,k,I],e,f);if(t){var n=[t[0],t[1],e.x,e.y];E.push(n)}}));var z=f.angleDeg();T({x:x.x,y:x.y,text:"".concat(c,"kN/m"),width:x.distance(y),rotation:z}),J({x:g.x,y:g.y,text:"".concat(a,"kN/m"),width:g.distance(C),rotation:z});var M=10*Math.max(c,a),N=f.clone().multiplyScalar(M+50),D=x.clone().add(N),R=g.clone().add(N);L([[D.x,D.y],[R.x,R.y]]),P([y.x,y.y,C.x,C.y]),S([[y.x,y.y,x.x,x.y]].concat(E,[[C.x,C.y,g.x,g.y]]))}),[u,t,i,o,c,a,d]);var Z=Object(s.useMemo)((function(){return h?"red":"pink"}),[h]);return Object(A.jsxs)(ne.c,{type:"trapezoid",id:n,beam:r,visible:f,onClick:g,onTap:g,onDblClick:y,onDblTap:y,children:[Object(A.jsx)(ne.f,Object(I.a)(Object(I.a)({points:M},we),{},{stroke:Z})),k.map((function(e,t){return Object(A.jsx)(ne.a,Object(I.a)(Object(I.a)({points:e},ke),{},{stroke:Z,fill:Z}),"arrow_".concat(t))})),h&&Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(ne.i,Object(I.a)(Object(I.a)(Object(I.a)({},Se),R),{},{fill:Z})),Object(A.jsx)(ne.i,Object(I.a)(Object(I.a)(Object(I.a)({},Se),B),{},{fill:Z})),Object(A.jsx)(xe,{start:G[0],end:G[1]})]})]})},Ee=25,ze=function(){var e=Object(s.useContext)(ce).nodes,t=Object(s.useMemo)((function(){var t={maxX:Number.MIN_SAFE_INTEGER,minX:Number.MAX_SAFE_INTEGER,guidesX:[],maxY:Number.MIN_SAFE_INTEGER,minY:Number.MAX_SAFE_INTEGER,guidesY:[]},n=new Set,r=new Set;if(e.forEach((function(e){var c=e.x,a=e.y;t.maxX<c&&(t.maxX=c),t.minX>c&&(t.minX=c),n.has(c)||n.add(c),t.maxY<a&&(t.maxY=a),t.minY>a&&(t.minY=a),r.has(a)||r.add(a)})),n.size>1)for(var c=Array.from(n).sort((function(e,t){return e<t?-1:1})),a=c[0],i=1;i<c.length;i++){var o=c[i],s={key:"LocalGuideX_".concat(i),start:[a,t.maxY+100],end:[o,t.maxY+100]};a=o,t.guidesX.push(s)}if(r.size>1)for(var l=Array.from(r).sort((function(e,t){return e<t?-1:1})),u=l[0],b=Math.max(t.minX-100,50),d=1;d<l.length;d++){var j=l[d],f={key:"LocalGuideY_".concat(d),start:[b,u],end:[b,j]};u=j,t.guidesY.push(f)}return t}),[e]),n=t.minX,r=t.maxX,c=t.guidesX,a=t.minY,i=t.maxY,o=t.guidesY,l=Object(s.useMemo)((function(){return n!==Number.MAX_SAFE_INTEGER?Math.max(Ee,n-125):0}),[n]),u=Object(s.useMemo)((function(){return i!==Number.MIN_SAFE_INTEGER?i+125:0}),[i]);return Object(A.jsxs)(ne.e,{listening:!1,children:[n!==Number.MAX_SAFE_INTEGER&&r!==Number.MIN_SAFE_INTEGER&&Object(A.jsx)(xe,{start:[n,u],end:[r,u]}),c.map((function(e){return Object(A.jsx)(xe,Object(I.a)({},e))})),a!==Number.MAX_SAFE_INTEGER&&i!==Number.MIN_SAFE_INTEGER&&Object(A.jsx)(xe,{start:[l,a],end:[l,i]}),o.map((function(e){return Object(A.jsx)(xe,Object(I.a)({},e))}))]})},Me=Object(s.createContext)(void 0),Pe=function(e){var t=e.children,n=Object(s.useState)(),r=Object(v.a)(n,2),c=r[0],a=r[1],i=Object(s.useState)({top:0,left:0}),o=Object(v.a)(i,2),l=o[0],u=o[1],b=Object(s.useState)({}),d=Object(v.a)(b,2),j=d[0],f=d[1],O=Object(s.useCallback)((function(e,t,n){a(e),u(t),n&&f(n)}),[u,a]),h=Object(s.useCallback)((function(){a(void 0),u({top:0,left:0}),f({})}),[u,a]);return Object(A.jsx)(Me.Provider,{value:{popupType:c,setPopupType:a,popupPosition:l,setPopupPosition:u,open:O,close:h,popupParams:j},children:t})},Ne=function(){var e=Object(s.useContext)(ce),t=e.tool,n=e.readonly,r=e.nodes,c=e.nodeMap,a=e.beams,i=e.beamMap,o=e.forces,l=e.forceAverage,u=e.trapezoids,b=e.snapSize,d=e.onChangeNode,j=e.onCreateForce,f=e.onDeleteBeam,O=e.onDeleteForce,h=e.onDeleteTrapezoid,p=e.select,g=e.isSelected,m=Object(s.useContext)(Me).open,y=Object(s.useRef)([]),C=Object(s.useRef)([]),k=Object(s.useRef)(null);Object(s.useEffect)((function(){y.current=y.current.slice(0,r.length)}),[r.length]),Object(s.useEffect)((function(){C.current=C.current.slice(0,a.length)}),[a.length]);var E=Object(s.useState)(),z=Object(v.a)(E,2),M=z[0],P=z[1],N=Object(s.useMemo)((function(){return!n&&"select"===t}),[n,t]),D=Object(s.useRef)(new x.a(0,0)),R=Object(s.useRef)(),T=Object(s.useCallback)((function(e,t){var n=c[e],r=c[t];return[n.x,n.y,r.x,r.y]}),[c]),_=Object(s.useCallback)((function(e){var t=i[e];return T(t.nodeI,t.nodeJ)}),[i,T]),W=Object(s.useCallback)((function(e){var n,r=!1;if("select"===t)p({type:"beams",id:e.target.id()}),r=!0;else if("delete"===t)f(e.target.id()),r=!0;else if("force"===t){var c,a=null===(c=e.target.getStage())||void 0===c?void 0:c.getPointerPosition(),i=e.target.attrs.points;if(a&&(oe(n=i)&&4===n.length)){var s=function(e,t,n,r){var c=t.distance(n),a=t.distance(r);return{beam:e,force:10,distanceI:w(a/c)}}(e.target.id(),new x.a(i[0],i[1]),new x.a(i[2],i[3]),new x.a(a.x,a.y)),l="Force_".concat(o.length);j(Object(I.a)(Object(I.a)({},s),{},{name:l})),r=!0}}e.cancelBubble=r}),[o.length,j,f,p,t]),B=Object(s.useCallback)((function(e){if("select"===t){var n,c=null===(n=e.target.getStage())||void 0===n?void 0:n.getPointerPosition(),a=r.find((function(t){return t.id===e.target.id()}));c&&a&&m("nodes",{top:c.y,left:c.x},a)}}),[r,m,t]),J=Object(s.useCallback)((function(){if(M){var e=D.current,t=e.x,n=e.y;C.current.forEach((function(e){if(e){var r=e.attrs,c=r.nodeI,a=r.nodeJ,i=e.points();c===M&&e.points([t,n,i[2],i[3]]),a===M&&e.points([i[0],i[1],t,n])}}))}}),[M]),F=Object(s.useCallback)((function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&(P(e.target.id()),D.current.x=n.x,D.current.y=n.y)}),[]);Object(s.useEffect)((function(){"undefined"!==typeof M&&(R.current&&clearInterval(R.current),R.current=setInterval(J,100))}),[M,J]);var X=Object(s.useCallback)((function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&(D.current.x=n.x,D.current.y=n.y)}),[]),G=Object(s.useCallback)((function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();if(n){R.current&&clearInterval(R.current),D.current.x=0,D.current.y=0,P(void 0);var r=S([n.x,n.y],b),c=Object(v.a)(r,2),a=c[0],i=c[1];d({id:e.target.id(),x:a,y:i,pin:e.target.attrs.pin})}}),[d,b]),L=Object(s.useCallback)((function(e){var n=e.currentTarget.id(),r=!1;"select"===t?(p({type:"forces",id:n}),r=!0):"delete"===t&&(O(n),r=!0),e.cancelBubble=r}),[O,p,t]),Y=Object(s.useCallback)((function(e){if("select"===t){var n,r=null===(n=e.target.getStage())||void 0===n?void 0:n.getPointerPosition(),c=o.find((function(t){return t.id===e.currentTarget.id()}));r&&c&&m("forces",{top:r.y,left:r.x},c)}}),[o,m,t]),U=Object(s.useCallback)((function(e){var n=e.currentTarget.id(),r=!1;"select"===t?(p({type:"trapezoids",id:n}),r=!0):"delete"===t&&(h(n),r=!0),e.cancelBubble=r}),[h,p,t]),Z=Object(s.useCallback)((function(e){if("select"===t){var n,r=null===(n=e.target.getStage())||void 0===n?void 0:n.getPointerPosition(),c=u.find((function(t){return t.id===e.currentTarget.id()}));r&&c&&m("trapezoids",{top:r.y,left:r.x},c)}}),[m,t,u]);return Object(A.jsxs)(ne.e,{ref:k,children:[a.map((function(e,t){return Object(A.jsx)(fe,Object(I.a)(Object(I.a)({ref:function(e){return C.current[t]=e}},e),{},{points:T(e.nodeI,e.nodeJ),selected:g({type:"beams",id:e.id}),onClick:W}),e.id)})),r.map((function(e,t){return Object(A.jsx)(Ce,Object(I.a)(Object(I.a)({ref:function(e){return y.current[t]=e}},e),{},{draggable:N,isDragging:M===e.id,onDblClick:B,onDragStart:F,onDragMove:X,onDragEnd:G}),e.id)})),o.map((function(e){return Object(A.jsx)(Oe,Object(I.a)(Object(I.a)({},e),{},{ratio:e.force/l,points:_(e.beam),visible:!Boolean(M),selected:g({type:"forces",id:e.id}),onClick:L,onDblClick:Y}),e.id)})),u.map((function(e){return Object(A.jsx)(Ie,Object(I.a)(Object(I.a)({},e),{},{points:_(e.beam),visible:!Boolean(M),selected:g({type:"trapezoids",id:e.id}),onClick:U,onDblClick:Z}),e.id)}))]})},De=n(31),Re=n(188),Te=n(165),_e=n(176),We=n(190),Be=n(183),Je=["values"],Ae=function(e){var t=e.force,n=e.onChange,r=e.onClose,c=Object(s.useState)(""),a=Object(v.a)(c,2),i=a[0],o=a[1],l=Object(s.useState)(),u=Object(v.a)(l,2),b=u[0],d=u[1],j=Object(s.useCallback)((function(e){if(e.preventDefault(),e.currentTarget.checkValidity()&&"undefined"===typeof b){var c=parseFloat(i);isNaN(c)||(n(Object(I.a)(Object(I.a)({},t),{},{force:c})),r())}}),[b,n,r,i,t]),f=Object(s.useCallback)((function(e){var t,n=e.currentTarget.value;o(n),0===n.length&&(t="\u6570\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044");var r=parseFloat(n);isNaN(r)&&(t="\u6570\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"),(0>r||r>Number.MAX_SAFE_INTEGER)&&(t="0 \u3088\u308a\u5927\u304d\u3044\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"),d(t)}),[]);return Object(s.useEffect)((function(){o("".concat(t.force)),d(void 0)}),[t]),Object(A.jsx)(Re.a,{children:Object(A.jsxs)(Te.a,{direction:"column",spacing:1,sx:{p:1,width:240},component:"form",autoComplete:"off",noValidate:!0,onSubmit:j,children:[Object(A.jsx)(_e.a,{variant:"outlined",margin:"dense",size:"small",label:"\u96c6\u4e2d\u8377\u91cd",value:i,required:!0,fullWidth:!0,onChange:f,InputProps:{endAdornment:Object(A.jsx)(We.a,{position:"end",children:"kN"})},error:Boolean(b),helperText:b}),Object(A.jsxs)(Te.a,{direction:"row",justifyContent:"flex-end",spacing:1,children:[Object(A.jsx)(Be.a,{size:"small",onClick:r,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),Object(A.jsx)(Be.a,{type:"submit",size:"small",variant:"contained",children:"OK"})]})]})})},Fe=function(e){var t=e.values,n=Object(De.a)(e,Je),r=Object(s.useMemo)((function(){return N(t)?t:{id:"",name:"",beam:"",force:0,distanceI:0}}),[t]);return Object(A.jsx)(Ae,Object(I.a)(Object(I.a)({},n),{},{force:r}))},Xe=n(90),Ge=n.n(Xe),Le=n(98),Ye=n(184),Ue=n(191),Ze=["title","titleId"];function Ve(){return Ve=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ve.apply(this,arguments)}function He(e,t){if(null==e)return{};var n,r,c=function(e,t){if(null==e)return{};var n,r,c={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(c[n]=e[n]);return c}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}function qe(e,t){var n=e.title,r=e.titleId,c=He(e,Ze);return s.createElement("svg",Ve({id:"svg",viewBox:"0 0 160 160",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},c),n?s.createElement("title",{id:r},n):null,o||(o=s.createElement("path",{d:"M80 0 L30 80 L130 80 Z",strokeWidth:6,stroke:"gray",fill:"transparent"})))}var Ke,Qe,$e,et,tt=s.forwardRef(qe),nt=(n.p,["title","titleId"]);function rt(){return rt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},rt.apply(this,arguments)}function ct(e,t){if(null==e)return{};var n,r,c=function(e,t){if(null==e)return{};var n,r,c={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(c[n]=e[n]);return c}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}function at(e,t){var n=e.title,r=e.titleId,c=ct(e,nt);return s.createElement("svg",rt({id:"svg",viewBox:"0 0 160 160",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},c),n?s.createElement("title",{id:r},n):null,Ke||(Ke=s.createElement("path",{d:"M80 0 L30 80 L130 80 Z",strokeWidth:6,stroke:"gray",fill:"transparent"})),Qe||(Qe=s.createElement("circle",{stroke:"gray",strokeWidth:6,fill:"transparent",cx:45,cy:115,r:20})),$e||($e=s.createElement("circle",{stroke:"gray",strokeWidth:6,fill:"transparent",cx:115,cy:115,r:20})),et||(et=s.createElement("line",{x1:30,y1:150,x2:130,y2:150,stroke:"gray",strokeWidth:6})))}var it,ot,st,lt,ut=s.forwardRef(at),bt=(n.p,["title","titleId"]);function dt(){return dt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},dt.apply(this,arguments)}function jt(e,t){if(null==e)return{};var n,r,c=function(e,t){if(null==e)return{};var n,r,c={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(c[n]=e[n]);return c}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}function ft(e,t){var n=e.title,r=e.titleId,c=jt(e,bt);return s.createElement("svg",dt({id:"svg",style:{width:64},viewBox:"0 0 160 160",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},c),n?s.createElement("title",{id:r},n):null,it||(it=s.createElement("path",{d:"M30 3 L30 80 L130 80 L130 3 Z",strokeWidth:6,stroke:"gray",fill:"transparent"})),ot||(ot=s.createElement("circle",{stroke:"gray",strokeWidth:6,fill:"transparent",cx:45,cy:115,r:20})),st||(st=s.createElement("circle",{stroke:"gray",strokeWidth:6,fill:"transparent",cx:115,cy:115,r:20})),lt||(lt=s.createElement("line",{x1:30,y1:150,x2:130,y2:150,stroke:"gray",strokeWidth:6})))}var Ot,vt,ht,xt,pt,gt=s.forwardRef(ft),mt=(n.p,["title","titleId"]);function yt(){return yt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},yt.apply(this,arguments)}function Ct(e,t){if(null==e)return{};var n,r,c=function(e,t){if(null==e)return{};var n,r,c={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(c[n]=e[n]);return c}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}function wt(e,t){var n=e.title,r=e.titleId,c=Ct(e,mt);return s.createElement("svg",yt({id:"svg",style:{width:64},viewBox:"0 0 160 160",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},c),n?s.createElement("title",{id:r},n):null,Ot||(Ot=s.createElement("line",{x1:0,y1:3,x2:160,y2:3,stroke:"gray",strokeWidth:6})),vt||(vt=s.createElement("line",{x1:20,y1:0,x2:0,y2:60,stroke:"gray",strokeWidth:6})),ht||(ht=s.createElement("line",{x1:60,y1:0,x2:40,y2:60,stroke:"gray",strokeWidth:6})),xt||(xt=s.createElement("line",{x1:100,y1:0,x2:80,y2:60,stroke:"gray",strokeWidth:6})),pt||(pt=s.createElement("line",{x1:140,y1:0,x2:120,y2:60,stroke:"gray",strokeWidth:6})))}var kt=s.forwardRef(wt),St=(n.p,["values"]),It={free:{type:"free",icon:Object(A.jsx)(Ge.a,{}),label:"\u5b8c\u5168\u30d5\u30ea\u30fc"},pin:{type:"pin",icon:Object(A.jsx)(Le.a,{sx:{width:24},viewBox:"0 0 160 160",children:Object(A.jsx)(tt,{})}),label:"\u5b8c\u5168\u30d4\u30f3"},pinX:{type:"pinX",icon:Object(A.jsx)(Le.a,{sx:{width:24},viewBox:"0 0 160 160",children:Object(A.jsx)(ut,{})}),label:"\u30d4\u30f3X\u30ed\u30fc\u30e9\u30fc"},pinZ:{type:"pinZ",icon:Object(A.jsx)(Le.a,{sx:{width:24,transform:"rotate(-90deg)"},viewBox:"0 0 160 160",children:Object(A.jsx)(ut,{})}),label:"\u30d4\u30f3Z\u30ed\u30fc\u30e9\u30fc"},fixX:{type:"fixX",icon:Object(A.jsx)(Le.a,{sx:{width:24},viewBox:"0 0 160 160",children:Object(A.jsx)(gt,{})}),label:"\u56fa\u5b9aX\u30ed\u30fc\u30e9\u30fc"},fix:{type:"fix",icon:Object(A.jsx)(Le.a,{sx:{width:24},viewBox:"0 0 160 160",children:Object(A.jsx)(kt,{})}),label:"\u5b8c\u5168\u56fa\u5b9a"}},Et={sx:{justifyContent:"flex-start",alignItems:"center"}},zt=function(e){var t=e.node,n=e.onChange,r=e.onClose,c=Object(s.useState)(),a=Object(v.a)(c,2),i=a[0],o=a[1],l=Object(s.useCallback)((function(e){e.preventDefault();var c=Object(I.a)(Object(I.a)({},t),{},{pin:i});n(c),r()}),[t,n,r,i]),u=Object(s.useCallback)((function(e,t){var n;null!==t&&("string"===typeof(n=t)&&M.some((function(e){return e===n})))&&o(t)}),[]);return Object(s.useEffect)((function(){var e;o(null!==(e=t.pin)&&void 0!==e?e:"free")}),[t.pin]),Object(A.jsx)(Re.a,{children:Object(A.jsxs)(Te.a,{direction:"column",spacing:1,sx:{p:1,width:240},component:"form",autoComplete:"off",noValidate:!0,onSubmit:l,children:[Object(A.jsx)(Ye.a,{orientation:"vertical",value:i,size:"small",exclusive:!0,fullWidth:!0,onChange:u,children:Object.entries(It).map((function(e){var t=Object(v.a)(e,2),n=t[0],r=t[1],c=r.icon,a=r.label;return Object(A.jsxs)(Ue.a,Object(I.a)(Object(I.a)({value:n},Et),{},{children:[c,Object(A.jsx)(q.a,{variant:"caption",sx:{ml:1},children:a})]}),n)}))}),Object(A.jsxs)(Te.a,{direction:"row",justifyContent:"flex-end",spacing:1,children:[Object(A.jsx)(Be.a,{size:"small",onClick:r,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),Object(A.jsx)(Be.a,{type:"submit",size:"small",variant:"contained",children:"OK"})]})]})})},Mt=function(e){var t=e.values,n=Object(De.a)(e,St),r=Object(s.useMemo)((function(){return P(t)?t:{id:"",x:0,y:0}}),[t]);return Object(A.jsx)(zt,Object(I.a)(Object(I.a)({},n),{},{node:r}))},Pt=n(3),Nt=n(192),Dt=n(178),Rt=["values"],Tt=function(e){if(0===e.length)return[NaN,!1,"\u6570\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"];var t=parseFloat(e);return isNaN(t)?[NaN,!1,"\u6570\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"]:0>=t&&t>Number.MAX_SAFE_INTEGER?[t,!1,"0 \u4ee5\u4e0a\u306e\u6570\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"]:[w(t,3),!0,""]},_t=function(e){if(e.length>0){var t=parseInt(e,10);return isNaN(t)||e.indexOf(".")>=0?[NaN,!1,"\u6574\u6570\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"]:-180>t||180<t?[t,!1,"-180 \u301c 180 \u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"]:(-180===t&&(t=180),[t,!0,""])}return[90,!0,""]},Wt=function(e){var t,n,r,c,a,i,o,l=e.trapezoid,u=e.onChange,b=e.onClose,d=Object(s.useState)({}),j=Object(v.a)(d,2),f=j[0],O=j[1],h=Object(s.useState)({}),x=Object(v.a)(h,2),p=x[0],g=x[1],m=Object(s.useCallback)((function(e){if((e.preventDefault(),e.currentTarget.checkValidity())&&!Object.values(p).some((function(e){return e.length>0}))){var t=function(e){var t,n,r,c,a={forceI:0,forceJ:0,angle:90,isGlobal:!1},i=Tt(null!==(t=e.forceI)&&void 0!==t?t:""),o=Object(v.a)(i,2),s=o[0],l=o[1],u=Tt(null!==(n=e.forceJ)&&void 0!==n?n:""),b=Object(v.a)(u,2),d=b[0],j=b[1],f=_t(null!==(r=e.angle)&&void 0!==r?r:""),O=Object(v.a)(f,2),h=O[0],x=O[1],p=l&&j&&x;return a.forceI=s,a.forceJ=d,a.angle=h,a.isGlobal=null!==(c=e.isGlobal)&&void 0!==c&&c,[p,a]}(f),n=Object(v.a)(t,2),r=n[0],c=n[1];console.log(r,c),r&&u(Object(I.a)(Object(I.a)({},l),c)),b()}}),[p,u,b,l,f]),y=Object(s.useCallback)((function(e){var t=e.target,n=t.name,r=t.value,c="";switch(n){case"forceI":case"forceJ":var a=Tt(r),i=Object(v.a)(a,3),o=i[1],s=i[2];o||(c=s);break;case"angle":var l=_t(r),u=Object(v.a)(l,3),b=u[1],d=u[2];b||(c=d)}g((function(e){return Object(I.a)(Object(I.a)({},e),{},Object(Pt.a)({},n,c))})),O((function(e){return Object(I.a)(Object(I.a)({},e),{},Object(Pt.a)({},n,r))}))}),[]),C=Object(s.useCallback)((function(e){var t=e.target.checked;O((function(e){return Object(I.a)(Object(I.a)({},e),{},{isGlobal:t})}))}),[]);return Object(s.useEffect)((function(){O(function(e){var t,n={};return n.forceI="".concat(e.forceI),n.forceJ="".concat(e.forceJ),n.angle="".concat(null!==(t=e.angle)&&void 0!==t?t:""),n.isGlobal=e.isGlobal,n}(l)),g({})}),[l]),Object(A.jsx)(Re.a,{children:Object(A.jsxs)(Te.a,{direction:"column",spacing:1,sx:{p:1,width:240},component:"form",autoComplete:"off",noValidate:!0,onSubmit:m,children:[Object(A.jsx)(_e.a,{variant:"outlined",margin:"dense",size:"small",label:"I\u7aef\u5074\u306e\u8377\u91cd",name:"forceI",value:null!==(t=f.forceI)&&void 0!==t?t:"",required:!0,fullWidth:!0,onChange:y,InputProps:{endAdornment:Object(A.jsx)(We.a,{position:"end",children:"kN/m"})},error:Boolean(p.forceI),helperText:null!==(n=p.forceI)&&void 0!==n?n:""}),Object(A.jsx)(_e.a,{variant:"outlined",margin:"dense",size:"small",label:"J\u7aef\u5074\u306e\u8377\u91cd",name:"forceJ",value:null!==(r=f.forceJ)&&void 0!==r?r:"",required:!0,fullWidth:!0,onChange:y,InputProps:{endAdornment:Object(A.jsx)(We.a,{position:"end",children:"kN/m"})},error:Boolean(p.forceJ),helperText:null!==(c=p.forceJ)&&void 0!==c?c:""}),Object(A.jsx)(_e.a,{variant:"outlined",margin:"dense",size:"small",label:"\u89d2\u5ea6",name:"angle",value:null!==(a=f.angle)&&void 0!==a?a:"",fullWidth:!0,onChange:y,InputProps:{endAdornment:Object(A.jsx)(We.a,{position:"end",children:"\xb0"})},error:Boolean(p.angle),helperText:null!==(i=p.angle)&&void 0!==i?i:""}),Object(A.jsx)(Nt.a,{label:"\u5168\u4f53\u5ea7\u6a19\u7cfb",control:Object(A.jsx)(Dt.a,{name:"isGlobal",size:"small",checked:null!==(o=f.isGlobal)&&void 0!==o&&o,onChange:C})}),Object(A.jsxs)(Te.a,{direction:"row",justifyContent:"flex-end",spacing:1,children:[Object(A.jsx)(Be.a,{size:"small",onClick:b,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),Object(A.jsx)(Be.a,{type:"submit",size:"small",variant:"contained",children:"OK"})]})]})})},Bt=function(e){var t=e.values,n=Object(De.a)(e,Rt),r=Object(s.useMemo)((function(){return D(t)?t:{id:"",name:"",beam:"",forceI:0,distanceI:0,forceJ:0,distanceJ:0}}),[t]);return Object(A.jsx)(Wt,Object(I.a)(Object(I.a)({},n),{},{trapezoid:r}))},Jt=function(){var e=Object(s.useContext)(Me),t=e.popupType,n=e.popupPosition,r=e.popupParams,c=e.close,a=Object(s.useContext)(ce),i=a.onChangeNode,o=a.onChangeForce,l=a.onChangeTrapezoid;return"undefined"===typeof t?null:Object(A.jsxs)(Z.a,{sx:Object(I.a)({position:"absolute",zIndex:5e3},n),children:["forces"===t&&Object(A.jsx)(Fe,{values:null!==r&&void 0!==r?r:{},onClose:c,onChange:o}),"trapezoids"===t&&Object(A.jsx)(Bt,{values:null!==r&&void 0!==r?r:{},onClose:c,onChange:l}),"nodes"===t&&Object(A.jsx)(Mt,{values:null!==r&&void 0!==r?r:{},onClose:c,onChange:i})]})},At=function(e,t){var n=Object(s.useContext)(F).mode,r=Object(s.useContext)(ce),c=r.tool,a=r.size,i=r.getStructure,o=r.clearSelection,l=Object(s.useContext)(Me).close,u=Object(s.useContext)(se),b=u.onPointerDown,d=u.onPointerMove,j=u.onPointerUp,f=re(ce,Me,se),O=Object(s.useRef)(null);Object(s.useImperativeHandle)(t,(function(){return{toDataURL:function(){if(O.current)return O.current.toDataURL()},getStructure:i}}),[i]);var v=Object(s.useCallback)((function(e){l(),"select"===c&&o()}),[o,l,c]);return Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(ne.h,{ref:O,width:a.width,height:a.height,listening:"canvas"===n,onClick:v,onTap:v,onPointerDown:b,onPointerMove:d,onPointerUp:j,children:Object(A.jsxs)(f,{children:[Object(A.jsx)(de,{}),Object(A.jsx)(ze,{}),Object(A.jsx)(Ne,{}),Object(A.jsx)(ue,{})]})}),Object(A.jsx)(Jt,{})]})},Ft=Object(s.forwardRef)(At),Xt=function(e,t){var n=e.tool,r=void 0===n?"select":n,c=e.structure,a=e.readonly,i=void 0!==a&&a,o=Object(s.useState)({width:0,height:0}),l=Object(v.a)(o,2),u=l[0],b=l[1],d=Object(s.useRef)(null),j=Object(s.useRef)(null);return Object(s.useImperativeHandle)(t,(function(){return{toDataURL:function(){if(j.current)return j.current.toDataURL()},getStructure:function(){return j.current?j.current.getStructure():R}}}),[]),Object(s.useEffect)((function(){var e=new ResizeObserver((function(e){var t=e[0].contentRect,n=t.width,r=t.height;b({width:n,height:r})}));return d.current&&e.observe(d.current),function(){e.disconnect()}}),[]),Object(A.jsx)(Z.a,{ref:d,sx:{width:"auto",height:"100%",backgroundColor:"#ffffff",overscrollBehavior:"contain"},children:Object(A.jsx)(ae,{tool:r,size:u,structure:c,readonly:i,children:Object(A.jsx)(le,{children:Object(A.jsx)(Pe,{children:Object(A.jsx)(Ft,{ref:j})})})})})},Gt=Object(s.forwardRef)(Xt),Lt=Object(s.createContext)(void 0),Yt=function(e){var t=e.children,n=Object(s.useRef)(),r=Object(s.useState)([]),c=Object(v.a)(r,2),a=c[0],i=c[1],o=Object(s.useContext)(F),l=o.mode,u=o.addDrawing,b=Object(s.useContext)(Y),d=b.mode,j=b.settings,f=Object(s.useCallback)((function(e){if("note"===l&&"edit"===d){var t=e.target.getStage();if(t){n.current=!0;var r=t.getPosition(),c=r.x,a=r.y,o=t.getPointerPosition();o&&i([o.x+Math.abs(c),o.y+Math.abs(a)])}}}),[l,d]),h=Object(s.useCallback)((function(e){if("edit"===d&&n.current){var t=e.target.getStage();if(t){var r=t.getPosition(),c=r.x,a=r.y,o=t.getPointerPosition();o&&i((function(e){return[].concat(Object(O.a)(e),[o.x+Math.abs(c),o.y+Math.abs(a)])}))}}}),[d]),x=Object(s.useCallback)((function(e){"note"===l&&"edit"===d&&n.current&&(n.current=!1,u(Object(I.a)({points:a},j)),i([]))}),[u,l,d,a,j]);return Object(A.jsx)(Lt.Provider,{value:{points:a,onPointerDown:f,onPointerMove:h,onPointerUp:x},children:t})},Ut=["eraser"],Zt=function(){var e=Object(s.useContext)(F).drawings,t=Object(s.useContext)(Y).settings,n=Object(s.useContext)(Lt).points;return Object(A.jsxs)(ne.e,{children:[e.map((function(e,t){var n=e.eraser,r=void 0!==n&&n,c=Object(De.a)(e,Ut);return Object(A.jsx)(ne.f,Object(I.a)(Object(I.a)({lineCap:"round",lineJoin:"round",tension:.5},c),{},{globalCompositeOperation:r?"destination-out":"source-over"}),"note-drawing-".concat(t))})),n&&Object(A.jsx)(ne.f,Object(I.a)(Object(I.a)({lineCap:"round",lineJoin:"round",tension:.5,points:n},t),{},{globalCompositeOperation:t.eraser?"destination-out":"source-over"}))]})},Vt=n(91),Ht=n.n(Vt),qt=n(92),Kt=n.n(qt),Qt=n(93),$t=n.n(Qt),en=n(8),tn=n(194),nn=n(94),rn=n(179),cn=n(96),an=Object(en.a)("div")({display:"flex",alignItems:"center",width:"100%",padding:"0 8"}),on=Object(en.a)("div")({flex:1}),sn=function(e){var t=e.visible,n=void 0!==t&&t,r=e.mode,c=e.y,a=e.x,i=e.width,o=e.onEdit,l=e.onCopy,u=e.onDelete,b=e.onCancel,d=Object(s.useState)(null),j=Object(v.a)(d,2),f=j[0],O=j[1],h=Object(s.useCallback)((function(e){O(e.currentTarget)}),[]),x=Object(s.useCallback)((function(){O(null)}),[]);return n?Object(A.jsxs)(cn.a,{divProps:{style:{top:"".concat(c-42,"px"),left:"".concat(a,"px"),width:"".concat(i,"px")}},children:[Object(A.jsxs)(an,{children:["canvas"===r&&Object(A.jsx)(tn.a,{size:"small",onClick:b,children:Object(A.jsx)(Ht.a,{})}),"note"===r&&Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(tn.a,{size:"small",onClick:o,children:Object(A.jsx)(Kt.a,{})}),Object(A.jsx)(on,{}),Object(A.jsx)(tn.a,{size:"small",onClick:h,children:Object(A.jsx)($t.a,{})})]})]}),Object(A.jsxs)(nn.a,{anchorEl:f,open:Boolean(f),onClose:x,children:[Object(A.jsx)(rn.a,{onClick:l,children:"\u30b3\u30d4\u30fc"}),Object(A.jsx)(rn.a,{onClick:u,children:"\u524a\u9664"})]})]}):null},ln=["appMode","noteMode","pageSize","draggable","index","onChange","selected","onSelect","data","image","onEditCanvas","onCloseCanvas"],un=function(e){var t=e.appMode,n=e.noteMode,r=e.pageSize,c=e.draggable,a=void 0!==c&&c,i=e.index,o=e.onChange,l=e.selected,u=void 0!==l&&l,b=e.onSelect,d=(e.data,e.image),j=e.onEditCanvas,f=e.onCloseCanvas,O=Object(De.a)(e,ln),h=Object(s.useRef)(null),x=Object(s.useRef)(null),p=Object(s.useState)(!1),g=Object(v.a)(p,2),m=g[0],y=g[1],w=ge()(null!==d&&void 0!==d?d:""),k=Object(v.a)(w,1)[0],S=Object(s.useMemo)((function(){return u&&!m&&"select"===n}),[m,n,u]),E=Object(s.useMemo)((function(){return a&&u}),[a,u]);Object(s.useEffect)((function(){var e;u&&x.current&&h.current&&(x.current.nodes([h.current]),null===(e=x.current.getLayer())||void 0===e||e.batchDraw())}),[u]);var z=Object(s.useCallback)((function(e){o((function(t){var n=C(t),r=n[i];return n[i]=Object(I.a)(Object(I.a)({},r),e),n}))}),[i,o]),M=Object(s.useCallback)((function(){y(!0)}),[]),P=Object(s.useCallback)((function(e){if(e.cancelBubble=!0,h.current){var t=e.target.attrs,n=t.x,c=t.y;if("number"===typeof n&&"number"===typeof c){var a=h.current.getSize(),i=a.width,o=a.height,s=n,l=c;s<0?s=0:s>r.width-i&&(s=r.width-i),l<0?l=0:l>r.height-o&&(l=r.height-o),n===s&&c===l||h.current.setPosition({x:s,y:l})}}}),[r.height,r.width]),N=Object(s.useCallback)((function(e){if(h.current){var t=h.current.getPosition(),n=t.x,r=t.y,c=h.current.getSize(),a={x:n,y:r,width:c.width,height:c.height};y(!1),z(a)}}),[z]),D=Object(s.useCallback)((function(e,t){return t.width<W.width||t.height<W.height?e:t}),[]),R=Object(s.useCallback)((function(){if(h.current){var e=h.current,t=e.scale(),n=t.x,r=t.y;e.scale({x:1,y:1});var c={x:e.x(),y:e.y(),width:Math.max(W.width,e.width()*n),height:Math.max(W.height,e.height()*r)};z(c)}}),[z]),T=Object(s.useCallback)((function(e){var t=e.currentTarget.getBoundingClientRect(),n=t.top,r={x:t.left,y:n+42,width:O.width,height:O.height};j(r)}),[j,O.height,O.width]);return Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(ne.g,Object(I.a)(Object(I.a)({},O),{},{fill:"white"})),k&&Object(A.jsx)(ne.d,Object(I.a)(Object(I.a)({},O),{},{image:k})),Object(A.jsx)(ne.g,Object(I.a)(Object(I.a)({ref:h,stroke:"black",strokeWidth:2,draggable:a},O),{},{onClick:b,onTap:b,onDragStart:M,onDragMove:P,onDragEnd:N,onTransformEnd:R})),Object(A.jsx)(sn,Object(I.a)(Object(I.a)({visible:S,mode:t},O),{},{onEdit:T,onCancel:f})),Object(A.jsx)(ne.j,{ref:x,visible:E,rotateEnabled:!1,boundBoxFunc:D})]})},bn=function(){var e=Object(s.useContext)(Y).mode,t=Object(s.useContext)(F),n=t.mode,r=t.pageSize,c=t.structures,a=t.onChangeStructures,i=t.selectedCanvasIndex,o=t.onSelectCanvas,l=t.editCanvas,u=t.closeCanvas,b=Object(s.useMemo)((function(){return"note"===n&&"select"===e}),[n,e]),d=Object(s.useCallback)((function(e){"note"===n&&"background"===e.target.attrs.type&&o(void 0)}),[n,o]);return Object(A.jsxs)(ne.e,{children:[Object(A.jsx)(ne.g,Object(I.a)(Object(I.a)({x:0,y:0},r),{},{attrs:{type:"background"},onClick:d,onTap:d})),c.map((function(t,c){return Object(A.jsx)(un,Object(I.a)({appMode:n,noteMode:e,pageSize:r,draggable:b,index:c,onChange:a,selected:c===i,onSelect:function(){return o(c)},onEditCanvas:l,onCloseCanvas:u},t),"handle-".concat(c))}))]})},dn={id:"",points:[],stroke:"#c9e1ff",strokeWidth:1,dash:[5,3],listening:!1},jn=function(e){var t=e.pageSize,n=Object(s.useMemo)((function(){for(var e=[],n=1,r=0;r<=t.height;r+=50)e.push(Object(I.a)(Object(I.a)({},dn),{},{id:"Horizontal_".concat(n),points:[0,r,t.width,r]})),n++;return e}),[t]),r=Object(s.useMemo)((function(){for(var e=[],n=1,r=0;r<=t.width;r+=50)e.push(Object(I.a)(Object(I.a)({},dn),{},{id:"Vertical_".concat(n),points:[r,0,r,t.height]})),n++;return e}),[t]);return Object(A.jsxs)(ne.e,{children:[n.map((function(e){return Object(A.jsx)(ne.f,Object(I.a)({},e),e.id)})),r.map((function(e){return Object(A.jsx)(ne.f,Object(I.a)({},e),e.id)}))]})},fn=function(e){var t=e.viewBox,n=Object(s.useRef)(null),r=Object(s.useContext)(Y).mode,c=Object(s.useContext)(F),a=c.mode,i=c.pageSize,o=Object(s.useContext)(Lt),l=o.onPointerDown,u=o.onPointerUp,b=o.onPointerMove,d=re(F,G,Y,Lt),j=Object(s.useMemo)((function(){return"note"===a&&"pan"===r}),[a,r]),f=Object(s.useCallback)((function(e){var r=e.target.attrs,c=r.x,a=r.y;if(n.current&&"number"===typeof c&&"number"===typeof a){var o=c,s=a,l=!1;o>0?(o=0,l=!0):Math.abs(o)+t.width>i.width&&(o=t.width-i.width,l=!0),s>0?(s=0,l=!0):Math.abs(s)+t.height>i.height&&(s=t.height-i.height,l=!0),l&&n.current.setPosition({x:o,y:s})}}),[i.height,i.width,t.height,t.width]);return Object(A.jsx)(ne.h,{ref:n,width:t.width,height:t.height,draggable:j,onDragMove:f,onPointerDown:l,onPointerMove:b,onPointerUp:u,listening:"note"===a,children:Object(A.jsxs)(d,{children:[Object(A.jsx)(jn,{pageSize:i}),Object(A.jsx)(bn,{}),Object(A.jsx)(Zt,{})]})})},On=function(){var e=Object(s.useRef)(null),t=Object(s.useState)({width:0,height:0}),n=Object(v.a)(t,2),r=n[0],c=n[1];return Object(s.useEffect)((function(){var t=new ResizeObserver((function(e){var t=e[0].contentRect,n=t.width,r=t.height;c({width:n,height:r})}));return e.current&&t.observe(e.current),function(){t.disconnect()}}),[]),Object(A.jsx)(Z.a,{ref:e,sx:{width:"auto",height:"100%",maxWidth:1e3,maxHeight:1e3,backgroundColor:"#ffffff",overscrollBehavior:"contain",overflow:"hidden"},children:Object(A.jsx)(Yt,{children:Object(A.jsx)(fn,{viewBox:r})})})},vn=function(){var e=Object(s.useContext)(F),t=e.structures,n=e.selectedCanvasIndex,r=e.canvasProps,c=e.canvasRef,a=Object(s.useContext)(G).tool,i=Object(s.useMemo)((function(){if("number"===typeof n)return t[n].data}),[n,t]);return Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(Z.a,{sx:{boxSizing:"border-box",ml:1,mb:1,flex:1,border:function(e){return"1px solid ".concat(e.palette.divider)},borderRadius:1,maxWidth:1e3,maxHeight:1e3,overflow:"hidden"},children:Object(A.jsx)(On,{})}),r&&Object(A.jsx)(Z.a,{sx:{position:"absolute",top:r.y,left:r.x,width:r.width,height:r.height},children:Object(A.jsx)(Gt,{ref:c,tool:a,structure:null!==i&&void 0!==i?i:R})})]})},hn=n(168),xn=n(169),pn=n(170),gn=n(171),mn=n(172),yn={select:{tool:"select",icon:Object(A.jsx)(hn.a,{}),label:"\u9078\u629e"},pen:{tool:"pen",icon:Object(A.jsx)(xn.a,{}),label:"\u6881\u8981\u7d20\u306e\u63cf\u753b"},force:{tool:"force",icon:Object(A.jsx)(pn.a,{}),label:"\u96c6\u4e2d\u8377\u91cd\u306e\u8ffd\u52a0"},trapezoid:{tool:"trapezoid",icon:Object(A.jsx)(gn.a,{}),label:"\u5206\u5e03\u8377\u91cd\u306e\u8ffd\u52a0"},delete:{tool:"delete",icon:Object(A.jsx)(mn.a,{}),label:"\u8981\u7d20\u306e\u524a\u9664"}},Cn=function(e){var t=e.tool,n=e.onChange,r=Object(s.useCallback)((function(e,t){var r;null!==t&&("string"===typeof(r=t)&&ie.some((function(e){return e===r})))&&n(t)}),[n]);return Object(A.jsxs)(Te.a,{sx:{width:160},alignItems:"flex-start",children:[Object(A.jsx)(q.a,{variant:"caption",children:"Toolbox"}),Object(A.jsx)(Ye.a,{orientation:"vertical",value:t,exclusive:!0,fullWidth:!0,onChange:r,children:Object.entries(yn).map((function(e){var t=Object(v.a)(e,2),n=t[0],r=t[1],c=r.icon,a=r.label;return Object(A.jsxs)(Ue.a,{value:n,sx:{justifyContent:"flex-start",alignItems:"center"},children:[c,Object(A.jsx)(q.a,{variant:"caption",sx:{ml:1},children:a})]},n)}))})]})},wn=function(){var e=Object(s.useContext)(G),t=e.tool,n=e.setTool;return Object(A.jsx)(Cn,{tool:t,onChange:n})},kn=n(173),Sn=n(174),In=n(180),En=["pen","eraser"],zn={pan:{mode:"pan",icon:Object(A.jsx)(kn.a,{}),label:"\u30d1\u30f3"},select:{mode:"select",icon:Object(A.jsx)(hn.a,{}),label:"\u9078\u629e"},edit:{mode:"edit",icon:Object(A.jsx)(xn.a,{}),label:"\u63cf\u753b"}},Mn={pen:{mode:"pen",icon:Object(A.jsx)(xn.a,{}),label:"\u30da\u30f3\u30c4\u30fc\u30eb"},eraser:{mode:"eraser",icon:Object(A.jsx)(Sn.a,{}),label:"\u6d88\u3057\u30b4\u30e0"}},Pn=function(e){var t=e.mode,n=e.settings,r=e.onChangeMode,c=e.onChangeDrawSettings,a=Object(s.useCallback)((function(e,t){var n;null!==t&&("string"===typeof(n=t)&&T.some((function(e){return e===n})))&&r(t)}),[r]),i=Object(s.useCallback)((function(e,t){var n;null!==t&&("string"===typeof(n=t)&&En.some((function(e){return e===n})))&&c((function(e){return Object(I.a)(Object(I.a)({},e),{},{eraser:"eraser"===t})}))}),[c]),o=Object(s.useCallback)((function(e,t){"number"===typeof t&&c((function(e){return Object(I.a)(Object(I.a)({},e),{},{strokeWidth:t})}))}),[c]),l=Object(s.useCallback)((function(e){if(e.target.checkValidity()){var t=e.target.value;c((function(e){return Object(I.a)(Object(I.a)({},e),{},{stroke:t})}))}}),[c]);return Object(A.jsxs)(Te.a,{sx:{width:160},alignItems:"flex-start",children:[Object(A.jsx)(q.a,{variant:"caption",children:"Toolbox"}),Object(A.jsx)(Ye.a,{orientation:"vertical",value:t,exclusive:!0,fullWidth:!0,onChange:a,children:Object.entries(zn).map((function(e){var t=Object(v.a)(e,2),n=t[0],r=t[1],c=r.icon,a=r.label;return Object(A.jsxs)(Ue.a,{value:n,sx:{justifyContent:"flex-start",alignItems:"center"},children:[c,Object(A.jsx)(q.a,{variant:"caption",sx:{ml:1},children:a})]},n)}))}),Object(A.jsx)(q.a,{variant:"caption",sx:{mt:1},children:"\u63cf\u753b\u30c4\u30fc\u30eb"}),Object(A.jsx)(Ye.a,{orientation:"vertical",value:n.eraser?"eraser":"pen",exclusive:!0,fullWidth:!0,disabled:"edit"!==t,onChange:i,children:Object.entries(Mn).map((function(e){var t=Object(v.a)(e,2),n=t[0],r=t[1],c=r.icon,a=r.label;return Object(A.jsxs)(Ue.a,{value:n,sx:{justifyContent:"flex-start",alignItems:"center"},children:[c,Object(A.jsx)(q.a,{variant:"caption",sx:{ml:1},children:a})]},n)}))}),Object(A.jsx)(q.a,{variant:"caption",sx:{mt:1},children:"\u592a\u3055"}),Object(A.jsx)(In.a,{sx:{ml:1,mb:2,boxSizing:"border-box",width:140},value:n.strokeWidth,min:4,max:20,step:4,marks:!0,valueLabelDisplay:"auto",disabled:"edit"!==t,onChange:o}),Object(A.jsx)(_e.a,{type:"color",label:"\u30da\u30f3\u306e\u8272",value:n.stroke,disabled:"edit"!==t||n.eraser,fullWidth:!0,margin:"dense",size:"small",onChange:l})]})},Nn=function(){var e=Object(s.useContext)(Y);return Object(A.jsx)(Pn,Object(I.a)({},e))},Dn=function(){return"canvas"===Object(s.useContext)(F).mode?Object(A.jsx)(wn,{}):Object(A.jsx)(Nn,{})},Rn=function(){var e=Object(s.useState)({width:0,height:0}),t=Object(v.a)(e,2),n=t[0],r=t[1],c=Object(s.useCallback)((function(){var e=window,t=e.innerHeight,n=e.innerWidth;r({height:t,width:n})}),[]);return Object(s.useEffect)((function(){return c(),window.addEventListener("resize",c),function(){window.removeEventListener("resize",c)}}),[c]),Object(A.jsxs)(Z.a,{sx:Object(I.a)(Object(I.a)({},n),{},{overflow:"hidden"}),children:[Object(A.jsx)(te,{}),Object(A.jsxs)(Z.a,{sx:{boxSizing:"border-box",width:"auto",height:"calc(100% - 48px)",display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"stretch",pt:1,px:1},children:[Object(A.jsx)(Dn,{}),Object(A.jsx)(vn,{})]})]})},Tn=Object(d.a)(),_n=function(){return Object(A.jsx)(j.a,{theme:Tn,children:Object(A.jsx)(X,{children:Object(A.jsx)(L,{children:Object(A.jsxs)(U,{children:[Object(A.jsx)(f.a,{}),Object(A.jsx)(Rn,{})]})})})})},Wn=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,195)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),r(e),c(e),a(e),i(e)}))};b.a.render(Object(A.jsx)(l.a.StrictMode,{children:Object(A.jsx)(_n,{})}),document.getElementById("root")),Wn()}},[[124,1,2]]]);
//# sourceMappingURL=main.4ed7b40d.chunk.js.map