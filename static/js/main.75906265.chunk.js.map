{"version":3,"sources":["components/Canvas/popup/pins/pin_1.svg","components/Canvas/util/vector.ts","components/Canvas/util/common.ts","components/Canvas/util/structure.ts","types/shape.ts","types/note.ts","providers/AppSettingsProvider.tsx","providers/ConfigurationProvider.tsx","providers/NoteSettingsProvider.tsx","components/Version.tsx","components/Header.tsx","types/common.ts","components/Canvas/provider/DrawProvider.tsx","components/Canvas/layer/DrawLayer.tsx","components/Canvas/provider/StructureProvider.tsx","components/Canvas/layer/GridLayer.tsx","components/Canvas/provider/SelectProvider.tsx","components/Canvas/shape/Beam.tsx","components/Canvas/provider/PopupProvider.tsx","components/Canvas/shape/Force.tsx","components/Canvas/shape/Guide.tsx","components/Canvas/shape/Node.tsx","components/Canvas/shape/Trapezoid.tsx","components/Canvas/layer/GuideLayer.tsx","components/Canvas/layer/ShapeLayer.tsx","components/Canvas/popup/ForceEditor.tsx","components/Canvas/popup/pins/pin_2.svg","components/Canvas/popup/pins/pin_3.svg","components/Canvas/popup/pins/pin_4.svg","components/Canvas/popup/PinSelector.tsx","components/Canvas/popup/TrapezoidEditor.tsx","components/Canvas/popup/index.tsx","components/Canvas/core.tsx","components/Canvas/index.tsx","components/Note/layer/Draw.tsx","components/Note/nodes/CanvasHandle/HeaderMenu.tsx","components/Note/nodes/CanvasHandle/index.tsx","components/Note/layer/Frame.tsx","components/Note/layer/Grid.tsx","components/Note/Page.tsx","hooks/useContextBridge.tsx","components/Note/index.tsx","components/MainContainer.tsx","components/Toolbox/CanvasToolbox.tsx","components/Toolbox/NoteToolbox.tsx","components/Toolbox/index.tsx","components/Layout.tsx","components/App.tsx","reportWebVitals.ts","index.tsx"],"names":["_path","vX","Vector","vY","lerp","v1","v2","alpha","dir","clone","subtract","normalize","distance","mv","multiplyScalar","add","verticalNormalizeVector","v","y","x","dot","invert","data","JSON","parse","stringify","round","value","figure","n","result","Math","snapping","snapSize","i","snap","createNode","id","uuid","NodePinTypes","emptyStructure","unit","force","length","nodes","beams","forces","trapezoids","NoteModes","PageSize","A3","width","height","A4","B4","B5","MinCanvasSize","defaultDrawSettings","stroke","strokeWidth","eraser","lineJoin","lineCap","defaultPageProps","size","drawings","structures","AppSettingsContext","createContext","undefined","AppSettingsProvider","children","useState","mode","setMode","page","setPage","selectedCanvasIndex","setCanvasIndex","canvasProps","setCanvasProps","canvasRef","useRef","editCanvas","useCallback","props","closeCanvas","current","structure","getStructure","image","toDataURL","state","Provider","onChangeMode","onChange","onSelectCanvas","ConfigurationContext","ConfigurationProvider","tool","setTool","NoteSettingsContext","NoteSettingsProvider","settings","setSettings","onChangeDrawSettings","hash","process","substring","date","version","Version","Typography","variant","sx","ml","Header","AppBar","position","Toolbar","component","color","CanvasTools","DrawContext","DrawProvider","readonly","points","setPoints","setStructure","isDrawing","beamRef","disabled","useMemo","handlePointerDown","event","target","attrs","beamId","beamPoints","item","Array","isArray","every","point","getStage","getPointerPosition","handlePointerMove","makeBeam","start","end","edgeI","edgeJ","nodeI","n1","find","node","push","nodeJ","n2","beam","name","createBeam","makeTrapezoid","trapezoid","pi","slice","pj","bi","bj","beamLength","beamDirection","ps","pe","disStart","disEnd","ti","angle","r","cos","tj","distanceI","distanceJ","forceI","forceJ","isGlobal","createTrapezoid","handlePointerUp","onPointerDown","onPointerMove","onPointerUp","DrawLayer","ConnectedDrawLayer","useContext","StructureContext","StructureProvider","gridSize","addForce","params","createForce","deleteForce","index","findIndex","splice","deleteTrapezoid","deleteBeam","forEach","exists","some","j","filter","defaultLineProps","dash","listening","GridLayer","horizontalLines","lines","count","verticalLines","map","SelectContext","SelectProvider","selected","setSelected","isSelected","type","select","toggle","Beam","onDelete","onSelect","labelPosition","setLabelPosition","labelWidth","setLabelWidth","labelAngle","setLabelAngle","guidePoints","setGuidePoints","viRef","vjRef","handleClick","cancelBubble","useEffect","vi","vj","label","angleDeg","guideDir","guideI","guideJ","onClick","onTap","rotation","text","fontSize","fill","align","wrap","ellipsis","Guide","ConnectedBeam","handleAddForce","vp","createForceParams","handleDelete","handleSelect","PopupContext","PopupProvider","popupType","setPopupType","popupPosition","setPopupPosition","popupParams","setPopupParams","open","close","top","left","Force","forceRatio","onEdit","setDistance","setRotation","tail","vertical","arrowLength","head","max","p","handleLabelClick","handleLabelDoubleClick","pointerLength","pointerWidth","offsetX","onDblClick","onDblTap","ConnectedForce","handleEdit","defaultGuideProps","defaultGuideArrowProps","pointerAtBeginning","GuideLine","v1Ref","v2Ref","basis","setBasis","dist","Pins","free","pin","pinX","pinZ","fixX","fix","Node","draggable","onCommit","isDragging","setIsDragging","pointRef","timerRef","imageUrl","useImage","redraw","handleDragStart","handleDragMove","handleDragEnd","clearInterval","handleDoubleClick","timer","setInterval","radius","onDragStart","onDragMove","onDragEnd","_useStrictMode","offsetY","ConnectedNode","Boolean","handleChange","px","py","values","handleCommit","targetId","newId","defaultArrowProps","defaultLabelProps","Trapezoid","arrows","setArrows","line","setLine","labelI","setLabelI","labelJ","setLabelJ","vI","vJ","vd","rotateDeg","direction","interval","getInsidePoints","slope","NaN","intercept","isNaN","insideArrows","pd","pu","targetLine","slope1","intercept1","slope2","intercept2","rangeX","sort","a","b","rangeY","err","console","error","intercectPoint","arrow","guidePosition","gi","gj","ConnectedTrapezoid","GuideInterval","GuideLayer","guide","maxX","Number","MIN_SAFE_INTEGER","minX","MAX_SAFE_INTEGER","guidesX","maxY","minY","guidesY","pointsX","Set","pointsY","has","array","from","prev","key","localX","GlobalVerticalGuidePositionX","GlobalHorizontalGuidePositionY","ShapeLayerCore","layerProps","items","average","reduce","c","Object","entries","ShapeLayer","ForceEditor","onClose","setValue","setError","handleSubmit","preventDefault","currentTarget","checkValidity","num","parseFloat","errorMessage","Paper","Stack","spacing","autoComplete","noValidate","onSubmit","TextField","margin","required","fullWidth","InputProps","endAdornment","InputAdornment","helperText","justifyContent","Button","ConnectedForceEditor","isForce","_extends","assign","arguments","source","prototype","hasOwnProperty","call","apply","this","_objectWithoutProperties","excluded","sourceKeys","keys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","SvgPin1","_ref","svgRef","title","titleId","viewBox","xmlns","ref","d","_circle","_circle2","_line","ForwardRef","SvgPin2","cx","cy","x1","y1","x2","y2","SvgPin3","style","_line2","_line3","_line4","_line5","SvgPin4","PinButtons","icon","SvgIcon","transform","defaultButtonProps","alignItems","PinSelector","setPin","_","newValue","ToggleButtonGroup","orientation","exclusive","ToggleButton","ConnectedPinSelector","isNode","validateForce","val","validateAngle","parseInt","TrapezoidEditor","setValues","errors","setErrors","value1","valid1","value2","valid2","value3","valid3","valid","parseFormValues","log","error1","error2","handleChangeIsGlobal","checked","toFormValues","FormControlLabel","control","Checkbox","ConnectedTrapezoidEditor","isTrapezoid","Popup","divProps","zIndex","handleChangeForce","handleChangeTrapezoid","handleChangeNode","CanvasCore","drawContextValues","useImperativeHandle","forwardRef","Canvas","setSize","containerRef","observer","ResizeObserver","contentRect","observe","disconnect","Box","backgroundColor","overscrollBehavior","Draw","lineProps","globalCompositeOperation","Background","styled","display","padding","Spacer","flex","HeaderMenu","visible","onCopy","onCancel","anchorEl","setAnchorEl","handleClickMore","handleCloseMenu","IconButton","Menu","MenuItem","CanvasHandle","dataURL","rectRef","tfRef","setDragging","noteMode","appMode","pageSize","visibleMenu","visibleTransformer","getLayer","batchDraw","rect","newPage","getSize","newX","newY","setPosition","getPosition","newRectProps","handleChangeBoundBox","oldBox","newBox","handleTransformEnd","scale","scaleX","scaleY","getBoundingClientRect","onTransformEnd","rotateEnabled","boundBoxFunc","Frame","Grid","layerSize","Page","stageRef","ContextBridge","contexts","cRef","React","context","reduceRight","acc","Context","useContextBridge","modified","abs","Note","setViewBox","overflow","MainContainer","boxSizing","mb","border","theme","palette","divider","borderRadius","ToolboxButtons","PanToolAlt","pen","ArrowDownward","Texture","delete","Delete","CanvasToolboxCore","CanvasToolbox","DrawModes","NoteModeButtons","edit","DrawModeButtons","AutoFixNormal","NoteToolboxCore","handleChangeMode","handleChangeTool","handleChangeStrokeWidth","handleChangeStroke","mt","Slider","min","step","marks","valueLabelDisplay","NoteToolbox","Toolbox","Layout","windowRect","setWindowRect","fitWindowSize","window","innerHeight","innerWidth","addEventListener","removeEventListener","flexDirection","flexWrap","pt","createTheme","App","ThemeProvider","CssBaseline","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.75906265.chunk.js","sourcesContent":["var _path;\n\nvar _excluded = [\"title\", \"titleId\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgPin1(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    id: \"svg\",\n    viewBox: \"0 0 160 160\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M80 0 L30 80 L130 80 Z\",\n    strokeWidth: 6,\n    stroke: \"gray\",\n    fill: \"transparent\"\n  })));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgPin1);\nexport default __webpack_public_path__ + \"static/media/pin_1.92d54adc.svg\";\nexport { ForwardRef as ReactComponent };","import Vector from 'victor';\n\nexport { Vector };\n\n// X方向のベクトル\nexport const vX = new Vector(1, 0);\n// Y方向のベクトル\nexport const vY = new Vector(0, 1);\n\n/**\n * v1 と v2 の間にある vp を取得する\n * @param v1\n * @param v2\n * @param alpha\n * @returns\n */\nexport const lerp = (v1: Vector, v2: Vector, alpha: number): Vector => {\n    if (alpha >= 1) {\n        return v2;\n    }\n    if (alpha <= 0) {\n        return v1;\n    }\n    const dir = v2.clone().subtract(v1).normalize();\n    const distance = v1.distance(v2);\n    const mv = dir.multiplyScalar(distance * alpha);\n    return v1.clone().add(mv);\n};\n\n/**\n * v1 と v2 に直交する単位ベクトルを返す\n * @param v1\n * @param v2\n * @returns\n */\nexport const verticalNormalizeVector = (v1: Vector, v2: Vector): Vector => {\n    const dir = v2.clone().subtract(v1).normalize();\n    const v = new Vector(dir.y, dir.x * -1).normalize();\n\n    const value = vY.dot(v);\n    if (value > 0) {\n        v.invert();\n    }\n\n    return v;\n};\n","import { Point } from '../types';\nimport { lerp, Vector } from './vector';\n\nexport const clone = <T>(data: T): T => {\n    return JSON.parse(JSON.stringify(data)) as T;\n};\n\nexport const round = (value: number, figure = 3): number => {\n    const n = 10 ** figure;\n    const result = Math.round(value * n) / n;\n    return result;\n};\n\nconst snapping = (value: number, snapSize = 25): number => {\n    const n = value / snapSize;\n    const i = Math.round(n) * snapSize;\n    return i;\n};\n\nexport const DEFAULT_SNAP_SIZE = 25;\n\nexport const snap = ([x, y]: [number, number], snapSize = DEFAULT_SNAP_SIZE): [number, number] => {\n    return [snapping(x, snapSize), snapping(y, snapSize)];\n};\n\nconst InsideArrowCount = 10;\nconst InsideArrowInterval = 25;\nconst InsideArrowMinInterval = 10;\n\n/**\n * 開始点から終了点まで等間隔に点を取る\n * @param start\n * @param end\n * @param direction\n * @returns\n */\nexport const getInsidePoints = (start: Vector, end: Vector, direction: Vector): Vector[] => {\n    const points: Vector[] = [];\n    // 2点間の距離\n    const distance = start.distance(end);\n    // 分割数\n    let count = InsideArrowCount;\n    // 間隔\n    let interval = distance / (count + 1);\n    while (interval < InsideArrowInterval && count > 0) {\n        count--;\n        interval = distance / (count + 1);\n    }\n\n    if (count > 0) {\n        // 始点から interval の間隔で count 個 点を取る\n        for (let i = 1; i <= count; i++) {\n            const point = start.clone().add(direction.clone().multiplyScalar(interval * i));\n            points.push(point);\n        }\n    } else {\n        // 半分にしてみる\n        interval = distance / 2;\n        if (interval >= InsideArrowMinInterval) {\n            // 半分の位置に点を置く\n            const point = lerp(start, end, 0.5);\n            points.push(point);\n        }\n    }\n\n    return points;\n};\n\n/**\n * 開始点からある方向に伸ばした線が対象となる線と交わる点を取得する\n * @param targetLine 対象となる Line [始点、終点、傾き、切片]\n * @param start 開始点\n * @param dir 方向\n * @returns 交点（なければ null）\n */\nexport const intercectPoint = (\n    targetLine: [Vector, Vector, number, number],\n    start: Vector,\n    dir: Vector\n): Point | null => {\n    const [pi, pj, slope1, intercept1] = targetLine;\n    let point: Point | null = null;\n    try {\n        // dir の傾き\n        const end: Vector = start.clone().add(dir);\n        const slope2 = end.x - start.x !== 0 ? (end.y - start.y) / (end.x - start.x) : NaN;\n        // dir の切片\n        const intercept2 = isNaN(slope2) ? NaN : start.y - slope2 * start.x;\n\n        if (slope1 === slope2) {\n            // 平行なので交点なし\n            return null;\n        }\n\n        if (!isNaN(slope1) && !isNaN(slope2)) {\n            // どちらも垂直でない\n            const px = (intercept2 - intercept1) / (slope1 - slope2);\n            const py = slope1 * px + intercept1;\n\n            point = [px, py];\n        } else if (isNaN(slope1)) {\n            // 対象の Line が垂直\n            const px = pi.x;\n            const py = px * slope2 + intercept2;\n\n            point = [px, py];\n        } else if (isNaN(slope2)) {\n            // dir が垂直\n            const px = start.x;\n            const py = px * slope1 + intercept1;\n\n            point = [px, py];\n        }\n\n        // 交点が Line の内側？\n        if (point) {\n            const [x, y] = point;\n            const rangeX = [pi.x, pj.x].sort((a, b) => a - b);\n            const rangeY = [pi.y, pj.y].sort((a, b) => a - b);\n            if (x >= rangeX[0] && x <= rangeX[1] && y >= rangeY[0] && y <= rangeY[1]) {\n                return point;\n            }\n        }\n        return null;\n    } catch (err) {\n        console.error(err);\n    }\n\n    return null;\n};\n","import { v4 as uuid } from 'uuid';\nimport { Beam, Force, Node, Structure, Trapezoid } from '../../../types/shape';\nimport { round } from './common';\nimport { Vector } from './vector';\n\n/**\n * 節点の作成\n * @param x\n * @param y\n * @returns\n */\nexport const createNode = (x: number, y: number): Node => {\n    return {\n        id: uuid(),\n        x,\n        y,\n    };\n};\n\nexport const createBeam = (name: string, nodeI: string, nodeJ: string): Beam => {\n    return {\n        id: uuid(),\n        name,\n        nodeI,\n        nodeJ,\n    };\n};\n\ntype CreateForceParams = Omit<Force, 'id'>;\n\nexport const createForce = (params: CreateForceParams): Force => {\n    return {\n        ...params,\n        id: uuid(),\n    };\n};\n\nexport const createForceParams = (\n    beam: string,\n    vi: Vector,\n    vj: Vector,\n    vp: Vector\n): Omit<Force, 'id' | 'name'> => {\n    const beamLength = vi.distance(vj);\n    // クリック位置までの距離\n    const distance = vi.distance(vp);\n\n    return {\n        beam,\n        force: 10,\n        distanceI: round(distance / beamLength),\n    };\n};\n\nexport const replaceNode = (structure: Structure, targetId: string, newId: string): Structure => {\n    structure.beams.forEach((beam) => {\n        if (beam.nodeI === targetId) {\n            beam.nodeI = newId;\n        }\n        if (beam.nodeJ === targetId) {\n            beam.nodeJ = newId;\n        }\n    });\n    return structure;\n};\n\nexport const createTrapezoid = (\n    start: number[],\n    end: number[],\n    beamId: string,\n    beamPoints: number[]\n): Trapezoid => {\n    // 梁要素の情報\n    const pi = beamPoints.slice(0, 2);\n    const pj = beamPoints.slice(-2);\n    const bi = new Vector(pi[0], pi[1]);\n    const bj = new Vector(pj[0], pj[1]);\n    const beamLength = bi.distance(bj);\n    const beamDirection = bj.clone().subtract(bi).normalize();\n\n    // ドラッグ開始点/終了点\n    let ps = new Vector(start[0], start[1]);\n    let pe = new Vector(end[0], end[1]);\n    // 開始点と終了点のどちらが i端に近い？\n    let disStart = bi.distance(ps);\n    let disEnd = bi.distance(pe);\n    if (disStart > disEnd) {\n        // 終了点の方が i端に近ければ入れ替える\n        [ps, pe] = [pe, ps];\n        [disStart, disEnd] = [disEnd, disStart];\n    }\n\n    // 分布荷重の開始点を梁要素上の座標に取り直す\n    const ti = bi.clone().add(beamDirection.clone().multiplyScalar(disStart));\n    // ドラッグ方向\n    const dir = pe.clone().subtract(ti).normalize();\n    // 梁要素とドラッグ方向が成す角度\n    const angle = beamDirection.angle() - dir.angle();\n    // 開始点からドラッグ終了点までの長さ\n    const dragLength = ti.distance(pe);\n    // 角度と長さから分布荷重の終了点を計算する\n    const r = dragLength * Math.cos(angle);\n    const tj = ti.clone().add(beamDirection.clone().multiplyScalar(r));\n    // j端から分布荷重の終了点までの距離を取り直す\n    disEnd = bj.distance(tj);\n\n    // i端から開始点までの比率\n    const distanceI = round(disStart / beamLength, 3);\n    const distanceJ = round(disEnd / beamLength, 3);\n\n    const trapezoid: Trapezoid = {\n        id: uuid(),\n        name: 'Trapezoid_N', //仮に名前を設定\n        beam: beamId,\n        forceI: 10,\n        forceJ: 10,\n        distanceI,\n        distanceJ,\n        angle: 90,\n        isGlobal: false,\n    };\n\n    return trapezoid;\n};\n","/**\n * 単位: 力\n */\nexport const ForceUnitValues = ['N', 'kN'] as const;\n\n/**\n * 単位: 長さ\n */\nexport const LengthUnitValues = ['mm', 'cm', 'm'] as const;\n\nexport type ForceUnitType = typeof ForceUnitValues[number];\nexport type LengthUnitType = typeof LengthUnitValues[number];\n\n/**\n * 単位\n */\nexport interface Unit {\n    force: ForceUnitType;\n    length: LengthUnitType;\n}\n\nexport const NodePinTypes = ['free', 'pin', 'pinX', 'pinZ', 'fixX', 'fix'] as const;\nexport type NodePinType = typeof NodePinTypes[number];\n\nexport const isNodePinType = (item: unknown): item is NodePinType => {\n    if (typeof item === 'string') {\n        return NodePinTypes.some((type) => type === item);\n    }\n    return false;\n};\n\nexport interface Node {\n    id: string;\n    x: number;\n    y: number;\n    pin?: NodePinType;\n}\n\nexport const isNode = (item: unknown): item is Node => {\n    if (item && typeof item === 'object') {\n        const value = item as Record<string, unknown>;\n        return (\n            typeof value.id === 'string' &&\n            typeof value.x === 'number' &&\n            typeof value.y === 'number'\n        );\n    }\n    return false;\n};\n\nexport interface Beam {\n    id: string;\n    name: string;\n    nodeI: string;\n    nodeJ: string;\n}\n\nexport interface Force {\n    id: string;\n    name: string;\n    beam: string;\n    force: number;\n    // i端からの距離 (0 〜 1)\n    distanceI: number;\n}\nexport const isForce = (item: unknown): item is Force => {\n    if (item && typeof item === 'object') {\n        const value = item as Record<string, unknown>;\n        return (\n            typeof value.id === 'string' &&\n            typeof value.name === 'string' &&\n            typeof value.beam === 'string' &&\n            typeof value.force === 'number' &&\n            typeof value.distanceI === 'number'\n        );\n    }\n    return false;\n};\n\nexport interface Trapezoid {\n    id: string;\n    name: string;\n    beam: string;\n    // kN/m\n    forceI: number;\n    // kN/m\n    forceJ: number;\n    // i端からの距離 (0 〜 1, distanceI + distanceJ <= 1)\n    distanceI: number;\n    // j端からの距離 (0 〜 1, distanceI + distanceJ <= 1)\n    distanceJ: number;\n    // 角度、デフォルト 90度、-179 〜 180 度の間で指定 (-180 = 180)\n    angle?: number;\n    // 全体座標系に垂直か、部材に垂直か デフォルト false\n    isGlobal?: boolean;\n}\n\nexport const isTrapezoid = (item: unknown): item is Trapezoid => {\n    if (item && typeof item === 'object') {\n        const value = item as Record<string, unknown>;\n        return (\n            typeof value.id === 'string' &&\n            typeof value.name === 'string' &&\n            typeof value.beam === 'string' &&\n            typeof value.forceI === 'number' &&\n            typeof value.distanceI === 'number' &&\n            typeof value.forceJ === 'number' &&\n            typeof value.distanceJ === 'number'\n        );\n    }\n    return false;\n};\n\nexport interface Structure {\n    unit: Unit;\n    nodes: Node[];\n    beams: Beam[];\n    forces: Force[];\n    trapezoids: Trapezoid[];\n}\n\nexport type StructureFieldType = keyof Omit<Structure, 'unit'>;\n\nexport const defaultUnit: Unit = {\n    force: 'kN',\n    length: 'm',\n};\n\nexport const emptyStructure: Structure = {\n    unit: defaultUnit,\n    nodes: [],\n    beams: [],\n    forces: [],\n    trapezoids: [],\n};\n","import { LineCap, LineJoin } from 'konva/lib/Shape';\nimport { DOMSize } from './common';\nimport { emptyStructure, Structure } from './shape';\n\nconst NoteModes = ['select', 'edit'] as const;\nexport type NoteMode = typeof NoteModes[number];\nexport const isNoteMode = (item: unknown): item is NoteMode => {\n    if (typeof item === 'string') {\n        return NoteModes.some((mode) => mode === item);\n    }\n    return false;\n};\n\nexport const PageSizeTypes = ['A4', 'A3', 'B5', 'B4'] as const;\nexport type PageSizeType = typeof PageSizeTypes[number];\n\nexport const PageSize: Record<PageSizeType, DOMSize> = {\n    A3: {\n        width: 0,\n        height: 0,\n    },\n    A4: {\n        width: 2970,\n        height: 2100,\n    },\n    B4: {\n        width: 0,\n        height: 0,\n    },\n    B5: {\n        width: 0,\n        height: 0,\n    },\n};\n\nexport interface StructureCanvasProps {\n    data: Structure;\n    image?: string;\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n}\n\nexport const MinCanvasSize: DOMSize = {\n    width: 160,\n    height: 90,\n};\n\nexport interface DrawingProps {\n    stroke: string;\n    strokeWidth: number;\n    eraser?: boolean;\n    points: number[];\n    lineJoin?: LineJoin;\n    lineCap?: LineCap;\n}\nexport type DrawSettings = Omit<DrawingProps, 'points'>;\nexport const defaultDrawSettings: DrawSettings = {\n    stroke: '#000000',\n    strokeWidth: 4,\n    eraser: false,\n    lineJoin: 'round',\n    lineCap: 'round',\n};\n\nexport interface PageProps {\n    size: PageSizeType;\n    drawings: DrawingProps[];\n    structures: StructureCanvasProps[];\n}\n\nexport const defaultPageProps: PageProps = {\n    size: 'A4',\n    drawings: [],\n    structures: [\n        {\n            data: emptyStructure,\n            x: 100,\n            y: 100,\n            ...MinCanvasSize,\n        },\n    ],\n};\n","import {\n    createContext,\n    Dispatch,\n    RefObject,\n    SetStateAction,\n    useCallback,\n    useRef,\n    useState,\n} from 'react';\nimport { CanvasHandler } from '../components/Canvas';\nimport { clone } from '../components/Canvas/util';\nimport { AppMode, ShapeBaseProps } from '../types/common';\nimport { defaultPageProps, PageProps } from '../types/note';\n\ninterface Props {\n    children: React.ReactNode;\n}\n\ninterface IAppSettingsContext {\n    mode: AppMode;\n    onChangeMode: Dispatch<SetStateAction<AppMode>>;\n    page: PageProps;\n    onChange: Dispatch<SetStateAction<PageProps>>;\n    selectedCanvasIndex?: number;\n    onSelectCanvas: Dispatch<SetStateAction<number | undefined>>;\n    canvasProps?: ShapeBaseProps;\n    editCanvas: (props: ShapeBaseProps) => void;\n    closeCanvas: VoidFunction;\n    canvasRef: RefObject<CanvasHandler>;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\nexport const AppSettingsContext = createContext<IAppSettingsContext>(undefined!);\n\nconst AppSettingsProvider: React.VFC<Props> = ({ children }) => {\n    const [mode, setMode] = useState<AppMode>('note');\n    const [page, setPage] = useState<PageProps>(defaultPageProps);\n    const [selectedCanvasIndex, setCanvasIndex] = useState<number>();\n    const [canvasProps, setCanvasProps] = useState<ShapeBaseProps>();\n    const canvasRef = useRef<CanvasHandler>(null);\n\n    const editCanvas = useCallback((props: ShapeBaseProps) => {\n        setMode('canvas');\n        setCanvasProps(props);\n    }, []);\n\n    const closeCanvas = useCallback(() => {\n        if (canvasRef.current) {\n            // 更新した構造データを取得する\n            const structure = canvasRef.current.getStructure();\n            const image = canvasRef.current.toDataURL();\n\n            // 選択中のキャンバスのデータを更新\n            if (typeof selectedCanvasIndex === 'number') {\n                setPage((state) => {\n                    const data = clone(state);\n                    data.structures[selectedCanvasIndex].data = structure;\n                    data.structures[selectedCanvasIndex].image = image;\n                    return data;\n                });\n            }\n        }\n\n        // 状態をリセット\n        setMode('note');\n        setCanvasProps(undefined);\n    }, [selectedCanvasIndex]);\n\n    return (\n        <AppSettingsContext.Provider\n            value={{\n                mode,\n                onChangeMode: setMode,\n                page,\n                onChange: setPage,\n                selectedCanvasIndex,\n                onSelectCanvas: setCanvasIndex,\n                canvasProps,\n                editCanvas,\n                closeCanvas,\n                canvasRef,\n            }}\n        >\n            {children}\n        </AppSettingsContext.Provider>\n    );\n};\n\nexport default AppSettingsProvider;\n","import { createContext, useState } from 'react';\nimport { CanvasTool } from '../types/common';\n\ninterface Props {\n    children: React.ReactNode;\n}\n\ninterface IConfigurationContext {\n    tool: CanvasTool;\n    setTool: (tool: CanvasTool) => void;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\nexport const ConfigurationContext = createContext<IConfigurationContext>(undefined!);\n\nconst ConfigurationProvider: React.VFC<Props> = ({ children }) => {\n    const [tool, setTool] = useState<CanvasTool>('select');\n\n    return (\n        <ConfigurationContext.Provider value={{ tool, setTool }}>\n            {children}\n        </ConfigurationContext.Provider>\n    );\n};\n\nexport default ConfigurationProvider;\n","import { createContext, Dispatch, SetStateAction, useState } from 'react';\nimport { defaultDrawSettings, DrawSettings, NoteMode } from '../types/note';\n\ninterface Props {\n    children: React.ReactNode;\n}\n\ninterface INoteSettingsContext {\n    mode: NoteMode;\n    settings: DrawSettings;\n    onChangeMode: Dispatch<SetStateAction<NoteMode>>;\n    onChangeDrawSettings: Dispatch<SetStateAction<DrawSettings>>;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\nexport const NoteSettingsContext = createContext<INoteSettingsContext>(undefined!);\n\nconst NoteSettingsProvider: React.VFC<Props> = ({ children }) => {\n    const [mode, setMode] = useState<NoteMode>('select');\n    const [settings, setSettings] = useState<DrawSettings>(defaultDrawSettings);\n\n    return (\n        <NoteSettingsContext.Provider\n            value={{ mode, settings, onChangeMode: setMode, onChangeDrawSettings: setSettings }}\n        >\n            {children}\n        </NoteSettingsContext.Provider>\n    );\n};\n\nexport default NoteSettingsProvider;\n","import { Typography } from '@mui/material';\n\nconst hash = process.env.REACT_APP_GIT_COMMIT_HASH?.substring(0, 7) ?? '';\nconst date = process.env.REACT_APP_GIT_COMMIT_DATE ?? '';\nconst version = process.env.REACT_APP_PACKAGE_VERSION ?? '';\n\nconst Version: React.VFC = () => {\n    return (\n        <Typography\n            variant=\"caption\"\n            sx={{ ml: 2 }}\n        >{`ver ${version} (${hash}: ${date})`}</Typography>\n    );\n};\n\nexport default Version;\n","import { AppBar, Toolbar, Typography } from '@mui/material';\nimport Version from './Version';\n\nconst Header: React.VFC = () => {\n    return (\n        <AppBar position=\"static\">\n            <Toolbar variant=\"dense\">\n                <Typography component=\"h1\" variant=\"h6\" color=\"inherit\">\n                    Drawing Sample\n                </Typography>\n                <Version />\n            </Toolbar>\n        </AppBar>\n    );\n};\n\nexport default Header;\n","// --- app 共通 ---\nexport interface DOMSize {\n    width: number;\n    height: number;\n}\n\nexport interface ShapePosition {\n    x: number;\n    y: number;\n}\n\nexport type ShapeBaseProps = DOMSize & ShapePosition;\n\nexport const AppModes = ['note', 'canvas'] as const;\nexport type AppMode = typeof AppModes[number];\n\n// --- canvas関係 ---\n\nexport const CanvasTools = ['select', 'pen', 'force', 'trapezoid', 'delete'] as const;\nexport type CanvasTool = typeof CanvasTools[number];\nexport const isCanvasTool = (item: unknown): item is CanvasTool => {\n    if (typeof item === 'string') {\n        return CanvasTools.some((tool) => tool === item);\n    }\n    return false;\n};\n\nexport const isNumberArray = (item: unknown): item is number[] => {\n    if (Array.isArray(item)) {\n        if (item.length === 0) {\n            return true;\n        }\n\n        return item.every((value) => typeof value === 'number');\n    }\n    return false;\n};\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport {\n    createContext,\n    Dispatch,\n    ReactNode,\n    SetStateAction,\n    useCallback,\n    useMemo,\n    useRef,\n} from 'react';\nimport { isNumberArray } from '../../../types/common';\nimport { CanvasProps } from '../core';\nimport { clone, createBeam, createNode, createTrapezoid, DEFAULT_SNAP_SIZE, snap } from '../util';\n\ninterface DrawEventHandlers {\n    onPointerDown: (event: KonvaEventObject<Event>) => void;\n    onPointerMove: (event: KonvaEventObject<Event>) => void;\n    onPointerUp: (event: KonvaEventObject<Event>) => void;\n}\n\ninterface DrawContextValue extends Omit<CanvasProps, 'size'> {\n    points: number[];\n    setPoints: Dispatch<SetStateAction<number[]>>;\n}\n\ntype IDrawContext = DrawContextValue & DrawEventHandlers;\n\ninterface Props {\n    value: DrawContextValue;\n    children: ReactNode;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\nexport const DrawContext = createContext<IDrawContext>(undefined!);\n\ntype BeamAttrs = {\n    id: string;\n    points: number[];\n};\n\nconst DrawProvider: React.VFC<Props> = ({\n    value: { tool, readonly, points, setPoints, structure, setStructure },\n    children,\n}) => {\n    const isDrawing = useRef<boolean>();\n    const beamRef = useRef<BeamAttrs>();\n\n    const disabled = useMemo(() => {\n        if (!readonly && typeof setStructure !== 'undefined') {\n            return !(tool === 'pen' || tool === 'trapezoid');\n        }\n        return true;\n    }, [readonly, setStructure, tool]);\n\n    const handlePointerDown = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            if (disabled) {\n                return;\n            }\n\n            if (tool === 'trapezoid') {\n                // 梁要素の選択でなければ無視する\n                if (event.target.attrs['type'] !== 'beam') {\n                    return;\n                }\n                const beamId = event.target.attrs['id'];\n                const beamPoints = event.target.attrs['points'];\n                if (isNumberArray(beamPoints) && typeof beamId === 'string') {\n                    beamRef.current = {\n                        id: beamId,\n                        points: beamPoints,\n                    };\n                }\n            }\n\n            const point = event.target.getStage()?.getPointerPosition();\n            if (point) {\n                isDrawing.current = true;\n                setPoints([point.x, point.y]);\n            }\n        },\n        [disabled, setPoints, tool]\n    );\n\n    const handlePointerMove = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            if (disabled) {\n                return;\n            }\n            if (!isDrawing.current) {\n                return;\n            }\n\n            const point = event.target.getStage()?.getPointerPosition();\n            if (point) {\n                setPoints((state) => [...state, point.x, point.y]);\n            }\n        },\n        [disabled, setPoints]\n    );\n\n    const makeBeam = useCallback(\n        (start: number[], end: number[]) => {\n            if (setStructure) {\n                // スナップさせる\n                const edgeI = snap([start[0], start[1]], DEFAULT_SNAP_SIZE);\n                const edgeJ = snap([end[0], end[1]], DEFAULT_SNAP_SIZE);\n\n                setStructure((structure) => {\n                    const data = clone(structure);\n                    const nodeI = createNode(...edgeI);\n                    // 同一座標の節点が存在するか？\n                    const n1 = data.nodes.find((node) => node.x === nodeI.x && node.y === nodeI.y);\n                    if (n1) {\n                        // 既存の節点を使用する\n                        nodeI.id = n1.id;\n                    } else {\n                        // 新規追加\n                        data.nodes.push(nodeI);\n                    }\n\n                    const nodeJ = createNode(...edgeJ);\n                    const n2 = data.nodes.find((node) => node.x === nodeJ.x && node.y === nodeJ.y);\n                    if (n2) {\n                        // 既存の節点を使用する\n                        nodeJ.id = n2.id;\n                    } else {\n                        // 新規追加\n                        data.nodes.push(nodeJ);\n                    }\n\n                    const name = `Beam_${data.beams.length + 1}`;\n                    const beam = createBeam(name, nodeI.id, nodeJ.id);\n                    data.beams.push(beam);\n\n                    return data;\n                });\n            }\n        },\n        [setStructure]\n    );\n\n    const makeTrapezoid = useCallback(\n        (start: number[], end: number[], attrs: BeamAttrs) => {\n            if (setStructure) {\n                // 分布荷重の登録\n                const trapezoid = createTrapezoid(start, end, attrs.id, attrs.points);\n                setStructure((structure) => {\n                    const data = clone(structure);\n\n                    // 分布荷重を追加\n                    const name = `Trapezoid_${data.trapezoids.length + 1}`;\n                    trapezoid.name = name;\n                    data.trapezoids.push(trapezoid);\n\n                    return data;\n                });\n            }\n        },\n        [setStructure]\n    );\n\n    const handlePointerUp = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            if (disabled) {\n                return;\n            }\n\n            if (isDrawing.current) {\n                isDrawing.current = false;\n\n                if (points.length >= 4) {\n                    // 開始点\n                    const start = points.slice(0, 2);\n                    // 終了点\n                    const end = points.slice(-2);\n\n                    if (tool === 'pen') {\n                        // 梁要素の生成\n                        makeBeam(start, end);\n                    } else if (tool === 'trapezoid' && beamRef.current) {\n                        // 分布荷重の生成\n                        makeTrapezoid(start, end, beamRef.current);\n                    }\n\n                    setPoints([]);\n                    beamRef.current = undefined;\n                }\n            }\n        },\n        [disabled, makeBeam, makeTrapezoid, points, setPoints, tool]\n    );\n\n    return (\n        <DrawContext.Provider\n            value={{\n                tool,\n                readonly,\n                points,\n                setPoints,\n                structure,\n                setStructure,\n                onPointerDown: handlePointerDown,\n                onPointerMove: handlePointerMove,\n                onPointerUp: handlePointerUp,\n            }}\n        >\n            {children}\n        </DrawContext.Provider>\n    );\n};\n\nexport default DrawProvider;\n","import { useContext, useMemo } from 'react';\nimport { Layer, Line } from 'react-konva';\nimport { CanvasTool } from '../../../types/common';\nimport { DrawContext } from '../provider/DrawProvider';\n\ninterface Props {\n    tool: CanvasTool;\n    points: number[];\n}\n\nconst DrawLayer: React.VFC<Props> = ({ tool, points }) => {\n    const color = useMemo(() => {\n        switch (tool) {\n            case 'pen':\n                return 'blue';\n            case 'trapezoid':\n                return 'red';\n            default:\n                return 'black';\n        }\n    }, [tool]);\n\n    return (\n        <Layer>\n            <Line points={points} strokeWidth={3} stroke={color} />\n        </Layer>\n    );\n};\n\nconst ConnectedDrawLayer: React.VFC = () => {\n    const { tool, points } = useContext(DrawContext);\n    return <DrawLayer tool={tool} points={points} />;\n};\n\nexport default ConnectedDrawLayer;\n","import { createContext, Dispatch, SetStateAction, useCallback } from 'react';\nimport { CanvasTool, DOMSize } from '../../../types/common';\nimport { Force, Structure } from '../../../types/shape';\nimport { clone, createForce } from '../util';\n\ninterface Props {\n    children: React.ReactNode;\n    size: DOMSize;\n    gridSize?: number;\n    snapSize?: number;\n    tool?: CanvasTool;\n    structure: Structure;\n    setStructure?: Dispatch<SetStateAction<Structure>>;\n}\n\ntype AddForceFunction = (params: Omit<Force, 'id' | 'name'>) => void;\n\ninterface IStructureContext {\n    // 選択されているツール\n    tool: CanvasTool;\n    // キャンバスのサイズ\n    size: DOMSize;\n    // グリッドの幅\n    gridSize: number;\n    // スナップする単位\n    snapSize: number;\n    // 単位変換された構造データ\n    structure: Structure;\n    // 集中荷重の追加\n    addForce: AddForceFunction;\n    // 集中荷重の削除\n    deleteForce: (id: string) => void;\n    // 分布荷重の削除\n    deleteTrapezoid: (id: string) => void;\n    // 梁要素の削除\n    deleteBeam: (id: string) => void;\n    // 構造データの更新\n    setStructure?: Dispatch<SetStateAction<Structure>>;\n}\n\n// Context | React TypeScript Cheatsheets\n// https://react-typescript-cheatsheet.netlify.app/docs/basic/getting-started/context/\n// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\nexport const StructureContext = createContext<IStructureContext>(undefined!);\n\nconst StructureProvider: React.VFC<Props> = ({\n    children,\n    tool = 'select',\n    size,\n    gridSize = 25,\n    snapSize = 25,\n    structure,\n    setStructure,\n}) => {\n    const addForce = useCallback(\n        (params: Omit<Force, 'id' | 'name'>) => {\n            const data = clone(structure);\n            const name = `Force_${data.forces.length + 1}`;\n            const force = createForce({ name, ...params });\n            data.forces.push(force);\n            setStructure && setStructure(data);\n        },\n        [setStructure, structure]\n    );\n\n    const deleteForce = useCallback(\n        (id: string) => {\n            const index = structure.forces.findIndex(({ id: itemId }) => itemId === id);\n            if (index >= 0) {\n                const data = clone(structure);\n                data.forces.splice(index, 1);\n                setStructure && setStructure(data);\n            }\n        },\n        [setStructure, structure]\n    );\n\n    const deleteTrapezoid = useCallback(\n        (id: string) => {\n            const index = structure.trapezoids.findIndex(({ id: itemId }) => itemId === id);\n            if (index >= 0) {\n                const data = clone(structure);\n                data.trapezoids.splice(index, 1);\n                setStructure && setStructure(data);\n            }\n        },\n        [setStructure, structure]\n    );\n\n    const deleteBeam = useCallback(\n        (id: string) => {\n            const index = structure.beams.findIndex(({ id: itemId }) => itemId === id);\n            if (index >= 0) {\n                const { nodeI, nodeJ } = structure.beams[index];\n                // 梁要素を削除\n                const data = clone(structure);\n                data.beams.splice(index, 1);\n\n                // beam の両端の節点について、該当 beam 以外で使用していなければ削除\n                [nodeI, nodeJ].forEach((node) => {\n                    // 他 beam で使用されていないかチェック\n                    const exists = data.beams.some(({ nodeI: i, nodeJ: j }) => {\n                        return node === i || node === j;\n                    });\n\n                    if (!exists) {\n                        // 該当 node を削除\n                        const i = data.nodes.findIndex(({ id: nodeId }) => nodeId === node);\n                        if (i >= 0) {\n                            data.nodes.splice(i, 1);\n                        }\n                    }\n                });\n\n                // beam に紐づく集中荷重を削除\n                const forces = data.forces.filter(({ beam }) => beam !== id);\n                data.forces = forces;\n                // beam に紐づく分布荷重を削除\n                const trapezoids = data.trapezoids.filter(({ beam }) => beam !== id);\n                data.trapezoids = trapezoids;\n\n                setStructure && setStructure(data);\n            }\n        },\n        [setStructure, structure]\n    );\n\n    return (\n        <StructureContext.Provider\n            value={{\n                tool,\n                size,\n                gridSize,\n                snapSize,\n                structure,\n                addForce,\n                deleteForce,\n                deleteTrapezoid,\n                deleteBeam,\n                setStructure,\n            }}\n        >\n            {children}\n        </StructureContext.Provider>\n    );\n};\n\nexport default StructureProvider;\n","import { useContext, useMemo } from 'react';\nimport { Layer, Line } from 'react-konva';\nimport { StructureContext } from '../provider/StructureProvider';\n\ninterface LineProps {\n    id: string;\n    points: number[];\n    stroke: string;\n    strokeWidth: number;\n    dash: [number, number];\n    listening: boolean;\n}\n\nconst defaultLineProps: LineProps = {\n    id: '',\n    points: [],\n    stroke: '#c9e1ff',\n    strokeWidth: 1,\n    dash: [5, 3],\n    listening: false,\n};\n\nconst GridLayer: React.VFC = () => {\n    // キャンバスサイズ, グリッドの幅\n    const { size, gridSize } = useContext(StructureContext);\n\n    const horizontalLines: LineProps[] = useMemo(() => {\n        const lines: LineProps[] = [];\n        let count = 1;\n        for (let y = 0; y <= size.height; y += gridSize) {\n            lines.push({\n                ...defaultLineProps,\n                id: `Horizontal_${count}`,\n                points: [0, y, size.width, y],\n            });\n            count++;\n        }\n        return lines;\n    }, [gridSize, size.height, size.width]);\n\n    const verticalLines: LineProps[] = useMemo(() => {\n        const lines: LineProps[] = [];\n        let count = 1;\n        for (let x = 0; x <= size.width; x += gridSize) {\n            lines.push({\n                ...defaultLineProps,\n                id: `Vertical_${count}`,\n                points: [x, 0, x, size.height],\n            });\n            count++;\n        }\n        return lines;\n    }, [gridSize, size.height, size.width]);\n\n    return (\n        <Layer listening={false}>\n            {/* horizontal */}\n            {horizontalLines.map((props) => (\n                <Line key={props.id} {...props} />\n            ))}\n            {/* vertical */}\n            {verticalLines.map((props) => (\n                <Line key={props.id} {...props} />\n            ))}\n        </Layer>\n    );\n};\n\nexport default GridLayer;\n","import { createContext, Dispatch, ReactNode, SetStateAction, useCallback } from 'react';\nimport { Shape } from '../types';\n\ninterface ISelectContext {\n    selected: Shape[];\n    setSelected: Dispatch<SetStateAction<Shape[]>>;\n    isSelected: (item: Shape) => boolean;\n    select: (item: Shape) => void;\n    toggle: (item: Shape) => void;\n}\n\ninterface Props {\n    value: Omit<ISelectContext, 'isSelected' | 'select' | 'toggle'>;\n    children: ReactNode;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\nexport const SelectContext = createContext<ISelectContext>(undefined!);\n\n/**\n * 要素選択 provider\n */\nconst SelectProvider: React.VFC<Props> = ({ value: { selected, setSelected }, children }) => {\n    const isSelected = useCallback(\n        (item: Shape) => {\n            return selected.some(({ type, id }) => type === item.type && id === item.id);\n        },\n        [selected]\n    );\n\n    const select = useCallback(\n        (item: Shape) => {\n            if (!isSelected(item)) {\n                setSelected((state) => [...state, item]);\n            }\n        },\n        [isSelected, setSelected]\n    );\n\n    const toggle = useCallback(\n        (item: Shape) => {\n            if (isSelected(item)) {\n                // 削除\n                setSelected((state) =>\n                    state.filter(({ type, id }) => !(type === item.type && id === item.id))\n                );\n            } else {\n                // 追加\n                setSelected((state) => [...state, item]);\n            }\n        },\n        [isSelected, setSelected]\n    );\n\n    return (\n        <SelectContext.Provider\n            value={{\n                selected,\n                setSelected,\n                isSelected,\n                select,\n                toggle,\n            }}\n        >\n            {children}\n        </SelectContext.Provider>\n    );\n};\n\nexport default SelectProvider;\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport { Vector2d } from 'konva/lib/types';\nimport { useCallback, useContext, useEffect, useRef, useState } from 'react';\nimport { Line, Text } from 'react-konva';\nimport { Guide } from '.';\nimport { CanvasTool } from '../../../types/common';\nimport { SelectContext } from '../provider/SelectProvider';\nimport { StructureContext } from '../provider/StructureProvider';\nimport { BeamProps, Point } from '../types';\nimport { createForceParams, Vector, verticalNormalizeVector } from '../util';\n\ninterface Props extends BeamProps {\n    tool: CanvasTool;\n    selected?: boolean;\n    addForce: (point: Vector2d, vi: Vector, vj: Vector) => void;\n    onDelete: VoidFunction;\n    onSelect: VoidFunction;\n}\n\nconst Beam: React.VFC<Props> = ({\n    id,\n    name,\n    nodeI,\n    nodeJ,\n    tool,\n    selected = false,\n    addForce,\n    onDelete,\n    onSelect,\n}) => {\n    const [points, setPoints] = useState<number[]>([]);\n    const [labelPosition, setLabelPosition] = useState<Point>([0, 0]);\n    const [labelWidth, setLabelWidth] = useState(0);\n    const [labelAngle, setLabelAngle] = useState(0);\n    const [guidePoints, setGuidePoints] = useState<[Point, Point]>([\n        [0, 0],\n        [0, 0],\n    ]);\n    const viRef = useRef<Vector>(new Vector(0, 0));\n    const vjRef = useRef<Vector>(new Vector(0, 0));\n\n    /**\n     * beam をクリック\n     * - 該当位置に集中荷重を追加する\n     * - 該当要素を削除\n     */\n    const handleClick = useCallback(\n        (event: KonvaEventObject<MouseEvent>) => {\n            // 集中荷重の追加モードの場合\n            if (tool === 'force') {\n                // クリック位置\n                const point = event.target.getStage()?.getPointerPosition();\n                if (point) {\n                    addForce(point, viRef.current, vjRef.current);\n                    // イベントの伝播を止める\n                    event.cancelBubble = true;\n                }\n            } else if (tool === 'delete') {\n                // 梁要素の削除\n                onDelete();\n                // イベントの伝播を止める\n                event.cancelBubble = true;\n            } else if (tool === 'select') {\n                // 梁要素の選択\n                onSelect();\n                // イベントの伝播を止める\n                event.cancelBubble = true;\n            }\n        },\n        [addForce, onDelete, onSelect, tool]\n    );\n\n    useEffect(() => {\n        setPoints([nodeI.x, nodeI.y, nodeJ.x, nodeJ.y]);\n        viRef.current.x = nodeI.x;\n        viRef.current.y = nodeI.y;\n        vjRef.current.x = nodeJ.x;\n        vjRef.current.y = nodeJ.y;\n\n        if (selected) {\n            // 必ず左から右になるようにする\n            let vi = viRef.current;\n            let vj = vjRef.current;\n            if (vi.x > vj.x) {\n                [vi, vj] = [vj, vi];\n            }\n\n            // 梁要素の長さ\n            const distance = vi.distance(vj);\n            // 梁要素に対して垂直なベクトル\n            const dir = verticalNormalizeVector(vi, vj);\n            // ラベル位置\n            const label = vi.clone().add(dir.clone().multiplyScalar(16));\n            // ラベル方向\n            const angle = vj.clone().subtract(vi).angleDeg();\n            // 寸法線位置\n            const guideDir = dir.clone().multiplyScalar(75);\n            const guideI = vi.clone().add(guideDir);\n            const guideJ = vj.clone().add(guideDir);\n\n            setLabelWidth(distance);\n            setLabelPosition([label.x, label.y]);\n            setLabelAngle(angle);\n            setGuidePoints([\n                [guideI.x, guideI.y],\n                [guideJ.x, guideJ.y],\n            ]);\n        }\n    }, [nodeI.x, nodeI.y, nodeJ.x, nodeJ.y, selected]);\n\n    return (\n        <>\n            <Line\n                id={id}\n                type=\"beam\"\n                points={points}\n                stroke={selected ? 'blue' : 'black'}\n                strokeWidth={4}\n                onClick={handleClick}\n                onTap={handleClick}\n            />\n            {selected && (\n                <>\n                    {/* ラベル */}\n                    <Text\n                        x={labelPosition[0]}\n                        y={labelPosition[1]}\n                        rotation={labelAngle}\n                        text={name}\n                        fontSize={12}\n                        width={labelWidth}\n                        fill=\"blue\"\n                        align=\"center\"\n                        wrap=\"none\"\n                        ellipsis\n                        listening={false}\n                    />\n                    {/* 寸法線 */}\n                    <Guide start={guidePoints[0]} end={guidePoints[1]} />\n                </>\n            )}\n        </>\n    );\n};\n\nconst ConnectedBeam: React.VFC<BeamProps> = (props) => {\n    const { tool, addForce, deleteBeam } = useContext(StructureContext);\n    const { isSelected, toggle } = useContext(SelectContext);\n\n    const handleAddForce = useCallback(\n        (point: Vector2d, vi: Vector, vj: Vector) => {\n            const vp = new Vector(point.x, point.y);\n            const force = createForceParams(props.id, vi, vj, vp);\n            addForce(force);\n        },\n        [addForce, props.id]\n    );\n\n    const handleDelete = useCallback(() => {\n        deleteBeam(props.id);\n    }, [deleteBeam, props.id]);\n\n    const handleSelect = useCallback(() => {\n        toggle({ type: 'beams', id: props.id });\n    }, [props.id, toggle]);\n\n    return (\n        <Beam\n            {...props}\n            tool={tool}\n            selected={isSelected({ type: 'beams', id: props.id })}\n            addForce={handleAddForce}\n            onDelete={handleDelete}\n            onSelect={handleSelect}\n        />\n    );\n};\n\nexport default ConnectedBeam;\n","import { createContext, Dispatch, ReactNode, SetStateAction, useCallback, useState } from 'react';\nimport { PopupParams, PopupPosition, PopupType } from '../popup/types';\n\ninterface IPopupContext {\n    popupType?: PopupType;\n    setPopupType: Dispatch<SetStateAction<PopupType | undefined>>;\n    popupPosition: PopupPosition;\n    setPopupPosition: Dispatch<SetStateAction<PopupPosition>>;\n    open: (popup: PopupType, position: PopupPosition, popupParams?: PopupParams) => void;\n    close: VoidFunction;\n    popupParams?: PopupParams;\n}\n\ninterface Props {\n    value: Omit<IPopupContext, 'open' | 'close' | 'popupParams'>;\n    children: ReactNode;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\nexport const PopupContext = createContext<IPopupContext>(undefined!);\n\nconst PopupProvider: React.VFC<Props> = ({\n    value: { popupType, setPopupType, popupPosition, setPopupPosition },\n    children,\n}) => {\n    const [popupParams, setPopupParams] = useState<PopupParams>({});\n\n    const open = useCallback(\n        (type: PopupType, position: PopupPosition, params?: PopupParams) => {\n            setPopupType(type);\n            setPopupPosition(position);\n            if (params) {\n                setPopupParams(params);\n            }\n        },\n        [setPopupPosition, setPopupType]\n    );\n\n    const close = useCallback(() => {\n        setPopupType(undefined);\n        setPopupPosition({ top: 0, left: 0 });\n        setPopupParams({});\n    }, [setPopupPosition, setPopupType]);\n\n    return (\n        <PopupContext.Provider\n            value={{\n                popupType,\n                setPopupType,\n                popupPosition,\n                setPopupPosition,\n                open,\n                close,\n                popupParams,\n            }}\n        >\n            {children}\n        </PopupContext.Provider>\n    );\n};\n\nexport default PopupProvider;\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport { useCallback, useContext, useEffect, useMemo, useRef, useState } from 'react';\nimport { Arrow, Text } from 'react-konva';\nimport { CanvasTool } from '../../../types/common';\nimport { Force as IForce } from '../../../types/shape';\nimport { PopupParams, PopupPosition } from '../popup/types';\nimport { PopupContext } from '../provider/PopupProvider';\nimport { SelectContext } from '../provider/SelectProvider';\nimport { StructureContext } from '../provider/StructureProvider';\nimport { ForceProps, Point } from '../types';\nimport { lerp, Vector, verticalNormalizeVector, vX } from '../util';\n\ninterface Props extends ForceProps {\n    tool: CanvasTool;\n    selected?: boolean;\n    onDelete: VoidFunction;\n    onSelect: VoidFunction;\n    onEdit: (position: PopupPosition) => void;\n}\n\nconst BaseLength = 30;\n\nconst Force: React.VFC<Props> = ({\n    beam,\n    distanceI,\n    force,\n    forceRatio,\n    tool,\n    selected = false,\n    onDelete,\n    onSelect,\n    onEdit,\n}) => {\n    const [points, setPoints] = useState<number[]>([]);\n    const [distance, setDistance] = useState(0);\n    const [rotation, setRotation] = useState(0);\n    const [labelPosition, setLabelPosition] = useState<Point>([0, 0]);\n\n    const viRef = useRef<Vector>(new Vector(0, 0));\n    const vjRef = useRef<Vector>(new Vector(0, 0));\n\n    useEffect(() => {\n        const { nodeI, nodeJ } = beam;\n\n        // i端、j端\n        viRef.current.x = nodeI.x;\n        viRef.current.y = nodeI.y;\n        vjRef.current.x = nodeJ.x;\n        vjRef.current.y = nodeJ.y;\n        // 矢印の先端\n        const tail = lerp(viRef.current, vjRef.current, distanceI);\n        // 梁に直交する単位ベクトル\n        const vertical = verticalNormalizeVector(viRef.current, vjRef.current);\n        // 矢印の開始点\n        const arrowLength = BaseLength * forceRatio;\n        const head = tail.clone().add(vertical.multiplyScalar(arrowLength));\n\n        setPoints([head.x, head.y, tail.x, tail.y]);\n\n        // ラベル描画用\n        setDistance(Math.max(arrowLength, 140));\n        const angle = vertical.clone().angleDeg();\n        setRotation(angle);\n        const dir = viRef.current.clone().subtract(vjRef.current).normalize();\n        if (vX.dot(dir) < 0) {\n            dir.invert();\n        }\n        const p = tail.clone().add(dir.multiplyScalar(6));\n        setLabelPosition([p.x, p.y]);\n    }, [beam, distanceI, forceRatio]);\n\n    const handleClick = useCallback(\n        (event: KonvaEventObject<MouseEvent>) => {\n            if (tool === 'delete') {\n                onDelete();\n                // イベントの伝播を止める\n                event.cancelBubble = true;\n            } else if (tool === 'select') {\n                onSelect();\n                // イベントの伝播を止める\n                event.cancelBubble = true;\n            }\n        },\n        [onDelete, onSelect, tool]\n    );\n\n    const handleLabelClick = useCallback((event: KonvaEventObject<MouseEvent>) => {\n        // ダブルクリック時にはクリックイベントも発生する\n        // 何もバインドしていないと Stage のクリックイベント（選択解除）が発生するので\n        // イベントの伝播を止めるだけのイベントハンドラを設定する\n        event.cancelBubble = true;\n    }, []);\n\n    const handleLabelDoubleClick = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            const point = event.target.getStage()?.getPointerPosition();\n            if (point) {\n                const { x, y } = point;\n                // ポップアップを開く\n                onEdit({ top: y, left: x });\n            }\n        },\n        [onEdit]\n    );\n\n    const color = useMemo(() => {\n        return selected ? 'red' : 'orange';\n    }, [selected]);\n\n    return (\n        <>\n            <Arrow\n                points={points}\n                pointerLength={6}\n                pointerWidth={6}\n                fill={color}\n                stroke={color}\n                strokeWidth={2}\n                onClick={handleClick}\n                onTap={handleClick}\n            />\n            {selected && (\n                <Text\n                    x={labelPosition[0]}\n                    y={labelPosition[1]}\n                    offsetX={-6}\n                    text={`${force}kN`}\n                    fontSize={12}\n                    width={distance}\n                    rotation={rotation}\n                    fill={color}\n                    wrap=\"none\"\n                    ellipsis\n                    onClick={handleLabelClick}\n                    onTap={handleLabelClick}\n                    onDblClick={handleLabelDoubleClick}\n                    onDblTap={handleLabelDoubleClick}\n                />\n            )}\n        </>\n    );\n};\n\nconst ConnectedForce: React.VFC<ForceProps> = (props) => {\n    const { tool, deleteForce } = useContext(StructureContext);\n    const { isSelected, toggle } = useContext(SelectContext);\n    const { open } = useContext(PopupContext);\n\n    const handleDelete = useCallback(() => {\n        deleteForce(props.id);\n    }, [deleteForce, props.id]);\n\n    const handleSelect = useCallback(() => {\n        toggle({ type: 'forces', id: props.id });\n    }, [props.id, toggle]);\n\n    const handleEdit = useCallback(\n        (position: PopupPosition) => {\n            const force: IForce = {\n                ...props,\n                beam: props.beam.id,\n            };\n            // ポップアップを表示\n            open('forces', position, force as unknown as PopupParams);\n        },\n        [open, props]\n    );\n\n    return (\n        <Force\n            {...props}\n            tool={tool}\n            selected={isSelected({ type: 'forces', id: props.id })}\n            onDelete={handleDelete}\n            onSelect={handleSelect}\n            onEdit={handleEdit}\n        />\n    );\n};\n\nexport default ConnectedForce;\n","import { useEffect, useRef, useState } from 'react';\nimport { Arrow, Group, Line, Text } from 'react-konva';\nimport { Point } from '../types';\nimport { Vector } from '../util';\n\ninterface Props {\n    start: Point;\n    end: Point;\n}\n\ninterface GuideProps {\n    fill: string;\n    stroke: string;\n    strokeWidth: number;\n    listening: boolean;\n}\n\ninterface GuideArrowProps extends GuideProps {\n    pointerLength: number;\n    pointerWidth: number;\n    pointerAtBeginning: boolean;\n}\n\nconst defaultGuideProps: GuideProps = {\n    fill: 'silver',\n    stroke: 'silver',\n    strokeWidth: 1,\n    listening: false,\n};\n\nconst defaultGuideArrowProps: GuideArrowProps = {\n    pointerLength: 6,\n    pointerWidth: 6,\n    pointerAtBeginning: true,\n    ...defaultGuideProps,\n};\n\nconst GuideLine: React.VFC<Props> = ({ start, end }) => {\n    const v1Ref = useRef<Vector>(new Vector(0, 0));\n    const v2Ref = useRef<Vector>(new Vector(0, 0));\n\n    const [distance, setDistance] = useState(0);\n    const [rotation, setRotation] = useState(0);\n    const [basis, setBasis] = useState<Point>([0, 0]);\n\n    useEffect(() => {\n        v1Ref.current.x = start[0];\n        v1Ref.current.y = start[1];\n        v2Ref.current.x = end[0];\n        v2Ref.current.y = end[1];\n\n        const dist = v1Ref.current.distance(v2Ref.current);\n        const dir = v2Ref.current.clone().subtract(v1Ref.current).normalize();\n        const angle = dir.angleDeg();\n\n        setDistance(Math.round(dist));\n        setRotation(angle === 90 ? -90 : angle);\n        setBasis(angle === 90 ? end : start);\n    }, [end, start]);\n\n    return (\n        <Group x={basis[0]} y={basis[1]} rotation={rotation}>\n            {/* 左端 */}\n            <Line points={[0, 0, 0, 10]} {...defaultGuideProps} />\n            {/* 矢印部分 */}\n            <Arrow points={[0, 5, distance, 5]} {...defaultGuideArrowProps} />\n            {/* 右端 */}\n            <Line points={[distance, 0, distance, 10]} {...defaultGuideProps} />\n            {/* ラベル */}\n            <Text\n                x={0}\n                y={-8}\n                text={`${distance}px`}\n                fontSize={12}\n                fill=\"silver\"\n                width={distance}\n                align=\"center\"\n                listening={false}\n                wrap=\"none\"\n                ellipsis\n            />\n        </Group>\n    );\n};\n\nexport default GuideLine;\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport { Vector2d } from 'konva/lib/types';\nimport { useCallback, useContext, useEffect, useMemo, useRef, useState } from 'react';\nimport { Circle, Image } from 'react-konva';\nimport useImage from 'use-image';\nimport { CanvasTool } from '../../../types/common';\nimport { Node as NodeProps, NodePinType } from '../../../types/shape';\nimport { PopupParams, PopupPosition } from '../popup/types';\nimport { PopupContext } from '../provider/PopupProvider';\nimport { StructureContext } from '../provider/StructureProvider';\nimport { clone, replaceNode, snap } from '../util';\n\ninterface Props extends NodeProps {\n    tool: CanvasTool;\n    draggable?: boolean;\n    onChange?: (node: NodeProps) => void;\n    onCommit?: (node: NodeProps) => void;\n    onEdit: (position: PopupPosition) => void;\n}\n\nconst Pins: Record<NodePinType, string> = {\n    free: '/assets/images/pins/pin_1.svg', // とりあえずダミーで指定\n    pin: '/assets/images/pins/pin_1.svg',\n    pinX: '/assets/images/pins/pin_2.svg',\n    pinZ: '/assets/images/pins/pin_2.svg',\n    fixX: '/assets/images/pins/pin_3.svg',\n    fix: '/assets/images/pins/pin_4.svg',\n};\n\nconst DrawInterval = 100;\n\nconst Node: React.VFC<Props> = ({\n    id,\n    x,\n    y,\n    pin = 'free',\n    tool,\n    draggable = false,\n    onChange,\n    onCommit,\n    onEdit,\n}) => {\n    const [isDragging, setIsDragging] = useState(false);\n    const pointRef = useRef<Vector2d>({ x, y });\n    const timerRef = useRef<NodeJS.Timer>();\n\n    const imageUrl = useMemo(() => {\n        return `${process.env.PUBLIC_URL}${Pins[pin]}`;\n    }, [pin]);\n\n    const [image] = useImage(imageUrl);\n\n    const redraw = useCallback(() => {\n        if (draggable) {\n            const node: NodeProps = { id, x: pointRef.current.x, y: pointRef.current.y };\n            onChange && onChange(node);\n        }\n    }, [draggable, id, onChange]);\n\n    const handleDragStart = useCallback((event: KonvaEventObject<DragEvent>) => {\n        const point = event.target.getStage()?.getPointerPosition();\n        if (point) {\n            pointRef.current = point;\n            setIsDragging(true);\n        }\n    }, []);\n\n    const handleDragMove = useCallback((event: KonvaEventObject<DragEvent>) => {\n        const point = event.target.getStage()?.getPointerPosition();\n        if (point) {\n            pointRef.current = point;\n        }\n    }, []);\n\n    const handleDragEnd = useCallback(\n        (event: KonvaEventObject<DragEvent>) => {\n            const point = event.target.getStage()?.getPointerPosition();\n            if (point) {\n                pointRef.current = point;\n                setIsDragging(false);\n                if (timerRef.current) {\n                    clearInterval(timerRef.current);\n                    timerRef.current = undefined;\n                }\n\n                // 節点のマージ処理\n                const node: NodeProps = { id, x: pointRef.current.x, y: pointRef.current.y };\n                onCommit && onCommit(node);\n            }\n        },\n        [id, onCommit]\n    );\n\n    const handleClick = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            if (tool === 'select') {\n                // イベントの伝播を止める\n                event.cancelBubble = true;\n            }\n        },\n        [tool]\n    );\n\n    const handleDoubleClick = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            if (tool === 'select') {\n                const point = event.target.getStage()?.getPointerPosition();\n                if (point) {\n                    const { x, y } = point;\n                    // ポップアップを開く\n                    onEdit({ top: y, left: x });\n                }\n            }\n        },\n        [onEdit, tool]\n    );\n\n    useEffect(() => {\n        const timer = timerRef.current;\n        if (draggable) {\n            if (isDragging) {\n                redraw();\n                timerRef.current = setInterval(redraw, DrawInterval);\n            }\n        }\n\n        return () => {\n            if (timer) {\n                clearInterval(timer);\n            }\n        };\n    }, [draggable, isDragging, redraw]);\n\n    return (\n        <>\n            <Circle\n                id={id}\n                x={x}\n                y={y}\n                fill={isDragging ? 'blue' : 'black'}\n                radius={4}\n                draggable={draggable}\n                onDragStart={handleDragStart}\n                onDragMove={handleDragMove}\n                onDragEnd={handleDragEnd}\n                onClick={handleClick}\n                onTap={handleClick}\n                onDblClick={handleDoubleClick}\n                onDblTap={handleDoubleClick}\n                _useStrictMode\n            />\n            {!isDragging && pin !== 'free' && (\n                <Image\n                    x={x}\n                    y={y}\n                    offsetX={12}\n                    offsetY={-4}\n                    rotation={pin === 'pinZ' ? -90 : 0}\n                    image={image}\n                    width={24}\n                    height={24}\n                    listening={false}\n                />\n            )}\n        </>\n    );\n};\n\nconst ConnectedNode: React.VFC<NodeProps> = (props) => {\n    const { tool, snapSize, setStructure } = useContext(StructureContext);\n    const { open } = useContext(PopupContext);\n\n    const draggable = useMemo(() => {\n        return tool !== 'pen' && Boolean(setStructure);\n    }, [setStructure, tool]);\n\n    const handleChange = useCallback(\n        ({ id, x, y }: NodeProps) => {\n            if (setStructure) {\n                const [px, py] = snap([x, y], snapSize);\n                setStructure((values) => {\n                    const data = clone(values);\n                    const node = data.nodes.find((item) => item.id === id);\n                    if (node) {\n                        node.x = px;\n                        node.y = py;\n                    }\n                    return data;\n                });\n            }\n        },\n        [setStructure, snapSize]\n    );\n\n    const handleCommit = useCallback(\n        ({ id, x, y }: NodeProps) => {\n            if (setStructure) {\n                const [px, py] = snap([x, y], snapSize);\n                setStructure((values) => {\n                    const data = clone(values);\n                    // 該当ID の index\n                    const index = data.nodes.findIndex((item) => item.id === id);\n                    if (index >= 0) {\n                        // 座標が一致する別の節点が存在する？\n                        const node = data.nodes.find((item) => {\n                            return item.id !== id && item.x === px && item.y === py;\n                        });\n                        if (node) {\n                            // 現在の node を座標が一致する node に置き換える\n                            replaceNode(data, id, node.id);\n                            // 不要となった現在の node を削除する\n                            data.nodes.splice(index, 1);\n                        }\n                    }\n\n                    return data;\n                });\n            }\n        },\n        [setStructure, snapSize]\n    );\n\n    const handleEdit = useCallback(\n        (position: PopupPosition) => {\n            // ポップアップを表示\n            open('nodes', position, props as unknown as PopupParams);\n        },\n        [open, props]\n    );\n\n    return (\n        <Node\n            {...props}\n            draggable={draggable}\n            tool={tool}\n            onChange={handleChange}\n            onCommit={handleCommit}\n            onEdit={handleEdit}\n        />\n    );\n};\n\nexport default ConnectedNode;\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport { useCallback, useContext, useEffect, useMemo, useState } from 'react';\nimport { Arrow, Group, Line, Text } from 'react-konva';\nimport { CanvasTool } from '../../../types/common';\nimport { Trapezoid as ITrapezoid } from '../../../types/shape';\nimport { PopupParams, PopupPosition } from '../popup/types';\nimport { PopupContext } from '../provider/PopupProvider';\nimport { SelectContext } from '../provider/SelectProvider';\nimport { StructureContext } from '../provider/StructureProvider';\nimport { Point, TrapezoidProps } from '../types';\nimport { getInsidePoints, intercectPoint, Vector, vX } from '../util';\nimport Guide from './Guide';\n\ninterface Props extends TrapezoidProps {\n    tool: CanvasTool;\n    selected?: boolean;\n    onDelete: VoidFunction;\n    onSelect: VoidFunction;\n    onEdit: (position: PopupPosition) => void;\n}\n\ntype LinePoints = [number, number, number, number];\n\ninterface LineProps {\n    stroke: string;\n    strokeWidth: number;\n}\n\ninterface ArrowProps extends LineProps {\n    pointerLength: number;\n    pointerWidth: number;\n    fill: string;\n}\n\nconst defaultLineProps: LineProps = {\n    stroke: 'pink',\n    strokeWidth: 2,\n};\n\nconst defaultArrowProps: ArrowProps = {\n    pointerLength: 6,\n    pointerWidth: 6,\n    fill: 'pink',\n    ...defaultLineProps,\n};\n\ninterface LabelProps {\n    offsetX: number;\n    offsetY: number;\n    fontSize: number;\n    wrap: string;\n    ellipsis: boolean;\n}\nconst defaultLabelProps: LabelProps = {\n    offsetX: -6,\n    offsetY: 14,\n    fontSize: 12,\n    wrap: 'none',\n    ellipsis: true,\n};\n\ninterface LabelAttrs {\n    x: number;\n    y: number;\n    text: string;\n    width: number;\n    rotation: number;\n}\n\nconst Trapezoid: React.VFC<Props> = ({\n    beam,\n    forceI,\n    forceJ,\n    distanceI,\n    distanceJ,\n    angle = 90,\n    isGlobal = false,\n    tool,\n    selected = false,\n    onDelete,\n    onSelect,\n    onEdit,\n}) => {\n    // 分布荷重の矢印\n    const [arrows, setArrows] = useState<LinePoints[]>([]);\n    // 分布荷重の上端\n    const [line, setLine] = useState<LinePoints>([0, 0, 0, 0]);\n    // ラベル\n    const [labelI, setLabelI] = useState<LabelAttrs>();\n    const [labelJ, setLabelJ] = useState<LabelAttrs>();\n    // 寸法線\n    const [guidePoints, setGuidePoints] = useState<[Point, Point]>([\n        [0, 0],\n        [0, 0],\n    ]);\n\n    useEffect(() => {\n        // 梁要素\n        const { nodeI, nodeJ } = beam;\n        const vI = new Vector(nodeI.x, nodeI.y);\n        const vJ = new Vector(nodeJ.x, nodeJ.y);\n        // 梁要素の方向\n        const vd = vJ.clone().subtract(vI).normalize();\n        // 分布荷重の方向\n        let dir: Vector;\n        if (isGlobal) {\n            dir = vX.clone().rotateDeg(angle * -1);\n        } else {\n            dir = vd\n                .clone()\n                .rotateDeg(angle * -1)\n                .normalize();\n        }\n        // 梁要素の長さ\n        const beamLength = vI.distance(vJ);\n        // 分布荷重の下端の位置\n        const bi = vI.clone().add(vd.clone().multiplyScalar(beamLength * distanceI));\n        const bj = vJ.clone().add(\n            vd\n                .clone()\n                .invert()\n                .multiplyScalar(beamLength * distanceJ)\n        );\n        // 分布荷重の上端の位置\n        const pi = bi.clone().add(dir.clone().multiplyScalar(forceI * 10));\n        const pj = bj.clone().add(dir.clone().multiplyScalar(forceJ * 10));\n\n        // 下端を等間隔に分割する点を取得\n        const points = getInsidePoints(bi, bj, vd);\n        // 上端の傾き\n        const slope = pj.x - pi.x !== 0 ? (pj.y - pi.y) / (pj.x - pi.x) : NaN;\n        // 上端の切片\n        const intercept = isNaN(slope) ? NaN : pi.y - slope * pi.x;\n\n        // 内側の矢印\n        const insideArrows: LinePoints[] = [];\n        points.forEach((pd) => {\n            // pd から分布荷重の方向に線を伸ばして上端と交差する点\n            const pu = intercectPoint([pi, pj, slope, intercept], pd, dir);\n            if (pu) {\n                const arrow: LinePoints = [pu[0], pu[1], pd.x, pd.y];\n                insideArrows.push(arrow);\n            }\n        });\n\n        const labelAngle = dir.angleDeg();\n        // ラベル (i端)\n        setLabelI({\n            x: bi.x,\n            y: bi.y,\n            text: `${forceI}kN/m`,\n            width: bi.distance(pi),\n            rotation: labelAngle,\n        });\n        // ラベル (j端)\n        setLabelJ({\n            x: bj.x,\n            y: bj.y,\n            text: `${forceJ}kN/m`,\n            width: bj.distance(pj),\n            rotation: labelAngle,\n        });\n\n        // 寸法線の位置\n        const force = Math.max(forceI, forceJ) * 10;\n        const guidePosition = dir.clone().multiplyScalar(force + 50);\n        const gi = bi.clone().add(guidePosition);\n        const gj = bj.clone().add(guidePosition);\n        setGuidePoints([\n            [gi.x, gi.y],\n            [gj.x, gj.y],\n        ]);\n\n        // 上端\n        setLine([pi.x, pi.y, pj.x, pj.y]);\n        // 矢印\n        setArrows([\n            // 左端\n            [pi.x, pi.y, bi.x, bi.y],\n            // 内側の矢印\n            ...insideArrows,\n            // 右端\n            [pj.x, pj.y, bj.x, bj.y],\n        ]);\n    }, [angle, beam, distanceI, distanceJ, forceI, forceJ, isGlobal]);\n\n    const handleClick = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            if (tool === 'select') {\n                onSelect();\n            } else if (tool === 'delete') {\n                onDelete();\n            }\n            // イベントの伝播を止める\n            event.cancelBubble = true;\n        },\n        [onDelete, onSelect, tool]\n    );\n\n    const handleDoubleClick = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            if (tool === 'select') {\n                const point = event.target.getStage()?.getPointerPosition();\n                if (point) {\n                    const { x, y } = point;\n                    // ポップアップを開く\n                    onEdit({ top: y, left: x });\n                }\n            }\n        },\n        [onEdit, tool]\n    );\n\n    const color = useMemo(() => {\n        return selected ? 'red' : 'pink';\n    }, [selected]);\n\n    return (\n        <Group\n            onClick={handleClick}\n            onTap={handleClick}\n            onDblClick={handleDoubleClick}\n            onDblTap={handleDoubleClick}\n        >\n            {/* 上端 */}\n            <Line points={line} {...defaultLineProps} stroke={color} />\n            {/* 矢印 */}\n            {arrows.map((arrow, index) => (\n                <Arrow\n                    key={`arrow_${index}`}\n                    points={arrow}\n                    {...defaultArrowProps}\n                    stroke={color}\n                    fill={color}\n                />\n            ))}\n            {/* ラベルと寸法線 */}\n            {selected && (\n                <>\n                    {/* I端側ラベル */}\n                    <Text {...defaultLabelProps} {...labelI} fill={color} />\n                    {/* J端側ラベル */}\n                    <Text {...defaultLabelProps} {...labelJ} fill={color} />\n                    {/* 寸法線 */}\n                    <Guide start={guidePoints[0]} end={guidePoints[1]} />\n                </>\n            )}\n        </Group>\n    );\n};\n\nconst ConnectedTrapezoid: React.VFC<TrapezoidProps> = (props) => {\n    const { tool, deleteTrapezoid } = useContext(StructureContext);\n    const { isSelected, toggle } = useContext(SelectContext);\n    const { open } = useContext(PopupContext);\n\n    const handleDelete = useCallback(() => {\n        deleteTrapezoid(props.id);\n    }, [deleteTrapezoid, props.id]);\n\n    const handleSelect = useCallback(() => {\n        toggle({ type: 'trapezoids', id: props.id });\n    }, [props.id, toggle]);\n\n    const handleEdit = useCallback(\n        (position: PopupPosition) => {\n            const trapezoid: ITrapezoid = {\n                ...props,\n                beam: props.beam.id,\n            };\n            // ポップアップを表示\n            open('trapezoids', position, trapezoid as unknown as PopupParams);\n        },\n        [open, props]\n    );\n\n    return (\n        <Trapezoid\n            {...props}\n            tool={tool}\n            selected={isSelected({ type: 'trapezoids', id: props.id })}\n            onDelete={handleDelete}\n            onSelect={handleSelect}\n            onEdit={handleEdit}\n        />\n    );\n};\n\nexport default ConnectedTrapezoid;\n","import { useContext, useMemo } from 'react';\nimport { Layer } from 'react-konva';\nimport { StructureContext } from '../provider/StructureProvider';\nimport { Guide as GuideLine } from '../shape';\n\ninterface GuideLineProps {\n    key: string;\n    start: [number, number];\n    end: [number, number];\n}\n\ninterface GuidePoint {\n    minX: number;\n    maxX: number;\n    guidesX: GuideLineProps[];\n    minY: number;\n    maxY: number;\n    guidesY: GuideLineProps[];\n}\n\nconst GuideInterval = 25;\n\nconst GuideLayer: React.VFC = () => {\n    const { structure } = useContext(StructureContext);\n\n    const { minX, maxX, guidesX, minY, maxY, guidesY }: GuidePoint = useMemo(() => {\n        const guide: GuidePoint = {\n            maxX: Number.MIN_SAFE_INTEGER,\n            minX: Number.MAX_SAFE_INTEGER,\n            guidesX: [],\n            maxY: Number.MIN_SAFE_INTEGER,\n            minY: Number.MAX_SAFE_INTEGER,\n            guidesY: [],\n        };\n\n        const pointsX = new Set<number>();\n        const pointsY = new Set<number>();\n        structure.nodes.forEach(({ x, y }) => {\n            if (guide.maxX < x) {\n                guide.maxX = x;\n            }\n            if (guide.minX > x) {\n                guide.minX = x;\n            }\n            if (!pointsX.has(x)) {\n                pointsX.add(x);\n            }\n            if (guide.maxY < y) {\n                guide.maxY = y;\n            }\n            if (guide.minY > y) {\n                guide.minY = y;\n            }\n            if (!pointsY.has(y)) {\n                pointsY.add(y);\n            }\n        });\n\n        // ガイドの生成\n        if (pointsX.size > 1) {\n            const array = Array.from(pointsX).sort((a, b) => (a < b ? -1 : 1));\n            let prev = array[0];\n            for (let i = 1; i < array.length; i++) {\n                const current = array[i];\n                const props: GuideLineProps = {\n                    key: `LocalGuideX_${i}`,\n                    start: [prev, guide.maxY + GuideInterval * 4],\n                    end: [current, guide.maxY + GuideInterval * 4],\n                };\n                prev = current;\n                guide.guidesX.push(props);\n            }\n        }\n        if (pointsY.size > 1) {\n            const array = Array.from(pointsY).sort((a, b) => (a < b ? -1 : 1));\n            let prev = array[0];\n            const localX = Math.max(guide.minX - GuideInterval * 4, GuideInterval * 2);\n            for (let i = 1; i < array.length; i++) {\n                const current = array[i];\n                const props: GuideLineProps = {\n                    key: `LocalGuideY_${i}`,\n                    start: [localX, prev],\n                    end: [localX, current],\n                };\n                prev = current;\n                guide.guidesY.push(props);\n            }\n        }\n\n        return guide;\n    }, [structure.nodes]);\n\n    const GlobalVerticalGuidePositionX = useMemo(() => {\n        if (minX !== Number.MAX_SAFE_INTEGER) {\n            return Math.max(GuideInterval, minX - GuideInterval * 5);\n        }\n        return 0;\n    }, [minX]);\n\n    const GlobalHorizontalGuidePositionY = useMemo(() => {\n        if (maxY !== Number.MIN_SAFE_INTEGER) {\n            return maxY + GuideInterval * 5;\n        }\n        return 0;\n    }, [maxY]);\n\n    return (\n        <Layer listening={false}>\n            {/* Horizontal */}\n            {minX !== Number.MAX_SAFE_INTEGER && maxX !== Number.MIN_SAFE_INTEGER && (\n                <GuideLine\n                    start={[minX, GlobalHorizontalGuidePositionY]}\n                    end={[maxX, GlobalHorizontalGuidePositionY]}\n                />\n            )}\n            {guidesX.map((props) => (\n                <GuideLine {...props} />\n            ))}\n            {/* Vertical */}\n            {minY !== Number.MAX_SAFE_INTEGER && maxY !== Number.MIN_SAFE_INTEGER && (\n                <GuideLine\n                    start={[GlobalVerticalGuidePositionX, minY]}\n                    end={[GlobalVerticalGuidePositionX, maxY]}\n                />\n            )}\n            {guidesY.map((props) => (\n                <GuideLine {...props} />\n            ))}\n        </Layer>\n    );\n};\n\nexport default GuideLayer;\n","import { useContext, useMemo } from 'react';\nimport { Layer } from 'react-konva';\nimport { ShapePosition } from '../../../types/common';\nimport { Node as NodeProps, Structure } from '../../../types/shape';\nimport { StructureContext } from '../provider/StructureProvider';\nimport { Beam, Force, Node, Trapezoid } from '../shape';\nimport { BeamProps, ForceProps, TrapezoidProps } from '../types';\n\ninterface Props extends Partial<ShapePosition> {\n    structure: Structure;\n}\n\nexport const ShapeLayerCore: React.VFC<Props> = ({ structure, ...layerProps }) => {\n    const nodes = useMemo(() => {\n        const map: Record<string, NodeProps> = {};\n\n        structure.nodes.forEach((node) => {\n            map[node.id] = node;\n        });\n\n        return map;\n    }, [structure.nodes]);\n\n    const beams = useMemo(() => {\n        const map: Record<string, BeamProps> = {};\n\n        structure.beams.forEach(({ nodeI, nodeJ, ...beam }) => {\n            const item: BeamProps = {\n                ...beam,\n                nodeI: nodes[nodeI],\n                nodeJ: nodes[nodeJ],\n            };\n            map[beam.id] = item;\n        });\n\n        return map;\n    }, [nodes, structure.beams]);\n\n    const forces = useMemo(() => {\n        const { forces: items } = structure;\n        const map: Record<string, ForceProps> = {};\n\n        if (items.length > 0) {\n            const total = items.map((item) => item.force).reduce((p, c) => p + c);\n            const average = total / items.length;\n            items.forEach(({ beam, force: value, ...force }) => {\n                const forceRatio = value / average;\n                map[force.id] = {\n                    ...force,\n                    force: value,\n                    forceRatio,\n                    beam: beams[beam],\n                };\n            });\n        }\n\n        return map;\n    }, [beams, structure]);\n\n    const trapezoids = useMemo(() => {\n        const { trapezoids: items } = structure;\n        const map: Record<string, TrapezoidProps> = {};\n\n        items.forEach(({ beam, ...props }) => {\n            map[props.id] = {\n                ...props,\n                beam: beams[beam],\n            };\n        });\n\n        return map;\n    }, [beams, structure]);\n\n    return (\n        <Layer {...layerProps}>\n            {Object.entries(beams).map(([key, beam]) => (\n                <Beam key={key} {...beam} />\n            ))}\n            {Object.entries(nodes).map(([key, node]) => (\n                <Node key={key} {...node} />\n            ))}\n            {Object.entries(forces).map(([key, force]) => (\n                <Force key={key} {...force} />\n            ))}\n            {Object.entries(trapezoids).map(([key, trapezoid]) => (\n                <Trapezoid key={key} {...trapezoid} />\n            ))}\n        </Layer>\n    );\n};\n\nconst ShapeLayer: React.VFC = () => {\n    const { structure } = useContext(StructureContext);\n    return <ShapeLayerCore structure={structure} />;\n};\n\nexport default ShapeLayer;\n","import { Button, InputAdornment, Paper, Stack, TextField } from '@mui/material';\nimport { ChangeEvent, FormEvent, useCallback, useEffect, useMemo, useState } from 'react';\nimport { Force, isForce } from '../../../types/shape';\nimport { PopupParams } from './types';\n\ninterface Props {\n    values: PopupParams;\n    onClose: VoidFunction;\n    onChange: (force: Force) => void;\n}\n\ninterface ForceEditorProps extends Omit<Props, 'values'> {\n    force: Force;\n}\n\nconst ForceEditor: React.VFC<ForceEditorProps> = ({ force, onChange, onClose }) => {\n    const [value, setValue] = useState('');\n    const [error, setError] = useState<string>();\n\n    const handleSubmit = useCallback(\n        (event: FormEvent<HTMLFormElement>) => {\n            event.preventDefault();\n\n            if (event.currentTarget.checkValidity() && typeof error === 'undefined') {\n                const num = parseFloat(value);\n                if (!isNaN(num)) {\n                    // 更新\n                    onChange({\n                        ...force,\n                        force: num,\n                    });\n                    // ポップアップ閉じる\n                    onClose();\n                }\n            }\n        },\n        [error, onChange, onClose, value, force]\n    );\n\n    const handleChange = useCallback((event: ChangeEvent<HTMLInputElement>) => {\n        const { value } = event.currentTarget;\n        let errorMessage: string | undefined;\n        setValue(value);\n\n        // 必須\n        if (value.length === 0) {\n            errorMessage = '数値を入力してください';\n        }\n        // 数値？\n        const num = parseFloat(value);\n        if (isNaN(num)) {\n            errorMessage = '数値を入力してください';\n        }\n        if (0 > num || num > Number.MAX_SAFE_INTEGER) {\n            errorMessage = '0 より大きい値を入力してください';\n        }\n\n        setError(errorMessage);\n    }, []);\n\n    useEffect(() => {\n        setValue(`${force.force}`);\n        setError(undefined);\n    }, [force]);\n\n    return (\n        <Paper>\n            <Stack\n                direction=\"column\"\n                spacing={1}\n                sx={{ p: 1, width: 240 }}\n                component=\"form\"\n                autoComplete=\"off\"\n                noValidate\n                onSubmit={handleSubmit}\n            >\n                <TextField\n                    variant=\"outlined\"\n                    margin=\"dense\"\n                    size=\"small\"\n                    label=\"集中荷重\"\n                    value={value}\n                    required\n                    fullWidth\n                    onChange={handleChange}\n                    InputProps={{\n                        endAdornment: <InputAdornment position=\"end\">kN</InputAdornment>,\n                    }}\n                    error={Boolean(error)}\n                    helperText={error}\n                />\n                <Stack direction=\"row\" justifyContent=\"flex-end\" spacing={1}>\n                    <Button size=\"small\" onClick={onClose}>\n                        キャンセル\n                    </Button>\n                    <Button type=\"submit\" size=\"small\" variant=\"contained\">\n                        OK\n                    </Button>\n                </Stack>\n            </Stack>\n        </Paper>\n    );\n};\n\nconst ConnectedForceEditor: React.VFC<Props> = ({ values, ...props }) => {\n    const force = useMemo(() => {\n        if (isForce(values)) {\n            return values;\n        }\n        // 空の force を渡す\n        return {\n            id: '',\n            name: '',\n            beam: '',\n            force: 0,\n            distanceI: 0,\n        };\n    }, [values]);\n\n    return <ForceEditor {...props} force={force} />;\n};\n\nexport default ConnectedForceEditor;\n","var _path, _circle, _circle2, _line;\n\nvar _excluded = [\"title\", \"titleId\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgPin2(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    id: \"svg\",\n    viewBox: \"0 0 160 160\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M80 0 L30 80 L130 80 Z\",\n    strokeWidth: 6,\n    stroke: \"gray\",\n    fill: \"transparent\"\n  })), _circle || (_circle = /*#__PURE__*/React.createElement(\"circle\", {\n    stroke: \"gray\",\n    strokeWidth: 6,\n    fill: \"transparent\",\n    cx: 45,\n    cy: 115,\n    r: 20\n  })), _circle2 || (_circle2 = /*#__PURE__*/React.createElement(\"circle\", {\n    stroke: \"gray\",\n    strokeWidth: 6,\n    fill: \"transparent\",\n    cx: 115,\n    cy: 115,\n    r: 20\n  })), _line || (_line = /*#__PURE__*/React.createElement(\"line\", {\n    x1: 30,\n    y1: 150,\n    x2: 130,\n    y2: 150,\n    stroke: \"gray\",\n    strokeWidth: 6\n  })));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgPin2);\nexport default __webpack_public_path__ + \"static/media/pin_2.2b2bb714.svg\";\nexport { ForwardRef as ReactComponent };","var _path, _circle, _circle2, _line;\n\nvar _excluded = [\"title\", \"titleId\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgPin3(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    id: \"svg\",\n    style: {\n      width: 64\n    },\n    viewBox: \"0 0 160 160\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M30 3 L30 80 L130 80 L130 3 Z\",\n    strokeWidth: 6,\n    stroke: \"gray\",\n    fill: \"transparent\"\n  })), _circle || (_circle = /*#__PURE__*/React.createElement(\"circle\", {\n    stroke: \"gray\",\n    strokeWidth: 6,\n    fill: \"transparent\",\n    cx: 45,\n    cy: 115,\n    r: 20\n  })), _circle2 || (_circle2 = /*#__PURE__*/React.createElement(\"circle\", {\n    stroke: \"gray\",\n    strokeWidth: 6,\n    fill: \"transparent\",\n    cx: 115,\n    cy: 115,\n    r: 20\n  })), _line || (_line = /*#__PURE__*/React.createElement(\"line\", {\n    x1: 30,\n    y1: 150,\n    x2: 130,\n    y2: 150,\n    stroke: \"gray\",\n    strokeWidth: 6\n  })));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgPin3);\nexport default __webpack_public_path__ + \"static/media/pin_3.d7b6571b.svg\";\nexport { ForwardRef as ReactComponent };","var _line, _line2, _line3, _line4, _line5;\n\nvar _excluded = [\"title\", \"titleId\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgPin4(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    id: \"svg\",\n    style: {\n      width: 64\n    },\n    viewBox: \"0 0 160 160\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _line || (_line = /*#__PURE__*/React.createElement(\"line\", {\n    x1: 0,\n    y1: 3,\n    x2: 160,\n    y2: 3,\n    stroke: \"gray\",\n    strokeWidth: 6\n  })), _line2 || (_line2 = /*#__PURE__*/React.createElement(\"line\", {\n    x1: 20,\n    y1: 0,\n    x2: 0,\n    y2: 60,\n    stroke: \"gray\",\n    strokeWidth: 6\n  })), _line3 || (_line3 = /*#__PURE__*/React.createElement(\"line\", {\n    x1: 60,\n    y1: 0,\n    x2: 40,\n    y2: 60,\n    stroke: \"gray\",\n    strokeWidth: 6\n  })), _line4 || (_line4 = /*#__PURE__*/React.createElement(\"line\", {\n    x1: 100,\n    y1: 0,\n    x2: 80,\n    y2: 60,\n    stroke: \"gray\",\n    strokeWidth: 6\n  })), _line5 || (_line5 = /*#__PURE__*/React.createElement(\"line\", {\n    x1: 140,\n    y1: 0,\n    x2: 120,\n    y2: 60,\n    stroke: \"gray\",\n    strokeWidth: 6\n  })));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgPin4);\nexport default __webpack_public_path__ + \"static/media/pin_4.4442f3d6.svg\";\nexport { ForwardRef as ReactComponent };","import CircleOutlinedIcon from '@mui/icons-material/CircleOutlined';\nimport {\n    Button,\n    Paper,\n    Stack,\n    SvgIcon,\n    ToggleButton,\n    ToggleButtonGroup,\n    ToggleButtonProps,\n    Typography,\n} from '@mui/material';\nimport {\n    FormEvent,\n    MouseEvent,\n    ReactElement,\n    useCallback,\n    useEffect,\n    useMemo,\n    useState,\n} from 'react';\nimport { isNode, isNodePinType, Node, NodePinType } from '../../../types/shape';\nimport { ReactComponent as PinIcon1 } from './pins/pin_1.svg';\nimport { ReactComponent as PinIcon2 } from './pins/pin_2.svg';\nimport { ReactComponent as PinIcon3 } from './pins/pin_3.svg';\nimport { ReactComponent as PinIcon4 } from './pins/pin_4.svg';\nimport { PopupParams } from './types';\n\ninterface Props {\n    values: PopupParams;\n    onClose: VoidFunction;\n    onChange: (node: Node) => void;\n}\n\ninterface PinSelectorProps extends Omit<Props, 'values'> {\n    node: Node;\n}\n\ninterface PinButtonProps {\n    type: NodePinType;\n    icon: ReactElement;\n    label: string;\n}\n\nconst PinButtons: Readonly<Record<NodePinType, PinButtonProps>> = {\n    free: {\n        type: 'free',\n        icon: <CircleOutlinedIcon />,\n        label: '完全フリー',\n    },\n    pin: {\n        type: 'pin',\n        icon: (\n            <SvgIcon sx={{ width: 24 }} viewBox=\"0 0 160 160\">\n                <PinIcon1 />\n            </SvgIcon>\n        ),\n        label: '完全ピン',\n    },\n    pinX: {\n        type: 'pinX',\n        icon: (\n            <SvgIcon sx={{ width: 24 }} viewBox=\"0 0 160 160\">\n                <PinIcon2 />\n            </SvgIcon>\n        ),\n        label: 'ピンXローラー',\n    },\n    pinZ: {\n        type: 'pinZ',\n        icon: (\n            <SvgIcon sx={{ width: 24, transform: 'rotate(-90deg)' }} viewBox=\"0 0 160 160\">\n                <PinIcon2 />\n            </SvgIcon>\n        ),\n        label: 'ピンZローラー',\n    },\n    fixX: {\n        type: 'fixX',\n        icon: (\n            <SvgIcon sx={{ width: 24 }} viewBox=\"0 0 160 160\">\n                <PinIcon3 />\n            </SvgIcon>\n        ),\n        label: '固定Xローラー',\n    },\n    fix: {\n        type: 'fix',\n        icon: (\n            <SvgIcon sx={{ width: 24 }} viewBox=\"0 0 160 160\">\n                <PinIcon4 />\n            </SvgIcon>\n        ),\n        label: '完全固定',\n    },\n};\n\nconst defaultButtonProps: Partial<ToggleButtonProps> = {\n    sx: { justifyContent: 'flex-start', alignItems: 'center' },\n};\n\nconst PinSelector: React.VFC<PinSelectorProps> = ({ node, onChange, onClose }) => {\n    const [pin, setPin] = useState<NodePinType>();\n\n    const handleSubmit = useCallback(\n        (event: FormEvent) => {\n            event.preventDefault();\n\n            const values: Node = {\n                ...node,\n                pin,\n            };\n            onChange(values);\n            onClose();\n        },\n        [node, onChange, onClose, pin]\n    );\n\n    const handleChange = useCallback((_: MouseEvent<HTMLElement>, newValue: string | null) => {\n        if (newValue !== null && isNodePinType(newValue)) {\n            setPin(newValue);\n        }\n    }, []);\n\n    useEffect(() => {\n        setPin(node.pin ?? 'free');\n    }, [node.pin]);\n\n    return (\n        <Paper>\n            <Stack\n                direction=\"column\"\n                spacing={1}\n                sx={{ p: 1, width: 240 }}\n                component=\"form\"\n                autoComplete=\"off\"\n                noValidate\n                onSubmit={handleSubmit}\n            >\n                <ToggleButtonGroup\n                    orientation=\"vertical\"\n                    value={pin}\n                    size=\"small\"\n                    exclusive\n                    fullWidth\n                    onChange={handleChange}\n                >\n                    {Object.entries(PinButtons).map(([key, { icon, label }]) => (\n                        <ToggleButton key={key} value={key} {...defaultButtonProps}>\n                            {icon}\n                            <Typography variant=\"caption\" sx={{ ml: 1 }}>\n                                {label}\n                            </Typography>\n                        </ToggleButton>\n                    ))}\n                </ToggleButtonGroup>\n                <Stack direction=\"row\" justifyContent=\"flex-end\" spacing={1}>\n                    <Button size=\"small\" onClick={onClose}>\n                        キャンセル\n                    </Button>\n                    <Button type=\"submit\" size=\"small\" variant=\"contained\">\n                        OK\n                    </Button>\n                </Stack>\n            </Stack>\n        </Paper>\n    );\n};\n\nconst ConnectedPinSelector: React.VFC<Props> = ({ values, ...props }) => {\n    const node = useMemo(() => {\n        if (isNode(values)) {\n            return values;\n        }\n        return {\n            id: '',\n            x: 0,\n            y: 0,\n        };\n    }, [values]);\n\n    return <PinSelector {...props} node={node} />;\n};\n\nexport default ConnectedPinSelector;\n","import {\n    Button,\n    Checkbox,\n    FormControlLabel,\n    InputAdornment,\n    Paper,\n    Stack,\n    TextField,\n} from '@mui/material';\nimport { ChangeEvent, FormEvent, useCallback, useEffect, useMemo, useState } from 'react';\nimport { isTrapezoid, Trapezoid } from '../../../types/shape';\nimport { round } from '../util';\nimport { PopupParams } from './types';\n\ninterface Props {\n    values: PopupParams;\n    onClose: VoidFunction;\n    onChange: (trapezoid: Trapezoid) => void;\n}\n\ninterface FormProps extends Omit<Props, 'values'> {\n    trapezoid: Trapezoid;\n}\n\ninterface TrapezoidAttrs {\n    forceI: number;\n    forceJ: number;\n    angle: number;\n    isGlobal: boolean;\n}\ninterface FormValues {\n    forceI: string;\n    forceJ: string;\n    angle: string;\n    isGlobal: boolean;\n}\n\ntype ValidateTuple = [value: number, valid: boolean, error: string];\n\n/**\n * 必須かつ 0以上の数値\n * @param value\n */\nconst validateForce = (value: string): ValidateTuple => {\n    if (value.length === 0) {\n        // 必須\n        return [NaN, false, '数値を入力してください'];\n    } else {\n        const val = parseFloat(value);\n        if (isNaN(val)) {\n            // 数値でない\n            return [NaN, false, '数値を入力してください'];\n        } else if (0 >= val && val > Number.MAX_SAFE_INTEGER) {\n            // 数値が範囲外\n            return [val, false, '0 以上の数値を入力してください'];\n        }\n        // OK\n        return [round(val, 3), true, ''];\n    }\n};\n\n/**\n * -180 から 180 の範囲の数値\n * -180 の場合は 180 とする\n * @param value\n */\nconst validateAngle = (value: string): ValidateTuple => {\n    if (value.length > 0) {\n        let val = parseInt(value, 10);\n        if (isNaN(val) || value.indexOf('.') >= 0) {\n            // 整数でない\n            return [NaN, false, '整数を入力してください'];\n        } else if (-180 > val || 180 < val) {\n            // 180 から 180 の範囲外\n            return [val, false, '-180 〜 180 で入力してください'];\n        }\n        if (val === -180) {\n            // -180 の場合は 180 とする\n            val = 180;\n        }\n        // OK\n        return [val, true, ''];\n    }\n    // 未指定の場合は 90 を返す\n    return [90, true, ''];\n};\n\nconst parseFormValues = (values: Partial<FormValues>): [boolean, TrapezoidAttrs] => {\n    const attrs: TrapezoidAttrs = {\n        forceI: 0,\n        forceJ: 0,\n        angle: 90,\n        isGlobal: false,\n    };\n\n    // forceI\n    const [value1, valid1] = validateForce(values.forceI ?? '');\n    const [value2, valid2] = validateForce(values.forceJ ?? '');\n    const [value3, valid3] = validateAngle(values.angle ?? '');\n    const valid = valid1 && valid2 && valid3;\n\n    attrs.forceI = value1;\n    attrs.forceJ = value2;\n    attrs.angle = value3;\n    attrs.isGlobal = values.isGlobal ?? false;\n\n    return [valid, attrs];\n};\n\nconst toFormValues = (trapezoid: Trapezoid): Partial<FormValues> => {\n    const values: Partial<FormValues> = {};\n\n    values.forceI = `${trapezoid.forceI}`;\n    values.forceJ = `${trapezoid.forceJ}`;\n    values.angle = `${trapezoid.angle ?? ''}`;\n    values.isGlobal = trapezoid.isGlobal;\n\n    return values;\n};\n\nconst TrapezoidEditor: React.VFC<FormProps> = ({ trapezoid, onChange, onClose }) => {\n    const [values, setValues] = useState<Partial<FormValues>>({});\n    const [errors, setErrors] = useState<Record<string, string>>({});\n\n    const handleSubmit = useCallback(\n        (event: FormEvent<HTMLFormElement>) => {\n            event.preventDefault();\n\n            if (event.currentTarget.checkValidity()) {\n                // エラーがあれば更新しない\n                const invalid = Object.values(errors).some((error) => error.length > 0);\n                if (!invalid) {\n                    // values を TrapezoidAttrs に変換する\n                    const [valid, attrs] = parseFormValues(values);\n                    console.log(valid, attrs);\n                    if (valid) {\n                        // 更新\n                        onChange({\n                            ...trapezoid,\n                            ...attrs,\n                        });\n                    }\n                    // ポップアップ閉じる\n                    onClose();\n                }\n            }\n        },\n        [errors, onChange, onClose, trapezoid, values]\n    );\n\n    const handleChange = useCallback((event: ChangeEvent<HTMLInputElement>) => {\n        const { name, value } = event.target;\n        let errorMessage = '';\n        switch (name) {\n            case 'forceI':\n            case 'forceJ':\n                // 必須かつ 0以上の数値\n                const [, valid1, error1] = validateForce(value);\n                if (!valid1) {\n                    errorMessage = error1;\n                }\n                break;\n            case 'angle':\n                const [, valid2, error2] = validateAngle(value);\n                if (!valid2) {\n                    errorMessage = error2;\n                }\n                break;\n        }\n\n        // エラー情報の更新\n        setErrors((state) => ({\n            ...state,\n            [name]: errorMessage,\n        }));\n\n        // 値を更新\n        setValues((state) => ({\n            ...state,\n            [name]: value,\n        }));\n    }, []);\n\n    const handleChangeIsGlobal = useCallback((event: ChangeEvent<HTMLInputElement>) => {\n        const { checked } = event.target;\n        setValues((state) => ({\n            ...state,\n            isGlobal: checked,\n        }));\n    }, []);\n\n    useEffect(() => {\n        setValues(toFormValues(trapezoid));\n        setErrors({});\n    }, [trapezoid]);\n\n    return (\n        <Paper>\n            <Stack\n                direction=\"column\"\n                spacing={1}\n                sx={{ p: 1, width: 240 }}\n                component=\"form\"\n                autoComplete=\"off\"\n                noValidate\n                onSubmit={handleSubmit}\n            >\n                {/* forceI */}\n                <TextField\n                    variant=\"outlined\"\n                    margin=\"dense\"\n                    size=\"small\"\n                    label=\"I端側の荷重\"\n                    name=\"forceI\"\n                    value={values['forceI'] ?? ''}\n                    required\n                    fullWidth\n                    onChange={handleChange}\n                    InputProps={{\n                        endAdornment: <InputAdornment position=\"end\">kN/m</InputAdornment>,\n                    }}\n                    error={Boolean(errors['forceI'])}\n                    helperText={errors['forceI'] ?? ''}\n                />\n                {/* forceJ */}\n                <TextField\n                    variant=\"outlined\"\n                    margin=\"dense\"\n                    size=\"small\"\n                    label=\"J端側の荷重\"\n                    name=\"forceJ\"\n                    value={values['forceJ'] ?? ''}\n                    required\n                    fullWidth\n                    onChange={handleChange}\n                    InputProps={{\n                        endAdornment: <InputAdornment position=\"end\">kN/m</InputAdornment>,\n                    }}\n                    error={Boolean(errors['forceJ'])}\n                    helperText={errors['forceJ'] ?? ''}\n                />\n                {/* angle */}\n                <TextField\n                    variant=\"outlined\"\n                    margin=\"dense\"\n                    size=\"small\"\n                    label=\"角度\"\n                    name=\"angle\"\n                    value={values['angle'] ?? ''}\n                    fullWidth\n                    onChange={handleChange}\n                    InputProps={{\n                        endAdornment: <InputAdornment position=\"end\">°</InputAdornment>,\n                    }}\n                    error={Boolean(errors['angle'])}\n                    helperText={errors['angle'] ?? ''}\n                />\n                {/* isGlobal */}\n                <FormControlLabel\n                    label=\"全体座標系\"\n                    control={\n                        <Checkbox\n                            name=\"isGlobal\"\n                            size=\"small\"\n                            checked={values.isGlobal ?? false}\n                            onChange={handleChangeIsGlobal}\n                        />\n                    }\n                />\n                <Stack direction=\"row\" justifyContent=\"flex-end\" spacing={1}>\n                    <Button size=\"small\" onClick={onClose}>\n                        キャンセル\n                    </Button>\n                    <Button type=\"submit\" size=\"small\" variant=\"contained\">\n                        OK\n                    </Button>\n                </Stack>\n            </Stack>\n        </Paper>\n    );\n};\n\nconst ConnectedTrapezoidEditor: React.VFC<Props> = ({ values, ...props }) => {\n    const trapezoid = useMemo(() => {\n        if (isTrapezoid(values)) {\n            return values;\n        }\n        // 空データを返す\n        return {\n            id: '',\n            name: '',\n            beam: '',\n            forceI: 0,\n            distanceI: 0,\n            forceJ: 0,\n            distanceJ: 0,\n        };\n    }, [values]);\n\n    return <TrapezoidEditor {...props} trapezoid={trapezoid} />;\n};\n\nexport default ConnectedTrapezoidEditor;\n","import { useCallback, useContext, useMemo } from 'react';\nimport { Html } from 'react-konva-utils';\nimport { Force, Node, Trapezoid } from '../../../types/shape';\nimport { PopupContext } from '../provider/PopupProvider';\nimport { StructureContext } from '../provider/StructureProvider';\nimport { clone } from '../util';\nimport ForceEditor from './ForceEditor';\nimport PinSelector from './PinSelector';\nimport TrapezoidEditor from './TrapezoidEditor';\n\nconst Popup: React.VFC = () => {\n    const { popupType, popupPosition, popupParams, close } = useContext(PopupContext);\n    const { setStructure } = useContext(StructureContext);\n\n    const divProps = useMemo(() => {\n        const { top, left } = popupPosition;\n        return {\n            style: {\n                zIndex: 5000,\n                top: `${top}px`,\n                left: `${left}px`,\n            },\n        };\n    }, [popupPosition]);\n\n    const handleChangeForce = useCallback(\n        (force: Force) => {\n            setStructure &&\n                setStructure((structure) => {\n                    const data = clone(structure);\n\n                    const index = data.forces.findIndex(({ id }) => id === force.id);\n                    if (index >= 0) {\n                        data.forces[index] = {\n                            ...force,\n                        };\n                    }\n\n                    return data;\n                });\n        },\n        [setStructure]\n    );\n\n    const handleChangeTrapezoid = useCallback(\n        (trapezoid: Trapezoid) => {\n            setStructure &&\n                setStructure((structure) => {\n                    const data = clone(structure);\n                    const index = data.trapezoids.findIndex(({ id }) => id === trapezoid.id);\n                    if (index >= 0) {\n                        data.trapezoids[index] = {\n                            ...trapezoid,\n                        };\n                    }\n                    return data;\n                });\n        },\n        [setStructure]\n    );\n\n    const handleChangeNode = useCallback(\n        (node: Node) => {\n            setStructure &&\n                setStructure((structure) => {\n                    const data = clone(structure);\n                    const index = data.nodes.findIndex(({ id }) => id === node.id);\n                    if (index >= 0) {\n                        data.nodes[index] = {\n                            ...node,\n                        };\n                    }\n                    return data;\n                });\n        },\n        [setStructure]\n    );\n\n    if (typeof popupType === 'undefined') {\n        return null;\n    }\n\n    return (\n        <Html divProps={divProps}>\n            {popupType === 'forces' && (\n                <ForceEditor\n                    values={popupParams ?? {}}\n                    onClose={close}\n                    onChange={handleChangeForce}\n                />\n            )}\n            {popupType === 'trapezoids' && (\n                <TrapezoidEditor\n                    values={popupParams ?? {}}\n                    onClose={close}\n                    onChange={handleChangeTrapezoid}\n                />\n            )}\n            {popupType === 'nodes' && (\n                <PinSelector\n                    values={popupParams ?? {}}\n                    onClose={close}\n                    onChange={handleChangeNode}\n                />\n            )}\n        </Html>\n    );\n};\n\nexport default Popup;\n","import Konva from 'konva';\nimport { KonvaEventObject } from 'konva/lib/Node';\nimport {\n    Dispatch,\n    forwardRef,\n    SetStateAction,\n    useCallback,\n    useContext,\n    useImperativeHandle,\n    useRef,\n} from 'react';\nimport { Stage } from 'react-konva';\nimport { CanvasTool, DOMSize } from '../../types/common';\nimport { Structure } from '../../types/shape';\nimport DrawLayer from './layer/DrawLayer';\nimport GridLayer from './layer/GridLayer';\nimport GuideLayer from './layer/GuideLayer';\nimport ShapeLayer from './layer/ShapeLayer';\nimport Popup from './popup';\nimport DrawProvider, { DrawContext } from './provider/DrawProvider';\nimport PopupProvider, { PopupContext } from './provider/PopupProvider';\nimport SelectProvider, { SelectContext } from './provider/SelectProvider';\nimport StructureProvider from './provider/StructureProvider';\nimport { CanvasCoreHandler } from './types';\n\nexport interface CanvasProps {\n    tool: CanvasTool;\n    structure: Structure;\n    size: DOMSize;\n    readonly?: boolean;\n    setStructure?: Dispatch<SetStateAction<Structure>>;\n}\n\nconst CanvasCore: React.ForwardRefRenderFunction<CanvasCoreHandler, CanvasProps> = (\n    { tool, structure, size, readonly = false, setStructure },\n    ref\n) => {\n    const { selected, setSelected } = useContext(SelectContext);\n    const { popupType, setPopupType, popupPosition, setPopupPosition, close } =\n        useContext(PopupContext);\n    const { points, onPointerDown, onPointerMove, onPointerUp, ...drawContextValues } =\n        useContext(DrawContext);\n\n    const canvasRef = useRef<Konva.Stage>(null);\n\n    useImperativeHandle(\n        ref,\n        () => ({\n            toDataURL: () => {\n                if (canvasRef.current) {\n                    return canvasRef.current.toDataURL();\n                }\n            },\n        }),\n        []\n    );\n\n    /**\n     * Stage のクリック\n     */\n    const handleClick = useCallback(\n        (_: KonvaEventObject<PointerEvent>) => {\n            // ポップオーバーを閉じる\n            close();\n\n            if (tool === 'select') {\n                // 選択解除\n                setSelected([]);\n            }\n        },\n        [close, setSelected, tool]\n    );\n\n    return (\n        <Stage\n            ref={canvasRef}\n            width={size.width}\n            height={size.height}\n            onClick={handleClick}\n            onTap={handleClick}\n            {...{ onPointerDown, onPointerMove, onPointerUp }}\n        >\n            <StructureProvider\n                size={size}\n                structure={structure}\n                tool={tool}\n                setStructure={setStructure}\n            >\n                <PopupProvider value={{ popupType, setPopupType, popupPosition, setPopupPosition }}>\n                    <SelectProvider value={{ selected, setSelected }}>\n                        <DrawProvider value={{ points, ...drawContextValues }}>\n                            <GridLayer />\n                            <GuideLayer />\n                            <ShapeLayer />\n                            <DrawLayer />\n                            {/* ポップアップ */}\n                            <Popup />\n                        </DrawProvider>\n                    </SelectProvider>\n                </PopupProvider>\n            </StructureProvider>\n        </Stage>\n    );\n};\n\nexport default forwardRef(CanvasCore);\n","import { Box } from '@mui/material';\nimport { forwardRef, useEffect, useImperativeHandle, useRef, useState } from 'react';\nimport { CanvasTool, DOMSize } from '../../types/common';\nimport { Structure } from '../../types/shape';\nimport CanvasCore, { CanvasProps } from './core';\nimport { PopupPosition, PopupType } from './popup/types';\nimport DrawProvider from './provider/DrawProvider';\nimport PopupProvider from './provider/PopupProvider';\nimport SelectProvider from './provider/SelectProvider';\nimport { CanvasCoreHandler, Shape } from './types';\n\ninterface Props extends Omit<CanvasProps, 'size' | 'tool' | 'setStructure'> {\n    tool?: CanvasTool;\n}\n\nexport interface CanvasHandler extends CanvasCoreHandler {\n    getStructure: () => Structure;\n}\n\nconst Canvas: React.ForwardRefRenderFunction<CanvasHandler, Props> = (\n    { tool = 'select', structure: source, ...props },\n    ref\n) => {\n    // キャンバス表示領域\n    const [size, setSize] = useState<DOMSize>({ width: 0, height: 0 });\n    // 選択要素\n    const [selected, setSelected] = useState<Shape[]>([]);\n    // ポップオーバーの表示\n    const [popupType, setPopupType] = useState<PopupType>();\n    const [popupPosition, setPopupPosition] = useState<PopupPosition>({ top: 0, left: 0 });\n    // 描画する点\n    const [points, setPoints] = useState<number[]>([]);\n    // データ\n    const [structure, setStructure] = useState(source);\n\n    // キャンバスの親要素\n    const containerRef = useRef<HTMLDivElement>(null);\n    // キャンバス本体\n    const canvasRef = useRef<CanvasCoreHandler>(null);\n\n    useImperativeHandle(\n        ref,\n        () => ({\n            toDataURL: () => {\n                if (canvasRef.current) {\n                    return canvasRef.current.toDataURL();\n                }\n            },\n            getStructure: () => structure,\n        }),\n        [structure]\n    );\n\n    // 要素のリサイズを監視\n    useEffect(() => {\n        const observer = new ResizeObserver((entries) => {\n            const { width, height } = entries[0].contentRect;\n            setSize({\n                width,\n                height,\n            });\n        });\n\n        if (containerRef.current) {\n            observer.observe(containerRef.current);\n        }\n\n        return () => {\n            observer.disconnect();\n        };\n    }, []);\n\n    return (\n        <Box\n            ref={containerRef}\n            sx={{\n                width: 'auto',\n                height: '100%',\n                backgroundColor: '#ffffff',\n                overscrollBehavior: 'contain',\n            }}\n        >\n            <PopupProvider value={{ popupType, setPopupType, popupPosition, setPopupPosition }}>\n                <SelectProvider value={{ selected, setSelected }}>\n                    <DrawProvider\n                        value={{ points, setPoints, tool, structure, setStructure, ...props }}\n                    >\n                        <CanvasCore\n                            ref={canvasRef}\n                            size={size}\n                            tool={tool}\n                            structure={structure}\n                            setStructure={setStructure}\n                            {...props}\n                        />\n                    </DrawProvider>\n                </SelectProvider>\n            </PopupProvider>\n        </Box>\n    );\n};\n\nexport default forwardRef(Canvas);\n","import { Layer, Line } from 'react-konva';\nimport { DrawingProps, DrawSettings } from '../../../types/note';\n\ninterface Props {\n    drawings: DrawingProps[];\n    // 描画中のデータ\n    settings: DrawSettings;\n    points?: number[];\n}\n\nconst Draw: React.VFC<Props> = ({ drawings, settings, points }) => {\n    return (\n        <Layer>\n            {drawings.map(({ eraser = false, ...lineProps }, index) => (\n                <Line\n                    key={`note-drawing-${index}`}\n                    {...lineProps}\n                    globalCompositeOperation={eraser ? 'destination-out' : 'source-over'}\n                />\n            ))}\n            {points && (\n                <Line\n                    {...settings}\n                    points={points}\n                    globalCompositeOperation={settings.eraser ? 'destination-out' : 'source-over'}\n                />\n            )}\n        </Layer>\n    );\n};\n\nexport default Draw;\n","import CloseIcon from '@mui/icons-material/Close';\nimport EditIcon from '@mui/icons-material/Edit';\nimport MoreVertIcon from '@mui/icons-material/MoreVert';\nimport { IconButton, Menu, MenuItem, styled } from '@mui/material';\nimport { MouseEvent, MouseEventHandler, useCallback, useState } from 'react';\nimport { Html } from 'react-konva-utils';\nimport { AppMode } from '../../../../types/common';\n\ninterface Props {\n    visible?: boolean;\n    mode: AppMode;\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    onEdit?: MouseEventHandler<HTMLButtonElement>;\n    onCopy?: VoidFunction;\n    onDelete?: VoidFunction;\n    onCancel?: VoidFunction;\n}\n\nconst Background = styled('div')({\n    display: 'flex',\n    alignItems: 'center',\n    width: '100%',\n    padding: '0 8',\n});\nconst Spacer = styled('div')({\n    flex: 1,\n});\n\nconst HeaderMenu: React.VFC<Props> = ({\n    visible = false,\n    mode,\n    y: top,\n    x: left,\n    width,\n    onEdit,\n    onCopy,\n    onDelete,\n    onCancel,\n}) => {\n    const [anchorEl, setAnchorEl] = useState<HTMLButtonElement | null>(null);\n\n    const handleClickMore = useCallback((event: MouseEvent<HTMLButtonElement>) => {\n        setAnchorEl(event.currentTarget);\n    }, []);\n    const handleCloseMenu = useCallback(() => {\n        setAnchorEl(null);\n    }, []);\n\n    if (!visible) {\n        return null;\n    }\n\n    return (\n        <Html\n            divProps={{\n                style: {\n                    top: `${top - 42}px`,\n                    left: `${left}px`,\n                    width: `${width}px`,\n                },\n            }}\n        >\n            <Background>\n                {mode === 'canvas' && (\n                    <IconButton size=\"small\" onClick={onCancel}>\n                        <CloseIcon />\n                    </IconButton>\n                )}\n                {mode === 'note' && (\n                    <>\n                        <IconButton size=\"small\" onClick={onEdit}>\n                            <EditIcon />\n                        </IconButton>\n                        <Spacer />\n                        <IconButton size=\"small\" onClick={handleClickMore}>\n                            <MoreVertIcon />\n                        </IconButton>\n                    </>\n                )}\n            </Background>\n            <Menu anchorEl={anchorEl} open={Boolean(anchorEl)} onClose={handleCloseMenu}>\n                <MenuItem onClick={onCopy}>コピー</MenuItem>\n                <MenuItem onClick={onDelete}>削除</MenuItem>\n            </Menu>\n        </Html>\n    );\n};\n\nexport default HeaderMenu;\n","import Konva from 'konva';\nimport { KonvaEventObject } from 'konva/lib/Node';\nimport { Box } from 'konva/lib/shapes/Transformer';\nimport {\n    Dispatch,\n    MouseEvent,\n    SetStateAction,\n    useCallback,\n    useContext,\n    useEffect,\n    useMemo,\n    useRef,\n    useState,\n} from 'react';\nimport { Image, Rect, Transformer } from 'react-konva';\nimport useImage from 'use-image';\nimport { AppSettingsContext } from '../../../../providers/AppSettingsProvider';\nimport { NoteSettingsContext } from '../../../../providers/NoteSettingsProvider';\nimport { ShapeBaseProps } from '../../../../types/common';\nimport {\n    MinCanvasSize,\n    PageProps,\n    PageSize,\n    PageSizeType,\n    StructureCanvasProps,\n} from '../../../../types/note';\nimport { clone } from '../../../Canvas/util';\nimport HeaderMenu from './HeaderMenu';\n\ninterface Props extends StructureCanvasProps {\n    // ページ情報\n    size: PageSizeType;\n    draggable?: boolean;\n    // キャンバス情報\n    index: number;\n    onChange: Dispatch<SetStateAction<PageProps>>;\n    // 選択状態\n    selected?: boolean;\n    onSelect: VoidFunction;\n}\n\nconst CanvasHandle: React.VFC<Props> = ({\n    size,\n    draggable = false,\n    index,\n    onChange,\n    selected = false,\n    onSelect,\n    data,\n    image: dataURL,\n    ...props\n}) => {\n    const rectRef = useRef<Konva.Rect>(null);\n    const tfRef = useRef<Konva.Transformer>(null);\n    const [isDragging, setDragging] = useState(false);\n    const [image] = useImage(dataURL ?? '');\n\n    const { mode: noteMode } = useContext(NoteSettingsContext);\n    const { mode: appMode, editCanvas, closeCanvas } = useContext(AppSettingsContext);\n\n    const pageSize = useMemo(() => {\n        return PageSize[size];\n    }, [size]);\n\n    const visibleMenu = useMemo(() => {\n        return selected && !isDragging && noteMode === 'select';\n    }, [isDragging, noteMode, selected]);\n\n    const visibleTransformer = useMemo(() => {\n        return draggable && selected;\n    }, [draggable, selected]);\n\n    // 選択時にサイズ変更を可能にする\n    useEffect(() => {\n        if (selected && tfRef.current && rectRef.current) {\n            tfRef.current.nodes([rectRef.current]);\n            // 強制描画\n            tfRef.current.getLayer()?.batchDraw();\n        }\n    }, [selected]);\n\n    /**\n     * 位置/サイズ変更の確定\n     */\n    const handleChange = useCallback(\n        (rect: ShapeBaseProps) => {\n            onChange((page) => {\n                const newPage = clone(page);\n                const d = newPage.structures[index].data;\n                newPage.structures[index] = {\n                    data: d,\n                    ...rect,\n                };\n\n                return newPage;\n            });\n        },\n        [index, onChange]\n    );\n\n    /**\n     * ドラッグ開始\n     */\n    const handleDragStart = useCallback(() => {\n        setDragging(true);\n    }, []);\n\n    /**\n     * 移動\n     */\n    const handleDragMove = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            // イベントを伝播させない\n            event.cancelBubble = true;\n\n            if (rectRef.current) {\n                // ドラッグした位置\n                const { x, y } = event.target.attrs;\n                if (typeof x === 'number' && typeof y === 'number') {\n                    // 位置がページサイズの範囲内になるように x, y を補正\n                    const { width, height } = rectRef.current.getSize();\n                    let [newX, newY] = [x, y];\n\n                    if (newX < 0) {\n                        newX = 0;\n                    } else if (newX > pageSize.width - width) {\n                        newX = pageSize.width - width;\n                    }\n                    if (newY < 0) {\n                        newY = 0;\n                    } else if (newY > pageSize.height - height) {\n                        newY = pageSize.height - height;\n                    }\n\n                    if (x !== newX || y !== newY) {\n                        rectRef.current.setPosition({ x: newX, y: newY });\n                    }\n                }\n            }\n        },\n        [pageSize.height, pageSize.width]\n    );\n\n    /**\n     * 移動の確定\n     */\n    const handleDragEnd = useCallback(\n        (_: KonvaEventObject<Event>) => {\n            if (rectRef.current) {\n                // 現在位置を取得\n                const { x, y } = rectRef.current.getPosition();\n                const { width, height } = rectRef.current.getSize();\n                const newRectProps: ShapeBaseProps = {\n                    x,\n                    y,\n                    width,\n                    height,\n                };\n                // ドラッグ終了\n                setDragging(false);\n                // 更新\n                handleChange(newRectProps);\n            }\n        },\n        [handleChange]\n    );\n\n    /**\n     * サイズを最小値以下にできないように制限\n     */\n    const handleChangeBoundBox = useCallback((oldBox: Box, newBox: Box) => {\n        if (newBox.width < MinCanvasSize.width || newBox.height < MinCanvasSize.height) {\n            return oldBox;\n        }\n        return newBox;\n    }, []);\n\n    /**\n     * サイズ変更の確定\n     */\n    const handleTransformEnd = useCallback(() => {\n        if (rectRef.current) {\n            const rect = rectRef.current;\n            const { x: scaleX, y: scaleY } = rect.scale();\n            // reset scale\n            rect.scale({ x: 1, y: 1 });\n            const newRectProps: ShapeBaseProps = {\n                x: rect.x(),\n                y: rect.y(),\n                width: Math.max(MinCanvasSize.width, rect.width() * scaleX),\n                height: Math.max(MinCanvasSize.height, rect.height() * scaleY),\n            };\n\n            handleChange(newRectProps);\n        }\n    }, [handleChange]);\n\n    const handleEdit = useCallback(\n        (event: MouseEvent<HTMLButtonElement>) => {\n            // ボタンの位置\n            const { top, left } = event.currentTarget.getBoundingClientRect();\n\n            // 編集開始\n            const canvasProps: ShapeBaseProps = {\n                x: left,\n                y: top + 42,\n                width: props.width,\n                height: props.height,\n            };\n            editCanvas(canvasProps);\n        },\n        [editCanvas, props.height, props.width]\n    );\n\n    return (\n        <>\n            <Rect {...props} fill=\"white\" />\n            {image && <Image {...props} image={image} />}\n            <Rect\n                ref={rectRef}\n                stroke=\"black\"\n                strokeWidth={2}\n                draggable={draggable}\n                {...props}\n                onClick={onSelect}\n                onTap={onSelect}\n                onDragStart={handleDragStart}\n                onDragMove={handleDragMove}\n                onDragEnd={handleDragEnd}\n                onTransformEnd={handleTransformEnd}\n            />\n            <HeaderMenu\n                visible={visibleMenu}\n                mode={appMode}\n                {...props}\n                onEdit={handleEdit}\n                onCancel={closeCanvas}\n            />\n            <Transformer\n                ref={tfRef}\n                visible={visibleTransformer}\n                rotateEnabled={false}\n                boundBoxFunc={handleChangeBoundBox}\n            />\n        </>\n    );\n};\n\nexport default CanvasHandle;\n","import { KonvaEventObject } from 'konva/lib/Node';\nimport { Dispatch, SetStateAction, useCallback, useContext, useMemo } from 'react';\nimport { Layer, Rect } from 'react-konva';\nimport { AppSettingsContext } from '../../../providers/AppSettingsProvider';\nimport { PageProps, PageSize } from '../../../types/note';\nimport CanvasHandle from '../nodes/CanvasHandle';\n\ninterface Props extends Pick<PageProps, 'size' | 'structures'> {\n    draggable?: boolean;\n    onChange: Dispatch<SetStateAction<PageProps>>;\n}\n\nconst Frame: React.VFC<Props> = ({ size, structures, draggable = false, onChange }) => {\n    const { selectedCanvasIndex, onSelectCanvas } = useContext(AppSettingsContext);\n\n    const pageSize = useMemo(() => {\n        return PageSize[size];\n    }, [size]);\n\n    const handleClick = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            if (event.target.attrs.type === 'background') {\n                onSelectCanvas(undefined);\n            }\n        },\n        [onSelectCanvas]\n    );\n\n    return (\n        <Layer>\n            {/* クリックが空振りしたときに選択解除する */}\n            <Rect\n                x={0}\n                y={0}\n                {...pageSize}\n                attrs={{ type: 'background' }}\n                onClick={handleClick}\n                onTap={handleClick}\n            />\n            {structures.map((structure, index) => (\n                <CanvasHandle\n                    key={`handle-${index}`}\n                    size={size}\n                    draggable={draggable}\n                    index={index}\n                    onChange={onChange}\n                    selected={index === selectedCanvasIndex}\n                    onSelect={() => onSelectCanvas(index)}\n                    {...structure}\n                />\n            ))}\n        </Layer>\n    );\n};\n\nexport default Frame;\n","import { useMemo } from 'react';\nimport { Layer, Line } from 'react-konva';\nimport { PageSize, PageSizeType } from '../../../types/note';\n\ninterface LineProps {\n    id: string;\n    points: number[];\n    stroke: string;\n    strokeWidth: number;\n    dash: [number, number];\n    listening: boolean;\n}\n\nconst defaultLineProps: LineProps = {\n    id: '',\n    points: [],\n    stroke: '#c9e1ff',\n    strokeWidth: 1,\n    dash: [5, 3],\n    listening: false,\n};\n\nconst GridSize = 50;\n\ninterface Props {\n    size: PageSizeType;\n}\n\nconst Grid: React.VFC<Props> = ({ size }) => {\n    const layerSize = useMemo(() => {\n        return PageSize[size];\n    }, [size]);\n\n    const horizontalLines: LineProps[] = useMemo(() => {\n        const lines: LineProps[] = [];\n        let count = 1;\n        for (let y = 0; y <= layerSize.height; y += GridSize) {\n            lines.push({\n                ...defaultLineProps,\n                id: `Horizontal_${count}`,\n                points: [0, y, layerSize.width, y],\n            });\n            count++;\n        }\n        return lines;\n    }, [layerSize]);\n\n    const verticalLines: LineProps[] = useMemo(() => {\n        const lines: LineProps[] = [];\n        let count = 1;\n        for (let x = 0; x <= layerSize.width; x += GridSize) {\n            lines.push({\n                ...defaultLineProps,\n                id: `Vertical_${count}`,\n                points: [x, 0, x, layerSize.height],\n            });\n            count++;\n        }\n        return lines;\n    }, [layerSize]);\n\n    return (\n        <Layer>\n            {/* horizontal */}\n            {horizontalLines.map((props) => (\n                <Line key={props.id} {...props} />\n            ))}\n            {/* vertical */}\n            {verticalLines.map((props) => (\n                <Line key={props.id} {...props} />\n            ))}\n        </Layer>\n    );\n};\n\nexport default Grid;\n","import Konva from 'konva';\nimport { KonvaEventObject } from 'konva/lib/Node';\nimport {\n    Dispatch,\n    SetStateAction,\n    useCallback,\n    useContext,\n    useMemo,\n    useRef,\n    useState,\n} from 'react';\nimport { Stage } from 'react-konva';\nimport { useContextBridge } from '../../hooks/useContextBridge';\nimport { AppSettingsContext } from '../../providers/AppSettingsProvider';\nimport { ConfigurationContext } from '../../providers/ConfigurationProvider';\nimport { NoteSettingsContext } from '../../providers/NoteSettingsProvider';\nimport { DOMSize } from '../../types/common';\nimport { PageProps, PageSize } from '../../types/note';\nimport { clone } from '../Canvas/util';\nimport Draw from './layer/Draw';\nimport Frame from './layer/Frame';\nimport Grid from './layer/Grid';\n\ninterface Props extends PageProps {\n    viewBox: DOMSize;\n    onChange: Dispatch<SetStateAction<PageProps>>;\n}\n\nconst Page: React.VFC<Props> = ({ viewBox, size, drawings, structures, onChange }) => {\n    const stageRef = useRef<Konva.Stage>(null);\n    const { mode: noteMode, settings } = useContext(NoteSettingsContext);\n    const { mode: appMode } = useContext(AppSettingsContext);\n\n    // Stage 以降で使用する Context を Bridge する\n    const ContextBridge = useContextBridge(\n        AppSettingsContext,\n        ConfigurationContext,\n        NoteSettingsContext\n    );\n\n    // 描画用\n    const isDrawing = useRef<boolean>();\n    const [points, setPoints] = useState<number[]>([]);\n\n    const pageSize = useMemo(() => {\n        return PageSize[size];\n    }, [size]);\n\n    const draggable = useMemo(() => {\n        return appMode === 'note' && noteMode === 'select';\n    }, [appMode, noteMode]);\n\n    /**\n     * ページサイズの範囲で表示領域を移動する\n     */\n    const handleDragMove = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            const { x, y } = event.target.attrs;\n            if (stageRef.current && typeof x === 'number' && typeof y === 'number') {\n                let [newX, newY] = [x, y];\n                let modified = false;\n\n                if (newX > 0) {\n                    newX = 0;\n                    modified = true;\n                } else if (Math.abs(newX) + viewBox.width > pageSize.width) {\n                    newX = viewBox.width - pageSize.width;\n                    modified = true;\n                }\n\n                if (newY > 0) {\n                    newY = 0;\n                    modified = true;\n                } else if (Math.abs(newY) + viewBox.height > pageSize.height) {\n                    newY = viewBox.height - pageSize.height;\n                    modified = true;\n                }\n\n                if (modified) {\n                    stageRef.current.setPosition({ x: newX, y: newY });\n                }\n            }\n        },\n        [pageSize.height, pageSize.width, viewBox.height, viewBox.width]\n    );\n\n    /**\n     * 描画の開始\n     */\n    const handlePointerDown = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            if (noteMode !== 'edit') {\n                return;\n            }\n\n            const point = event.target.getStage()?.getPointerPosition();\n            if (stageRef.current && point) {\n                isDrawing.current = true;\n\n                const { x, y } = stageRef.current.getPosition();\n                setPoints([point.x + Math.abs(x), point.y + Math.abs(y)]);\n            }\n        },\n        [noteMode]\n    );\n\n    /**\n     * ポインタの移動時に位置を取得\n     */\n    const handlePointerMove = useCallback(\n        (event: KonvaEventObject<Event>) => {\n            if (noteMode !== 'edit') {\n                return;\n            }\n            if (!isDrawing.current) {\n                return;\n            }\n\n            const point = event.target.getStage()?.getPointerPosition();\n            if (stageRef.current && point) {\n                const { x, y } = stageRef.current.getPosition();\n                setPoints((state) => [...state, point.x + Math.abs(x), point.y + Math.abs(y)]);\n            }\n        },\n        [noteMode]\n    );\n\n    /**\n     * 描画の確定\n     */\n    const handlePointerUp = useCallback(\n        (_: KonvaEventObject<Event>) => {\n            if (noteMode !== 'edit') {\n                return;\n            }\n            if (!isDrawing.current) {\n                return;\n            }\n\n            isDrawing.current = false;\n            // 更新を確定\n            onChange((page) => {\n                const data = clone(page);\n                // 描画データを追加\n                data.drawings.push({\n                    ...settings,\n                    points,\n                });\n\n                return data;\n            });\n            // 現在の描画データをクリア\n            setPoints([]);\n        },\n        [noteMode, onChange, points, settings]\n    );\n\n    return (\n        <Stage\n            ref={stageRef}\n            width={viewBox.width}\n            height={viewBox.height}\n            draggable={draggable}\n            onDragMove={handleDragMove}\n            onPointerDown={handlePointerDown}\n            onPointerMove={handlePointerMove}\n            onPointerUp={handlePointerUp}\n        >\n            <ContextBridge>\n                <Grid size={size} />\n                <Frame\n                    size={size}\n                    structures={structures}\n                    draggable={draggable}\n                    onChange={onChange}\n                />\n                <Draw drawings={drawings} settings={settings} points={points} />\n            </ContextBridge>\n        </Stage>\n    );\n};\n\nexport default Page;\n","/* eslint-disable @typescript-eslint/explicit-module-boundary-types */\n/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable react-hooks/rules-of-hooks */\nimport * as React from 'react';\n\n// https://github.com/pmndrs/drei/blob/master/src/core/useContextBridge.tsx\nexport const useContextBridge = (...contexts: Array<React.Context<any>>) => {\n    const cRef = React.useRef<Array<React.Context<any>>>([]);\n    cRef.current = contexts.map((context) => React.useContext(context));\n\n    return React.useMemo(\n        () =>\n            ({ children }: { children: React.ReactNode }): JSX.Element =>\n                contexts.reduceRight(\n                    (acc, Context, i) => (\n                        <Context.Provider value={cRef.current[i]} children={acc} />\n                    ),\n                    children\n                ) as unknown as JSX.Element,\n        [contexts]\n    );\n};\n","import { Box } from '@mui/material';\nimport { useContext, useEffect, useRef, useState } from 'react';\nimport { AppSettingsContext } from '../../providers/AppSettingsProvider';\nimport { DOMSize } from '../../types/common';\nimport Page from './Page';\n\nconst Note: React.VFC = () => {\n    // キャンバスの親要素\n    const containerRef = useRef<HTMLDivElement>(null);\n    // 表示領域\n    const [viewBox, setViewBox] = useState<DOMSize>({ width: 0, height: 0 });\n    // ページデータ\n    const { page, onChange } = useContext(AppSettingsContext);\n\n    // 要素のリサイズを監視\n    useEffect(() => {\n        const observer = new ResizeObserver((entries) => {\n            const { width, height } = entries[0].contentRect;\n            setViewBox({\n                width,\n                height,\n            });\n        });\n\n        if (containerRef.current) {\n            observer.observe(containerRef.current);\n        }\n\n        return () => {\n            observer.disconnect();\n        };\n    }, []);\n\n    return (\n        <Box\n            ref={containerRef}\n            sx={{\n                width: 'auto',\n                height: '100%',\n                backgroundColor: '#ffffff',\n                overscrollBehavior: 'contain',\n                overflow: 'hidden',\n            }}\n        >\n            <Page viewBox={viewBox} {...page} onChange={onChange} />\n        </Box>\n    );\n};\n\nexport default Note;\n","import { Box } from '@mui/material';\nimport { useContext, useMemo } from 'react';\nimport { AppSettingsContext } from '../providers/AppSettingsProvider';\nimport { ConfigurationContext } from '../providers/ConfigurationProvider';\nimport { emptyStructure } from '../types/shape';\nimport Canvas from './Canvas';\nimport Note from './Note';\n\nconst MainContainer: React.VFC = () => {\n    const { page, selectedCanvasIndex, canvasProps, canvasRef } = useContext(AppSettingsContext);\n    const { tool } = useContext(ConfigurationContext);\n\n    const structure = useMemo(() => {\n        if (typeof selectedCanvasIndex === 'number') {\n            return page.structures[selectedCanvasIndex].data;\n        }\n    }, [page.structures, selectedCanvasIndex]);\n\n    return (\n        <>\n            <Box\n                sx={{\n                    boxSizing: 'border-box',\n                    ml: 1,\n                    mb: 1,\n                    flex: 1,\n                    border: (theme) => `1px solid ${theme.palette.divider}`,\n                    borderRadius: 1,\n                    overflow: 'hidden',\n                }}\n            >\n                <Note />\n            </Box>\n            {canvasProps && (\n                <Box\n                    sx={{\n                        position: 'absolute',\n                        top: canvasProps.y,\n                        left: canvasProps.x,\n                        width: canvasProps.width,\n                        height: canvasProps.height,\n                        backgroundColor: 'red',\n                    }}\n                >\n                    <Canvas ref={canvasRef} tool={tool} structure={structure ?? emptyStructure} />\n                </Box>\n            )}\n        </>\n    );\n};\n\nexport default MainContainer;\n","import { ArrowDownward, Delete, Edit, PanToolAlt, Texture } from '@mui/icons-material';\nimport { Stack, ToggleButton, ToggleButtonGroup, Typography } from '@mui/material';\nimport { MouseEvent, ReactElement, useCallback, useContext } from 'react';\nimport { ConfigurationContext } from '../../providers/ConfigurationProvider';\nimport { CanvasTool, isCanvasTool } from '../../types/common';\n\ninterface Props {\n    tool: CanvasTool;\n    onChange: (tool: CanvasTool) => void;\n}\n\ninterface ButtonProps {\n    tool: CanvasTool;\n    icon: ReactElement;\n    label: string;\n}\n\nconst ToolboxButtons: Readonly<Record<CanvasTool, ButtonProps>> = {\n    select: {\n        tool: 'select',\n        icon: <PanToolAlt />,\n        label: '選択',\n    },\n    pen: {\n        tool: 'pen',\n        icon: <Edit />,\n        label: '梁要素の描画',\n    },\n    force: {\n        tool: 'force',\n        icon: <ArrowDownward />,\n        label: '集中荷重の追加',\n    },\n    trapezoid: {\n        tool: 'trapezoid',\n        icon: <Texture />,\n        label: '分布荷重の追加',\n    },\n    delete: {\n        tool: 'delete',\n        icon: <Delete />,\n        label: '要素の削除',\n    },\n};\n\nconst CanvasToolboxCore: React.VFC<Props> = ({ tool, onChange }) => {\n    /**\n     * ツールの変更\n     */\n    const handleChange = useCallback(\n        (_: MouseEvent<HTMLElement>, newValue: string | null) => {\n            if (newValue !== null && isCanvasTool(newValue)) {\n                onChange(newValue);\n            }\n        },\n        [onChange]\n    );\n\n    return (\n        <Stack sx={{ width: 160 }} alignItems=\"flex-start\">\n            <Typography variant=\"caption\">Toolbox</Typography>\n            <ToggleButtonGroup\n                orientation=\"vertical\"\n                value={tool}\n                exclusive\n                fullWidth\n                onChange={handleChange}\n            >\n                {Object.entries(ToolboxButtons).map(([key, { icon, label }]) => (\n                    <ToggleButton\n                        key={key}\n                        value={key}\n                        sx={{ justifyContent: 'flex-start', alignItems: 'center' }}\n                    >\n                        {icon}\n                        <Typography variant=\"caption\" sx={{ ml: 1 }}>\n                            {label}\n                        </Typography>\n                    </ToggleButton>\n                ))}\n            </ToggleButtonGroup>\n        </Stack>\n    );\n};\n\nconst CanvasToolbox: React.VFC = () => {\n    const { tool, setTool } = useContext(ConfigurationContext);\n    return <CanvasToolboxCore tool={tool} onChange={setTool} />;\n};\n\nexport default CanvasToolbox;\n","import { AutoFixNormal, Edit, PanToolAlt } from '@mui/icons-material';\nimport {\n    Slider,\n    Stack,\n    TextField,\n    ToggleButton,\n    ToggleButtonGroup,\n    Typography,\n} from '@mui/material';\nimport {\n    ChangeEvent,\n    Dispatch,\n    MouseEvent,\n    ReactElement,\n    SetStateAction,\n    useCallback,\n    useContext,\n} from 'react';\nimport { NoteSettingsContext } from '../../providers/NoteSettingsProvider';\nimport { DrawSettings, isNoteMode, NoteMode } from '../../types/note';\n\ninterface Props {\n    mode: NoteMode;\n    settings: DrawSettings;\n    onChangeMode: Dispatch<SetStateAction<NoteMode>>;\n    onChangeDrawSettings: Dispatch<SetStateAction<DrawSettings>>;\n}\n\nconst DrawModes = ['pen', 'eraser'] as const;\ntype DrawMode = typeof DrawModes[number];\nconst isDrawMode = (item: unknown): item is DrawMode => {\n    if (typeof item === 'string') {\n        return DrawModes.some((mode) => mode === item);\n    }\n    return false;\n};\n\ninterface ButtonProps {\n    mode: NoteMode | DrawMode;\n    icon: ReactElement;\n    label: string;\n}\n\nconst NoteModeButtons: Readonly<Record<NoteMode, ButtonProps>> = {\n    select: {\n        mode: 'select',\n        icon: <PanToolAlt />,\n        label: '選択',\n    },\n    edit: {\n        mode: 'edit',\n        icon: <Edit />,\n        label: '描画',\n    },\n};\n\nconst DrawModeButtons: Readonly<Record<DrawMode, ButtonProps>> = {\n    pen: {\n        mode: 'pen',\n        icon: <Edit />,\n        label: 'ペンツール',\n    },\n    eraser: {\n        mode: 'eraser',\n        icon: <AutoFixNormal />,\n        label: '消しゴム',\n    },\n};\n\nconst MinStrokeWidth = 4;\nconst MaxStrokeWidth = 20;\nconst StrokeWidthStep = 4;\n\nconst NoteToolboxCore: React.VFC<Props> = ({\n    mode,\n    settings,\n    onChangeMode,\n    onChangeDrawSettings,\n}) => {\n    /**\n     * モードの変更\n     */\n    const handleChangeMode = useCallback(\n        (_: MouseEvent<HTMLElement>, newValue: string | null) => {\n            if (newValue !== null && isNoteMode(newValue)) {\n                onChangeMode(newValue);\n            }\n        },\n        [onChangeMode]\n    );\n\n    /**\n     * 描画ツールの選択\n     */\n    const handleChangeTool = useCallback(\n        (_: MouseEvent<HTMLElement>, newValue: string | null) => {\n            if (newValue !== null && isDrawMode(newValue)) {\n                onChangeDrawSettings((state) => ({\n                    ...state,\n                    eraser: newValue === 'eraser',\n                }));\n            }\n        },\n        [onChangeDrawSettings]\n    );\n\n    const handleChangeStrokeWidth = useCallback(\n        (_: Event, value: number | number[]) => {\n            if (typeof value === 'number') {\n                onChangeDrawSettings((state) => ({\n                    ...state,\n                    strokeWidth: value,\n                }));\n            }\n        },\n        [onChangeDrawSettings]\n    );\n\n    const handleChangeStroke = useCallback(\n        (event: ChangeEvent<HTMLInputElement>) => {\n            if (event.target.checkValidity()) {\n                const { value } = event.target;\n                onChangeDrawSettings((state) => ({\n                    ...state,\n                    stroke: value,\n                }));\n            }\n        },\n        [onChangeDrawSettings]\n    );\n\n    return (\n        <Stack sx={{ width: 160 }} alignItems=\"flex-start\">\n            <Typography variant=\"caption\">Toolbox</Typography>\n            {/* 選択 / 編集の切り替え */}\n            <ToggleButtonGroup\n                orientation=\"vertical\"\n                value={mode}\n                exclusive\n                fullWidth\n                onChange={handleChangeMode}\n            >\n                {Object.entries(NoteModeButtons).map(([key, { icon, label }]) => (\n                    <ToggleButton\n                        key={key}\n                        value={key}\n                        sx={{ justifyContent: 'flex-start', alignItems: 'center' }}\n                    >\n                        {icon}\n                        <Typography variant=\"caption\" sx={{ ml: 1 }}>\n                            {label}\n                        </Typography>\n                    </ToggleButton>\n                ))}\n            </ToggleButtonGroup>\n            <Typography variant=\"caption\" sx={{ mt: 1 }}>\n                描画ツール\n            </Typography>\n            {/* eraser */}\n            <ToggleButtonGroup\n                orientation=\"vertical\"\n                value={settings.eraser ? 'eraser' : 'pen'}\n                exclusive\n                fullWidth\n                disabled={mode === 'select'}\n                onChange={handleChangeTool}\n            >\n                {Object.entries(DrawModeButtons).map(([key, { icon, label }]) => (\n                    <ToggleButton\n                        key={key}\n                        value={key}\n                        sx={{ justifyContent: 'flex-start', alignItems: 'center' }}\n                    >\n                        {icon}\n                        <Typography variant=\"caption\" sx={{ ml: 1 }}>\n                            {label}\n                        </Typography>\n                    </ToggleButton>\n                ))}\n            </ToggleButtonGroup>\n            {/* strokeWidth */}\n            <Typography variant=\"caption\" sx={{ mt: 1 }}>\n                太さ\n            </Typography>\n            <Slider\n                sx={{ ml: 1, mb: 2, boxSizing: 'border-box', width: 140 }}\n                value={settings.strokeWidth}\n                min={MinStrokeWidth}\n                max={MaxStrokeWidth}\n                step={StrokeWidthStep}\n                marks\n                valueLabelDisplay=\"auto\"\n                disabled={mode === 'select'}\n                onChange={handleChangeStrokeWidth}\n            />\n            {/* stroke */}\n            <TextField\n                type=\"color\"\n                label=\"ペンの色\"\n                value={settings.stroke}\n                disabled={mode === 'select' || settings.eraser}\n                fullWidth\n                margin=\"dense\"\n                size=\"small\"\n                onChange={handleChangeStroke}\n            />\n        </Stack>\n    );\n};\n\nconst NoteToolbox: React.VFC = () => {\n    const props = useContext(NoteSettingsContext);\n    return <NoteToolboxCore {...props} />;\n};\n\nexport default NoteToolbox;\n","import { useContext } from 'react';\nimport { AppSettingsContext } from '../../providers/AppSettingsProvider';\nimport CanvasToolbox from './CanvasToolbox';\nimport NoteToolbox from './NoteToolbox';\n\nconst Toolbox: React.VFC = () => {\n    const { mode } = useContext(AppSettingsContext);\n    if (mode === 'canvas') {\n        return <CanvasToolbox />;\n    }\n    return <NoteToolbox />;\n};\n\nexport default Toolbox;\n","import { Box } from '@mui/material';\nimport { useCallback, useEffect, useState } from 'react';\nimport { DOMSize } from '../types/common';\nimport Header from './Header';\nimport MainContainer from './MainContainer';\nimport Toolbox from './Toolbox';\n\nconst Layout: React.VFC = () => {\n    const [windowRect, setWindowRect] = useState<DOMSize>({ width: 0, height: 0 });\n\n    const fitWindowSize = useCallback(() => {\n        const { innerHeight, innerWidth } = window;\n        setWindowRect({\n            height: innerHeight,\n            width: innerWidth,\n        });\n    }, []);\n\n    useEffect(() => {\n        fitWindowSize();\n        window.addEventListener('resize', fitWindowSize);\n\n        return () => {\n            window.removeEventListener('resize', fitWindowSize);\n        };\n    }, [fitWindowSize]);\n\n    return (\n        <Box sx={{ ...windowRect, overflow: 'hidden' }}>\n            <Header />\n            <Box\n                sx={{\n                    boxSizing: 'border-box',\n                    width: 'auto',\n                    height: 'calc(100% - 48px)',\n                    display: 'flex',\n                    flexDirection: 'row',\n                    flexWrap: 'nowrap',\n                    alignItems: 'stretch',\n                    pt: 1,\n                    px: 1,\n                }}\n            >\n                <Toolbox />\n                <MainContainer />\n            </Box>\n        </Box>\n    );\n};\n\nexport default Layout;\n","import { createTheme, CssBaseline, ThemeProvider } from '@mui/material';\nimport React from 'react';\nimport AppSettingsProvider from '../providers/AppSettingsProvider';\nimport ConfigurationProvider from '../providers/ConfigurationProvider';\nimport NoteSettingsProvider from '../providers/NoteSettingsProvider';\nimport Layout from './Layout';\n\nconst theme = createTheme();\n\nconst App: React.VFC = () => {\n    return (\n        <ThemeProvider theme={theme}>\n            <AppSettingsProvider>\n                <ConfigurationProvider>\n                    <NoteSettingsProvider>\n                        <CssBaseline />\n                        <Layout />\n                    </NoteSettingsProvider>\n                </ConfigurationProvider>\n            </AppSettingsProvider>\n        </ThemeProvider>\n    );\n};\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler): void => {\n    if (onPerfEntry && onPerfEntry instanceof Function) {\n        import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n            getCLS(onPerfEntry);\n            getFID(onPerfEntry);\n            getFCP(onPerfEntry);\n            getLCP(onPerfEntry);\n            getTTFB(onPerfEntry);\n        });\n    }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './components/App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n    <React.StrictMode>\n        <App />\n    </React.StrictMode>,\n    document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}