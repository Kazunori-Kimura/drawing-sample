(this["webpackJsonpdrawing-sample"]=this["webpackJsonpdrawing-sample"]||[]).push([[0],{76:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),o=n(54),i=n.n(o),a=n(57),u=n(110),s=n(114),l=n(7),b=n(1),d=Object(r.createContext)(void 0),j=function(e){var t=e.children,n=Object(r.useState)("select"),c=Object(l.a)(n,2),o=c[0],i=c[1];return Object(b.jsx)(d.Provider,{value:{tool:o,setTool:i},children:t})},f=n(9),O=n(111),v={unit:{force:"kN",length:"m"},nodes:[],beams:[],forces:[],trapezoids:[]},h=n(26),x=n(16),g=n(20),p=function(e){return JSON.parse(JSON.stringify(e))},m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=Math.pow(10,t),r=Math.round(e*n)/n;return r},w=n(106),C=function(e,t){return{id:Object(w.a)(),x:e,y:t}},y=n(29),S=n.n(y),k=function(e){var t=e.disabled,n=void 0!==t&&t,c=e.structure,o=e.setStructure,i=Object(r.useState)([]),a=Object(l.a)(i,2),u=a[0],s=a[1],b=Object(r.useRef)(!1),d=Object(r.useCallback)((function(e){var t;if(!n){var r=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();r&&(b.current=!0,s([r.x,r.y]))}}),[n]),j=Object(r.useCallback)((function(e){var t;if(!n&&b.current){var r=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();r&&(b.current=!0,s((function(e){return[].concat(Object(g.a)(e),[r.x,r.y])})))}}),[n]),f=Object(r.useCallback)((function(){if(!n&&(b.current=!1,o&&u.length>=4)){var e=JSON.parse(JSON.stringify(c)),t=u.slice(0,2),r=u.slice(-2),i=C(t[0],t[1]),a=C(r[0],r[1]);e.nodes.push(i,a);var l=function(e,t,n){return{id:Object(w.a)(),name:e,nodeI:t,nodeJ:n}}("Beam_".concat(e.beams.length+1),i.id,a.id);e.beams.push(l),o(e),s([])}}),[n,u,o,c]);return Object(r.useEffect)((function(){n&&s([])}),[n]),{points:u,onPointerDown:d,onPointerMove:j,onPointerUp:f}},z=function(e){var t=e.points;return Object(b.jsx)(x.c,{children:Object(b.jsx)(x.d,{points:t,strokeWidth:3,stroke:"blue"})})},I=["nodeI","nodeJ"],P=["beam","force"],J=Object(r.createContext)(void 0),E=function(e){var t=e.children,n=e.tool,c=void 0===n?"select":n,o=e.size,i=e.structure,a=e.setStructure,u=Object(r.useMemo)((function(){var e={};return i.nodes.forEach((function(t){e[t.id]=t})),e}),[i.nodes]),s=Object(r.useMemo)((function(){var e={};return i.beams.forEach((function(t){var n=t.nodeI,r=t.nodeJ,c=Object(h.a)(t,I),o=Object(f.a)(Object(f.a)({},c),{},{nodeI:u[n],nodeJ:u[r]});e[c.id]=o})),e}),[u,i.beams]),l=Object(r.useMemo)((function(){var e=i.forces,t={};if(e.length>0){var n=e.map((function(e){return e.force})).reduce((function(e,t){return e+t}))/e.length;e.forEach((function(e){var r=e.beam,c=e.force,o=Object(h.a)(e,P),i=c/n;t[o.id]=Object(f.a)(Object(f.a)({},o),{},{force:c,forceRatio:i,beam:s[r]})}))}return t}),[s,i]),d=Object(r.useCallback)((function(e){var t=p(i),n="Force_".concat(t.forces.length+1),r=function(e){return Object(f.a)(Object(f.a)({},e),{},{id:Object(w.a)()})}(Object(f.a)({name:n},e));t.forces.push(r),a&&a(t)}),[a,i]),j=Object(r.useCallback)((function(e){var t=i.forces.findIndex((function(t){return t.id===e}));if(t>=0){var n=p(i);n.forces.splice(t,1),a&&a(n)}}),[a,i]),O=Object(r.useCallback)((function(e){var t=i.beams.findIndex((function(t){return t.id===e}));if(t>=0){var n=i.beams[t],r=n.nodeI,c=n.nodeJ,o=p(i);o.beams.splice(t,1),[r,c].forEach((function(e){var t=o.beams.some((function(t){var n=t.nodeI,r=t.nodeJ;return e===n||e===r}));if(!t){var n=o.nodes.findIndex((function(t){return t.id===e}));n>=0&&o.nodes.splice(n,1)}}));var u=o.forces.filter((function(t){return t.beam!==e}));o.forces=u;var s=o.trapezoids.filter((function(t){return t.beam!==e}));o.trapezoids=s,a&&a(o)}}),[a,i]);return Object(b.jsx)(J.Provider,{value:{tool:c,size:o,structure:i,nodes:u,beams:s,forces:l,addForce:d,deleteForce:j,deleteBeam:O,setStructure:a},children:t})},M={id:"",points:[],stroke:"#c9e1ff",strokeWidth:1,dash:[5,3],listening:!1},B=function(){var e=Object(r.useContext)(J).size,t=Object(r.useMemo)((function(){for(var t=[],n=1,r=0;r<=e.height;r+=25)t.push(Object(f.a)(Object(f.a)({},M),{},{id:"Horizontal_".concat(n),points:[0,r,e.width,r]})),n++;return t}),[e.height,e.width]),n=Object(r.useMemo)((function(){for(var t=[],n=1,r=0;r<=e.width;r+=25)t.push(Object(f.a)(Object(f.a)({},M),{},{id:"Vertical_".concat(n),points:[r,0,r,e.height]})),n++;return t}),[e.height,e.width]);return Object(b.jsxs)(x.c,{listening:!1,children:[t.map((function(e){return Object(b.jsx)(x.d,Object(f.a)({},e),e.id)})),n.map((function(e){return Object(b.jsx)(x.d,Object(f.a)({},e),e.id)}))]})},R=function(e){var t=e.id,n=e.nodeI,c=e.nodeJ,o=Object(r.useContext)(J),i=o.tool,a=o.addForce,u=o.deleteBeam,s=Object(r.useState)([]),d=Object(l.a)(s,2),j=d[0],f=d[1],O=Object(r.useRef)(new S.a(0,0)),v=Object(r.useRef)(new S.a(0,0)),h=Object(r.useCallback)((function(e){if("force"===i){var n,r=null===(n=e.target.getStage())||void 0===n?void 0:n.getPointerPosition();if(r){var c=new S.a(r.x,r.y),o=function(e,t,n,r){var c=t.distance(n),o=t.distance(r);return{beam:e,force:10,distanceI:m(o/c)}}(t,O.current,v.current,c);a(o),e.cancelBubble=!0}}else"delete"===i&&(u(t),e.cancelBubble=!0)}),[a,t,u,i]);return Object(r.useEffect)((function(){f([n.x,n.y,c.x,c.y]),O.current.x=n.x,O.current.y=n.y,v.current.x=c.x,v.current.y=c.y}),[n.x,n.y,c.x,c.y]),Object(b.jsx)(x.d,{points:j,stroke:"black",strokeWidth:3,onClick:h,onTap:h})},F=function(e){var t=e.id,n=e.beam,c=e.distanceI,o=e.forceRatio,i=Object(r.useContext)(J),a=i.deleteForce,u=i.tool,s=Object(r.useMemo)((function(){var e=n.nodeI,t=n.nodeJ,r=new S.a(e.x,e.y),i=new S.a(t.x,t.y),a=function(e,t,n){var r=t.clone().subtract(e).normalize(),c=e.distance(t),o=r.multiplyScalar(c*n);return e.clone().add(o)}(r,i,c),u=function(e,t){var n=t.clone().subtract(e).normalize();return new S.a(n.y,-1*n.x).normalize()}(r,i),s=a.clone().add(u.multiplyScalar(30*o));return[s.x,s.y,a.x,a.y]}),[n,c,o]),l=Object(r.useCallback)((function(e){"delete"===u&&(a(t),e.cancelBubble=!0)}),[a,t,u]);return Object(b.jsx)(x.a,{points:s,pointerLength:6,pointerWidth:6,fill:"orange",stroke:"orange",strokeWidth:2,onClick:l,onTap:l})},W=function(e){var t=e.id,n=e.x,c=e.y,o=e.draggable,i=void 0!==o&&o,a=e.onChange,u=Object(r.useState)(!1),s=Object(l.a)(u,2),d=s[0],j=s[1],f=Object(r.useRef)({x:n,y:c}),O=Object(r.useCallback)((function(){if(i){var e={id:t,x:f.current.x,y:f.current.y};a(e)}}),[i,t,a]),v=Object(r.useCallback)((function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&(f.current=n,j(!0))}),[]),h=Object(r.useCallback)((function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&(f.current=n)}),[]),g=Object(r.useCallback)((function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&(f.current=n,j(!1))}),[]);return Object(r.useEffect)((function(){var e;return i&&(O(),d?e=setInterval(O,100):e&&(clearInterval(e),e=void 0)),function(){e&&clearInterval(e)}}),[i,d,O]),Object(b.jsx)(x.b,{id:t,x:n,y:c,fill:d?"blue":"black",radius:4,draggable:i,onDragStart:v,onDragMove:h,onDragEnd:g})},D=function(){var e=Object(r.useContext)(J),t=e.tool,n=e.nodes,c=e.beams,o=e.forces,i=e.setStructure,a=Object(r.useCallback)((function(e){var t=e.id,n=e.x,r=e.y;i&&i((function(e){var c=p(e),o=c.nodes.find((function(e){return e.id===t}));return o&&(o.x=n,o.y=r),c}))}),[i]);return Object(b.jsxs)(x.c,{children:[Object.entries(c).map((function(e){var t=Object(l.a)(e,2),n=t[0],r=t[1];return Object(b.jsx)(R,Object(f.a)({},r),n)})),Object.entries(n).map((function(e){var n=Object(l.a)(e,2),r=n[0],c=n[1];return Object(b.jsx)(W,Object(f.a)(Object(f.a)({},c),{},{draggable:"pen"!==t&&Boolean(i),onChange:a}),r)})),Object.entries(o).map((function(e){var t=Object(l.a)(e,2),n=t[0],r=t[1];return Object(b.jsx)(F,Object(f.a)({},r),n)}))]})},T=["points"],L=function(e){var t=e.tool,n=e.structure,r=e.size,c=e.readonly,o=void 0!==c&&c,i=e.setStructure,a=k({disabled:o||"pen"!==t,structure:n,setStructure:i}),u=a.points,s=Object(h.a)(a,T);return Object(b.jsx)(x.e,Object(f.a)(Object(f.a)({width:r.width,height:r.height},s),{},{children:Object(b.jsxs)(E,{size:r,structure:n,tool:t,setStructure:i,children:[Object(b.jsx)(B,{}),Object(b.jsx)(D,{}),Object(b.jsx)(z,{points:u})]})}))},N=["tool"],_=function(e){var t=e.tool,n=void 0===t?"select":t,c=Object(h.a)(e,N),o=Object(r.useState)({width:0,height:0}),i=Object(l.a)(o,2),a=i[0],u=i[1],s=Object(r.useRef)(null);return Object(r.useEffect)((function(){var e=new ResizeObserver((function(e){var t=e[0].contentRect,n=t.width,r=t.height;u({width:n,height:r})}));return s.current&&e.observe(s.current),function(){e.disconnect()}}),[]),Object(b.jsx)(O.a,{ref:s,sx:{width:"auto",height:"100%",backgroundColor:"#ffffff",overscrollBehavior:"contain"},children:Object(b.jsx)(L,Object(f.a)({size:a,tool:n},c))})},H=function(){var e=Object(r.useContext)(d).tool,t=Object(r.useState)(v),n=Object(l.a)(t,2),c=n[0],o=n[1];return Object(b.jsx)(O.a,{sx:{boxSizing:"border-box",ml:1,mb:1,flex:1,border:function(e){return"1px solid ".concat(e.palette.divider)},borderRadius:1,overflow:"hidden"},children:Object(b.jsx)(_,{tool:e,structure:c,setStructure:o})})},U=n(107),V=n(112),q=n(113),A=function(){return Object(b.jsx)(U.a,{position:"static",children:Object(b.jsx)(V.a,{variant:"dense",children:Object(b.jsx)(q.a,{component:"h1",variant:"h6",color:"inherit",children:"Drawing Sample"})})})},G=n(98),K=n(99),Q=n(100),X=n(101),Y=n(102),Z=n(103),$=n(109),ee=n(105),te=["select","pen","force","trapezoid","delete"],ne={select:{tool:"select",icon:Object(b.jsx)(G.a,{}),label:"\u9078\u629e"},pen:{tool:"pen",icon:Object(b.jsx)(K.a,{}),label:"\u6881\u8981\u7d20\u306e\u63cf\u753b"},force:{tool:"force",icon:Object(b.jsx)(Q.a,{}),label:"\u96c6\u4e2d\u8377\u91cd\u306e\u8ffd\u52a0"},trapezoid:{tool:"trapezoid",icon:Object(b.jsx)(X.a,{}),label:"\u5206\u5e03\u8377\u91cd\u306e\u8ffd\u52a0"},delete:{tool:"delete",icon:Object(b.jsx)(Y.a,{}),label:"\u8981\u7d20\u306e\u524a\u9664"}},re=function(e){var t=e.tool,n=e.onChange,c=Object(r.useCallback)((function(e,t){var r;null!==t&&("string"===typeof(r=t)&&te.some((function(e){return e===r})))&&n(t)}),[n]);return Object(b.jsxs)(Z.a,{sx:{width:160},alignItems:"flex-start",children:[Object(b.jsx)(q.a,{variant:"caption",children:"Toolbox"}),Object(b.jsx)($.a,{orientation:"vertical",value:t,exclusive:!0,fullWidth:!0,onChange:c,children:Object.entries(ne).map((function(e){var t=Object(l.a)(e,2),n=t[0],r=t[1],c=r.icon,o=r.label;return Object(b.jsxs)(ee.a,{value:n,sx:{justifyContent:"flex-start",alignItems:"center"},children:[c,Object(b.jsx)(q.a,{variant:"caption",sx:{ml:1},children:o})]},n)}))})]})},ce=function(){var e=Object(r.useContext)(d),t=e.tool,n=e.setTool;return Object(b.jsx)(re,{tool:t,onChange:n})},oe=function(){var e=Object(r.useState)({width:0,height:0}),t=Object(l.a)(e,2),n=t[0],c=t[1],o=Object(r.useCallback)((function(){var e=window,t=e.innerHeight,n=e.innerWidth;c({height:t,width:n})}),[]);return Object(r.useEffect)((function(){return o(),window.addEventListener("resize",o),function(){window.removeEventListener("resize",o)}}),[o]),Object(b.jsxs)(O.a,{sx:Object(f.a)(Object(f.a)({},n),{},{overflow:"hidden"}),children:[Object(b.jsx)(A,{}),Object(b.jsxs)(O.a,{sx:{boxSizing:"border-box",width:"auto",height:"calc(100% - 48px)",display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"stretch",pt:1,px:1},children:[Object(b.jsx)(ce,{}),Object(b.jsx)(H,{})]})]})},ie=Object(a.a)(),ae=function(){return Object(b.jsx)(u.a,{theme:ie,children:Object(b.jsxs)(j,{children:[Object(b.jsx)(s.a,{}),Object(b.jsx)(oe,{})]})})},ue=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,115)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,o=t.getLCP,i=t.getTTFB;n(e),r(e),c(e),o(e),i(e)}))};i.a.render(Object(b.jsx)(c.a.StrictMode,{children:Object(b.jsx)(ae,{})}),document.getElementById("root")),ue()}},[[76,1,2]]]);
//# sourceMappingURL=main.67ffc96a.chunk.js.map