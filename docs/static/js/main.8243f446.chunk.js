(this["webpackJsonpdrawing-sample"]=this["webpackJsonpdrawing-sample"]||[]).push([[0],{76:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),i=n(54),o=n.n(i),a=n(57),u=n(110),s=n(114),b=n(7),d=n(1),l=Object(r.createContext)(void 0),j=function(e){var t=e.children,n=Object(r.useState)("select"),c=Object(b.a)(n,2),i=c[0],o=c[1];return Object(d.jsx)(l.Provider,{value:{tool:i,setTool:o},children:t})},f=n(8),O=n(111),v={unit:{force:"kN",length:"m"},nodes:[],beams:[],forces:[],trapezoids:[]},x=n(26),h=n(10),g=n(17),p=function(e){return JSON.parse(JSON.stringify(e))},m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=Math.pow(10,t),r=Math.round(e*n)/n;return r},y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,n=e/t,r=Math.round(n)*t;return r},S=function(e){var t=Object(b.a)(e,2),n=t[0],r=t[1],c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25;return[y(n,c),y(r,c)]},w=n(106),C=function(e,t){return{id:Object(w.a)(),x:e,y:t}},k=n(29),z=n.n(k),I=function(e){var t=e.disabled,n=void 0!==t&&t,c=e.snapSize,i=void 0===c?25:c,o=e.structure,a=e.setStructure,u=Object(r.useState)([]),s=Object(b.a)(u,2),d=s[0],l=s[1],j=Object(r.useRef)(!1),f=Object(r.useCallback)((function(e){var t;if(!n){var r=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();r&&(j.current=!0,l([r.x,r.y]))}}),[n]),O=Object(r.useCallback)((function(e){var t;if(!n&&j.current){var r=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();r&&(j.current=!0,l((function(e){return[].concat(Object(g.a)(e),[r.x,r.y])})))}}),[n]),v=Object(r.useCallback)((function(){if(!n&&(j.current=!1,a&&d.length>=4)){var e=p(o),t=d.slice(0,2),r=d.slice(-2),c=S([t[0],t[1]],i),u=S([r[0],r[1]],i),s=C.apply(void 0,Object(g.a)(c)),b=e.nodes.find((function(e){return e.x===s.x&&e.y===s.y}));b?s.id=b.id:e.nodes.push(s);var f=C.apply(void 0,Object(g.a)(u)),O=e.nodes.find((function(e){return e.x===f.x&&e.y===f.y}));O?f.id=O.id:e.nodes.push(f);var v=function(e,t,n){return{id:Object(w.a)(),name:e,nodeI:t,nodeJ:n}}("Beam_".concat(e.beams.length+1),s.id,f.id);e.beams.push(v),a(e),l([])}}),[n,d,a,i,o]);return Object(r.useEffect)((function(){n&&l([])}),[n]),{points:d,onPointerDown:f,onPointerMove:O,onPointerUp:v}},E=function(e){var t=e.points;return Object(d.jsx)(h.d,{children:Object(d.jsx)(h.e,{points:t,strokeWidth:3,stroke:"blue"})})},M=["nodeI","nodeJ"],P=["beam","force"],R=Object(r.createContext)(void 0),J=function(e){var t=e.children,n=e.tool,c=void 0===n?"select":n,i=e.size,o=e.gridSize,a=void 0===o?25:o,u=e.snapSize,s=void 0===u?25:u,b=e.structure,l=e.setStructure,j=Object(r.useMemo)((function(){var e={};return b.nodes.forEach((function(t){e[t.id]=t})),e}),[b.nodes]),O=Object(r.useMemo)((function(){var e={};return b.beams.forEach((function(t){var n=t.nodeI,r=t.nodeJ,c=Object(x.a)(t,M),i=Object(f.a)(Object(f.a)({},c),{},{nodeI:j[n],nodeJ:j[r]});e[c.id]=i})),e}),[j,b.beams]),v=Object(r.useMemo)((function(){var e=b.forces,t={};if(e.length>0){var n=e.map((function(e){return e.force})).reduce((function(e,t){return e+t}))/e.length;e.forEach((function(e){var r=e.beam,c=e.force,i=Object(x.a)(e,P),o=c/n;t[i.id]=Object(f.a)(Object(f.a)({},i),{},{force:c,forceRatio:o,beam:O[r]})}))}return t}),[O,b]),h=Object(r.useCallback)((function(e){var t=p(b),n="Force_".concat(t.forces.length+1),r=function(e){return Object(f.a)(Object(f.a)({},e),{},{id:Object(w.a)()})}(Object(f.a)({name:n},e));t.forces.push(r),l&&l(t)}),[l,b]),g=Object(r.useCallback)((function(e){var t=b.forces.findIndex((function(t){return t.id===e}));if(t>=0){var n=p(b);n.forces.splice(t,1),l&&l(n)}}),[l,b]),m=Object(r.useCallback)((function(e){var t=b.beams.findIndex((function(t){return t.id===e}));if(t>=0){var n=b.beams[t],r=n.nodeI,c=n.nodeJ,i=p(b);i.beams.splice(t,1),[r,c].forEach((function(e){var t=i.beams.some((function(t){var n=t.nodeI,r=t.nodeJ;return e===n||e===r}));if(!t){var n=i.nodes.findIndex((function(t){return t.id===e}));n>=0&&i.nodes.splice(n,1)}}));var o=i.forces.filter((function(t){return t.beam!==e}));i.forces=o;var a=i.trapezoids.filter((function(t){return t.beam!==e}));i.trapezoids=a,l&&l(i)}}),[l,b]);return Object(d.jsx)(R.Provider,{value:{tool:c,size:i,gridSize:a,snapSize:s,structure:b,nodes:j,beams:O,forces:v,addForce:h,deleteForce:g,deleteBeam:m,setStructure:l},children:t})},_={id:"",points:[],stroke:"#c9e1ff",strokeWidth:1,dash:[5,3],listening:!1},F=function(){var e=Object(r.useContext)(R),t=e.size,n=e.gridSize,c=Object(r.useMemo)((function(){for(var e=[],r=1,c=0;c<=t.height;c+=n)e.push(Object(f.a)(Object(f.a)({},_),{},{id:"Horizontal_".concat(r),points:[0,c,t.width,c]})),r++;return e}),[n,t.height,t.width]),i=Object(r.useMemo)((function(){for(var e=[],r=1,c=0;c<=t.width;c+=n)e.push(Object(f.a)(Object(f.a)({},_),{},{id:"Vertical_".concat(r),points:[c,0,c,t.height]})),r++;return e}),[n,t.height,t.width]);return Object(d.jsxs)(h.d,{listening:!1,children:[c.map((function(e){return Object(d.jsx)(h.e,Object(f.a)({},e),e.id)})),i.map((function(e){return Object(d.jsx)(h.e,Object(f.a)({},e),e.id)}))]})},N={fill:"silver",stroke:"silver",strokeWidth:1,listening:!1},B=Object(f.a)({pointerLength:6,pointerWidth:6,pointerAtBeginning:!0},N),T=function(e){var t=e.start,n=e.end,c=Object(r.useRef)(new z.a(0,0)),i=Object(r.useRef)(new z.a(0,0)),o=Object(r.useState)(0),a=Object(b.a)(o,2),u=a[0],s=a[1],l=Object(r.useState)(0),j=Object(b.a)(l,2),O=j[0],v=j[1];return Object(r.useEffect)((function(){c.current.x=t[0],c.current.y=t[1],i.current.x=n[0],i.current.y=n[1];var e=c.current.distance(i.current),r=i.current.clone().subtract(c.current).normalize().angleDeg();s(e),v(r)}),[n,t]),Object(d.jsxs)(h.c,{x:t[0],y:t[1],rotation:O,children:[Object(d.jsx)(h.e,Object(f.a)({points:[0,0,0,10]},N)),Object(d.jsx)(h.a,Object(f.a)({points:[0,5,u,5]},B)),Object(d.jsx)(h.e,Object(f.a)({points:[u,0,u,10]},N)),Object(d.jsx)(h.g,{x:0,y:-8,text:"".concat(u,"px"),fontSize:12,fill:"silver",width:u,align:"center",listening:!1})]})},W=function(){var e=Object(r.useContext)(R).nodes,t=Object(r.useMemo)((function(){var t={max:Number.MIN_SAFE_INTEGER,min:Number.MAX_SAFE_INTEGER,guides:[]},n=new Set;if(Object.values(e).forEach((function(e){var r=e.y;t.max<r&&(t.max=r),t.min>r&&(t.min=r),n.has(r)||n.add(r)})),n.size>1)for(var r=Array.from(n).sort((function(e,t){return e<t?-1:1})),c=r[0],i=1;i<r.length;i++){var o=r[i],a={key:"LocalGuide_".concat(i),start:[55,c],end:[55,o]};c=o,t.guides.push(a)}return t}),[e]),n=t.min,c=t.max,i=t.guides;return n===Number.MAX_SAFE_INTEGER||c===Number.MIN_SAFE_INTEGER?null:Object(d.jsxs)(h.d,{listening:!1,children:[Object(d.jsx)(T,{start:[30,n],end:[30,c]}),i.map((function(e){return Object(d.jsx)(T,Object(f.a)({},e))}))]})},A=function(e){var t=e.id,n=e.nodeI,c=e.nodeJ,i=Object(r.useContext)(R),o=i.tool,a=i.addForce,u=i.deleteBeam,s=Object(r.useState)([]),l=Object(b.a)(s,2),j=l[0],f=l[1],O=Object(r.useRef)(new z.a(0,0)),v=Object(r.useRef)(new z.a(0,0)),x=Object(r.useCallback)((function(e){if("force"===o){var n,r=null===(n=e.target.getStage())||void 0===n?void 0:n.getPointerPosition();if(r){var c=new z.a(r.x,r.y),i=function(e,t,n,r){var c=t.distance(n),i=t.distance(r);return{beam:e,force:10,distanceI:m(i/c)}}(t,O.current,v.current,c);a(i),e.cancelBubble=!0}}else"delete"===o&&(u(t),e.cancelBubble=!0)}),[a,t,u,o]);return Object(r.useEffect)((function(){f([n.x,n.y,c.x,c.y]),O.current.x=n.x,O.current.y=n.y,v.current.x=c.x,v.current.y=c.y}),[n.x,n.y,c.x,c.y]),Object(d.jsx)(h.e,{points:j,stroke:"black",strokeWidth:3,onClick:x,onTap:x})},D=function(e){var t=e.id,n=e.beam,c=e.distanceI,i=e.forceRatio,o=Object(r.useContext)(R),a=o.deleteForce,u=o.tool,s=Object(r.useMemo)((function(){var e=n.nodeI,t=n.nodeJ,r=new z.a(e.x,e.y),o=new z.a(t.x,t.y),a=function(e,t,n){var r=t.clone().subtract(e).normalize(),c=e.distance(t),i=r.multiplyScalar(c*n);return e.clone().add(i)}(r,o,c),u=function(e,t){var n=t.clone().subtract(e).normalize();return new z.a(n.y,-1*n.x).normalize()}(r,o),s=a.clone().add(u.multiplyScalar(30*i));return[s.x,s.y,a.x,a.y]}),[n,c,i]),b=Object(r.useCallback)((function(e){"delete"===u&&(a(t),e.cancelBubble=!0)}),[a,t,u]);return Object(d.jsx)(h.a,{points:s,pointerLength:6,pointerWidth:6,fill:"orange",stroke:"orange",strokeWidth:2,onClick:b,onTap:b})},L=function(e){var t=e.id,n=e.x,c=e.y,i=e.draggable,o=void 0!==i&&i,a=e.onChange,u=e.onCommit,s=Object(r.useState)(!1),l=Object(b.a)(s,2),j=l[0],f=l[1],O=Object(r.useRef)({x:n,y:c}),v=Object(r.useRef)(),x=Object(r.useCallback)((function(){if(o){var e={id:t,x:O.current.x,y:O.current.y};a&&a(e)}}),[o,t,a]),g=Object(r.useCallback)((function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&(O.current=n,f(!0))}),[]),p=Object(r.useCallback)((function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&(O.current=n)}),[]),m=Object(r.useCallback)((function(e){var n,r=null===(n=e.target.getStage())||void 0===n?void 0:n.getPointerPosition();if(r){O.current=r,f(!1),v.current&&(clearInterval(v.current),v.current=void 0);var c={id:t,x:O.current.x,y:O.current.y};u&&u(c)}}),[t,u]);return Object(r.useEffect)((function(){var e=v.current;return o&&j&&(x(),v.current=setInterval(x,100)),function(){e&&clearInterval(e)}}),[o,j,x]),Object(d.jsx)(h.b,{id:t,x:n,y:c,fill:j?"blue":"black",radius:4,draggable:o,onDragStart:g,onDragMove:p,onDragEnd:m,_useStrictMode:!0})},G=function(e){var t=Object(r.useContext)(R),n=t.tool,c=t.snapSize,i=t.setStructure,o=Object(r.useMemo)((function(){return"pen"!==n&&Boolean(i)}),[i,n]),a=Object(r.useCallback)((function(e){var t=e.id,n=e.x,r=e.y;if(i){var o=S([n,r],c),a=Object(b.a)(o,2),u=a[0],s=a[1];i((function(e){var n=p(e),r=n.nodes.find((function(e){return e.id===t}));return r&&(r.x=u,r.y=s),n}))}}),[i,c]),u=Object(r.useCallback)((function(e){var t=e.id,n=e.x,r=e.y;if(i){var o=S([n,r],c),a=Object(b.a)(o,2),u=a[0],s=a[1];i((function(e){var n,r,c,i=p(e),o=i.nodes.findIndex((function(e){return e.id===t}));if(o>=0){var a=i.nodes.find((function(e){return e.id!==t&&e.x===u&&e.y===s}));a&&(n=i,r=t,c=a.id,n.beams.forEach((function(e){e.nodeI===r&&(e.nodeI=c),e.nodeJ===r&&(e.nodeJ=c)})),i.nodes.splice(o,1))}return i}))}}),[i,c]);return Object(d.jsx)(L,Object(f.a)(Object(f.a)({},e),{},{draggable:o,onChange:a,onCommit:u}))},H=function(){var e=Object(r.useContext)(R),t=e.nodes,n=e.beams,c=e.forces;return Object(d.jsxs)(h.d,{children:[Object.entries(n).map((function(e){var t=Object(b.a)(e,2),n=t[0],r=t[1];return Object(d.jsx)(A,Object(f.a)({},r),n)})),Object.entries(t).map((function(e){var t=Object(b.a)(e,2),n=t[0],r=t[1];return Object(d.jsx)(G,Object(f.a)({},r),n)})),Object.entries(c).map((function(e){var t=Object(b.a)(e,2),n=t[0],r=t[1];return Object(d.jsx)(D,Object(f.a)({},r),n)}))]})},X=["points"],U=function(e){var t=e.tool,n=e.structure,r=e.size,c=e.readonly,i=void 0!==c&&c,o=e.setStructure,a=I({disabled:i||"pen"!==t,structure:n,setStructure:o}),u=a.points,s=Object(x.a)(a,X);return Object(d.jsx)(h.f,Object(f.a)(Object(f.a)({width:r.width,height:r.height},s),{},{children:Object(d.jsxs)(J,{size:r,structure:n,tool:t,setStructure:o,children:[Object(d.jsx)(F,{}),Object(d.jsx)(W,{}),Object(d.jsx)(H,{}),Object(d.jsx)(E,{points:u})]})}))},V=["tool"],q=function(e){var t=e.tool,n=void 0===t?"select":t,c=Object(x.a)(e,V),i=Object(r.useState)({width:0,height:0}),o=Object(b.a)(i,2),a=o[0],u=o[1],s=Object(r.useRef)(null);return Object(r.useEffect)((function(){var e=new ResizeObserver((function(e){var t=e[0].contentRect,n=t.width,r=t.height;u({width:n,height:r})}));return s.current&&e.observe(s.current),function(){e.disconnect()}}),[]),Object(d.jsx)(O.a,{ref:s,sx:{width:"auto",height:"100%",backgroundColor:"#ffffff",overscrollBehavior:"contain"},children:Object(d.jsx)(U,Object(f.a)({size:a,tool:n},c))})},K=function(){var e=Object(r.useContext)(l).tool,t=Object(r.useState)(v),n=Object(b.a)(t,2),c=n[0],i=n[1];return Object(d.jsx)(O.a,{sx:{boxSizing:"border-box",ml:1,mb:1,flex:1,border:function(e){return"1px solid ".concat(e.palette.divider)},borderRadius:1,overflow:"hidden"},children:Object(d.jsx)(q,{tool:e,structure:c,setStructure:i})})},Q=n(107),Y=n(112),Z=n(113),$=function(){return Object(d.jsx)(Q.a,{position:"static",children:Object(d.jsx)(Y.a,{variant:"dense",children:Object(d.jsx)(Z.a,{component:"h1",variant:"h6",color:"inherit",children:"Drawing Sample"})})})},ee=n(98),te=n(99),ne=n(100),re=n(101),ce=n(102),ie=n(103),oe=n(109),ae=n(105),ue=["select","pen","force","trapezoid","delete"],se={select:{tool:"select",icon:Object(d.jsx)(ee.a,{}),label:"\u9078\u629e"},pen:{tool:"pen",icon:Object(d.jsx)(te.a,{}),label:"\u6881\u8981\u7d20\u306e\u63cf\u753b"},force:{tool:"force",icon:Object(d.jsx)(ne.a,{}),label:"\u96c6\u4e2d\u8377\u91cd\u306e\u8ffd\u52a0"},trapezoid:{tool:"trapezoid",icon:Object(d.jsx)(re.a,{}),label:"\u5206\u5e03\u8377\u91cd\u306e\u8ffd\u52a0"},delete:{tool:"delete",icon:Object(d.jsx)(ce.a,{}),label:"\u8981\u7d20\u306e\u524a\u9664"}},be=function(e){var t=e.tool,n=e.onChange,c=Object(r.useCallback)((function(e,t){var r;null!==t&&("string"===typeof(r=t)&&ue.some((function(e){return e===r})))&&n(t)}),[n]);return Object(d.jsxs)(ie.a,{sx:{width:160},alignItems:"flex-start",children:[Object(d.jsx)(Z.a,{variant:"caption",children:"Toolbox"}),Object(d.jsx)(oe.a,{orientation:"vertical",value:t,exclusive:!0,fullWidth:!0,onChange:c,children:Object.entries(se).map((function(e){var t=Object(b.a)(e,2),n=t[0],r=t[1],c=r.icon,i=r.label;return Object(d.jsxs)(ae.a,{value:n,sx:{justifyContent:"flex-start",alignItems:"center"},children:[c,Object(d.jsx)(Z.a,{variant:"caption",sx:{ml:1},children:i})]},n)}))})]})},de=function(){var e=Object(r.useContext)(l),t=e.tool,n=e.setTool;return Object(d.jsx)(be,{tool:t,onChange:n})},le=function(){var e=Object(r.useState)({width:0,height:0}),t=Object(b.a)(e,2),n=t[0],c=t[1],i=Object(r.useCallback)((function(){var e=window,t=e.innerHeight,n=e.innerWidth;c({height:t,width:n})}),[]);return Object(r.useEffect)((function(){return i(),window.addEventListener("resize",i),function(){window.removeEventListener("resize",i)}}),[i]),Object(d.jsxs)(O.a,{sx:Object(f.a)(Object(f.a)({},n),{},{overflow:"hidden"}),children:[Object(d.jsx)($,{}),Object(d.jsxs)(O.a,{sx:{boxSizing:"border-box",width:"auto",height:"calc(100% - 48px)",display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"stretch",pt:1,px:1},children:[Object(d.jsx)(de,{}),Object(d.jsx)(K,{})]})]})},je=Object(a.a)(),fe=function(){return Object(d.jsx)(u.a,{theme:je,children:Object(d.jsxs)(j,{children:[Object(d.jsx)(s.a,{}),Object(d.jsx)(le,{})]})})},Oe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,115)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),r(e),c(e),i(e),o(e)}))};o.a.render(Object(d.jsx)(c.a.StrictMode,{children:Object(d.jsx)(fe,{})}),document.getElementById("root")),Oe()}},[[76,1,2]]]);
//# sourceMappingURL=main.8243f446.chunk.js.map