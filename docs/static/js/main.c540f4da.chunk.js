(this["webpackJsonpdrawing-sample"]=this["webpackJsonpdrawing-sample"]||[]).push([[0],{117:function(e,t,n){"use strict";n.r(t);var c,a,i,r,o=n(0),s=n.n(o),l=n(26),u=n.n(l),b=n(92),j=n(176),d=n(168),h=n(10),O=n(17),x={unit:{force:"kN",length:"m"},nodes:[],beams:[],forces:[],trapezoids:[]},f=["select","edit"],g={A3:{width:0,height:0},A4:{width:2970,height:2100},B4:{width:0,height:0},B5:{width:0,height:0}},v={width:160,height:90},p={stroke:"#000000",strokeWidth:4,eraser:!1,lineJoin:"round",lineCap:"round"},C={size:"A4",drawings:[],structures:[Object(O.a)({data:x,x:100,y:100},v)]},m=n(1),w=Object(o.createContext)(void 0),k=function(e){var t=e.children,n=Object(o.useState)("note"),c=Object(h.a)(n,2),a=c[0],i=c[1],r=Object(o.useState)(C),s=Object(h.a)(r,2),l=s[0],u=s[1],b=Object(o.useState)(),j=Object(h.a)(b,2),d=j[0],O=j[1],x=Object(o.useState)(),f=Object(h.a)(x,2),g=f[0],v=f[1],p=Object(o.useCallback)((function(e){i("canvas"),v(e)}),[]),k=Object(o.useCallback)((function(){i("note"),v(void 0)}),[]);return Object(m.jsx)(w.Provider,{value:{mode:a,onChangeMode:i,page:l,onChange:u,selectedCanvasIndex:d,onSelectCanvas:O,canvasProps:g,editCanvas:p,closeCanvas:k},children:t})},y=Object(o.createContext)(void 0),S=function(e){var t=e.children,n=Object(o.useState)("select"),c=Object(h.a)(n,2),a=c[0],i=c[1];return Object(m.jsx)(y.Provider,{value:{tool:a,setTool:i},children:t})},z=Object(o.createContext)(void 0),M=function(e){var t=e.children,n=Object(o.useState)("select"),c=Object(h.a)(n,2),a=c[0],i=c[1],r=Object(o.useState)(p),s=Object(h.a)(r,2),l=s[0],u=s[1];return Object(m.jsx)(z.Provider,{value:{mode:a,settings:l,onChangeMode:i,onChangeDrawSettings:u},children:t})},P=n(182),D=n(178),E=n(180),B=n(177),I=null!==(c=null===(a="a911b143b99fddcdb9e0d3459906f18f93648564\n")?void 0:a.substring(0,7))&&void 0!==c?c:"",R=null!==(i="2022/01/08 16:10:15")?i:"",T=null!==(r="0.1.0")?r:"",W=function(){return Object(m.jsx)(B.a,{variant:"caption",sx:{ml:2},children:"ver ".concat(T," (").concat(I,": ").concat(R,")")})},F=function(){return Object(m.jsx)(D.a,{position:"static",children:Object(m.jsxs)(E.a,{variant:"dense",children:[Object(m.jsx)(B.a,{component:"h1",variant:"h6",color:"inherit",children:"Drawing Sample"}),Object(m.jsx)(W,{})]})})},J=n(18),L=n(20),H=n(52),A=n.n(H),N=(new A.a(1,0),new A.a(0,1),function(e){return JSON.parse(JSON.stringify(e))}),_=(n(173),n(42)),V=["eraser"],U=function(e){var t=e.drawings,n=e.settings,c=e.points;return Object(m.jsxs)(L.b,{children:[t.map((function(e,t){var n=e.eraser,c=void 0!==n&&n,a=Object(_.a)(e,V);return Object(m.jsx)(L.c,Object(O.a)(Object(O.a)({},a),{},{globalCompositeOperation:c?"destination-out":"source-over"}),"note-drawing-".concat(t))})),c&&Object(m.jsx)(L.c,Object(O.a)(Object(O.a)({},n),{},{points:c,globalCompositeOperation:n.eraser?"destination-out":"source-over"}))]})},q=n(88),G=n.n(q),K=n(89),Q=n.n(K),X=n(90),Y=n.n(X),Z=n(6),$=n(181),ee=n(91),te=n(171),ne=n(93),ce=Object(Z.a)("div")({display:"flex",alignItems:"center",width:"100%",padding:"0 8"}),ae=Object(Z.a)("div")({flex:1}),ie=function(e){var t=e.visible,n=void 0!==t&&t,c=e.mode,a=e.y,i=e.x,r=e.width,s=e.onEdit,l=e.onCopy,u=e.onDelete,b=e.onCancel,j=Object(o.useState)(null),d=Object(h.a)(j,2),O=d[0],x=d[1],f=Object(o.useCallback)((function(e){x(e.currentTarget)}),[]),g=Object(o.useCallback)((function(){x(null)}),[]);return n?Object(m.jsxs)(ne.a,{divProps:{style:{top:"".concat(a-42,"px"),left:"".concat(i,"px"),width:"".concat(r,"px")}},children:[Object(m.jsxs)(ce,{children:["canvas"===c&&Object(m.jsx)($.a,{size:"small",onClick:b,children:Object(m.jsx)(G.a,{})}),"note"===c&&Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)($.a,{size:"small",onClick:s,children:Object(m.jsx)(Q.a,{})}),Object(m.jsx)(ae,{}),Object(m.jsx)($.a,{size:"small",onClick:f,children:Object(m.jsx)(Y.a,{})})]})]}),Object(m.jsxs)(ee.a,{anchorEl:O,open:Boolean(O),onClose:g,children:[Object(m.jsx)(te.a,{onClick:l,children:"\u30b3\u30d4\u30fc"}),Object(m.jsx)(te.a,{onClick:u,children:"\u524a\u9664"})]})]}):null},re=["size","draggable","index","onChange","selected","onSelect","data"],oe=function(e){var t=e.size,n=e.draggable,c=void 0!==n&&n,a=e.index,i=e.onChange,r=e.selected,s=void 0!==r&&r,l=e.onSelect,u=(e.data,Object(_.a)(e,re)),b=Object(o.useRef)(null),j=Object(o.useRef)(null),d=Object(o.useState)(!1),x=Object(h.a)(d,2),f=x[0],p=x[1],C=Object(o.useContext)(w),k=C.mode,y=C.editCanvas,S=C.closeCanvas,z=Object(o.useMemo)((function(){return g[t]}),[t]),M=Object(o.useMemo)((function(){return c&&s}),[c,s]);Object(o.useEffect)((function(){var e;s&&j.current&&b.current&&(j.current.nodes([b.current]),null===(e=j.current.getLayer())||void 0===e||e.batchDraw())}),[s]);var P=Object(o.useCallback)((function(e){i((function(t){var n=N(t),c=n.structures[a].data;return n.structures[a]=Object(O.a)({data:c},e),n}))}),[a,i]),D=Object(o.useCallback)((function(){p(!0)}),[]),E=Object(o.useCallback)((function(e){if(e.cancelBubble=!0,b.current){var t=e.target.attrs,n=t.x,c=t.y;if("number"===typeof n&&"number"===typeof c){var a=b.current.getSize(),i=a.width,r=a.height,o=n,s=c;o<0?o=0:o>z.width-i&&(o=z.width-i),s<0?s=0:s>z.height-r&&(s=z.height-r),n===o&&c===s||b.current.setPosition({x:o,y:s})}}}),[z.height,z.width]),B=Object(o.useCallback)((function(e){if(b.current){var t=b.current.getPosition(),n=t.x,c=t.y,a=b.current.getSize(),i={x:n,y:c,width:a.width,height:a.height};p(!1),P(i)}}),[P]),I=Object(o.useCallback)((function(e,t){return t.width<v.width||t.height<v.height?e:t}),[]),R=Object(o.useCallback)((function(){if(b.current){var e=b.current,t=e.scale(),n=t.x,c=t.y;e.scale({x:1,y:1});var a={x:e.x(),y:e.y(),width:Math.max(v.width,e.width()*n),height:Math.max(v.height,e.height()*c)};P(a)}}),[P]),T=Object(o.useCallback)((function(e){var t=e.currentTarget.getBoundingClientRect(),n=t.top,c={x:t.left,y:n+42,width:u.width,height:u.height};y(c)}),[y,u.height,u.width]);return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(L.d,Object(O.a)(Object(O.a)({ref:b,stroke:"black",strokeWidth:2,draggable:c},u),{},{onClick:l,onTap:l,onDragStart:D,onDragMove:E,onDragEnd:B,onTransformEnd:R})),Object(m.jsx)(ie,Object(O.a)(Object(O.a)({visible:s&&!f,mode:k},u),{},{onEdit:T,onCancel:S})),Object(m.jsx)(L.g,{ref:j,visible:M,rotateEnabled:!1,boundBoxFunc:I})]})},se=function(e){var t=e.size,n=e.structures,c=e.draggable,a=void 0!==c&&c,i=e.onChange,r=Object(o.useContext)(w),s=r.selectedCanvasIndex,l=r.onSelectCanvas,u=Object(o.useMemo)((function(){return g[t]}),[t]),b=Object(o.useCallback)((function(e){"background"===e.target.attrs.type&&l(void 0)}),[l]);return Object(m.jsxs)(L.b,{children:[Object(m.jsx)(L.d,Object(O.a)(Object(O.a)({x:0,y:0},u),{},{attrs:{type:"background"},onClick:b,onTap:b})),n.map((function(e,n){return Object(m.jsx)(oe,Object(O.a)({size:t,draggable:a,index:n,onChange:i,selected:n===s,onSelect:function(){return l(n)}},e),"handle-".concat(n))}))]})},le={id:"",points:[],stroke:"#c9e1ff",strokeWidth:1,dash:[5,3],listening:!1},ue=function(e){var t=e.size,n=Object(o.useMemo)((function(){return g[t]}),[t]),c=Object(o.useMemo)((function(){for(var e=[],t=1,c=0;c<=n.height;c+=50)e.push(Object(O.a)(Object(O.a)({},le),{},{id:"Horizontal_".concat(t),points:[0,c,n.width,c]})),t++;return e}),[n]),a=Object(o.useMemo)((function(){for(var e=[],t=1,c=0;c<=n.width;c+=50)e.push(Object(O.a)(Object(O.a)({},le),{},{id:"Vertical_".concat(t),points:[c,0,c,n.height]})),t++;return e}),[n]);return Object(m.jsxs)(L.b,{children:[c.map((function(e){return Object(m.jsx)(L.c,Object(O.a)({},e),e.id)})),a.map((function(e){return Object(m.jsx)(L.c,Object(O.a)({},e),e.id)}))]})},be=["visible"],je=function(e){var t=e.visible,n=void 0!==t&&t,c=Object(_.a)(e,be),a=Object(o.useCallback)((function(e){var t;console.log("hoge");var n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&console.log(n)}),[]);return Object(m.jsxs)(L.b,{x:c.x,y:c.y,visible:n,children:[Object(m.jsx)(L.d,{x:0,y:0,width:c.width,height:c.height,fill:"#ccc",onClick:a}),Object(m.jsx)(L.f,{x:0,y:0,text:"".concat(JSON.stringify(c)),fill:"black"})]})},de=function(e){var t=e.viewBox,n=e.size,c=e.drawings,a=e.structures,i=e.onChange,r=Object(o.useRef)(null),s=Object(o.useContext)(z),l=s.mode,u=s.settings,b=Object(o.useContext)(w).mode,j=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var c=o.useRef([]);return c.current=t.map((function(e){return o.useContext(e)})),o.useMemo((function(){return function(e){var n=e.children;return t.reduceRight((function(e,t,n){return Object(m.jsx)(t.Provider,{value:c.current[n],children:e})}),n)}}),[t])}(w,y),d=Object(o.useRef)(),x=Object(o.useState)([]),f=Object(h.a)(x,2),v=f[0],p=f[1],C=Object(o.useMemo)((function(){return g[n]}),[n]),k=Object(o.useMemo)((function(){return"note"===b&&"select"===l}),[b,l]),S=Object(o.useCallback)((function(e){var n=e.target.attrs,c=n.x,a=n.y;if(r.current&&"number"===typeof c&&"number"===typeof a){var i=c,o=a,s=!1;i>0?(i=0,s=!0):Math.abs(i)+t.width>C.width&&(i=t.width-C.width,s=!0),o>0?(o=0,s=!0):Math.abs(o)+t.height>C.height&&(o=t.height-C.height,s=!0),s&&r.current.setPosition({x:i,y:o})}}),[C.height,C.width,t.height,t.width]),M=Object(o.useCallback)((function(e){var t;if("edit"===l){var n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();if(r.current&&n){d.current=!0;var c=r.current.getPosition(),a=c.x,i=c.y;p([n.x+Math.abs(a),n.y+Math.abs(i)])}}}),[l]),P=Object(o.useCallback)((function(e){var t;if("edit"===l&&d.current){var n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();if(r.current&&n){var c=r.current.getPosition(),a=c.x,i=c.y;p((function(e){return[].concat(Object(J.a)(e),[n.x+Math.abs(a),n.y+Math.abs(i)])}))}}}),[l]),D=Object(o.useCallback)((function(e){"edit"===l&&d.current&&(d.current=!1,i((function(e){var t=N(e);return t.drawings.push(Object(O.a)(Object(O.a)({},u),{},{points:v})),t})),p([]))}),[l,i,v,u]);return Object(m.jsx)(L.e,{ref:r,width:t.width,height:t.height,draggable:k,onDragMove:S,onPointerDown:M,onPointerMove:P,onPointerUp:D,children:Object(m.jsxs)(j,{children:[Object(m.jsx)(ue,{size:n}),a.map((function(e,t){return Object(m.jsx)(je,Object(O.a)(Object(O.a)({},e),{},{visible:!0}),"canvas_".concat(t))})),Object(m.jsx)(se,{size:n,structures:a,draggable:k,onChange:i}),Object(m.jsx)(U,{drawings:c,settings:u,points:v})]})})},he=function(){var e=Object(o.useRef)(null),t=Object(o.useState)({width:0,height:0}),n=Object(h.a)(t,2),c=n[0],a=n[1],i=Object(o.useContext)(w),r=i.page,s=i.onChange;return Object(o.useEffect)((function(){var t=new ResizeObserver((function(e){var t=e[0].contentRect,n=t.width,c=t.height;a({width:n,height:c})}));return e.current&&t.observe(e.current),function(){t.disconnect()}}),[]),Object(m.jsx)(P.a,{ref:e,sx:{width:"auto",height:"100%",backgroundColor:"#ffffff",overscrollBehavior:"contain",overflow:"hidden"},children:Object(m.jsx)(de,Object(O.a)(Object(O.a)({viewBox:c},r),{},{onChange:s}))})},Oe=function(){var e=Object(o.useContext)(w).canvasProps;return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(P.a,{sx:{boxSizing:"border-box",ml:1,mb:1,flex:1,border:function(e){return"1px solid ".concat(e.palette.divider)},borderRadius:1,overflow:"hidden"},children:Object(m.jsx)(he,{})}),e&&Object(m.jsx)(P.a,{sx:{position:"absolute",top:e.y,left:e.x,width:e.width,height:e.height,backgroundColor:"red"},children:"HOHOHO!!!"})]})},xe=n(161),fe=n(162),ge=n(163),ve=n(164),pe=n(165),Ce=n(166),me=n(175),we=n(183),ke=["select","pen","force","trapezoid","delete"],ye={select:{tool:"select",icon:Object(m.jsx)(xe.a,{}),label:"\u9078\u629e"},pen:{tool:"pen",icon:Object(m.jsx)(fe.a,{}),label:"\u6881\u8981\u7d20\u306e\u63cf\u753b"},force:{tool:"force",icon:Object(m.jsx)(ge.a,{}),label:"\u96c6\u4e2d\u8377\u91cd\u306e\u8ffd\u52a0"},trapezoid:{tool:"trapezoid",icon:Object(m.jsx)(ve.a,{}),label:"\u5206\u5e03\u8377\u91cd\u306e\u8ffd\u52a0"},delete:{tool:"delete",icon:Object(m.jsx)(pe.a,{}),label:"\u8981\u7d20\u306e\u524a\u9664"}},Se=function(e){var t=e.tool,n=e.onChange,c=Object(o.useCallback)((function(e,t){var c;null!==t&&("string"===typeof(c=t)&&ke.some((function(e){return e===c})))&&n(t)}),[n]);return Object(m.jsxs)(Ce.a,{sx:{width:160},alignItems:"flex-start",children:[Object(m.jsx)(B.a,{variant:"caption",children:"Toolbox"}),Object(m.jsx)(me.a,{orientation:"vertical",value:t,exclusive:!0,fullWidth:!0,onChange:c,children:Object.entries(ye).map((function(e){var t=Object(h.a)(e,2),n=t[0],c=t[1],a=c.icon,i=c.label;return Object(m.jsxs)(we.a,{value:n,sx:{justifyContent:"flex-start",alignItems:"center"},children:[a,Object(m.jsx)(B.a,{variant:"caption",sx:{ml:1},children:i})]},n)}))})]})},ze=function(){var e=Object(o.useContext)(y),t=e.tool,n=e.setTool;return Object(m.jsx)(Se,{tool:t,onChange:n})},Me=n(167),Pe=n(172),De=n(169),Ee=["pen","eraser"],Be={select:{mode:"select",icon:Object(m.jsx)(xe.a,{}),label:"\u9078\u629e"},edit:{mode:"edit",icon:Object(m.jsx)(fe.a,{}),label:"\u63cf\u753b"}},Ie={pen:{mode:"pen",icon:Object(m.jsx)(fe.a,{}),label:"\u30da\u30f3\u30c4\u30fc\u30eb"},eraser:{mode:"eraser",icon:Object(m.jsx)(Me.a,{}),label:"\u6d88\u3057\u30b4\u30e0"}},Re=function(e){var t=e.mode,n=e.settings,c=e.onChangeMode,a=e.onChangeDrawSettings,i=Object(o.useCallback)((function(e,t){var n;null!==t&&("string"===typeof(n=t)&&f.some((function(e){return e===n})))&&c(t)}),[c]),r=Object(o.useCallback)((function(e,t){var n;null!==t&&("string"===typeof(n=t)&&Ee.some((function(e){return e===n})))&&a((function(e){return Object(O.a)(Object(O.a)({},e),{},{eraser:"eraser"===t})}))}),[a]),s=Object(o.useCallback)((function(e,t){"number"===typeof t&&a((function(e){return Object(O.a)(Object(O.a)({},e),{},{strokeWidth:t})}))}),[a]),l=Object(o.useCallback)((function(e){if(e.target.checkValidity()){var t=e.target.value;a((function(e){return Object(O.a)(Object(O.a)({},e),{},{stroke:t})}))}}),[a]);return Object(m.jsxs)(Ce.a,{sx:{width:160},alignItems:"flex-start",children:[Object(m.jsx)(B.a,{variant:"caption",children:"Toolbox"}),Object(m.jsx)(me.a,{orientation:"vertical",value:t,exclusive:!0,fullWidth:!0,onChange:i,children:Object.entries(Be).map((function(e){var t=Object(h.a)(e,2),n=t[0],c=t[1],a=c.icon,i=c.label;return Object(m.jsxs)(we.a,{value:n,sx:{justifyContent:"flex-start",alignItems:"center"},children:[a,Object(m.jsx)(B.a,{variant:"caption",sx:{ml:1},children:i})]},n)}))}),Object(m.jsx)(B.a,{variant:"caption",sx:{mt:1},children:"\u63cf\u753b\u30c4\u30fc\u30eb"}),Object(m.jsx)(me.a,{orientation:"vertical",value:n.eraser?"eraser":"pen",exclusive:!0,fullWidth:!0,disabled:"select"===t,onChange:r,children:Object.entries(Ie).map((function(e){var t=Object(h.a)(e,2),n=t[0],c=t[1],a=c.icon,i=c.label;return Object(m.jsxs)(we.a,{value:n,sx:{justifyContent:"flex-start",alignItems:"center"},children:[a,Object(m.jsx)(B.a,{variant:"caption",sx:{ml:1},children:i})]},n)}))}),Object(m.jsx)(B.a,{variant:"caption",sx:{mt:1},children:"\u592a\u3055"}),Object(m.jsx)(Pe.a,{sx:{ml:1,mb:2,boxSizing:"border-box",width:140},value:n.strokeWidth,min:4,max:20,step:4,marks:!0,valueLabelDisplay:"auto",disabled:"select"===t,onChange:s}),Object(m.jsx)(De.a,{type:"color",label:"\u30da\u30f3\u306e\u8272",value:n.stroke,disabled:"select"===t||n.eraser,fullWidth:!0,margin:"dense",size:"small",onChange:l})]})},Te=function(){var e=Object(o.useContext)(z);return Object(m.jsx)(Re,Object(O.a)({},e))},We=function(){return"canvas"===Object(o.useContext)(w).mode?Object(m.jsx)(ze,{}):Object(m.jsx)(Te,{})},Fe=function(){var e=Object(o.useState)({width:0,height:0}),t=Object(h.a)(e,2),n=t[0],c=t[1],a=Object(o.useCallback)((function(){var e=window,t=e.innerHeight,n=e.innerWidth;c({height:t,width:n})}),[]);return Object(o.useEffect)((function(){return a(),window.addEventListener("resize",a),function(){window.removeEventListener("resize",a)}}),[a]),Object(m.jsxs)(P.a,{sx:Object(O.a)(Object(O.a)({},n),{},{overflow:"hidden"}),children:[Object(m.jsx)(F,{}),Object(m.jsxs)(P.a,{sx:{boxSizing:"border-box",width:"auto",height:"calc(100% - 48px)",display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"stretch",pt:1,px:1},children:[Object(m.jsx)(We,{}),Object(m.jsx)(Oe,{})]})]})},Je=Object(b.a)(),Le=function(){return Object(m.jsx)(j.a,{theme:Je,children:Object(m.jsx)(k,{children:Object(m.jsx)(S,{children:Object(m.jsxs)(M,{children:[Object(m.jsx)(d.a,{}),Object(m.jsx)(Fe,{})]})})})})},He=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,184)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,i=t.getLCP,r=t.getTTFB;n(e),c(e),a(e),i(e),r(e)}))};u.a.render(Object(m.jsx)(s.a.StrictMode,{children:Object(m.jsx)(Le,{})}),document.getElementById("root")),He()}},[[117,1,2]]]);
//# sourceMappingURL=main.c540f4da.chunk.js.map