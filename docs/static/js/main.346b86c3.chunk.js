(this["webpackJsonpdrawing-sample"]=this["webpackJsonpdrawing-sample"]||[]).push([[0],{116:function(e,t,n){"use strict";n.r(t);var r,c=n(0),a=n.n(c),o=n(28),i=n.n(o),l=n(86),s=n(169),u=n(161),b=n(6),d=n(1),j=Object(c.createContext)(void 0),f=function(e){var t=e.children,n=Object(c.useState)("select"),r=Object(b.a)(n,2),a=r[0],o=r[1];return Object(d.jsx)(j.Provider,{value:{tool:a,setTool:o},children:t})},O=n(7),p=n(175),v=["free","pin","pinX","pinZ","fixX","fix"],x={unit:{force:"kN",length:"m"},nodes:[],beams:[],forces:[],trapezoids:[]},h=n(26),m=n(18),g=n(19),y=["select","pen","force","trapezoid","delete"],k=n(52),C=n.n(k),S=new C.a(1,0),w=new C.a(0,1),E=function(e,t,n){if(n>=1)return t;if(n<=0)return e;var r=t.clone().subtract(e).normalize(),c=e.distance(t),a=r.multiplyScalar(c*n);return e.clone().add(a)},I=function(e,t){var n=t.clone().subtract(e).normalize(),r=new C.a(n.y,-1*n.x).normalize();return w.dot(r)>0&&r.invert(),r},P=function(e){return JSON.parse(JSON.stringify(e))},z=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=Math.pow(10,t),r=Math.round(e*n)/n;return r},N=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,n=e/t,r=Math.round(n)*t;return r},M=function(e){var t=Object(b.a)(e,2),n=t[0],r=t[1],c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25;return[N(n,c),N(r,c)]},T=n(165),_=function(e,t){return{id:Object(T.a)(),x:e,y:t}},J=Object(c.createContext)(void 0),X=function(e){var t=e.value,n=t.tool,r=t.readonly,a=t.points,o=t.setPoints,i=t.structure,l=t.setStructure,s=e.children,u=Object(c.useRef)(),b=Object(c.useRef)(),j=Object(c.useMemo)((function(){return!(!r&&"undefined"!==typeof l)||!("pen"===n||"trapezoid"===n)}),[r,l,n]),f=Object(c.useCallback)((function(e){var t;if(!j){if("trapezoid"===n){if("beam"!==e.target.attrs.type)return;var r=e.target.attrs.id,c=e.target.attrs.points;a=c,Array.isArray(a)&&(0===a.length||a.every((function(e){return"number"===typeof e})))&&"string"===typeof r&&(b.current={id:r,points:c})}var a,i=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();i&&(u.current=!0,o([i.x,i.y]))}}),[j,o,n]),O=Object(c.useCallback)((function(e){var t;if(!j&&u.current){var n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&o((function(e){return[].concat(Object(g.a)(e),[n.x,n.y])}))}}),[j,o]),p=Object(c.useCallback)((function(e,t){if(l){var n=M([e[0],e[1]],25),r=M([t[0],t[1]],25);l((function(e){var t=P(e),c=_.apply(void 0,Object(g.a)(n)),a=t.nodes.find((function(e){return e.x===c.x&&e.y===c.y}));a?c.id=a.id:t.nodes.push(c);var o=_.apply(void 0,Object(g.a)(r)),i=t.nodes.find((function(e){return e.x===o.x&&e.y===o.y}));i?o.id=i.id:t.nodes.push(o);var l=function(e,t,n){return{id:Object(T.a)(),name:e,nodeI:t,nodeJ:n}}("Beam_".concat(t.beams.length+1),c.id,o.id);return t.beams.push(l),t}))}}),[l]),v=Object(c.useCallback)((function(e,t,n){if(l){var r=function(e,t,n,r){var c=r.slice(0,2),a=r.slice(-2),o=new C.a(c[0],c[1]),i=new C.a(a[0],a[1]),l=o.distance(i),s=i.clone().subtract(o).normalize(),u=new C.a(e[0],e[1]),b=new C.a(t[0],t[1]),d=o.distance(u),j=o.distance(b);if(d>j){var f=[b,u];u=f[0],b=f[1];var O=[j,d];d=O[0],j=O[1]}var p=o.clone().add(s.clone().multiplyScalar(d)),v=b.clone().subtract(p).normalize(),x=s.angle()-v.angle(),h=p.distance(b)*Math.cos(x),m=p.clone().add(s.clone().multiplyScalar(h));j=i.distance(m);var g=z(d/l,3),y=z(j/l,3);return{id:Object(T.a)(),name:"Trapezoid_N",beam:n,forceI:10,forceJ:10,distanceI:g,distanceJ:y,angle:90,isGlobal:!1}}(e,t,n.id,n.points);l((function(e){var t=P(e),n="Trapezoid_".concat(t.trapezoids.length+1);return r.name=n,t.trapezoids.push(r),t}))}}),[l]),x=Object(c.useCallback)((function(e){if(!j&&u.current&&(u.current=!1,a.length>=4)){var t=a.slice(0,2),r=a.slice(-2);"pen"===n?p(t,r):"trapezoid"===n&&b.current&&v(t,r,b.current),o([]),b.current=void 0}}),[j,p,v,a,o,n]);return Object(d.jsx)(J.Provider,{value:{tool:n,readonly:r,points:a,setPoints:o,structure:i,setStructure:l,onPointerDown:f,onPointerMove:O,onPointerUp:x},children:s})},R=function(e){var t=e.tool,n=e.points,r=Object(c.useMemo)((function(){switch(t){case"pen":return"blue";case"trapezoid":return"red";default:return"black"}}),[t]);return Object(d.jsx)(m.e,{children:Object(d.jsx)(m.f,{points:n,strokeWidth:3,stroke:r})})},D=function(){var e=Object(c.useContext)(J),t=e.tool,n=e.points;return Object(d.jsx)(R,{tool:t,points:n})},F=["nodeI","nodeJ"],W=["beam","force"],B=["beam"],A=Object(c.createContext)(void 0),G=function(e){var t=e.children,n=e.tool,r=void 0===n?"select":n,a=e.size,o=e.gridSize,i=void 0===o?25:o,l=e.snapSize,s=void 0===l?25:l,u=e.structure,b=e.setStructure,j=Object(c.useMemo)((function(){var e={};return u.nodes.forEach((function(t){e[t.id]=t})),e}),[u.nodes]),f=Object(c.useMemo)((function(){var e={};return u.beams.forEach((function(t){var n=t.nodeI,r=t.nodeJ,c=Object(h.a)(t,F),a=Object(O.a)(Object(O.a)({},c),{},{nodeI:j[n],nodeJ:j[r]});e[c.id]=a})),e}),[j,u.beams]),p=Object(c.useMemo)((function(){var e=u.forces,t={};if(e.length>0){var n=e.map((function(e){return e.force})).reduce((function(e,t){return e+t}))/e.length;e.forEach((function(e){var r=e.beam,c=e.force,a=Object(h.a)(e,W),o=c/n;t[a.id]=Object(O.a)(Object(O.a)({},a),{},{force:c,forceRatio:o,beam:f[r]})}))}return t}),[f,u]),v=Object(c.useMemo)((function(){var e=u.trapezoids,t={};return e.forEach((function(e){var n=e.beam,r=Object(h.a)(e,B);t[r.id]=Object(O.a)(Object(O.a)({},r),{},{beam:f[n]})})),t}),[f,u]),x=Object(c.useCallback)((function(e){var t=P(u),n="Force_".concat(t.forces.length+1),r=function(e){return Object(O.a)(Object(O.a)({},e),{},{id:Object(T.a)()})}(Object(O.a)({name:n},e));t.forces.push(r),b&&b(t)}),[b,u]),m=Object(c.useCallback)((function(e){var t=u.forces.findIndex((function(t){return t.id===e}));if(t>=0){var n=P(u);n.forces.splice(t,1),b&&b(n)}}),[b,u]),g=Object(c.useCallback)((function(e){var t=u.trapezoids.findIndex((function(t){return t.id===e}));if(t>=0){var n=P(u);n.trapezoids.splice(t,1),b&&b(n)}}),[b,u]),y=Object(c.useCallback)((function(e){var t=u.beams.findIndex((function(t){return t.id===e}));if(t>=0){var n=u.beams[t],r=n.nodeI,c=n.nodeJ,a=P(u);a.beams.splice(t,1),[r,c].forEach((function(e){var t=a.beams.some((function(t){var n=t.nodeI,r=t.nodeJ;return e===n||e===r}));if(!t){var n=a.nodes.findIndex((function(t){return t.id===e}));n>=0&&a.nodes.splice(n,1)}}));var o=a.forces.filter((function(t){return t.beam!==e}));a.forces=o;var i=a.trapezoids.filter((function(t){return t.beam!==e}));a.trapezoids=i,b&&b(a)}}),[b,u]);return Object(d.jsx)(A.Provider,{value:{tool:r,size:a,gridSize:i,snapSize:s,structure:u,nodes:j,beams:f,forces:p,trapezoids:v,addForce:x,deleteForce:m,deleteTrapezoid:g,deleteBeam:y,setStructure:b},children:t})},L={id:"",points:[],stroke:"#c9e1ff",strokeWidth:1,dash:[5,3],listening:!1},Y=function(){var e=Object(c.useContext)(A),t=e.size,n=e.gridSize,r=Object(c.useMemo)((function(){for(var e=[],r=1,c=0;c<=t.height;c+=n)e.push(Object(O.a)(Object(O.a)({},L),{},{id:"Horizontal_".concat(r),points:[0,c,t.width,c]})),r++;return e}),[n,t.height,t.width]),a=Object(c.useMemo)((function(){for(var e=[],r=1,c=0;c<=t.width;c+=n)e.push(Object(O.a)(Object(O.a)({},L),{},{id:"Vertical_".concat(r),points:[c,0,c,t.height]})),r++;return e}),[n,t.height,t.width]);return Object(d.jsxs)(m.e,{listening:!1,children:[r.map((function(e){return Object(d.jsx)(m.f,Object(O.a)({},e),e.id)})),a.map((function(e){return Object(d.jsx)(m.f,Object(O.a)({},e),e.id)}))]})},Z=Object(c.createContext)(void 0),V=function(e){var t=e.value,n=t.selected,r=t.setSelected,a=e.children,o=Object(c.useCallback)((function(e){return n.some((function(t){var n=t.type,r=t.id;return n===e.type&&r===e.id}))}),[n]),i=Object(c.useCallback)((function(e){o(e)||r((function(t){return[].concat(Object(g.a)(t),[e])}))}),[o,r]),l=Object(c.useCallback)((function(e){o(e)?r((function(t){return t.filter((function(t){var n=t.type,r=t.id;return!(n===e.type&&r===e.id)}))})):r((function(t){return[].concat(Object(g.a)(t),[e])}))}),[o,r]);return Object(d.jsx)(Z.Provider,{value:{selected:n,setSelected:r,isSelected:o,select:i,toggle:l},children:a})},U=function(e){var t=e.id,n=e.name,r=e.nodeI,a=e.nodeJ,o=e.tool,i=e.selected,l=void 0!==i&&i,s=e.addForce,u=e.onDelete,j=e.onSelect,f=Object(c.useState)([]),O=Object(b.a)(f,2),p=O[0],v=O[1],x=Object(c.useState)([0,0]),h=Object(b.a)(x,2),g=h[0],y=h[1],k=Object(c.useState)(0),S=Object(b.a)(k,2),w=S[0],E=S[1],P=Object(c.useState)(0),z=Object(b.a)(P,2),N=z[0],M=z[1],T=Object(c.useState)([[0,0],[0,0]]),_=Object(b.a)(T,2),J=_[0],X=_[1],R=Object(c.useRef)(new C.a(0,0)),D=Object(c.useRef)(new C.a(0,0)),F=Object(c.useCallback)((function(e){if("force"===o){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&(s(n,R.current,D.current),e.cancelBubble=!0)}else"delete"===o?(u(),e.cancelBubble=!0):"select"===o&&(j(),e.cancelBubble=!0)}),[s,u,j,o]);return Object(c.useEffect)((function(){if(v([r.x,r.y,a.x,a.y]),R.current.x=r.x,R.current.y=r.y,D.current.x=a.x,D.current.y=a.y,l){var e=R.current,t=D.current;if(e.x>t.x){var n=[t,e];e=n[0],t=n[1]}var c=e.distance(t),o=I(e,t),i=e.clone().add(o.clone().multiplyScalar(16)),s=t.clone().subtract(e).angleDeg(),u=o.clone().multiplyScalar(75),b=e.clone().add(u),d=t.clone().add(u);E(c),y([i.x,i.y]),M(s),X([[b.x,b.y],[d.x,d.y]])}}),[r.x,r.y,a.x,a.y,l]),Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(m.f,{id:t,type:"beam",points:p,stroke:l?"blue":"black",strokeWidth:4,onClick:F,onTap:F}),l&&Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(m.h,{x:g[0],y:g[1],rotation:N,text:n,fontSize:12,width:w,fill:"blue",align:"center",wrap:"none",ellipsis:!0,listening:!1}),Object(d.jsx)(ne,{start:J[0],end:J[1]})]})]})},q=function(e){var t=Object(c.useContext)(A),n=t.tool,r=t.addForce,a=t.deleteBeam,o=Object(c.useContext)(Z),i=o.isSelected,l=o.toggle,s=Object(c.useCallback)((function(t,n,c){var a=new C.a(t.x,t.y),o=function(e,t,n,r){var c=t.distance(n),a=t.distance(r);return{beam:e,force:10,distanceI:z(a/c)}}(e.id,n,c,a);r(o)}),[r,e.id]),u=Object(c.useCallback)((function(){a(e.id)}),[a,e.id]),b=Object(c.useCallback)((function(){l({type:"beams",id:e.id})}),[e.id,l]);return Object(d.jsx)(U,Object(O.a)(Object(O.a)({},e),{},{tool:n,selected:i({type:"beams",id:e.id}),addForce:s,onDelete:u,onSelect:b}))},K=Object(c.createContext)(void 0),H=function(e){var t=e.value,n=t.popupType,r=t.setPopupType,a=t.popupPosition,o=t.setPopupPosition,i=e.children,l=Object(c.useState)({}),s=Object(b.a)(l,2),u=s[0],j=s[1],f=Object(c.useCallback)((function(e,t,n){r(e),o(t),n&&j(n)}),[o,r]),O=Object(c.useCallback)((function(){r(void 0),o({top:0,left:0}),j({})}),[o,r]);return Object(d.jsx)(K.Provider,{value:{popupType:n,setPopupType:r,popupPosition:a,setPopupPosition:o,open:f,close:O,popupParams:u},children:i})},Q=function(e){var t=e.beam,n=e.distanceI,r=e.force,a=e.forceRatio,o=e.tool,i=e.selected,l=void 0!==i&&i,s=e.onDelete,u=e.onSelect,j=e.onEdit,f=Object(c.useState)([]),O=Object(b.a)(f,2),p=O[0],v=O[1],x=Object(c.useState)(0),h=Object(b.a)(x,2),g=h[0],y=h[1],k=Object(c.useState)(0),w=Object(b.a)(k,2),P=w[0],z=w[1],N=Object(c.useState)([0,0]),M=Object(b.a)(N,2),T=M[0],_=M[1],J=Object(c.useRef)(new C.a(0,0)),X=Object(c.useRef)(new C.a(0,0));Object(c.useEffect)((function(){var e=t.nodeI,r=t.nodeJ;J.current.x=e.x,J.current.y=e.y,X.current.x=r.x,X.current.y=r.y;var c=E(J.current,X.current,n),o=I(J.current,X.current),i=30*a,l=c.clone().add(o.multiplyScalar(i));v([l.x,l.y,c.x,c.y]),y(Math.max(i,140));var s=o.clone().angleDeg();z(s);var u=J.current.clone().subtract(X.current).normalize();S.dot(u)<0&&u.invert();var b=c.clone().add(u.multiplyScalar(6));_([b.x,b.y])}),[t,n,a]);var R=Object(c.useCallback)((function(e){"delete"===o?(s(),e.cancelBubble=!0):"select"===o&&(u(),e.cancelBubble=!0)}),[s,u,o]),D=Object(c.useCallback)((function(e){e.cancelBubble=!0}),[]),F=Object(c.useCallback)((function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();if(n){var r=n.x,c=n.y;j({top:c,left:r})}}),[j]),W=Object(c.useMemo)((function(){return l?"red":"orange"}),[l]);return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(m.a,{points:p,pointerLength:6,pointerWidth:6,fill:W,stroke:W,strokeWidth:2,onClick:R,onTap:R}),l&&Object(d.jsx)(m.h,{x:T[0],y:T[1],offsetX:-6,text:"".concat(r,"kN"),fontSize:12,width:g,rotation:P,fill:W,wrap:"none",ellipsis:!0,onClick:D,onTap:D,onDblClick:F,onDblTap:F})]})},$=function(e){var t=Object(c.useContext)(A),n=t.tool,r=t.deleteForce,a=Object(c.useContext)(Z),o=a.isSelected,i=a.toggle,l=Object(c.useContext)(K).open,s=Object(c.useCallback)((function(){r(e.id)}),[r,e.id]),u=Object(c.useCallback)((function(){i({type:"forces",id:e.id})}),[e.id,i]),b=Object(c.useCallback)((function(t){var n=Object(O.a)(Object(O.a)({},e),{},{beam:e.beam.id});l("forces",t,n)}),[l,e]);return Object(d.jsx)(Q,Object(O.a)(Object(O.a)({},e),{},{tool:n,selected:o({type:"forces",id:e.id}),onDelete:s,onSelect:u,onEdit:b}))},ee={fill:"silver",stroke:"silver",strokeWidth:1,listening:!1},te=Object(O.a)({pointerLength:6,pointerWidth:6,pointerAtBeginning:!0},ee),ne=function(e){var t=e.start,n=e.end,r=Object(c.useRef)(new C.a(0,0)),a=Object(c.useRef)(new C.a(0,0)),o=Object(c.useState)(0),i=Object(b.a)(o,2),l=i[0],s=i[1],u=Object(c.useState)(0),j=Object(b.a)(u,2),f=j[0],p=j[1],v=Object(c.useState)([0,0]),x=Object(b.a)(v,2),h=x[0],g=x[1];return Object(c.useEffect)((function(){r.current.x=t[0],r.current.y=t[1],a.current.x=n[0],a.current.y=n[1];var e=r.current.distance(a.current),c=a.current.clone().subtract(r.current).normalize().angleDeg();s(Math.round(e)),p(90===c?-90:c),g(90===c?n:t)}),[n,t]),Object(d.jsxs)(m.c,{x:h[0],y:h[1],rotation:f,children:[Object(d.jsx)(m.f,Object(O.a)({points:[0,0,0,10]},ee)),Object(d.jsx)(m.a,Object(O.a)({points:[0,5,l,5]},te)),Object(d.jsx)(m.f,Object(O.a)({points:[l,0,l,10]},ee)),Object(d.jsx)(m.h,{x:0,y:-8,text:"".concat(l,"px"),fontSize:12,fill:"silver",width:l,align:"center",listening:!1,wrap:"none",ellipsis:!0})]})},re=n(57),ce=n.n(re),ae={free:"/assets/images/pins/pin_1.svg",pin:"/assets/images/pins/pin_1.svg",pinX:"/assets/images/pins/pin_2.svg",pinZ:"/assets/images/pins/pin_2.svg",fixX:"/assets/images/pins/pin_3.svg",fix:"/assets/images/pins/pin_4.svg"},oe=function(e){var t=e.id,n=e.x,r=e.y,a=e.pin,o=void 0===a?"free":a,i=e.tool,l=e.draggable,s=void 0!==l&&l,u=e.onChange,j=e.onCommit,f=e.onEdit,O=Object(c.useState)(!1),p=Object(b.a)(O,2),v=p[0],x=p[1],h=Object(c.useRef)({x:n,y:r}),g=Object(c.useRef)(),y=Object(c.useMemo)((function(){return"".concat("/drawing-sample").concat(ae[o])}),[o]),k=ce()(y),C=Object(b.a)(k,1)[0],S=Object(c.useCallback)((function(){if(s){var e={id:t,x:h.current.x,y:h.current.y};u&&u(e)}}),[s,t,u]),w=Object(c.useCallback)((function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&(h.current=n,x(!0))}),[]),E=Object(c.useCallback)((function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&(h.current=n)}),[]),I=Object(c.useCallback)((function(e){var n,r=null===(n=e.target.getStage())||void 0===n?void 0:n.getPointerPosition();if(r){h.current=r,x(!1),g.current&&(clearInterval(g.current),g.current=void 0);var c={id:t,x:h.current.x,y:h.current.y};j&&j(c)}}),[t,j]),P=Object(c.useCallback)((function(e){"select"===i&&(e.cancelBubble=!0)}),[i]),z=Object(c.useCallback)((function(e){if("select"===i){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();if(n){var r=n.x,c=n.y;f({top:c,left:r})}}}),[f,i]);return Object(c.useEffect)((function(){var e=g.current;return s&&v&&(S(),g.current=setInterval(S,100)),function(){e&&clearInterval(e)}}),[s,v,S]),Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(m.b,{id:t,x:n,y:r,fill:v?"blue":"black",radius:4,draggable:s,onDragStart:w,onDragMove:E,onDragEnd:I,onClick:P,onTap:P,onDblClick:z,onDblTap:z,_useStrictMode:!0}),!v&&"free"!==o&&Object(d.jsx)(m.d,{x:n,y:r,offsetX:12,offsetY:-4,rotation:"pinZ"===o?-90:0,image:C,width:24,height:24,listening:!1})]})},ie=function(e){var t=Object(c.useContext)(A),n=t.tool,r=t.snapSize,a=t.setStructure,o=Object(c.useContext)(K).open,i=Object(c.useMemo)((function(){return"pen"!==n&&Boolean(a)}),[a,n]),l=Object(c.useCallback)((function(e){var t=e.id,n=e.x,c=e.y;if(a){var o=M([n,c],r),i=Object(b.a)(o,2),l=i[0],s=i[1];a((function(e){var n=P(e),r=n.nodes.find((function(e){return e.id===t}));return r&&(r.x=l,r.y=s),n}))}}),[a,r]),s=Object(c.useCallback)((function(e){var t=e.id,n=e.x,c=e.y;if(a){var o=M([n,c],r),i=Object(b.a)(o,2),l=i[0],s=i[1];a((function(e){var n,r,c,a=P(e),o=a.nodes.findIndex((function(e){return e.id===t}));if(o>=0){var i=a.nodes.find((function(e){return e.id!==t&&e.x===l&&e.y===s}));i&&(n=a,r=t,c=i.id,n.beams.forEach((function(e){e.nodeI===r&&(e.nodeI=c),e.nodeJ===r&&(e.nodeJ=c)})),a.nodes.splice(o,1))}return a}))}}),[a,r]),u=Object(c.useCallback)((function(t){o("nodes",t,e)}),[o,e]);return Object(d.jsx)(oe,Object(O.a)(Object(O.a)({},e),{},{draggable:i,tool:n,onChange:l,onCommit:s,onEdit:u}))},le={stroke:"pink",strokeWidth:2},se=Object(O.a)({pointerLength:6,pointerWidth:6,fill:"pink"},le),ue={offsetX:-6,offsetY:14,fontSize:12,wrap:"none",ellipsis:!0},be=function(e){var t=e.beam,n=e.forceI,r=e.forceJ,a=e.distanceI,o=e.distanceJ,i=e.angle,l=void 0===i?90:i,s=e.isGlobal,u=void 0!==s&&s,j=e.tool,f=e.selected,p=void 0!==f&&f,v=e.onDelete,x=e.onSelect,h=e.onEdit,g=Object(c.useState)([]),y=Object(b.a)(g,2),k=y[0],w=y[1],I=Object(c.useState)([0,0,0,0]),P=Object(b.a)(I,2),z=P[0],N=P[1],M=Object(c.useState)(),T=Object(b.a)(M,2),_=T[0],J=T[1],X=Object(c.useState)(),R=Object(b.a)(X,2),D=R[0],F=R[1],W=Object(c.useState)([[0,0],[0,0]]),B=Object(b.a)(W,2),A=B[0],G=B[1];Object(c.useEffect)((function(){var e,c=t.nodeI,i=t.nodeJ,s=new C.a(c.x,c.y),d=new C.a(i.x,i.y),j=d.clone().subtract(s).normalize();e=u?S.clone().rotateDeg(-1*l):j.clone().rotateDeg(-1*l).normalize();var f=s.distance(d),O=s.clone().add(j.clone().multiplyScalar(f*a)),p=d.clone().add(j.clone().invert().multiplyScalar(f*o)),v=O.clone().add(e.clone().multiplyScalar(10*n)),x=p.clone().add(e.clone().multiplyScalar(10*r)),h=function(e,t,n){for(var r=[],c=e.distance(t),a=10,o=c/(a+1);o<25&&a>0;)o=c/(1+--a);if(a>0)for(var i=1;i<=a;i++){var l=e.clone().add(n.clone().multiplyScalar(o*i));r.push(l)}else if((o=c/2)>=10){var s=E(e,t,.5);r.push(s)}return r}(O,p,j),m=x.x-v.x!==0?(x.y-v.y)/(x.x-v.x):NaN,g=isNaN(m)?NaN:v.y-m*v.x,y=[];h.forEach((function(t){var n=function(e,t,n){var r=Object(b.a)(e,4),c=r[0],a=r[1],o=r[2],i=r[3],l=null;try{var s=t.clone().add(n),u=s.x-t.x!==0?(s.y-t.y)/(s.x-t.x):NaN,d=isNaN(u)?NaN:t.y-u*t.x;if(o===u)return null;if(isNaN(o)||isNaN(u)){if(isNaN(o)){var j=c.x;l=[j,j*u+d]}else if(isNaN(u)){var f=t.x;l=[f,f*o+i]}}else{var O=(d-i)/(o-u);l=[O,o*O+i]}if(l){var p=l,v=Object(b.a)(p,2),x=v[0],h=v[1],m=[c.x,a.x].sort((function(e,t){return e-t})),g=[c.y,a.y].sort((function(e,t){return e-t}));if(x>=m[0]&&x<=m[1]&&h>=g[0]&&h<=g[1])return l}return null}catch(y){console.error(y)}return null}([v,x,m,g],t,e);if(n){var r=[n[0],n[1],t.x,t.y];y.push(r)}}));var k=e.angleDeg();J({x:O.x,y:O.y,text:"".concat(n,"kN/m"),width:O.distance(v),rotation:k}),F({x:p.x,y:p.y,text:"".concat(r,"kN/m"),width:p.distance(x),rotation:k});var I=10*Math.max(n,r),P=e.clone().multiplyScalar(I+50),z=O.clone().add(P),M=p.clone().add(P);G([[z.x,z.y],[M.x,M.y]]),N([v.x,v.y,x.x,x.y]),w([[v.x,v.y,O.x,O.y]].concat(y,[[x.x,x.y,p.x,p.y]]))}),[l,t,a,o,n,r,u]);var L=Object(c.useCallback)((function(e){"select"===j?x():"delete"===j&&v(),e.cancelBubble=!0}),[v,x,j]),Y=Object(c.useCallback)((function(e){if("select"===j){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();if(n){var r=n.x,c=n.y;h({top:c,left:r})}}}),[h,j]),Z=Object(c.useMemo)((function(){return p?"red":"pink"}),[p]);return Object(d.jsxs)(m.c,{onClick:L,onTap:L,onDblClick:Y,onDblTap:Y,children:[Object(d.jsx)(m.f,Object(O.a)(Object(O.a)({points:z},le),{},{stroke:Z})),k.map((function(e,t){return Object(d.jsx)(m.a,Object(O.a)(Object(O.a)({points:e},se),{},{stroke:Z,fill:Z}),"arrow_".concat(t))})),p&&Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(m.h,Object(O.a)(Object(O.a)(Object(O.a)({},ue),_),{},{fill:Z})),Object(d.jsx)(m.h,Object(O.a)(Object(O.a)(Object(O.a)({},ue),D),{},{fill:Z})),Object(d.jsx)(ne,{start:A[0],end:A[1]})]})]})},de=function(e){var t=Object(c.useContext)(A),n=t.tool,r=t.deleteTrapezoid,a=Object(c.useContext)(Z),o=a.isSelected,i=a.toggle,l=Object(c.useContext)(K).open,s=Object(c.useCallback)((function(){r(e.id)}),[r,e.id]),u=Object(c.useCallback)((function(){i({type:"trapezoids",id:e.id})}),[e.id,i]),b=Object(c.useCallback)((function(t){var n=Object(O.a)(Object(O.a)({},e),{},{beam:e.beam.id});l("trapezoids",t,n)}),[l,e]);return Object(d.jsx)(be,Object(O.a)(Object(O.a)({},e),{},{tool:n,selected:o({type:"trapezoids",id:e.id}),onDelete:s,onSelect:u,onEdit:b}))},je=25,fe=function(){var e=Object(c.useContext)(A).nodes,t=Object(c.useMemo)((function(){var t={maxX:Number.MIN_SAFE_INTEGER,minX:Number.MAX_SAFE_INTEGER,guidesX:[],maxY:Number.MIN_SAFE_INTEGER,minY:Number.MAX_SAFE_INTEGER,guidesY:[]},n=new Set,r=new Set;if(Object.values(e).forEach((function(e){var c=e.x,a=e.y;t.maxX<c&&(t.maxX=c),t.minX>c&&(t.minX=c),n.has(c)||n.add(c),t.maxY<a&&(t.maxY=a),t.minY>a&&(t.minY=a),r.has(a)||r.add(a)})),n.size>1)for(var c=Array.from(n).sort((function(e,t){return e<t?-1:1})),a=c[0],o=1;o<c.length;o++){var i=c[o],l={key:"LocalGuideX_".concat(o),start:[a,t.maxY+100],end:[i,t.maxY+100]};a=i,t.guidesX.push(l)}if(r.size>1)for(var s=Array.from(r).sort((function(e,t){return e<t?-1:1})),u=s[0],b=Math.max(t.minX-100,50),d=1;d<s.length;d++){var j=s[d],f={key:"LocalGuideY_".concat(d),start:[b,u],end:[b,j]};u=j,t.guidesY.push(f)}return t}),[e]),n=t.minX,r=t.maxX,a=t.guidesX,o=t.minY,i=t.maxY,l=t.guidesY,s=Object(c.useMemo)((function(){return n!==Number.MAX_SAFE_INTEGER?Math.max(je,n-125):0}),[n]),u=Object(c.useMemo)((function(){return i!==Number.MIN_SAFE_INTEGER?i+125:0}),[i]);return Object(d.jsxs)(m.e,{listening:!1,children:[n!==Number.MAX_SAFE_INTEGER&&r!==Number.MIN_SAFE_INTEGER&&Object(d.jsx)(ne,{start:[n,u],end:[r,u]}),a.map((function(e){return Object(d.jsx)(ne,Object(O.a)({},e))})),o!==Number.MAX_SAFE_INTEGER&&i!==Number.MIN_SAFE_INTEGER&&Object(d.jsx)(ne,{start:[s,o],end:[s,i]}),l.map((function(e){return Object(d.jsx)(ne,Object(O.a)({},e))}))]})},Oe=n(87),pe=n(170),ve=n(153),xe=n(162),he=n(171),me=n(167),ge=["values"],ye=function(e){var t=e.force,n=e.onChange,r=e.onClose,a=Object(c.useState)(""),o=Object(b.a)(a,2),i=o[0],l=o[1],s=Object(c.useState)(),u=Object(b.a)(s,2),j=u[0],f=u[1],p=Object(c.useCallback)((function(e){if(e.preventDefault(),e.currentTarget.checkValidity()&&"undefined"===typeof j){var c=parseFloat(i);isNaN(c)||(n(Object(O.a)(Object(O.a)({},t),{},{force:c})),r())}}),[j,n,r,i,t]),v=Object(c.useCallback)((function(e){var t,n=e.currentTarget.value;l(n),0===n.length&&(t="\u6570\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044");var r=parseFloat(n);isNaN(r)&&(t="\u6570\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"),(0>r||r>Number.MAX_SAFE_INTEGER)&&(t="0 \u3088\u308a\u5927\u304d\u3044\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"),f(t)}),[]);return Object(c.useEffect)((function(){l("".concat(t.force)),f(void 0)}),[t]),Object(d.jsx)(pe.a,{children:Object(d.jsxs)(ve.a,{direction:"column",spacing:1,sx:{p:1,width:240},component:"form",autoComplete:"off",noValidate:!0,onSubmit:p,children:[Object(d.jsx)(xe.a,{variant:"outlined",margin:"dense",size:"small",label:"\u96c6\u4e2d\u8377\u91cd",value:i,required:!0,fullWidth:!0,onChange:v,InputProps:{endAdornment:Object(d.jsx)(he.a,{position:"end",children:"kN"})},error:Boolean(j),helperText:j}),Object(d.jsxs)(ve.a,{direction:"row",justifyContent:"flex-end",spacing:1,children:[Object(d.jsx)(me.a,{size:"small",onClick:r,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),Object(d.jsx)(me.a,{type:"submit",size:"small",variant:"contained",children:"OK"})]})]})})},ke=function(e){var t=e.values,n=Object(h.a)(e,ge),r=Object(c.useMemo)((function(){return function(e){if(e&&"object"===typeof e){var t=e;return"string"===typeof t.id&&"string"===typeof t.name&&"string"===typeof t.beam&&"number"===typeof t.force&&"number"===typeof t.distanceI}return!1}(t)?t:{id:"",name:"",beam:"",force:0,distanceI:0}}),[t]);return Object(d.jsx)(ye,Object(O.a)(Object(O.a)({},n),{},{force:r}))},Ce=n(85),Se=n.n(Ce),we=n(89),Ee=n(168),Ie=n(173),Pe=n(172),ze=["title","titleId"];function Ne(){return Ne=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ne.apply(this,arguments)}function Me(e,t){if(null==e)return{};var n,r,c=function(e,t){if(null==e)return{};var n,r,c={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(c[n]=e[n]);return c}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}function Te(e,t){var n=e.title,a=e.titleId,o=Me(e,ze);return c.createElement("svg",Ne({id:"svg",viewBox:"0 0 160 160",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":a},o),n?c.createElement("title",{id:a},n):null,r||(r=c.createElement("path",{d:"M80 0 L30 80 L130 80 Z",strokeWidth:6,stroke:"gray",fill:"transparent"})))}var _e,Je,Xe,Re,De=c.forwardRef(Te),Fe=(n.p,["title","titleId"]);function We(){return We=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},We.apply(this,arguments)}function Be(e,t){if(null==e)return{};var n,r,c=function(e,t){if(null==e)return{};var n,r,c={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(c[n]=e[n]);return c}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}function Ae(e,t){var n=e.title,r=e.titleId,a=Be(e,Fe);return c.createElement("svg",We({id:"svg",viewBox:"0 0 160 160",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},a),n?c.createElement("title",{id:r},n):null,_e||(_e=c.createElement("path",{d:"M80 0 L30 80 L130 80 Z",strokeWidth:6,stroke:"gray",fill:"transparent"})),Je||(Je=c.createElement("circle",{stroke:"gray",strokeWidth:6,fill:"transparent",cx:45,cy:115,r:20})),Xe||(Xe=c.createElement("circle",{stroke:"gray",strokeWidth:6,fill:"transparent",cx:115,cy:115,r:20})),Re||(Re=c.createElement("line",{x1:30,y1:150,x2:130,y2:150,stroke:"gray",strokeWidth:6})))}var Ge,Le,Ye,Ze,Ve=c.forwardRef(Ae),Ue=(n.p,["title","titleId"]);function qe(){return qe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},qe.apply(this,arguments)}function Ke(e,t){if(null==e)return{};var n,r,c=function(e,t){if(null==e)return{};var n,r,c={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(c[n]=e[n]);return c}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}function He(e,t){var n=e.title,r=e.titleId,a=Ke(e,Ue);return c.createElement("svg",qe({id:"svg",style:{width:64},viewBox:"0 0 160 160",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},a),n?c.createElement("title",{id:r},n):null,Ge||(Ge=c.createElement("path",{d:"M30 3 L30 80 L130 80 L130 3 Z",strokeWidth:6,stroke:"gray",fill:"transparent"})),Le||(Le=c.createElement("circle",{stroke:"gray",strokeWidth:6,fill:"transparent",cx:45,cy:115,r:20})),Ye||(Ye=c.createElement("circle",{stroke:"gray",strokeWidth:6,fill:"transparent",cx:115,cy:115,r:20})),Ze||(Ze=c.createElement("line",{x1:30,y1:150,x2:130,y2:150,stroke:"gray",strokeWidth:6})))}var Qe,$e,et,tt,nt,rt=c.forwardRef(He),ct=(n.p,["title","titleId"]);function at(){return at=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},at.apply(this,arguments)}function ot(e,t){if(null==e)return{};var n,r,c=function(e,t){if(null==e)return{};var n,r,c={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(c[n]=e[n]);return c}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}function it(e,t){var n=e.title,r=e.titleId,a=ot(e,ct);return c.createElement("svg",at({id:"svg",style:{width:64},viewBox:"0 0 160 160",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},a),n?c.createElement("title",{id:r},n):null,Qe||(Qe=c.createElement("line",{x1:0,y1:3,x2:160,y2:3,stroke:"gray",strokeWidth:6})),$e||($e=c.createElement("line",{x1:20,y1:0,x2:0,y2:60,stroke:"gray",strokeWidth:6})),et||(et=c.createElement("line",{x1:60,y1:0,x2:40,y2:60,stroke:"gray",strokeWidth:6})),tt||(tt=c.createElement("line",{x1:100,y1:0,x2:80,y2:60,stroke:"gray",strokeWidth:6})),nt||(nt=c.createElement("line",{x1:140,y1:0,x2:120,y2:60,stroke:"gray",strokeWidth:6})))}var lt,st,ut,bt,dt=c.forwardRef(it),jt=(n.p,["values"]),ft={free:{type:"free",icon:Object(d.jsx)(Se.a,{}),label:"\u5b8c\u5168\u30d5\u30ea\u30fc"},pin:{type:"pin",icon:Object(d.jsx)(we.a,{sx:{width:24},viewBox:"0 0 160 160",children:Object(d.jsx)(De,{})}),label:"\u5b8c\u5168\u30d4\u30f3"},pinX:{type:"pinX",icon:Object(d.jsx)(we.a,{sx:{width:24},viewBox:"0 0 160 160",children:Object(d.jsx)(Ve,{})}),label:"\u30d4\u30f3X\u30ed\u30fc\u30e9\u30fc"},pinZ:{type:"pinZ",icon:Object(d.jsx)(we.a,{sx:{width:24,transform:"rotate(-90deg)"},viewBox:"0 0 160 160",children:Object(d.jsx)(Ve,{})}),label:"\u30d4\u30f3Z\u30ed\u30fc\u30e9\u30fc"},fixX:{type:"fixX",icon:Object(d.jsx)(we.a,{sx:{width:24},viewBox:"0 0 160 160",children:Object(d.jsx)(rt,{})}),label:"\u56fa\u5b9aX\u30ed\u30fc\u30e9\u30fc"},fix:{type:"fix",icon:Object(d.jsx)(we.a,{sx:{width:24},viewBox:"0 0 160 160",children:Object(d.jsx)(dt,{})}),label:"\u5b8c\u5168\u56fa\u5b9a"}},Ot={sx:{justifyContent:"flex-start",alignItems:"center"}},pt=function(e){var t=e.node,n=e.onChange,r=e.onClose,a=Object(c.useState)(),o=Object(b.a)(a,2),i=o[0],l=o[1],s=Object(c.useCallback)((function(e){e.preventDefault();var c=Object(O.a)(Object(O.a)({},t),{},{pin:i});n(c),r()}),[t,n,r,i]),u=Object(c.useCallback)((function(e,t){var n;null!==t&&("string"===typeof(n=t)&&v.some((function(e){return e===n})))&&l(t)}),[]);return Object(c.useEffect)((function(){var e;l(null!==(e=t.pin)&&void 0!==e?e:"free")}),[t.pin]),Object(d.jsx)(pe.a,{children:Object(d.jsxs)(ve.a,{direction:"column",spacing:1,sx:{p:1,width:240},component:"form",autoComplete:"off",noValidate:!0,onSubmit:s,children:[Object(d.jsx)(Ee.a,{orientation:"vertical",value:i,size:"small",exclusive:!0,fullWidth:!0,onChange:u,children:Object.entries(ft).map((function(e){var t=Object(b.a)(e,2),n=t[0],r=t[1],c=r.icon,a=r.label;return Object(d.jsxs)(Ie.a,Object(O.a)(Object(O.a)({value:n},Ot),{},{children:[c,Object(d.jsx)(Pe.a,{variant:"caption",sx:{ml:1},children:a})]}),n)}))}),Object(d.jsxs)(ve.a,{direction:"row",justifyContent:"flex-end",spacing:1,children:[Object(d.jsx)(me.a,{size:"small",onClick:r,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),Object(d.jsx)(me.a,{type:"submit",size:"small",variant:"contained",children:"OK"})]})]})})},vt=function(e){var t=e.values,n=Object(h.a)(e,jt),r=Object(c.useMemo)((function(){return function(e){if(e&&"object"===typeof e){var t=e;return"string"===typeof t.id&&"number"===typeof t.x&&"number"===typeof t.y}return!1}(t)?t:{id:"",x:0,y:0}}),[t]);return Object(d.jsx)(pt,Object(O.a)(Object(O.a)({},n),{},{node:r}))},xt=n(3),ht=n(174),mt=n(164),gt=["values"],yt=function(e){if(0===e.length)return[NaN,!1,"\u6570\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"];var t=parseFloat(e);return isNaN(t)?[NaN,!1,"\u6570\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"]:0>=t&&t>Number.MAX_SAFE_INTEGER?[t,!1,"0 \u4ee5\u4e0a\u306e\u6570\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"]:[z(t,3),!0,""]},kt=function(e){if(e.length>0){var t=parseInt(e,10);return isNaN(t)||e.indexOf(".")>=0?[NaN,!1,"\u6574\u6570\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"]:-180>t||180<t?[t,!1,"-180 \u301c 180 \u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"]:(-180===t&&(t=180),[t,!0,""])}return[90,!0,""]},Ct=function(e){var t,n,r,a,o,i,l,s=e.trapezoid,u=e.onChange,j=e.onClose,f=Object(c.useState)({}),p=Object(b.a)(f,2),v=p[0],x=p[1],h=Object(c.useState)({}),m=Object(b.a)(h,2),g=m[0],y=m[1],k=Object(c.useCallback)((function(e){if((e.preventDefault(),e.currentTarget.checkValidity())&&!Object.values(g).some((function(e){return e.length>0}))){var t=function(e){var t,n,r,c,a={forceI:0,forceJ:0,angle:90,isGlobal:!1},o=yt(null!==(t=e.forceI)&&void 0!==t?t:""),i=Object(b.a)(o,2),l=i[0],s=i[1],u=yt(null!==(n=e.forceJ)&&void 0!==n?n:""),d=Object(b.a)(u,2),j=d[0],f=d[1],O=kt(null!==(r=e.angle)&&void 0!==r?r:""),p=Object(b.a)(O,2),v=p[0],x=p[1],h=s&&f&&x;return a.forceI=l,a.forceJ=j,a.angle=v,a.isGlobal=null!==(c=e.isGlobal)&&void 0!==c&&c,[h,a]}(v),n=Object(b.a)(t,2),r=n[0],c=n[1];console.log(r,c),r&&u(Object(O.a)(Object(O.a)({},s),c)),j()}}),[g,u,j,s,v]),C=Object(c.useCallback)((function(e){var t=e.target,n=t.name,r=t.value,c="";switch(n){case"forceI":case"forceJ":var a=yt(r),o=Object(b.a)(a,3),i=o[1],l=o[2];i||(c=l);break;case"angle":var s=kt(r),u=Object(b.a)(s,3),d=u[1],j=u[2];d||(c=j)}y((function(e){return Object(O.a)(Object(O.a)({},e),{},Object(xt.a)({},n,c))})),x((function(e){return Object(O.a)(Object(O.a)({},e),{},Object(xt.a)({},n,r))}))}),[]),S=Object(c.useCallback)((function(e){var t=e.target.checked;x((function(e){return Object(O.a)(Object(O.a)({},e),{},{isGlobal:t})}))}),[]);return Object(c.useEffect)((function(){x(function(e){var t,n={};return n.forceI="".concat(e.forceI),n.forceJ="".concat(e.forceJ),n.angle="".concat(null!==(t=e.angle)&&void 0!==t?t:""),n.isGlobal=e.isGlobal,n}(s)),y({})}),[s]),Object(d.jsx)(pe.a,{children:Object(d.jsxs)(ve.a,{direction:"column",spacing:1,sx:{p:1,width:240},component:"form",autoComplete:"off",noValidate:!0,onSubmit:k,children:[Object(d.jsx)(xe.a,{variant:"outlined",margin:"dense",size:"small",label:"I\u7aef\u5074\u306e\u8377\u91cd",name:"forceI",value:null!==(t=v.forceI)&&void 0!==t?t:"",required:!0,fullWidth:!0,onChange:C,InputProps:{endAdornment:Object(d.jsx)(he.a,{position:"end",children:"kN/m"})},error:Boolean(g.forceI),helperText:null!==(n=g.forceI)&&void 0!==n?n:""}),Object(d.jsx)(xe.a,{variant:"outlined",margin:"dense",size:"small",label:"J\u7aef\u5074\u306e\u8377\u91cd",name:"forceJ",value:null!==(r=v.forceJ)&&void 0!==r?r:"",required:!0,fullWidth:!0,onChange:C,InputProps:{endAdornment:Object(d.jsx)(he.a,{position:"end",children:"kN/m"})},error:Boolean(g.forceJ),helperText:null!==(a=g.forceJ)&&void 0!==a?a:""}),Object(d.jsx)(xe.a,{variant:"outlined",margin:"dense",size:"small",label:"\u89d2\u5ea6",name:"angle",value:null!==(o=v.angle)&&void 0!==o?o:"",fullWidth:!0,onChange:C,InputProps:{endAdornment:Object(d.jsx)(he.a,{position:"end",children:"\xb0"})},error:Boolean(g.angle),helperText:null!==(i=g.angle)&&void 0!==i?i:""}),Object(d.jsx)(ht.a,{label:"\u5168\u4f53\u5ea7\u6a19\u7cfb",control:Object(d.jsx)(mt.a,{name:"isGlobal",size:"small",checked:null!==(l=v.isGlobal)&&void 0!==l&&l,onChange:S})}),Object(d.jsxs)(ve.a,{direction:"row",justifyContent:"flex-end",spacing:1,children:[Object(d.jsx)(me.a,{size:"small",onClick:j,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),Object(d.jsx)(me.a,{type:"submit",size:"small",variant:"contained",children:"OK"})]})]})})},St=function(e){var t=e.values,n=Object(h.a)(e,gt),r=Object(c.useMemo)((function(){return function(e){if(e&&"object"===typeof e){var t=e;return"string"===typeof t.id&&"string"===typeof t.name&&"string"===typeof t.beam&&"number"===typeof t.forceI&&"number"===typeof t.distanceI&&"number"===typeof t.forceJ&&"number"===typeof t.distanceJ}return!1}(t)?t:{id:"",name:"",beam:"",forceI:0,distanceI:0,forceJ:0,distanceJ:0}}),[t]);return Object(d.jsx)(Ct,Object(O.a)(Object(O.a)({},n),{},{trapezoid:r}))},wt=function(){var e=Object(c.useContext)(K),t=e.popupType,n=e.popupPosition,r=e.popupParams,a=e.close,o=Object(c.useContext)(A).setStructure,i=Object(c.useMemo)((function(){var e=n.top,t=n.left;return{style:{zIndex:5e3,top:"".concat(e,"px"),left:"".concat(t,"px")}}}),[n]),l=Object(c.useCallback)((function(e){o&&o((function(t){var n=P(t),r=n.forces.findIndex((function(t){return t.id===e.id}));return r>=0&&(n.forces[r]=Object(O.a)({},e)),n}))}),[o]),s=Object(c.useCallback)((function(e){o&&o((function(t){var n=P(t),r=n.trapezoids.findIndex((function(t){return t.id===e.id}));return r>=0&&(n.trapezoids[r]=Object(O.a)({},e)),n}))}),[o]),u=Object(c.useCallback)((function(e){o&&o((function(t){var n=P(t),r=n.nodes.findIndex((function(t){return t.id===e.id}));return r>=0&&(n.nodes[r]=Object(O.a)({},e)),n}))}),[o]);return"undefined"===typeof t?null:Object(d.jsxs)(Oe.a,{divProps:i,children:["forces"===t&&Object(d.jsx)(ke,{values:null!==r&&void 0!==r?r:{},onClose:a,onChange:l}),"trapezoids"===t&&Object(d.jsx)(St,{values:null!==r&&void 0!==r?r:{},onClose:a,onChange:s}),"nodes"===t&&Object(d.jsx)(vt,{values:null!==r&&void 0!==r?r:{},onClose:a,onChange:u})]})},Et=function(){var e=Object(c.useContext)(A),t=e.nodes,n=e.beams,r=e.forces,a=e.trapezoids;return Object(d.jsxs)(m.e,{children:[Object.entries(n).map((function(e){var t=Object(b.a)(e,2),n=t[0],r=t[1];return Object(d.jsx)(q,Object(O.a)({},r),n)})),Object.entries(t).map((function(e){var t=Object(b.a)(e,2),n=t[0],r=t[1];return Object(d.jsx)(ie,Object(O.a)({},r),n)})),Object.entries(r).map((function(e){var t=Object(b.a)(e,2),n=t[0],r=t[1];return Object(d.jsx)($,Object(O.a)({},r),n)})),Object.entries(a).map((function(e){var t=Object(b.a)(e,2),n=t[0],r=t[1];return Object(d.jsx)(de,Object(O.a)({},r),n)})),Object(d.jsx)(wt,{})]})},It=["points","onPointerDown","onPointerMove","onPointerUp"],Pt=function(e){var t=e.tool,n=e.structure,r=e.size,a=(e.readonly,e.setStructure),o=Object(c.useContext)(Z),i=o.selected,l=o.setSelected,s=Object(c.useContext)(K),u=s.popupType,b=s.setPopupType,j=s.popupPosition,f=s.setPopupPosition,p=s.close,v=Object(c.useContext)(J),x=v.points,g=v.onPointerDown,y=v.onPointerMove,k=v.onPointerUp,C=Object(h.a)(v,It),S=Object(c.useCallback)((function(e){p(),"select"===t&&l([])}),[p,l,t]);return Object(d.jsx)(m.g,{width:r.width,height:r.height,onClick:S,onTap:S,onPointerDown:g,onPointerMove:y,onPointerUp:k,children:Object(d.jsx)(G,{size:r,structure:n,tool:t,setStructure:a,children:Object(d.jsx)(H,{value:{popupType:u,setPopupType:b,popupPosition:j,setPopupPosition:f},children:Object(d.jsx)(V,{value:{selected:i,setSelected:l},children:Object(d.jsxs)(X,{value:Object(O.a)({points:x},C),children:[Object(d.jsx)(Y,{}),Object(d.jsx)(fe,{}),Object(d.jsx)(Et,{}),Object(d.jsx)(D,{})]})})})})})},zt=["tool"],Nt=function(e){var t=e.tool,n=void 0===t?"select":t,r=Object(h.a)(e,zt),a=Object(c.useState)({width:0,height:0}),o=Object(b.a)(a,2),i=o[0],l=o[1],s=Object(c.useState)([]),u=Object(b.a)(s,2),j=u[0],f=u[1],v=Object(c.useState)(),x=Object(b.a)(v,2),m=x[0],g=x[1],y=Object(c.useState)({top:0,left:0}),k=Object(b.a)(y,2),C=k[0],S=k[1],w=Object(c.useState)([]),E=Object(b.a)(w,2),I=E[0],P=E[1],z=Object(c.useRef)(null);return Object(c.useEffect)((function(){var e=new ResizeObserver((function(e){var t=e[0].contentRect,n=t.width,r=t.height;l({width:n,height:r})}));return z.current&&e.observe(z.current),function(){e.disconnect()}}),[]),Object(d.jsx)(p.a,{ref:z,sx:{width:"auto",height:"100%",backgroundColor:"#ffffff",overscrollBehavior:"contain"},children:Object(d.jsx)(H,{value:{popupType:m,setPopupType:g,popupPosition:C,setPopupPosition:S},children:Object(d.jsx)(V,{value:{selected:j,setSelected:f},children:Object(d.jsx)(X,{value:Object(O.a)({points:I,setPoints:P,tool:n},r),children:Object(d.jsx)(Pt,Object(O.a)({size:i,tool:n},r))})})})})},Mt=function(){var e=Object(c.useContext)(j).tool,t=Object(c.useState)(x),n=Object(b.a)(t,2),r=n[0],a=n[1];return Object(d.jsx)(p.a,{sx:{boxSizing:"border-box",ml:1,mb:1,flex:1,border:function(e){return"1px solid ".concat(e.palette.divider)},borderRadius:1,overflow:"hidden"},children:Object(d.jsx)(Nt,{tool:e,structure:r,setStructure:a})})},Tt=n(176),_t=n(177),Jt=null!==(lt=null===(st="7ef9b9ac85b5d0c623bef65801cf172a807fd9aa\n")?void 0:st.substring(0,7))&&void 0!==lt?lt:"",Xt=null!==(ut="2021/12/27 23:00:28")?ut:"",Rt=null!==(bt="0.1.0")?bt:"",Dt=function(){return Object(d.jsx)(Pe.a,{variant:"caption",sx:{ml:2},children:"ver ".concat(Rt," (").concat(Jt,": ").concat(Xt,")")})},Ft=function(){return Object(d.jsx)(Tt.a,{position:"static",children:Object(d.jsxs)(_t.a,{variant:"dense",children:[Object(d.jsx)(Pe.a,{component:"h1",variant:"h6",color:"inherit",children:"Drawing Sample"}),Object(d.jsx)(Dt,{})]})})},Wt=n(156),Bt=n(157),At=n(158),Gt=n(159),Lt=n(160),Yt={select:{tool:"select",icon:Object(d.jsx)(Wt.a,{}),label:"\u9078\u629e"},pen:{tool:"pen",icon:Object(d.jsx)(Bt.a,{}),label:"\u6881\u8981\u7d20\u306e\u63cf\u753b"},force:{tool:"force",icon:Object(d.jsx)(At.a,{}),label:"\u96c6\u4e2d\u8377\u91cd\u306e\u8ffd\u52a0"},trapezoid:{tool:"trapezoid",icon:Object(d.jsx)(Gt.a,{}),label:"\u5206\u5e03\u8377\u91cd\u306e\u8ffd\u52a0"},delete:{tool:"delete",icon:Object(d.jsx)(Lt.a,{}),label:"\u8981\u7d20\u306e\u524a\u9664"}},Zt=function(e){var t=e.tool,n=e.onChange,r=Object(c.useCallback)((function(e,t){var r;null!==t&&("string"===typeof(r=t)&&y.some((function(e){return e===r})))&&n(t)}),[n]);return Object(d.jsxs)(ve.a,{sx:{width:160},alignItems:"flex-start",children:[Object(d.jsx)(Pe.a,{variant:"caption",children:"Toolbox"}),Object(d.jsx)(Ee.a,{orientation:"vertical",value:t,exclusive:!0,fullWidth:!0,onChange:r,children:Object.entries(Yt).map((function(e){var t=Object(b.a)(e,2),n=t[0],r=t[1],c=r.icon,a=r.label;return Object(d.jsxs)(Ie.a,{value:n,sx:{justifyContent:"flex-start",alignItems:"center"},children:[c,Object(d.jsx)(Pe.a,{variant:"caption",sx:{ml:1},children:a})]},n)}))})]})},Vt=function(){var e=Object(c.useContext)(j),t=e.tool,n=e.setTool;return Object(d.jsx)(Zt,{tool:t,onChange:n})},Ut=function(){var e=Object(c.useState)({width:0,height:0}),t=Object(b.a)(e,2),n=t[0],r=t[1],a=Object(c.useCallback)((function(){var e=window,t=e.innerHeight,n=e.innerWidth;r({height:t,width:n})}),[]);return Object(c.useEffect)((function(){return a(),window.addEventListener("resize",a),function(){window.removeEventListener("resize",a)}}),[a]),Object(d.jsxs)(p.a,{sx:Object(O.a)(Object(O.a)({},n),{},{overflow:"hidden"}),children:[Object(d.jsx)(Ft,{}),Object(d.jsxs)(p.a,{sx:{boxSizing:"border-box",width:"auto",height:"calc(100% - 48px)",display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"stretch",pt:1,px:1},children:[Object(d.jsx)(Vt,{}),Object(d.jsx)(Mt,{})]})]})},qt=Object(l.a)(),Kt=function(){return Object(d.jsx)(s.a,{theme:qt,children:Object(d.jsxs)(f,{children:[Object(d.jsx)(u.a,{}),Object(d.jsx)(Ut,{})]})})},Ht=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,178)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),r(e),c(e),a(e),o(e)}))};i.a.render(Object(d.jsx)(a.a.StrictMode,{children:Object(d.jsx)(Kt,{})}),document.getElementById("root")),Ht()}},[[116,1,2]]]);
//# sourceMappingURL=main.346b86c3.chunk.js.map