(this["webpackJsonpdrawing-sample"]=this["webpackJsonpdrawing-sample"]||[]).push([[0],{76:function(e,t,n){"use strict";n.r(t);var r,c,i,o,a=n(0),u=n.n(a),s=n(54),b=n.n(s),d=n(57),l=n(110),j=n(114),f=n(7),O=n(1),x=Object(a.createContext)(void 0),v=function(e){var t=e.children,n=Object(a.useState)("select"),r=Object(f.a)(n,2),c=r[0],i=r[1];return Object(O.jsx)(x.Provider,{value:{tool:c,setTool:i},children:t})},h=n(8),g=n(111),m={unit:{force:"kN",length:"m"},nodes:[],beams:[],forces:[],trapezoids:[]},p=n(26),S=n(10),y=n(17),E=function(e){return JSON.parse(JSON.stringify(e))},w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=Math.pow(10,t),r=Math.round(e*n)/n;return r},C=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,n=e/t,r=Math.round(n)*t;return r},I=function(e){var t=Object(f.a)(e,2),n=t[0],r=t[1],c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25;return[C(n,c),C(r,c)]},k=n(106),z=function(e,t){return{id:Object(k.a)(),x:e,y:t}},M=n(30),N=n.n(M),_=function(e){var t=e.disabled,n=void 0!==t&&t,r=e.snapSize,c=void 0===r?25:r,i=e.structure,o=e.setStructure,u=Object(a.useState)([]),s=Object(f.a)(u,2),b=s[0],d=s[1],l=Object(a.useRef)(!1),j=Object(a.useCallback)((function(e){var t;if(!n){var r=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();r&&(l.current=!0,d([r.x,r.y]))}}),[n]),O=Object(a.useCallback)((function(e){var t;if(!n&&l.current){var r=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();r&&(l.current=!0,d((function(e){return[].concat(Object(y.a)(e),[r.x,r.y])})))}}),[n]),x=Object(a.useCallback)((function(){if(!n&&(l.current=!1,o&&b.length>=4)){var e=E(i),t=b.slice(0,2),r=b.slice(-2),a=I([t[0],t[1]],c),u=I([r[0],r[1]],c),s=z.apply(void 0,Object(y.a)(a)),j=e.nodes.find((function(e){return e.x===s.x&&e.y===s.y}));j?s.id=j.id:e.nodes.push(s);var f=z.apply(void 0,Object(y.a)(u)),O=e.nodes.find((function(e){return e.x===f.x&&e.y===f.y}));O?f.id=O.id:e.nodes.push(f);var x=function(e,t,n){return{id:Object(k.a)(),name:e,nodeI:t,nodeJ:n}}("Beam_".concat(e.beams.length+1),s.id,f.id);e.beams.push(x),o(e),d([])}}),[n,b,o,c,i]);return Object(a.useEffect)((function(){n&&d([])}),[n]),{points:b,onPointerDown:j,onPointerMove:O,onPointerUp:x}},R=function(e){var t=e.points;return Object(O.jsx)(S.d,{children:Object(O.jsx)(S.e,{points:t,strokeWidth:3,stroke:"blue"})})},F=["nodeI","nodeJ"],P=["beam","force"],A=Object(a.createContext)(void 0),X=function(e){var t=e.children,n=e.tool,r=void 0===n?"select":n,c=e.size,i=e.gridSize,o=void 0===i?25:i,u=e.snapSize,s=void 0===u?25:u,b=e.structure,d=e.setStructure,l=Object(a.useMemo)((function(){var e={};return b.nodes.forEach((function(t){e[t.id]=t})),e}),[b.nodes]),j=Object(a.useMemo)((function(){var e={};return b.beams.forEach((function(t){var n=t.nodeI,r=t.nodeJ,c=Object(p.a)(t,F),i=Object(h.a)(Object(h.a)({},c),{},{nodeI:l[n],nodeJ:l[r]});e[c.id]=i})),e}),[l,b.beams]),f=Object(a.useMemo)((function(){var e=b.forces,t={};if(e.length>0){var n=e.map((function(e){return e.force})).reduce((function(e,t){return e+t}))/e.length;e.forEach((function(e){var r=e.beam,c=e.force,i=Object(p.a)(e,P),o=c/n;t[i.id]=Object(h.a)(Object(h.a)({},i),{},{force:c,forceRatio:o,beam:j[r]})}))}return t}),[j,b]),x=Object(a.useCallback)((function(e){var t=E(b),n="Force_".concat(t.forces.length+1),r=function(e){return Object(h.a)(Object(h.a)({},e),{},{id:Object(k.a)()})}(Object(h.a)({name:n},e));t.forces.push(r),d&&d(t)}),[d,b]),v=Object(a.useCallback)((function(e){var t=b.forces.findIndex((function(t){return t.id===e}));if(t>=0){var n=E(b);n.forces.splice(t,1),d&&d(n)}}),[d,b]),g=Object(a.useCallback)((function(e){var t=b.beams.findIndex((function(t){return t.id===e}));if(t>=0){var n=b.beams[t],r=n.nodeI,c=n.nodeJ,i=E(b);i.beams.splice(t,1),[r,c].forEach((function(e){var t=i.beams.some((function(t){var n=t.nodeI,r=t.nodeJ;return e===n||e===r}));if(!t){var n=i.nodes.findIndex((function(t){return t.id===e}));n>=0&&i.nodes.splice(n,1)}}));var o=i.forces.filter((function(t){return t.beam!==e}));i.forces=o;var a=i.trapezoids.filter((function(t){return t.beam!==e}));i.trapezoids=a,d&&d(i)}}),[d,b]);return Object(O.jsx)(A.Provider,{value:{tool:r,size:c,gridSize:o,snapSize:s,structure:b,nodes:l,beams:j,forces:f,addForce:x,deleteForce:v,deleteBeam:g,setStructure:d},children:t})},T={id:"",points:[],stroke:"#c9e1ff",strokeWidth:1,dash:[5,3],listening:!1},J=function(){var e=Object(a.useContext)(A),t=e.size,n=e.gridSize,r=Object(a.useMemo)((function(){for(var e=[],r=1,c=0;c<=t.height;c+=n)e.push(Object(h.a)(Object(h.a)({},T),{},{id:"Horizontal_".concat(r),points:[0,c,t.width,c]})),r++;return e}),[n,t.height,t.width]),c=Object(a.useMemo)((function(){for(var e=[],r=1,c=0;c<=t.width;c+=n)e.push(Object(h.a)(Object(h.a)({},T),{},{id:"Vertical_".concat(r),points:[c,0,c,t.height]})),r++;return e}),[n,t.height,t.width]);return Object(O.jsxs)(S.d,{listening:!1,children:[r.map((function(e){return Object(O.jsx)(S.e,Object(h.a)({},e),e.id)})),c.map((function(e){return Object(O.jsx)(S.e,Object(h.a)({},e),e.id)}))]})},Y={fill:"silver",stroke:"silver",strokeWidth:1,listening:!1},G=Object(h.a)({pointerLength:6,pointerWidth:6,pointerAtBeginning:!0},Y),B=function(e){var t=e.start,n=e.end,r=Object(a.useRef)(new N.a(0,0)),c=Object(a.useRef)(new N.a(0,0)),i=Object(a.useState)(0),o=Object(f.a)(i,2),u=o[0],s=o[1],b=Object(a.useState)(0),d=Object(f.a)(b,2),l=d[0],j=d[1],x=Object(a.useState)([0,0]),v=Object(f.a)(x,2),g=v[0],m=v[1];return Object(a.useEffect)((function(){r.current.x=t[0],r.current.y=t[1],c.current.x=n[0],c.current.y=n[1];var e=r.current.distance(c.current),i=c.current.clone().subtract(r.current).normalize().angleDeg();s(e),j(90===i?-90:i),m(90===i?n:t)}),[n,t]),Object(O.jsxs)(S.c,{x:g[0],y:g[1],rotation:l,children:[Object(O.jsx)(S.e,Object(h.a)({points:[0,0,0,10]},Y)),Object(O.jsx)(S.a,Object(h.a)({points:[0,5,u,5]},G)),Object(O.jsx)(S.e,Object(h.a)({points:[u,0,u,10]},Y)),Object(O.jsx)(S.g,{x:0,y:-8,text:"".concat(u,"px"),fontSize:12,fill:"silver",width:u,align:"center",listening:!1,wrap:"none",ellipsis:!0})]})},W=25,D=function(){var e=Object(a.useContext)(A).nodes,t=Object(a.useMemo)((function(){var t={maxX:Number.MIN_SAFE_INTEGER,minX:Number.MAX_SAFE_INTEGER,guidesX:[],maxY:Number.MIN_SAFE_INTEGER,minY:Number.MAX_SAFE_INTEGER,guidesY:[]},n=new Set,r=new Set;if(Object.values(e).forEach((function(e){var c=e.x,i=e.y;t.maxX<c&&(t.maxX=c),t.minX>c&&(t.minX=c),n.has(c)||n.add(c),t.maxY<i&&(t.maxY=i),t.minY>i&&(t.minY=i),r.has(i)||r.add(i)})),n.size>1)for(var c=Array.from(n).sort((function(e,t){return e<t?-1:1})),i=c[0],o=1;o<c.length;o++){var a=c[o],u={key:"LocalGuideX_".concat(o),start:[i,t.maxY+100],end:[a,t.maxY+100]};i=a,t.guidesX.push(u)}if(r.size>1)for(var s=Array.from(r).sort((function(e,t){return e<t?-1:1})),b=s[0],d=Math.max(t.minX-100,50),l=1;l<s.length;l++){var j=s[l],f={key:"LocalGuideY_".concat(l),start:[d,b],end:[d,j]};b=j,t.guidesY.push(f)}return t}),[e]),n=t.minX,r=t.maxX,c=t.guidesX,i=t.minY,o=t.maxY,u=t.guidesY,s=Object(a.useMemo)((function(){return n!==Number.MAX_SAFE_INTEGER?Math.max(W,n-125):0}),[n]),b=Object(a.useMemo)((function(){return o!==Number.MIN_SAFE_INTEGER?o+125:0}),[o]);return Object(O.jsxs)(S.d,{listening:!1,children:[n!==Number.MAX_SAFE_INTEGER&&r!==Number.MIN_SAFE_INTEGER&&Object(O.jsx)(B,{start:[n,b],end:[r,b]}),c.map((function(e){return Object(O.jsx)(B,Object(h.a)({},e))})),i!==Number.MAX_SAFE_INTEGER&&o!==Number.MIN_SAFE_INTEGER&&Object(O.jsx)(B,{start:[s,i],end:[s,o]}),u.map((function(e){return Object(O.jsx)(B,Object(h.a)({},e))}))]})},L=function(e){var t=e.id,n=e.nodeI,r=e.nodeJ,c=Object(a.useContext)(A),i=c.tool,o=c.addForce,u=c.deleteBeam,s=Object(a.useState)([]),b=Object(f.a)(s,2),d=b[0],l=b[1],j=Object(a.useRef)(new N.a(0,0)),x=Object(a.useRef)(new N.a(0,0)),v=Object(a.useCallback)((function(e){if("force"===i){var n,r=null===(n=e.target.getStage())||void 0===n?void 0:n.getPointerPosition();if(r){var c=new N.a(r.x,r.y),a=function(e,t,n,r){var c=t.distance(n),i=t.distance(r);return{beam:e,force:10,distanceI:w(i/c)}}(t,j.current,x.current,c);o(a),e.cancelBubble=!0}}else"delete"===i&&(u(t),e.cancelBubble=!0)}),[o,t,u,i]);return Object(a.useEffect)((function(){l([n.x,n.y,r.x,r.y]),j.current.x=n.x,j.current.y=n.y,x.current.x=r.x,x.current.y=r.y}),[n.x,n.y,r.x,r.y]),Object(O.jsx)(S.e,{points:d,stroke:"black",strokeWidth:3,onClick:v,onTap:v})},H=function(e){var t=e.id,n=e.beam,r=e.distanceI,c=e.forceRatio,i=Object(a.useContext)(A),o=i.deleteForce,u=i.tool,s=Object(a.useMemo)((function(){var e=n.nodeI,t=n.nodeJ,i=new N.a(e.x,e.y),o=new N.a(t.x,t.y),a=function(e,t,n){var r=t.clone().subtract(e).normalize(),c=e.distance(t),i=r.multiplyScalar(c*n);return e.clone().add(i)}(i,o,r),u=function(e,t){var n=t.clone().subtract(e).normalize();return new N.a(n.y,-1*n.x).normalize()}(i,o),s=a.clone().add(u.multiplyScalar(30*c));return[s.x,s.y,a.x,a.y]}),[n,r,c]),b=Object(a.useCallback)((function(e){"delete"===u&&(o(t),e.cancelBubble=!0)}),[o,t,u]);return Object(O.jsx)(S.a,{points:s,pointerLength:6,pointerWidth:6,fill:"orange",stroke:"orange",strokeWidth:2,onClick:b,onTap:b})},U=function(e){var t=e.id,n=e.x,r=e.y,c=e.draggable,i=void 0!==c&&c,o=e.onChange,u=e.onCommit,s=Object(a.useState)(!1),b=Object(f.a)(s,2),d=b[0],l=b[1],j=Object(a.useRef)({x:n,y:r}),x=Object(a.useRef)(),v=Object(a.useCallback)((function(){if(i){var e={id:t,x:j.current.x,y:j.current.y};o&&o(e)}}),[i,t,o]),h=Object(a.useCallback)((function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&(j.current=n,l(!0))}),[]),g=Object(a.useCallback)((function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();n&&(j.current=n)}),[]),m=Object(a.useCallback)((function(e){var n,r=null===(n=e.target.getStage())||void 0===n?void 0:n.getPointerPosition();if(r){j.current=r,l(!1),x.current&&(clearInterval(x.current),x.current=void 0);var c={id:t,x:j.current.x,y:j.current.y};u&&u(c)}}),[t,u]);return Object(a.useEffect)((function(){var e=x.current;return i&&d&&(v(),x.current=setInterval(v,100)),function(){e&&clearInterval(e)}}),[i,d,v]),Object(O.jsx)(S.b,{id:t,x:n,y:r,fill:d?"blue":"black",radius:4,draggable:i,onDragStart:h,onDragMove:g,onDragEnd:m,_useStrictMode:!0})},V=function(e){var t=Object(a.useContext)(A),n=t.tool,r=t.snapSize,c=t.setStructure,i=Object(a.useMemo)((function(){return"pen"!==n&&Boolean(c)}),[c,n]),o=Object(a.useCallback)((function(e){var t=e.id,n=e.x,i=e.y;if(c){var o=I([n,i],r),a=Object(f.a)(o,2),u=a[0],s=a[1];c((function(e){var n=E(e),r=n.nodes.find((function(e){return e.id===t}));return r&&(r.x=u,r.y=s),n}))}}),[c,r]),u=Object(a.useCallback)((function(e){var t=e.id,n=e.x,i=e.y;if(c){var o=I([n,i],r),a=Object(f.a)(o,2),u=a[0],s=a[1];c((function(e){var n,r,c,i=E(e),o=i.nodes.findIndex((function(e){return e.id===t}));if(o>=0){var a=i.nodes.find((function(e){return e.id!==t&&e.x===u&&e.y===s}));a&&(n=i,r=t,c=a.id,n.beams.forEach((function(e){e.nodeI===r&&(e.nodeI=c),e.nodeJ===r&&(e.nodeJ=c)})),i.nodes.splice(o,1))}return i}))}}),[c,r]);return Object(O.jsx)(U,Object(h.a)(Object(h.a)({},e),{},{draggable:i,onChange:o,onCommit:u}))},q=function(){var e=Object(a.useContext)(A),t=e.nodes,n=e.beams,r=e.forces;return Object(O.jsxs)(S.d,{children:[Object.entries(n).map((function(e){var t=Object(f.a)(e,2),n=t[0],r=t[1];return Object(O.jsx)(L,Object(h.a)({},r),n)})),Object.entries(t).map((function(e){var t=Object(f.a)(e,2),n=t[0],r=t[1];return Object(O.jsx)(V,Object(h.a)({},r),n)})),Object.entries(r).map((function(e){var t=Object(f.a)(e,2),n=t[0],r=t[1];return Object(O.jsx)(H,Object(h.a)({},r),n)}))]})},K=["points"],Q=function(e){var t=e.tool,n=e.structure,r=e.size,c=e.readonly,i=void 0!==c&&c,o=e.setStructure,a=_({disabled:i||"pen"!==t,structure:n,setStructure:o}),u=a.points,s=Object(p.a)(a,K);return Object(O.jsx)(S.f,Object(h.a)(Object(h.a)({width:r.width,height:r.height},s),{},{children:Object(O.jsxs)(X,{size:r,structure:n,tool:t,setStructure:o,children:[Object(O.jsx)(J,{}),Object(O.jsx)(D,{}),Object(O.jsx)(q,{}),Object(O.jsx)(R,{points:u})]})}))},Z=["tool"],$=function(e){var t=e.tool,n=void 0===t?"select":t,r=Object(p.a)(e,Z),c=Object(a.useState)({width:0,height:0}),i=Object(f.a)(c,2),o=i[0],u=i[1],s=Object(a.useRef)(null);return Object(a.useEffect)((function(){var e=new ResizeObserver((function(e){var t=e[0].contentRect,n=t.width,r=t.height;u({width:n,height:r})}));return s.current&&e.observe(s.current),function(){e.disconnect()}}),[]),Object(O.jsx)(g.a,{ref:s,sx:{width:"auto",height:"100%",backgroundColor:"#ffffff",overscrollBehavior:"contain"},children:Object(O.jsx)(Q,Object(h.a)({size:o,tool:n},r))})},ee=function(){var e=Object(a.useContext)(x).tool,t=Object(a.useState)(m),n=Object(f.a)(t,2),r=n[0],c=n[1];return Object(O.jsx)(g.a,{sx:{boxSizing:"border-box",ml:1,mb:1,flex:1,border:function(e){return"1px solid ".concat(e.palette.divider)},borderRadius:1,overflow:"hidden"},children:Object(O.jsx)($,{tool:e,structure:r,setStructure:c})})},te=n(107),ne=n(113),re=n(112),ce=null!==(r=null===(c="e32187634ab46722eb935db88c80467cda5d03e6\n")?void 0:c.substring(0,7))&&void 0!==r?r:"",ie=null!==(i="2021/12/21 09:46:06")?i:"",oe=null!==(o="0.1.0")?o:"",ae=function(){return Object(O.jsx)(re.a,{variant:"caption",sx:{ml:2},children:"ver ".concat(oe," (").concat(ce,": ").concat(ie,")")})},ue=function(){return Object(O.jsx)(te.a,{position:"static",children:Object(O.jsxs)(ne.a,{variant:"dense",children:[Object(O.jsx)(re.a,{component:"h1",variant:"h6",color:"inherit",children:"Drawing Sample"}),Object(O.jsx)(ae,{})]})})},se=n(98),be=n(99),de=n(100),le=n(101),je=n(102),fe=n(103),Oe=n(109),xe=n(105),ve=["select","pen","force","trapezoid","delete"],he={select:{tool:"select",icon:Object(O.jsx)(se.a,{}),label:"\u9078\u629e"},pen:{tool:"pen",icon:Object(O.jsx)(be.a,{}),label:"\u6881\u8981\u7d20\u306e\u63cf\u753b"},force:{tool:"force",icon:Object(O.jsx)(de.a,{}),label:"\u96c6\u4e2d\u8377\u91cd\u306e\u8ffd\u52a0"},trapezoid:{tool:"trapezoid",icon:Object(O.jsx)(le.a,{}),label:"\u5206\u5e03\u8377\u91cd\u306e\u8ffd\u52a0"},delete:{tool:"delete",icon:Object(O.jsx)(je.a,{}),label:"\u8981\u7d20\u306e\u524a\u9664"}},ge=function(e){var t=e.tool,n=e.onChange,r=Object(a.useCallback)((function(e,t){var r;null!==t&&("string"===typeof(r=t)&&ve.some((function(e){return e===r})))&&n(t)}),[n]);return Object(O.jsxs)(fe.a,{sx:{width:160},alignItems:"flex-start",children:[Object(O.jsx)(re.a,{variant:"caption",children:"Toolbox"}),Object(O.jsx)(Oe.a,{orientation:"vertical",value:t,exclusive:!0,fullWidth:!0,onChange:r,children:Object.entries(he).map((function(e){var t=Object(f.a)(e,2),n=t[0],r=t[1],c=r.icon,i=r.label;return Object(O.jsxs)(xe.a,{value:n,sx:{justifyContent:"flex-start",alignItems:"center"},children:[c,Object(O.jsx)(re.a,{variant:"caption",sx:{ml:1},children:i})]},n)}))})]})},me=function(){var e=Object(a.useContext)(x),t=e.tool,n=e.setTool;return Object(O.jsx)(ge,{tool:t,onChange:n})},pe=function(){var e=Object(a.useState)({width:0,height:0}),t=Object(f.a)(e,2),n=t[0],r=t[1],c=Object(a.useCallback)((function(){var e=window,t=e.innerHeight,n=e.innerWidth;r({height:t,width:n})}),[]);return Object(a.useEffect)((function(){return c(),window.addEventListener("resize",c),function(){window.removeEventListener("resize",c)}}),[c]),Object(O.jsxs)(g.a,{sx:Object(h.a)(Object(h.a)({},n),{},{overflow:"hidden"}),children:[Object(O.jsx)(ue,{}),Object(O.jsxs)(g.a,{sx:{boxSizing:"border-box",width:"auto",height:"calc(100% - 48px)",display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"stretch",pt:1,px:1},children:[Object(O.jsx)(me,{}),Object(O.jsx)(ee,{})]})]})},Se=Object(d.a)(),ye=function(){return Object(O.jsx)(l.a,{theme:Se,children:Object(O.jsxs)(v,{children:[Object(O.jsx)(j.a,{}),Object(O.jsx)(pe,{})]})})},Ee=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,115)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),r(e),c(e),i(e),o(e)}))};b.a.render(Object(O.jsx)(u.a.StrictMode,{children:Object(O.jsx)(ye,{})}),document.getElementById("root")),Ee()}},[[76,1,2]]]);
//# sourceMappingURL=main.e00d7ab6.chunk.js.map